/*! jQuery v1.7.1 jquery.com | jquery.org/license */
(function(a,b){function cy(a){return f.isWindow(a)?a:a.nodeType===9?a.defaultView||a.parentWindow:!1}function cv(a){if(!ck[a]){var b=c.body,d=f("<"+a+">").appendTo(b),e=d.css("display");d.remove();if(e==="none"||e===""){cl||(cl=c.createElement("iframe"),cl.frameBorder=cl.width=cl.height=0),b.appendChild(cl);if(!cm||!cl.createElement)cm=(cl.contentWindow||cl.contentDocument).document,cm.write((c.compatMode==="CSS1Compat"?"<!doctype html>":"")+"<html><body>"),cm.close();d=cm.createElement(a),cm.body.appendChild(d),e=f.css(d,"display"),b.removeChild(cl)}ck[a]=e}return ck[a]}function cu(a,b){var c={};f.each(cq.concat.apply([],cq.slice(0,b)),function(){c[this]=a});return c}function ct(){cr=b}function cs(){setTimeout(ct,0);return cr=f.now()}function cj(){try{return new a.ActiveXObject("Microsoft.XMLHTTP")}catch(b){}}function ci(){try{return new a.XMLHttpRequest}catch(b){}}function cc(a,c){a.dataFilter&&(c=a.dataFilter(c,a.dataType));var d=a.dataTypes,e={},g,h,i=d.length,j,k=d[0],l,m,n,o,p;for(g=1;g<i;g++){if(g===1)for(h in a.converters)typeof h=="string"&&(e[h.toLowerCase()]=a.converters[h]);l=k,k=d[g];if(k==="*")k=l;else if(l!=="*"&&l!==k){m=l+" "+k,n=e[m]||e["* "+k];if(!n){p=b;for(o in e){j=o.split(" ");if(j[0]===l||j[0]==="*"){p=e[j[1]+" "+k];if(p){o=e[o],o===!0?n=p:p===!0&&(n=o);break}}}}!n&&!p&&f.error("No conversion from "+m.replace(" "," to ")),n!==!0&&(c=n?n(c):p(o(c)))}}return c}function cb(a,c,d){var e=a.contents,f=a.dataTypes,g=a.responseFields,h,i,j,k;for(i in g)i in d&&(c[g[i]]=d[i]);while(f[0]==="*")f.shift(),h===b&&(h=a.mimeType||c.getResponseHeader("content-type"));if(h)for(i in e)if(e[i]&&e[i].test(h)){f.unshift(i);break}if(f[0]in d)j=f[0];else{for(i in d){if(!f[0]||a.converters[i+" "+f[0]]){j=i;break}k||(k=i)}j=j||k}if(j){j!==f[0]&&f.unshift(j);return d[j]}}function ca(a,b,c,d){if(f.isArray(b))f.each(b,function(b,e){c||bE.test(a)?d(a,e):ca(a+"["+(typeof e=="object"||f.isArray(e)?b:"")+"]",e,c,d)});else if(!c&&b!=null&&typeof b=="object")for(var e in b)ca(a+"["+e+"]",b[e],c,d);else d(a,b)}function b_(a,c){var d,e,g=f.ajaxSettings.flatOptions||{};for(d in c)c[d]!==b&&((g[d]?a:e||(e={}))[d]=c[d]);e&&f.extend(!0,a,e)}function b$(a,c,d,e,f,g){f=f||c.dataTypes[0],g=g||{},g[f]=!0;var h=a[f],i=0,j=h?h.length:0,k=a===bT,l;for(;i<j&&(k||!l);i++)l=h[i](c,d,e),typeof l=="string"&&(!k||g[l]?l=b:(c.dataTypes.unshift(l),l=b$(a,c,d,e,l,g)));(k||!l)&&!g["*"]&&(l=b$(a,c,d,e,"*",g));return l}function bZ(a){return function(b,c){typeof b!="string"&&(c=b,b="*");if(f.isFunction(c)){var d=b.toLowerCase().split(bP),e=0,g=d.length,h,i,j;for(;e<g;e++)h=d[e],j=/^\+/.test(h),j&&(h=h.substr(1)||"*"),i=a[h]=a[h]||[],i[j?"unshift":"push"](c)}}}function bC(a,b,c){var d=b==="width"?a.offsetWidth:a.offsetHeight,e=b==="width"?bx:by,g=0,h=e.length;if(d>0){if(c!=="border")for(;g<h;g++)c||(d-=parseFloat(f.css(a,"padding"+e[g]))||0),c==="margin"?d+=parseFloat(f.css(a,c+e[g]))||0:d-=parseFloat(f.css(a,"border"+e[g]+"Width"))||0;return d+"px"}d=bz(a,b,b);if(d<0||d==null)d=a.style[b]||0;d=parseFloat(d)||0;if(c)for(;g<h;g++)d+=parseFloat(f.css(a,"padding"+e[g]))||0,c!=="padding"&&(d+=parseFloat(f.css(a,"border"+e[g]+"Width"))||0),c==="margin"&&(d+=parseFloat(f.css(a,c+e[g]))||0);return d+"px"}function bp(a,b){b.src?f.ajax({url:b.src,async:!1,dataType:"script"}):f.globalEval((b.text||b.textContent||b.innerHTML||"").replace(bf,"/*$0*/")),b.parentNode&&b.parentNode.removeChild(b)}function bo(a){var b=c.createElement("div");bh.appendChild(b),b.innerHTML=a.outerHTML;return b.firstChild}function bn(a){var b=(a.nodeName||"").toLowerCase();b==="input"?bm(a):b!=="script"&&typeof a.getElementsByTagName!="undefined"&&f.grep(a.getElementsByTagName("input"),bm)}function bm(a){if(a.type==="checkbox"||a.type==="radio")a.defaultChecked=a.checked}function bl(a){return typeof a.getElementsByTagName!="undefined"?a.getElementsByTagName("*"):typeof a.querySelectorAll!="undefined"?a.querySelectorAll("*"):[]}function bk(a,b){var c;if(b.nodeType===1){b.clearAttributes&&b.clearAttributes(),b.mergeAttributes&&b.mergeAttributes(a),c=b.nodeName.toLowerCase();if(c==="object")b.outerHTML=a.outerHTML;else if(c!=="input"||a.type!=="checkbox"&&a.type!=="radio"){if(c==="option")b.selected=a.defaultSelected;else if(c==="input"||c==="textarea")b.defaultValue=a.defaultValue}else a.checked&&(b.defaultChecked=b.checked=a.checked),b.value!==a.value&&(b.value=a.value);b.removeAttribute(f.expando)}}function bj(a,b){if(b.nodeType===1&&!!f.hasData(a)){var c,d,e,g=f._data(a),h=f._data(b,g),i=g.events;if(i){delete h.handle,h.events={};for(c in i)for(d=0,e=i[c].length;d<e;d++)f.event.add(b,c+(i[c][d].namespace?".":"")+i[c][d].namespace,i[c][d],i[c][d].data)}h.data&&(h.data=f.extend({},h.data))}}function bi(a,b){return f.nodeName(a,"table")?a.getElementsByTagName("tbody")[0]||a.appendChild(a.ownerDocument.createElement("tbody")):a}function U(a){var b=V.split("|"),c=a.createDocumentFragment();if(c.createElement)while(b.length)c.createElement(b.pop());return c}function T(a,b,c){b=b||0;if(f.isFunction(b))return f.grep(a,function(a,d){var e=!!b.call(a,d,a);return e===c});if(b.nodeType)return f.grep(a,function(a,d){return a===b===c});if(typeof b=="string"){var d=f.grep(a,function(a){return a.nodeType===1});if(O.test(b))return f.filter(b,d,!c);b=f.filter(b,d)}return f.grep(a,function(a,d){return f.inArray(a,b)>=0===c})}function S(a){return!a||!a.parentNode||a.parentNode.nodeType===11}function K(){return!0}function J(){return!1}function n(a,b,c){var d=b+"defer",e=b+"queue",g=b+"mark",h=f._data(a,d);h&&(c==="queue"||!f._data(a,e))&&(c==="mark"||!f._data(a,g))&&setTimeout(function(){!f._data(a,e)&&!f._data(a,g)&&(f.removeData(a,d,!0),h.fire())},0)}function m(a){for(var b in a){if(b==="data"&&f.isEmptyObject(a[b]))continue;if(b!=="toJSON")return!1}return!0}function l(a,c,d){if(d===b&&a.nodeType===1){var e="data-"+c.replace(k,"-$1").toLowerCase();d=a.getAttribute(e);if(typeof d=="string"){try{d=d==="true"?!0:d==="false"?!1:d==="null"?null:f.isNumeric(d)?parseFloat(d):j.test(d)?f.parseJSON(d):d}catch(g){}f.data(a,c,d)}else d=b}return d}function h(a){var b=g[a]={},c,d;a=a.split(/\s+/);for(c=0,d=a.length;c<d;c++)b[a[c]]=!0;return b}var c=a.document,d=a.navigator,e=a.location,f=function(){function J(){if(!e.isReady){try{c.documentElement.doScroll("left")}catch(a){setTimeout(J,1);return}e.ready()}}var e=function(a,b){return new e.fn.init(a,b,h)},f=a.jQuery,g=a.$,h,i=/^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/,j=/\S/,k=/^\s+/,l=/\s+$/,m=/^<(\w+)\s*\/?>(?:<\/\1>)?$/,n=/^[\],:{}\s]*$/,o=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,p=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,q=/(?:^|:|,)(?:\s*\[)+/g,r=/(webkit)[ \/]([\w.]+)/,s=/(opera)(?:.*version)?[ \/]([\w.]+)/,t=/(msie) ([\w.]+)/,u=/(mozilla)(?:.*? rv:([\w.]+))?/,v=/-([a-z]|[0-9])/ig,w=/^-ms-/,x=function(a,b){return(b+"").toUpperCase()},y=d.userAgent,z,A,B,C=Object.prototype.toString,D=Object.prototype.hasOwnProperty,E=Array.prototype.push,F=Array.prototype.slice,G=String.prototype.trim,H=Array.prototype.indexOf,I={};e.fn=e.prototype={constructor:e,init:function(a,d,f){var g,h,j,k;if(!a)return this;if(a.nodeType){this.context=this[0]=a,this.length=1;return this}if(a==="body"&&!d&&c.body){this.context=c,this[0]=c.body,this.selector=a,this.length=1;return this}if(typeof a=="string"){a.charAt(0)!=="<"||a.charAt(a.length-1)!==">"||a.length<3?g=i.exec(a):g=[null,a,null];if(g&&(g[1]||!d)){if(g[1]){d=d instanceof e?d[0]:d,k=d?d.ownerDocument||d:c,j=m.exec(a),j?e.isPlainObject(d)?(a=[c.createElement(j[1])],e.fn.attr.call(a,d,!0)):a=[k.createElement(j[1])]:(j=e.buildFragment([g[1]],[k]),a=(j.cacheable?e.clone(j.fragment):j.fragment).childNodes);return e.merge(this,a)}h=c.getElementById(g[2]);if(h&&h.parentNode){if(h.id!==g[2])return f.find(a);this.length=1,this[0]=h}this.context=c,this.selector=a;return this}return!d||d.jquery?(d||f).find(a):this.constructor(d).find(a)}if(e.isFunction(a))return f.ready(a);a.selector!==b&&(this.selector=a.selector,this.context=a.context);return e.makeArray(a,this)},selector:"",jquery:"1.7.1",length:0,size:function(){return this.length},toArray:function(){return F.call(this,0)},get:function(a){return a==null?this.toArray():a<0?this[this.length+a]:this[a]},pushStack:function(a,b,c){var d=this.constructor();e.isArray(a)?E.apply(d,a):e.merge(d,a),d.prevObject=this,d.context=this.context,b==="find"?d.selector=this.selector+(this.selector?" ":"")+c:b&&(d.selector=this.selector+"."+b+"("+c+")");return d},each:function(a,b){return e.each(this,a,b)},ready:function(a){e.bindReady(),A.add(a);return this},eq:function(a){a=+a;return a===-1?this.slice(a):this.slice(a,a+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},slice:function(){return this.pushStack(F.apply(this,arguments),"slice",F.call(arguments).join(","))},map:function(a){return this.pushStack(e.map(this,function(b,c){return a.call(b,c,b)}))},end:function(){return this.prevObject||this.constructor(null)},push:E,sort:[].sort,splice:[].splice},e.fn.init.prototype=e.fn,e.extend=e.fn.extend=function(){var a,c,d,f,g,h,i=arguments[0]||{},j=1,k=arguments.length,l=!1;typeof i=="boolean"&&(l=i,i=arguments[1]||{},j=2),typeof i!="object"&&!e.isFunction(i)&&(i={}),k===j&&(i=this,--j);for(;j<k;j++)if((a=arguments[j])!=null)for(c in a){d=i[c],f=a[c];if(i===f)continue;l&&f&&(e.isPlainObject(f)||(g=e.isArray(f)))?(g?(g=!1,h=d&&e.isArray(d)?d:[]):h=d&&e.isPlainObject(d)?d:{},i[c]=e.extend(l,h,f)):f!==b&&(i[c]=f)}return i},e.extend({noConflict:function(b){a.$===e&&(a.$=g),b&&a.jQuery===e&&(a.jQuery=f);return e},isReady:!1,readyWait:1,holdReady:function(a){a?e.readyWait++:e.ready(!0)},ready:function(a){if(a===!0&&!--e.readyWait||a!==!0&&!e.isReady){if(!c.body)return setTimeout(e.ready,1);e.isReady=!0;if(a!==!0&&--e.readyWait>0)return;A.fireWith(c,[e]),e.fn.trigger&&e(c).trigger("ready").off("ready")}},bindReady:function(){if(!A){A=e.Callbacks("once memory");if(c.readyState==="complete")return setTimeout(e.ready,1);if(c.addEventListener)c.addEventListener("DOMContentLoaded",B,!1),a.addEventListener("load",e.ready,!1);else if(c.attachEvent){c.attachEvent("onreadystatechange",B),a.attachEvent("onload",e.ready);var b=!1;try{b=a.frameElement==null}catch(d){}c.documentElement.doScroll&&b&&J()}}},isFunction:function(a){return e.type(a)==="function"},isArray:Array.isArray||function(a){return e.type(a)==="array"},isWindow:function(a){return a&&typeof a=="object"&&"setInterval"in a},isNumeric:function(a){return!isNaN(parseFloat(a))&&isFinite(a)},type:function(a){return a==null?String(a):I[C.call(a)]||"object"},isPlainObject:function(a){if(!a||e.type(a)!=="object"||a.nodeType||e.isWindow(a))return!1;try{if(a.constructor&&!D.call(a,"constructor")&&!D.call(a.constructor.prototype,"isPrototypeOf"))return!1}catch(c){return!1}var d;for(d in a);return d===b||D.call(a,d)},isEmptyObject:function(a){for(var b in a)return!1;return!0},error:function(a){throw new Error(a)},parseJSON:function(b){if(typeof b!="string"||!b)return null;b=e.trim(b);if(a.JSON&&a.JSON.parse)return a.JSON.parse(b);if(n.test(b.replace(o,"@").replace(p,"]").replace(q,"")))return(new Function("return "+b))();e.error("Invalid JSON: "+b)},parseXML:function(c){var d,f;try{a.DOMParser?(f=new DOMParser,d=f.parseFromString(c,"text/xml")):(d=new ActiveXObject("Microsoft.XMLDOM"),d.async="false",d.loadXML(c))}catch(g){d=b}(!d||!d.documentElement||d.getElementsByTagName("parsererror").length)&&e.error("Invalid XML: "+c);return d},noop:function(){},globalEval:function(b){b&&j.test(b)&&(a.execScript||function(b){a.eval.call(a,b)})(b)},camelCase:function(a){return a.replace(w,"ms-").replace(v,x)},nodeName:function(a,b){return a.nodeName&&a.nodeName.toUpperCase()===b.toUpperCase()},each:function(a,c,d){var f,g=0,h=a.length,i=h===b||e.isFunction(a);if(d){if(i){for(f in a)if(c.apply(a[f],d)===!1)break}else for(;g<h;)if(c.apply(a[g++],d)===!1)break}else if(i){for(f in a)if(c.call(a[f],f,a[f])===!1)break}else for(;g<h;)if(c.call(a[g],g,a[g++])===!1)break;return a},trim:G?function(a){return a==null?"":G.call(a)}:function(a){return a==null?"":(a+"").replace(k,"").replace(l,"")},makeArray:function(a,b){var c=b||[];if(a!=null){var d=e.type(a);a.length==null||d==="string"||d==="function"||d==="regexp"||e.isWindow(a)?E.call(c,a):e.merge(c,a)}return c},inArray:function(a,b,c){var d;if(b){if(H)return H.call(b,a,c);d=b.length,c=c?c<0?Math.max(0,d+c):c:0;for(;c<d;c++)if(c in b&&b[c]===a)return c}return-1},merge:function(a,c){var d=a.length,e=0;if(typeof c.length=="number")for(var f=c.length;e<f;e++)a[d++]=c[e];else while(c[e]!==b)a[d++]=c[e++];a.length=d;return a},grep:function(a,b,c){var d=[],e;c=!!c;for(var f=0,g=a.length;f<g;f++)e=!!b(a[f],f),c!==e&&d.push(a[f]);return d},map:function(a,c,d){var f,g,h=[],i=0,j=a.length,k=a instanceof e||j!==b&&typeof j=="number"&&(j>0&&a[0]&&a[j-1]||j===0||e.isArray(a));if(k)for(;i<j;i++)f=c(a[i],i,d),f!=null&&(h[h.length]=f);else for(g in a)f=c(a[g],g,d),f!=null&&(h[h.length]=f);return h.concat.apply([],h)},guid:1,proxy:function(a,c){if(typeof c=="string"){var d=a[c];c=a,a=d}if(!e.isFunction(a))return b;var f=F.call(arguments,2),g=function(){return a.apply(c,f.concat(F.call(arguments)))};g.guid=a.guid=a.guid||g.guid||e.guid++;return g},access:function(a,c,d,f,g,h){var i=a.length;if(typeof c=="object"){for(var j in c)e.access(a,j,c[j],f,g,d);return a}if(d!==b){f=!h&&f&&e.isFunction(d);for(var k=0;k<i;k++)g(a[k],c,f?d.call(a[k],k,g(a[k],c)):d,h);return a}return i?g(a[0],c):b},now:function(){return(new Date).getTime()},uaMatch:function(a){a=a.toLowerCase();var b=r.exec(a)||s.exec(a)||t.exec(a)||a.indexOf("compatible")<0&&u.exec(a)||[];return{browser:b[1]||"",version:b[2]||"0"}},sub:function(){function a(b,c){return new a.fn.init(b,c)}e.extend(!0,a,this),a.superclass=this,a.fn=a.prototype=this(),a.fn.constructor=a,a.sub=this.sub,a.fn.init=function(d,f){f&&f instanceof e&&!(f instanceof a)&&(f=a(f));return e.fn.init.call(this,d,f,b)},a.fn.init.prototype=a.fn;var b=a(c);return a},browser:{}}),e.each("Boolean Number String Function Array Date RegExp Object".split(" "),function(a,b){I["[object "+b+"]"]=b.toLowerCase()}),z=e.uaMatch(y),z.browser&&(e.browser[z.browser]=!0,e.browser.version=z.version),e.browser.webkit&&(e.browser.safari=!0),j.test("Â ")&&(k=/^[\s\xA0]+/,l=/[\s\xA0]+$/),h=e(c),c.addEventListener?B=function(){c.removeEventListener("DOMContentLoaded",B,!1),e.ready()}:c.attachEvent&&(B=function(){c.readyState==="complete"&&(c.detachEvent("onreadystatechange",B),e.ready())});return e}(),g={};f.Callbacks=function(a){a=a?g[a]||h(a):{};var c=[],d=[],e,i,j,k,l,m=function(b){var d,e,g,h,i;for(d=0,e=b.length;d<e;d++)g=b[d],h=f.type(g),h==="array"?m(g):h==="function"&&(!a.unique||!o.has(g))&&c.push(g)},n=function(b,f){f=f||[],e=!a.memory||[b,f],i=!0,l=j||0,j=0,k=c.length;for(;c&&l<k;l++)if(c[l].apply(b,f)===!1&&a.stopOnFalse){e=!0;break}i=!1,c&&(a.once?e===!0?o.disable():c=[]:d&&d.length&&(e=d.shift(),o.fireWith(e[0],e[1])))},o={add:function(){if(c){var a=c.length;m(arguments),i?k=c.length:e&&e!==!0&&(j=a,n(e[0],e[1]))}return this},remove:function(){if(c){var b=arguments,d=0,e=b.length;for(;d<e;d++)for(var f=0;f<c.length;f++)if(b[d]===c[f]){i&&f<=k&&(k--,f<=l&&l--),c.splice(f--,1);if(a.unique)break}}return this},has:function(a){if(c){var b=0,d=c.length;for(;b<d;b++)if(a===c[b])return!0}return!1},empty:function(){c=[];return this},disable:function(){c=d=e=b;return this},disabled:function(){return!c},lock:function(){d=b,(!e||e===!0)&&o.disable();return this},locked:function(){return!d},fireWith:function(b,c){d&&(i?a.once||d.push([b,c]):(!a.once||!e)&&n(b,c));return this},fire:function(){o.fireWith(this,arguments);return this},fired:function(){return!!e}};return o};var i=[].slice;f.extend({Deferred:function(a){var b=f.Callbacks("once memory"),c=f.Callbacks("once memory"),d=f.Callbacks("memory"),e="pending",g={resolve:b,reject:c,notify:d},h={done:b.add,fail:c.add,progress:d.add,state:function(){return e},isResolved:b.fired,isRejected:c.fired,then:function(a,b,c){i.done(a).fail(b).progress(c);return this},always:function(){i.done.apply(i,arguments).fail.apply(i,arguments);return this},pipe:function(a,b,c){return f.Deferred(function(d){f.each({done:[a,"resolve"],fail:[b,"reject"],progress:[c,"notify"]},function(a,b){var c=b[0],e=b[1],g;f.isFunction(c)?i[a](function(){g=c.apply(this,arguments),g&&f.isFunction(g.promise)?g.promise().then(d.resolve,d.reject,d.notify):d[e+"With"](this===i?d:this,[g])}):i[a](d[e])})}).promise()},promise:function(a){if(a==null)a=h;else for(var b in h)a[b]=h[b];return a}},i=h.promise({}),j;for(j in g)i[j]=g[j].fire,i[j+"With"]=g[j].fireWith;i.done(function(){e="resolved"},c.disable,d.lock).fail(function(){e="rejected"},b.disable,d.lock),a&&a.call(i,i);return i},when:function(a){function m(a){return function(b){e[a]=arguments.length>1?i.call(arguments,0):b,j.notifyWith(k,e)}}function l(a){return function(c){b[a]=arguments.length>1?i.call(arguments,0):c,--g||j.resolveWith(j,b)}}var b=i.call(arguments,0),c=0,d=b.length,e=Array(d),g=d,h=d,j=d<=1&&a&&f.isFunction(a.promise)?a:f.Deferred(),k=j.promise();if(d>1){for(;c<d;c++)b[c]&&b[c].promise&&f.isFunction(b[c].promise)?b[c].promise().then(l(c),j.reject,m(c)):--g;g||j.resolveWith(j,b)}else j!==a&&j.resolveWith(j,d?[a]:[]);return k}}),f.support=function(){var b,d,e,g,h,i,j,k,l,m,n,o,p,q=c.createElement("div"),r=c.documentElement;q.setAttribute("className","t"),q.innerHTML="   <link/><table></table><a href='/a' style='top:1px;float:left;opacity:.55;'>a</a><input type='checkbox'/>",d=q.getElementsByTagName("*"),e=q.getElementsByTagName("a")[0];if(!d||!d.length||!e)return{};g=c.createElement("select"),h=g.appendChild(c.createElement("option")),i=q.getElementsByTagName("input")[0],b={leadingWhitespace:q.firstChild.nodeType===3,tbody:!q.getElementsByTagName("tbody").length,htmlSerialize:!!q.getElementsByTagName("link").length,style:/top/.test(e.getAttribute("style")),hrefNormalized:e.getAttribute("href")==="/a",opacity:/^0.55/.test(e.style.opacity),cssFloat:!!e.style.cssFloat,checkOn:i.value==="on",optSelected:h.selected,getSetAttribute:q.className!=="t",enctype:!!c.createElement("form").enctype,html5Clone:c.createElement("nav").cloneNode(!0).outerHTML!=="<:nav></:nav>",submitBubbles:!0,changeBubbles:!0,focusinBubbles:!1,deleteExpando:!0,noCloneEvent:!0,inlineBlockNeedsLayout:!1,shrinkWrapBlocks:!1,reliableMarginRight:!0},i.checked=!0,b.noCloneChecked=i.cloneNode(!0).checked,g.disabled=!0,b.optDisabled=!h.disabled;try{delete q.test}catch(s){b.deleteExpando=!1}!q.addEventListener&&q.attachEvent&&q.fireEvent&&(q.attachEvent("onclick",function(){b.noCloneEvent=!1}),q.cloneNode(!0).fireEvent("onclick")),i=c.createElement("input"),i.value="t",i.setAttribute("type","radio"),b.radioValue=i.value==="t",i.setAttribute("checked","checked"),q.appendChild(i),k=c.createDocumentFragment(),k.appendChild(q.lastChild),b.checkClone=k.cloneNode(!0).cloneNode(!0).lastChild.checked,b.appendChecked=i.checked,k.removeChild(i),k.appendChild(q),q.innerHTML="",a.getComputedStyle&&(j=c.createElement("div"),j.style.width="0",j.style.marginRight="0",q.style.width="2px",q.appendChild(j),b.reliableMarginRight=(parseInt((a.getComputedStyle(j,null)||{marginRight:0}).marginRight,10)||0)===0);if(q.attachEvent)for(o in{submit:1,change:1,focusin:1})n="on"+o,p=n in q,p||(q.setAttribute(n,"return;"),p=typeof q[n]=="function"),b[o+"Bubbles"]=p;k.removeChild(q),k=g=h=j=q=i=null,f(function(){var a,d,e,g,h,i,j,k,m,n,o,r=c.getElementsByTagName("body")[0];!r||(j=1,k="position:absolute;top:0;left:0;width:1px;height:1px;margin:0;",m="visibility:hidden;border:0;",n="style='"+k+"border:5px solid #000;padding:0;'",o="<div "+n+"><div></div></div>"+"<table "+n+" cellpadding='0' cellspacing='0'>"+"<tr><td></td></tr></table>",a=c.createElement("div"),a.style.cssText=m+"width:0;height:0;position:static;top:0;margin-top:"+j+"px",r.insertBefore(a,r.firstChild),q=c.createElement("div"),a.appendChild(q),q.innerHTML="<table><tr><td style='padding:0;border:0;display:none'></td><td>t</td></tr></table>",l=q.getElementsByTagName("td"),p=l[0].offsetHeight===0,l[0].style.display="",l[1].style.display="none",b.reliableHiddenOffsets=p&&l[0].offsetHeight===0,q.innerHTML="",q.style.width=q.style.paddingLeft="1px",f.boxModel=b.boxModel=q.offsetWidth===2,typeof q.style.zoom!="undefined"&&(q.style.display="inline",q.style.zoom=1,b.inlineBlockNeedsLayout=q.offsetWidth===2,q.style.display="",q.innerHTML="<div style='width:4px;'></div>",b.shrinkWrapBlocks=q.offsetWidth!==2),q.style.cssText=k+m,q.innerHTML=o,d=q.firstChild,e=d.firstChild,h=d.nextSibling.firstChild.firstChild,i={doesNotAddBorder:e.offsetTop!==5,doesAddBorderForTableAndCells:h.offsetTop===5},e.style.position="fixed",e.style.top="20px",i.fixedPosition=e.offsetTop===20||e.offsetTop===15,e.style.position=e.style.top="",d.style.overflow="hidden",d.style.position="relative",i.subtractsBorderForOverflowNotVisible=e.offsetTop===-5,i.doesNotIncludeMarginInBodyOffset=r.offsetTop!==j,r.removeChild(a),q=a=null,f.extend(b,i))});return b}();var j=/^(?:\{.*\}|\[.*\])$/,k=/([A-Z])/g;f.extend({cache:{},uuid:0,expando:"jQuery"+(f.fn.jquery+Math.random()).replace(/\D/g,""),noData:{embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:!0},hasData:function(a){a=a.nodeType?f.cache[a[f.expando]]:a[f.expando];return!!a&&!m(a)},data:function(a,c,d,e){if(!!f.acceptData(a)){var g,h,i,j=f.expando,k=typeof c=="string",l=a.nodeType,m=l?f.cache:a,n=l?a[j]:a[j]&&j,o=c==="events";if((!n||!m[n]||!o&&!e&&!m[n].data)&&k&&d===b)return;n||(l?a[j]=n=++f.uuid:n=j),m[n]||(m[n]={},l||(m[n].toJSON=f.noop));if(typeof c=="object"||typeof c=="function")e?m[n]=f.extend(m[n],c):m[n].data=f.extend(m[n].data,c);g=h=m[n],e||(h.data||(h.data={}),h=h.data),d!==b&&(h[f.camelCase(c)]=d);if(o&&!h[c])return g.events;k?(i=h[c],i==null&&(i=h[f.camelCase(c)])):i=h;return i}},removeData:function(a,b,c){if(!!f.acceptData(a)){var d,e,g,h=f.expando,i=a.nodeType,j=i?f.cache:a,k=i?a[h]:h;if(!j[k])return;if(b){d=c?j[k]:j[k].data;if(d){f.isArray(b)||(b in d?b=[b]:(b=f.camelCase(b),b in d?b=[b]:b=b.split(" ")));for(e=0,g=b.length;e<g;e++)delete d[b[e]];if(!(c?m:f.isEmptyObject)(d))return}}if(!c){delete j[k].data;if(!m(j[k]))return}f.support.deleteExpando||!j.setInterval?delete j[k]:j[k]=null,i&&(f.support.deleteExpando?delete a[h]:a.removeAttribute?a.removeAttribute(h):a[h]=null)}},_data:function(a,b,c){return f.data(a,b,c,!0)},acceptData:function(a){if(a.nodeName){var b=f.noData[a.nodeName.toLowerCase()];if(b)return b!==!0&&a.getAttribute("classid")===b}return!0}}),f.fn.extend({data:function(a,c){var d,e,g,h=null;if(typeof a=="undefined"){if(this.length){h=f.data(this[0]);if(this[0].nodeType===1&&!f._data(this[0],"parsedAttrs")){e=this[0].attributes;for(var i=0,j=e.length;i<j;i++)g=e[i].name,g.indexOf("data-")===0&&(g=f.camelCase(g.substring(5)),l(this[0],g,h[g]));f._data(this[0],"parsedAttrs",!0)}}return h}if(typeof a=="object")return this.each(function(){f.data(this,a)});d=a.split("."),d[1]=d[1]?"."+d[1]:"";if(c===b){h=this.triggerHandler("getData"+d[1]+"!",[d[0]]),h===b&&this.length&&(h=f.data(this[0],a),h=l(this[0],a,h));return h===b&&d[1]?this.data(d[0]):h}return this.each(function(){var b=f(this),e=[d[0],c];b.triggerHandler("setData"+d[1]+"!",e),f.data(this,a,c),b.triggerHandler("changeData"+d[1]+"!",e)})},removeData:function(a){return this.each(function(){f.removeData(this,a)})}}),f.extend({_mark:function(a,b){a&&(b=(b||"fx")+"mark",f._data(a,b,(f._data(a,b)||0)+1))},_unmark:function(a,b,c){a!==!0&&(c=b,b=a,a=!1);if(b){c=c||"fx";var d=c+"mark",e=a?0:(f._data(b,d)||1)-1;e?f._data(b,d,e):(f.removeData(b,d,!0),n(b,c,"mark"))}},queue:function(a,b,c){var d;if(a){b=(b||"fx")+"queue",d=f._data(a,b),c&&(!d||f.isArray(c)?d=f._data(a,b,f.makeArray(c)):d.push(c));return d||[]}},dequeue:function(a,b){b=b||"fx";var c=f.queue(a,b),d=c.shift(),e={};d==="inprogress"&&(d=c.shift()),d&&(b==="fx"&&c.unshift("inprogress"),f._data(a,b+".run",e),d.call(a,function(){f.dequeue(a,b)},e)),c.length||(f.removeData(a,b+"queue "+b+".run",!0),n(a,b,"queue"))}}),f.fn.extend({queue:function(a,c){typeof a!="string"&&(c=a,a="fx");if(c===b)return f.queue(this[0],a);return this.each(function(){var b=f.queue(this,a,c);a==="fx"&&b[0]!=="inprogress"&&f.dequeue(this,a)})},dequeue:function(a){return this.each(function(){f.dequeue(this,a)})},delay:function(a,b){a=f.fx?f.fx.speeds[a]||a:a,b=b||"fx";return this.queue(b,function(b,c){var d=setTimeout(b,a);c.stop=function(){clearTimeout(d)}})},clearQueue:function(a){return this.queue(a||"fx",[])},promise:function(a,c){function m(){--h||d.resolveWith(e,[e])}typeof a!="string"&&(c=a,a=b),a=a||"fx";var d=f.Deferred(),e=this,g=e.length,h=1,i=a+"defer",j=a+"queue",k=a+"mark",l;while(g--)if(l=f.data(e[g],i,b,!0)||(f.data(e[g],j,b,!0)||f.data(e[g],k,b,!0))&&f.data(e[g],i,f.Callbacks("once memory"),!0))h++,l.add(m);m();return d.promise()}});var o=/[\n\t\r]/g,p=/\s+/,q=/\r/g,r=/^(?:button|input)$/i,s=/^(?:button|input|object|select|textarea)$/i,t=/^a(?:rea)?$/i,u=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,v=f.support.getSetAttribute,w,x,y;f.fn.extend({attr:function(a,b){return f.access(this,a,b,!0,f.attr)},removeAttr:function(a){return this.each(function(){f.removeAttr(this,a)})},prop:function(a,b){return f.access(this,a,b,!0,f.prop)},removeProp:function(a){a=f.propFix[a]||a;return this.each(function(){try{this[a]=b,delete this[a]}catch(c){}})},addClass:function(a){var b,c,d,e,g,h,i;if(f.isFunction(a))return this.each(function(b){f(this).addClass(a.call(this,b,this.className))});if(a&&typeof a=="string"){b=a.split(p);for(c=0,d=this.length;c<d;c++){e=this[c];if(e.nodeType===1)if(!e.className&&b.length===1)e.className=a;else{g=" "+e.className+" ";for(h=0,i=b.length;h<i;h++)~g.indexOf(" "+b[h]+" ")||(g+=b[h]+" ");e.className=f.trim(g)}}}return this},removeClass:function(a){var c,d,e,g,h,i,j;if(f.isFunction(a))return this.each(function(b){f(this).removeClass(a.call(this,b,this.className))});if(a&&typeof a=="string"||a===b){c=(a||"").split(p);for(d=0,e=this.length;d<e;d++){g=this[d];if(g.nodeType===1&&g.className)if(a){h=(" "+g.className+" ").replace(o," ");for(i=0,j=c.length;i<j;i++)h=h.replace(" "+c[i]+" "," ");g.className=f.trim(h)}else g.className=""}}return this},toggleClass:function(a,b){var c=typeof a,d=typeof b=="boolean";if(f.isFunction(a))return this.each(function(c){f(this).toggleClass(a.call(this,c,this.className,b),b)});return this.each(function(){if(c==="string"){var e,g=0,h=f(this),i=b,j=a.split(p);while(e=j[g++])i=d?i:!h.hasClass(e),h[i?"addClass":"removeClass"](e)}else if(c==="undefined"||c==="boolean")this.className&&f._data(this,"__className__",this.className),this.className=this.className||a===!1?"":f._data(this,"__className__")||""})},hasClass:function(a){var b=" "+a+" ",c=0,d=this.length;for(;c<d;c++)if(this[c].nodeType===1&&(" "+this[c].className+" ").replace(o," ").indexOf(b)>-1)return!0;return!1},val:function(a){var c,d,e,g=this[0];{if(!!arguments.length){e=f.isFunction(a);return this.each(function(d){var g=f(this),h;if(this.nodeType===1){e?h=a.call(this,d,g.val()):h=a,h==null?h="":typeof h=="number"?h+="":f.isArray(h)&&(h=f.map(h,function(a){return a==null?"":a+""})),c=f.valHooks[this.nodeName.toLowerCase()]||f.valHooks[this.type];if(!c||!("set"in c)||c.set(this,h,"value")===b)this.value=h}})}if(g){c=f.valHooks[g.nodeName.toLowerCase()]||f.valHooks[g.type];if(c&&"get"in c&&(d=c.get(g,"value"))!==b)return d;d=g.value;return typeof d=="string"?d.replace(q,""):d==null?"":d}}}}),f.extend({valHooks:{option:{get:function(a){var b=a.attributes.value;return!b||b.specified?a.value:a.text}},select:{get:function(a){var b,c,d,e,g=a.selectedIndex,h=[],i=a.options,j=a.type==="select-one";if(g<0)return null;c=j?g:0,d=j?g+1:i.length;for(;c<d;c++){e=i[c];if(e.selected&&(f.support.optDisabled?!e.disabled:e.getAttribute("disabled")===null)&&(!e.parentNode.disabled||!f.nodeName(e.parentNode,"optgroup"))){b=f(e).val();if(j)return b;h.push(b)}}if(j&&!h.length&&i.length)return f(i[g]).val();return h},set:function(a,b){var c=f.makeArray(b);f(a).find("option").each(function(){this.selected=f.inArray(f(this).val(),c)>=0}),c.length||(a.selectedIndex=-1);return c}}},attrFn:{val:!0,css:!0,html:!0,text:!0,data:!0,width:!0,height:!0,offset:!0},attr:function(a,c,d,e){var g,h,i,j=a.nodeType;if(!!a&&j!==3&&j!==8&&j!==2){if(e&&c in f.attrFn)return f(a)[c](d);if(typeof a.getAttribute=="undefined")return f.prop(a,c,d);i=j!==1||!f.isXMLDoc(a),i&&(c=c.toLowerCase(),h=f.attrHooks[c]||(u.test(c)?x:w));if(d!==b){if(d===null){f.removeAttr(a,c);return}if(h&&"set"in h&&i&&(g=h.set(a,d,c))!==b)return g;a.setAttribute(c,""+d);return d}if(h&&"get"in h&&i&&(g=h.get(a,c))!==null)return g;g=a.getAttribute(c);return g===null?b:g}},removeAttr:function(a,b){var c,d,e,g,h=0;if(b&&a.nodeType===1){d=b.toLowerCase().split(p),g=d.length;for(;h<g;h++)e=d[h],e&&(c=f.propFix[e]||e,f.attr(a,e,""),a.removeAttribute(v?e:c),u.test(e)&&c in a&&(a[c]=!1))}},attrHooks:{type:{set:function(a,b){if(r.test(a.nodeName)&&a.parentNode)f.error("type property can't be changed");else if(!f.support.radioValue&&b==="radio"&&f.nodeName(a,"input")){var c=a.value;a.setAttribute("type",b),c&&(a.value=c);return b}}},value:{get:function(a,b){if(w&&f.nodeName(a,"button"))return w.get(a,b);return b in a?a.value:null},set:function(a,b,c){if(w&&f.nodeName(a,"button"))return w.set(a,b,c);a.value=b}}},propFix:{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},prop:function(a,c,d){var e,g,h,i=a.nodeType;if(!!a&&i!==3&&i!==8&&i!==2){h=i!==1||!f.isXMLDoc(a),h&&(c=f.propFix[c]||c,g=f.propHooks[c]);return d!==b?g&&"set"in g&&(e=g.set(a,d,c))!==b?e:a[c]=d:g&&"get"in g&&(e=g.get(a,c))!==null?e:a[c]}},propHooks:{tabIndex:{get:function(a){var c=a.getAttributeNode("tabindex");return c&&c.specified?parseInt(c.value,10):s.test(a.nodeName)||t.test(a.nodeName)&&a.href?0:b}}}}),f.attrHooks.tabindex=f.propHooks.tabIndex,x={get:function(a,c){var d,e=f.prop(a,c);return e===!0||typeof e!="boolean"&&(d=a.getAttributeNode(c))&&d.nodeValue!==!1?c.toLowerCase():b},set:function(a,b,c){var d;b===!1?f.removeAttr(a,c):(d=f.propFix[c]||c,d in a&&(a[d]=!0),a.setAttribute(c,c.toLowerCase()));return c}},v||(y={name:!0,id:!0},w=f.valHooks.button={get:function(a,c){var d;d=a.getAttributeNode(c);return d&&(y[c]?d.nodeValue!=="":d.specified)?d.nodeValue:b},set:function(a,b,d){var e=a.getAttributeNode(d);e||(e=c.createAttribute(d),a.setAttributeNode(e));return e.nodeValue=b+""}},f.attrHooks.tabindex.set=w.set,f.each(["width","height"],function(a,b){f.attrHooks[b]=f.extend(f.attrHooks[b],{set:function(a,c){if(c===""){a.setAttribute(b,"auto");return c}}})}),f.attrHooks.contenteditable={get:w.get,set:function(a,b,c){b===""&&(b="false"),w.set(a,b,c)}}),f.support.hrefNormalized||f.each(["href","src","width","height"],function(a,c){f.attrHooks[c]=f.extend(f.attrHooks[c],{get:function(a){var d=a.getAttribute(c,2);return d===null?b:d}})}),f.support.style||(f.attrHooks.style={get:function(a){return a.style.cssText.toLowerCase()||b},set:function(a,b){return a.style.cssText=""+b}}),f.support.optSelected||(f.propHooks.selected=f.extend(f.propHooks.selected,{get:function(a){var b=a.parentNode;b&&(b.selectedIndex,b.parentNode&&b.parentNode.selectedIndex);return null}})),f.support.enctype||(f.propFix.enctype="encoding"),f.support.checkOn||f.each(["radio","checkbox"],function(){f.valHooks[this]={get:function(a){return a.getAttribute("value")===null?"on":a.value}}}),f.each(["radio","checkbox"],function(){f.valHooks[this]=f.extend(f.valHooks[this],{set:function(a,b){if(f.isArray(b))return a.checked=f.inArray(f(a).val(),b)>=0}})});var z=/^(?:textarea|input|select)$/i,A=/^([^\.]*)?(?:\.(.+))?$/,B=/\bhover(\.\S+)?\b/,C=/^key/,D=/^(?:mouse|contextmenu)|click/,E=/^(?:focusinfocus|focusoutblur)$/,F=/^(\w*)(?:#([\w\-]+))?(?:\.([\w\-]+))?$/,G=function(a){var b=F.exec(a);b&&(b[1]=(b[1]||"").toLowerCase(),b[3]=b[3]&&new RegExp("(?:^|\\s)"+b[3]+"(?:\\s|$)"));return b},H=function(a,b){var c=a.attributes||{};return(!b[1]||a.nodeName.toLowerCase()===b[1])&&(!b[2]||(c.id||{}).value===b[2])&&(!b[3]||b[3].test((c["class"]||{}).value))},I=function(a){return f.event.special.hover?a:a.replace(B,"mouseenter$1 mouseleave$1")};
f.event={add:function(a,c,d,e,g){var h,i,j,k,l,m,n,o,p,q,r,s;if(!(a.nodeType===3||a.nodeType===8||!c||!d||!(h=f._data(a)))){d.handler&&(p=d,d=p.handler),d.guid||(d.guid=f.guid++),j=h.events,j||(h.events=j={}),i=h.handle,i||(h.handle=i=function(a){return typeof f!="undefined"&&(!a||f.event.triggered!==a.type)?f.event.dispatch.apply(i.elem,arguments):b},i.elem=a),c=f.trim(I(c)).split(" ");for(k=0;k<c.length;k++){l=A.exec(c[k])||[],m=l[1],n=(l[2]||"").split(".").sort(),s=f.event.special[m]||{},m=(g?s.delegateType:s.bindType)||m,s=f.event.special[m]||{},o=f.extend({type:m,origType:l[1],data:e,handler:d,guid:d.guid,selector:g,quick:G(g),namespace:n.join(".")},p),r=j[m];if(!r){r=j[m]=[],r.delegateCount=0;if(!s.setup||s.setup.call(a,e,n,i)===!1)a.addEventListener?a.addEventListener(m,i,!1):a.attachEvent&&a.attachEvent("on"+m,i)}s.add&&(s.add.call(a,o),o.handler.guid||(o.handler.guid=d.guid)),g?r.splice(r.delegateCount++,0,o):r.push(o),f.event.global[m]=!0}a=null}},global:{},remove:function(a,b,c,d,e){var g=f.hasData(a)&&f._data(a),h,i,j,k,l,m,n,o,p,q,r,s;if(!!g&&!!(o=g.events)){b=f.trim(I(b||"")).split(" ");for(h=0;h<b.length;h++){i=A.exec(b[h])||[],j=k=i[1],l=i[2];if(!j){for(j in o)f.event.remove(a,j+b[h],c,d,!0);continue}p=f.event.special[j]||{},j=(d?p.delegateType:p.bindType)||j,r=o[j]||[],m=r.length,l=l?new RegExp("(^|\\.)"+l.split(".").sort().join("\\.(?:.*\\.)?")+"(\\.|$)"):null;for(n=0;n<r.length;n++)s=r[n],(e||k===s.origType)&&(!c||c.guid===s.guid)&&(!l||l.test(s.namespace))&&(!d||d===s.selector||d==="**"&&s.selector)&&(r.splice(n--,1),s.selector&&r.delegateCount--,p.remove&&p.remove.call(a,s));r.length===0&&m!==r.length&&((!p.teardown||p.teardown.call(a,l)===!1)&&f.removeEvent(a,j,g.handle),delete o[j])}f.isEmptyObject(o)&&(q=g.handle,q&&(q.elem=null),f.removeData(a,["events","handle"],!0))}},customEvent:{getData:!0,setData:!0,changeData:!0},trigger:function(c,d,e,g){if(!e||e.nodeType!==3&&e.nodeType!==8){var h=c.type||c,i=[],j,k,l,m,n,o,p,q,r,s;if(E.test(h+f.event.triggered))return;h.indexOf("!")>=0&&(h=h.slice(0,-1),k=!0),h.indexOf(".")>=0&&(i=h.split("."),h=i.shift(),i.sort());if((!e||f.event.customEvent[h])&&!f.event.global[h])return;c=typeof c=="object"?c[f.expando]?c:new f.Event(h,c):new f.Event(h),c.type=h,c.isTrigger=!0,c.exclusive=k,c.namespace=i.join("."),c.namespace_re=c.namespace?new RegExp("(^|\\.)"+i.join("\\.(?:.*\\.)?")+"(\\.|$)"):null,o=h.indexOf(":")<0?"on"+h:"";if(!e){j=f.cache;for(l in j)j[l].events&&j[l].events[h]&&f.event.trigger(c,d,j[l].handle.elem,!0);return}c.result=b,c.target||(c.target=e),d=d!=null?f.makeArray(d):[],d.unshift(c),p=f.event.special[h]||{};if(p.trigger&&p.trigger.apply(e,d)===!1)return;r=[[e,p.bindType||h]];if(!g&&!p.noBubble&&!f.isWindow(e)){s=p.delegateType||h,m=E.test(s+h)?e:e.parentNode,n=null;for(;m;m=m.parentNode)r.push([m,s]),n=m;n&&n===e.ownerDocument&&r.push([n.defaultView||n.parentWindow||a,s])}for(l=0;l<r.length&&!c.isPropagationStopped();l++)m=r[l][0],c.type=r[l][1],q=(f._data(m,"events")||{})[c.type]&&f._data(m,"handle"),q&&q.apply(m,d),q=o&&m[o],q&&f.acceptData(m)&&q.apply(m,d)===!1&&c.preventDefault();c.type=h,!g&&!c.isDefaultPrevented()&&(!p._default||p._default.apply(e.ownerDocument,d)===!1)&&(h!=="click"||!f.nodeName(e,"a"))&&f.acceptData(e)&&o&&e[h]&&(h!=="focus"&&h!=="blur"||c.target.offsetWidth!==0)&&!f.isWindow(e)&&(n=e[o],n&&(e[o]=null),f.event.triggered=h,e[h](),f.event.triggered=b,n&&(e[o]=n));return c.result}},dispatch:function(c){c=f.event.fix(c||a.event);var d=(f._data(this,"events")||{})[c.type]||[],e=d.delegateCount,g=[].slice.call(arguments,0),h=!c.exclusive&&!c.namespace,i=[],j,k,l,m,n,o,p,q,r,s,t;g[0]=c,c.delegateTarget=this;if(e&&!c.target.disabled&&(!c.button||c.type!=="click")){m=f(this),m.context=this.ownerDocument||this;for(l=c.target;l!=this;l=l.parentNode||this){o={},q=[],m[0]=l;for(j=0;j<e;j++)r=d[j],s=r.selector,o[s]===b&&(o[s]=r.quick?H(l,r.quick):m.is(s)),o[s]&&q.push(r);q.length&&i.push({elem:l,matches:q})}}d.length>e&&i.push({elem:this,matches:d.slice(e)});for(j=0;j<i.length&&!c.isPropagationStopped();j++){p=i[j],c.currentTarget=p.elem;for(k=0;k<p.matches.length&&!c.isImmediatePropagationStopped();k++){r=p.matches[k];if(h||!c.namespace&&!r.namespace||c.namespace_re&&c.namespace_re.test(r.namespace))c.data=r.data,c.handleObj=r,n=((f.event.special[r.origType]||{}).handle||r.handler).apply(p.elem,g),n!==b&&(c.result=n,n===!1&&(c.preventDefault(),c.stopPropagation()))}}return c.result},props:"attrChange attrName relatedNode srcElement altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(a,b){a.which==null&&(a.which=b.charCode!=null?b.charCode:b.keyCode);return a}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(a,d){var e,f,g,h=d.button,i=d.fromElement;a.pageX==null&&d.clientX!=null&&(e=a.target.ownerDocument||c,f=e.documentElement,g=e.body,a.pageX=d.clientX+(f&&f.scrollLeft||g&&g.scrollLeft||0)-(f&&f.clientLeft||g&&g.clientLeft||0),a.pageY=d.clientY+(f&&f.scrollTop||g&&g.scrollTop||0)-(f&&f.clientTop||g&&g.clientTop||0)),!a.relatedTarget&&i&&(a.relatedTarget=i===a.target?d.toElement:i),!a.which&&h!==b&&(a.which=h&1?1:h&2?3:h&4?2:0);return a}},fix:function(a){if(a[f.expando])return a;var d,e,g=a,h=f.event.fixHooks[a.type]||{},i=h.props?this.props.concat(h.props):this.props;a=f.Event(g);for(d=i.length;d;)e=i[--d],a[e]=g[e];a.target||(a.target=g.srcElement||c),a.target.nodeType===3&&(a.target=a.target.parentNode),a.metaKey===b&&(a.metaKey=a.ctrlKey);return h.filter?h.filter(a,g):a},special:{ready:{setup:f.bindReady},load:{noBubble:!0},focus:{delegateType:"focusin"},blur:{delegateType:"focusout"},beforeunload:{setup:function(a,b,c){f.isWindow(this)&&(this.onbeforeunload=c)},teardown:function(a,b){this.onbeforeunload===b&&(this.onbeforeunload=null)}}},simulate:function(a,b,c,d){var e=f.extend(new f.Event,c,{type:a,isSimulated:!0,originalEvent:{}});d?f.event.trigger(e,null,b):f.event.dispatch.call(b,e),e.isDefaultPrevented()&&c.preventDefault()}},f.event.handle=f.event.dispatch,f.removeEvent=c.removeEventListener?function(a,b,c){a.removeEventListener&&a.removeEventListener(b,c,!1)}:function(a,b,c){a.detachEvent&&a.detachEvent("on"+b,c)},f.Event=function(a,b){if(!(this instanceof f.Event))return new f.Event(a,b);a&&a.type?(this.originalEvent=a,this.type=a.type,this.isDefaultPrevented=a.defaultPrevented||a.returnValue===!1||a.getPreventDefault&&a.getPreventDefault()?K:J):this.type=a,b&&f.extend(this,b),this.timeStamp=a&&a.timeStamp||f.now(),this[f.expando]=!0},f.Event.prototype={preventDefault:function(){this.isDefaultPrevented=K;var a=this.originalEvent;!a||(a.preventDefault?a.preventDefault():a.returnValue=!1)},stopPropagation:function(){this.isPropagationStopped=K;var a=this.originalEvent;!a||(a.stopPropagation&&a.stopPropagation(),a.cancelBubble=!0)},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=K,this.stopPropagation()},isDefaultPrevented:J,isPropagationStopped:J,isImmediatePropagationStopped:J},f.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(a,b){f.event.special[a]={delegateType:b,bindType:b,handle:function(a){var c=this,d=a.relatedTarget,e=a.handleObj,g=e.selector,h;if(!d||d!==c&&!f.contains(c,d))a.type=e.origType,h=e.handler.apply(this,arguments),a.type=b;return h}}}),f.support.submitBubbles||(f.event.special.submit={setup:function(){if(f.nodeName(this,"form"))return!1;f.event.add(this,"click._submit keypress._submit",function(a){var c=a.target,d=f.nodeName(c,"input")||f.nodeName(c,"button")?c.form:b;d&&!d._submit_attached&&(f.event.add(d,"submit._submit",function(a){this.parentNode&&!a.isTrigger&&f.event.simulate("submit",this.parentNode,a,!0)}),d._submit_attached=!0)})},teardown:function(){if(f.nodeName(this,"form"))return!1;f.event.remove(this,"._submit")}}),f.support.changeBubbles||(f.event.special.change={setup:function(){if(z.test(this.nodeName)){if(this.type==="checkbox"||this.type==="radio")f.event.add(this,"propertychange._change",function(a){a.originalEvent.propertyName==="checked"&&(this._just_changed=!0)}),f.event.add(this,"click._change",function(a){this._just_changed&&!a.isTrigger&&(this._just_changed=!1,f.event.simulate("change",this,a,!0))});return!1}f.event.add(this,"beforeactivate._change",function(a){var b=a.target;z.test(b.nodeName)&&!b._change_attached&&(f.event.add(b,"change._change",function(a){this.parentNode&&!a.isSimulated&&!a.isTrigger&&f.event.simulate("change",this.parentNode,a,!0)}),b._change_attached=!0)})},handle:function(a){var b=a.target;if(this!==b||a.isSimulated||a.isTrigger||b.type!=="radio"&&b.type!=="checkbox")return a.handleObj.handler.apply(this,arguments)},teardown:function(){f.event.remove(this,"._change");return z.test(this.nodeName)}}),f.support.focusinBubbles||f.each({focus:"focusin",blur:"focusout"},function(a,b){var d=0,e=function(a){f.event.simulate(b,a.target,f.event.fix(a),!0)};f.event.special[b]={setup:function(){d++===0&&c.addEventListener(a,e,!0)},teardown:function(){--d===0&&c.removeEventListener(a,e,!0)}}}),f.fn.extend({on:function(a,c,d,e,g){var h,i;if(typeof a=="object"){typeof c!="string"&&(d=c,c=b);for(i in a)this.on(i,c,d,a[i],g);return this}d==null&&e==null?(e=c,d=c=b):e==null&&(typeof c=="string"?(e=d,d=b):(e=d,d=c,c=b));if(e===!1)e=J;else if(!e)return this;g===1&&(h=e,e=function(a){f().off(a);return h.apply(this,arguments)},e.guid=h.guid||(h.guid=f.guid++));return this.each(function(){f.event.add(this,a,e,d,c)})},one:function(a,b,c,d){return this.on.call(this,a,b,c,d,1)},off:function(a,c,d){if(a&&a.preventDefault&&a.handleObj){var e=a.handleObj;f(a.delegateTarget).off(e.namespace?e.type+"."+e.namespace:e.type,e.selector,e.handler);return this}if(typeof a=="object"){for(var g in a)this.off(g,c,a[g]);return this}if(c===!1||typeof c=="function")d=c,c=b;d===!1&&(d=J);return this.each(function(){f.event.remove(this,a,d,c)})},bind:function(a,b,c){return this.on(a,null,b,c)},unbind:function(a,b){return this.off(a,null,b)},live:function(a,b,c){f(this.context).on(a,this.selector,b,c);return this},die:function(a,b){f(this.context).off(a,this.selector||"**",b);return this},delegate:function(a,b,c,d){return this.on(b,a,c,d)},undelegate:function(a,b,c){return arguments.length==1?this.off(a,"**"):this.off(b,a,c)},trigger:function(a,b){return this.each(function(){f.event.trigger(a,b,this)})},triggerHandler:function(a,b){if(this[0])return f.event.trigger(a,b,this[0],!0)},toggle:function(a){var b=arguments,c=a.guid||f.guid++,d=0,e=function(c){var e=(f._data(this,"lastToggle"+a.guid)||0)%d;f._data(this,"lastToggle"+a.guid,e+1),c.preventDefault();return b[e].apply(this,arguments)||!1};e.guid=c;while(d<b.length)b[d++].guid=c;return this.click(e)},hover:function(a,b){return this.mouseenter(a).mouseleave(b||a)}}),f.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(a,b){f.fn[b]=function(a,c){c==null&&(c=a,a=null);return arguments.length>0?this.on(b,null,a,c):this.trigger(b)},f.attrFn&&(f.attrFn[b]=!0),C.test(b)&&(f.event.fixHooks[b]=f.event.keyHooks),D.test(b)&&(f.event.fixHooks[b]=f.event.mouseHooks)}),function(){function x(a,b,c,e,f,g){for(var h=0,i=e.length;h<i;h++){var j=e[h];if(j){var k=!1;j=j[a];while(j){if(j[d]===c){k=e[j.sizset];break}if(j.nodeType===1){g||(j[d]=c,j.sizset=h);if(typeof b!="string"){if(j===b){k=!0;break}}else if(m.filter(b,[j]).length>0){k=j;break}}j=j[a]}e[h]=k}}}function w(a,b,c,e,f,g){for(var h=0,i=e.length;h<i;h++){var j=e[h];if(j){var k=!1;j=j[a];while(j){if(j[d]===c){k=e[j.sizset];break}j.nodeType===1&&!g&&(j[d]=c,j.sizset=h);if(j.nodeName.toLowerCase()===b){k=j;break}j=j[a]}e[h]=k}}}var a=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^\[\]]*\]|['"][^'"]*['"]|[^\[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g,d="sizcache"+(Math.random()+"").replace(".",""),e=0,g=Object.prototype.toString,h=!1,i=!0,j=/\\/g,k=/\r\n/g,l=/\W/;[0,0].sort(function(){i=!1;return 0});var m=function(b,d,e,f){e=e||[],d=d||c;var h=d;if(d.nodeType!==1&&d.nodeType!==9)return[];if(!b||typeof b!="string")return e;var i,j,k,l,n,q,r,t,u=!0,v=m.isXML(d),w=[],x=b;do{a.exec(""),i=a.exec(x);if(i){x=i[3],w.push(i[1]);if(i[2]){l=i[3];break}}}while(i);if(w.length>1&&p.exec(b))if(w.length===2&&o.relative[w[0]])j=y(w[0]+w[1],d,f);else{j=o.relative[w[0]]?[d]:m(w.shift(),d);while(w.length)b=w.shift(),o.relative[b]&&(b+=w.shift()),j=y(b,j,f)}else{!f&&w.length>1&&d.nodeType===9&&!v&&o.match.ID.test(w[0])&&!o.match.ID.test(w[w.length-1])&&(n=m.find(w.shift(),d,v),d=n.expr?m.filter(n.expr,n.set)[0]:n.set[0]);if(d){n=f?{expr:w.pop(),set:s(f)}:m.find(w.pop(),w.length===1&&(w[0]==="~"||w[0]==="+")&&d.parentNode?d.parentNode:d,v),j=n.expr?m.filter(n.expr,n.set):n.set,w.length>0?k=s(j):u=!1;while(w.length)q=w.pop(),r=q,o.relative[q]?r=w.pop():q="",r==null&&(r=d),o.relative[q](k,r,v)}else k=w=[]}k||(k=j),k||m.error(q||b);if(g.call(k)==="[object Array]")if(!u)e.push.apply(e,k);else if(d&&d.nodeType===1)for(t=0;k[t]!=null;t++)k[t]&&(k[t]===!0||k[t].nodeType===1&&m.contains(d,k[t]))&&e.push(j[t]);else for(t=0;k[t]!=null;t++)k[t]&&k[t].nodeType===1&&e.push(j[t]);else s(k,e);l&&(m(l,h,e,f),m.uniqueSort(e));return e};m.uniqueSort=function(a){if(u){h=i,a.sort(u);if(h)for(var b=1;b<a.length;b++)a[b]===a[b-1]&&a.splice(b--,1)}return a},m.matches=function(a,b){return m(a,null,null,b)},m.matchesSelector=function(a,b){return m(b,null,null,[a]).length>0},m.find=function(a,b,c){var d,e,f,g,h,i;if(!a)return[];for(e=0,f=o.order.length;e<f;e++){h=o.order[e];if(g=o.leftMatch[h].exec(a)){i=g[1],g.splice(1,1);if(i.substr(i.length-1)!=="\\"){g[1]=(g[1]||"").replace(j,""),d=o.find[h](g,b,c);if(d!=null){a=a.replace(o.match[h],"");break}}}}d||(d=typeof b.getElementsByTagName!="undefined"?b.getElementsByTagName("*"):[]);return{set:d,expr:a}},m.filter=function(a,c,d,e){var f,g,h,i,j,k,l,n,p,q=a,r=[],s=c,t=c&&c[0]&&m.isXML(c[0]);while(a&&c.length){for(h in o.filter)if((f=o.leftMatch[h].exec(a))!=null&&f[2]){k=o.filter[h],l=f[1],g=!1,f.splice(1,1);if(l.substr(l.length-1)==="\\")continue;s===r&&(r=[]);if(o.preFilter[h]){f=o.preFilter[h](f,s,d,r,e,t);if(!f)g=i=!0;else if(f===!0)continue}if(f)for(n=0;(j=s[n])!=null;n++)j&&(i=k(j,f,n,s),p=e^i,d&&i!=null?p?g=!0:s[n]=!1:p&&(r.push(j),g=!0));if(i!==b){d||(s=r),a=a.replace(o.match[h],"");if(!g)return[];break}}if(a===q)if(g==null)m.error(a);else break;q=a}return s},m.error=function(a){throw new Error("Syntax error, unrecognized expression: "+a)};var n=m.getText=function(a){var b,c,d=a.nodeType,e="";if(d){if(d===1||d===9){if(typeof a.textContent=="string")return a.textContent;if(typeof a.innerText=="string")return a.innerText.replace(k,"");for(a=a.firstChild;a;a=a.nextSibling)e+=n(a)}else if(d===3||d===4)return a.nodeValue}else for(b=0;c=a[b];b++)c.nodeType!==8&&(e+=n(c));return e},o=m.selectors={order:["ID","NAME","TAG"],match:{ID:/#((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,CLASS:/\.((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,NAME:/\[name=['"]*((?:[\w\u00c0-\uFFFF\-]|\\.)+)['"]*\]/,ATTR:/\[\s*((?:[\w\u00c0-\uFFFF\-]|\\.)+)\s*(?:(\S?=)\s*(?:(['"])(.*?)\3|(#?(?:[\w\u00c0-\uFFFF\-]|\\.)*)|)|)\s*\]/,TAG:/^((?:[\w\u00c0-\uFFFF\*\-]|\\.)+)/,CHILD:/:(only|nth|last|first)-child(?:\(\s*(even|odd|(?:[+\-]?\d+|(?:[+\-]?\d*)?n\s*(?:[+\-]\s*\d+)?))\s*\))?/,POS:/:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^\-]|$)/,PSEUDO:/:((?:[\w\u00c0-\uFFFF\-]|\\.)+)(?:\((['"]?)((?:\([^\)]+\)|[^\(\)]*)+)\2\))?/},leftMatch:{},attrMap:{"class":"className","for":"htmlFor"},attrHandle:{href:function(a){return a.getAttribute("href")},type:function(a){return a.getAttribute("type")}},relative:{"+":function(a,b){var c=typeof b=="string",d=c&&!l.test(b),e=c&&!d;d&&(b=b.toLowerCase());for(var f=0,g=a.length,h;f<g;f++)if(h=a[f]){while((h=h.previousSibling)&&h.nodeType!==1);a[f]=e||h&&h.nodeName.toLowerCase()===b?h||!1:h===b}e&&m.filter(b,a,!0)},">":function(a,b){var c,d=typeof b=="string",e=0,f=a.length;if(d&&!l.test(b)){b=b.toLowerCase();for(;e<f;e++){c=a[e];if(c){var g=c.parentNode;a[e]=g.nodeName.toLowerCase()===b?g:!1}}}else{for(;e<f;e++)c=a[e],c&&(a[e]=d?c.parentNode:c.parentNode===b);d&&m.filter(b,a,!0)}},"":function(a,b,c){var d,f=e++,g=x;typeof b=="string"&&!l.test(b)&&(b=b.toLowerCase(),d=b,g=w),g("parentNode",b,f,a,d,c)},"~":function(a,b,c){var d,f=e++,g=x;typeof b=="string"&&!l.test(b)&&(b=b.toLowerCase(),d=b,g=w),g("previousSibling",b,f,a,d,c)}},find:{ID:function(a,b,c){if(typeof b.getElementById!="undefined"&&!c){var d=b.getElementById(a[1]);return d&&d.parentNode?[d]:[]}},NAME:function(a,b){if(typeof b.getElementsByName!="undefined"){var c=[],d=b.getElementsByName(a[1]);for(var e=0,f=d.length;e<f;e++)d[e].getAttribute("name")===a[1]&&c.push(d[e]);return c.length===0?null:c}},TAG:function(a,b){if(typeof b.getElementsByTagName!="undefined")return b.getElementsByTagName(a[1])}},preFilter:{CLASS:function(a,b,c,d,e,f){a=" "+a[1].replace(j,"")+" ";if(f)return a;for(var g=0,h;(h=b[g])!=null;g++)h&&(e^(h.className&&(" "+h.className+" ").replace(/[\t\n\r]/g," ").indexOf(a)>=0)?c||d.push(h):c&&(b[g]=!1));return!1},ID:function(a){return a[1].replace(j,"")},TAG:function(a,b){return a[1].replace(j,"").toLowerCase()},CHILD:function(a){if(a[1]==="nth"){a[2]||m.error(a[0]),a[2]=a[2].replace(/^\+|\s*/g,"");var b=/(-?)(\d*)(?:n([+\-]?\d*))?/.exec(a[2]==="even"&&"2n"||a[2]==="odd"&&"2n+1"||!/\D/.test(a[2])&&"0n+"+a[2]||a[2]);a[2]=b[1]+(b[2]||1)-0,a[3]=b[3]-0}else a[2]&&m.error(a[0]);a[0]=e++;return a},ATTR:function(a,b,c,d,e,f){var g=a[1]=a[1].replace(j,"");!f&&o.attrMap[g]&&(a[1]=o.attrMap[g]),a[4]=(a[4]||a[5]||"").replace(j,""),a[2]==="~="&&(a[4]=" "+a[4]+" ");return a},PSEUDO:function(b,c,d,e,f){if(b[1]==="not")if((a.exec(b[3])||"").length>1||/^\w/.test(b[3]))b[3]=m(b[3],null,null,c);else{var g=m.filter(b[3],c,d,!0^f);d||e.push.apply(e,g);return!1}else if(o.match.POS.test(b[0])||o.match.CHILD.test(b[0]))return!0;return b},POS:function(a){a.unshift(!0);return a}},filters:{enabled:function(a){return a.disabled===!1&&a.type!=="hidden"},disabled:function(a){return a.disabled===!0},checked:function(a){return a.checked===!0},selected:function(a){a.parentNode&&a.parentNode.selectedIndex;return a.selected===!0},parent:function(a){return!!a.firstChild},empty:function(a){return!a.firstChild},has:function(a,b,c){return!!m(c[3],a).length},header:function(a){return/h\d/i.test(a.nodeName)},text:function(a){var b=a.getAttribute("type"),c=a.type;return a.nodeName.toLowerCase()==="input"&&"text"===c&&(b===c||b===null)},radio:function(a){return a.nodeName.toLowerCase()==="input"&&"radio"===a.type},checkbox:function(a){return a.nodeName.toLowerCase()==="input"&&"checkbox"===a.type},file:function(a){return a.nodeName.toLowerCase()==="input"&&"file"===a.type},password:function(a){return a.nodeName.toLowerCase()==="input"&&"password"===a.type},submit:function(a){var b=a.nodeName.toLowerCase();return(b==="input"||b==="button")&&"submit"===a.type},image:function(a){return a.nodeName.toLowerCase()==="input"&&"image"===a.type},reset:function(a){var b=a.nodeName.toLowerCase();return(b==="input"||b==="button")&&"reset"===a.type},button:function(a){var b=a.nodeName.toLowerCase();return b==="input"&&"button"===a.type||b==="button"},input:function(a){return/input|select|textarea|button/i.test(a.nodeName)},focus:function(a){return a===a.ownerDocument.activeElement}},setFilters:{first:function(a,b){return b===0},last:function(a,b,c,d){return b===d.length-1},even:function(a,b){return b%2===0},odd:function(a,b){return b%2===1},lt:function(a,b,c){return b<c[3]-0},gt:function(a,b,c){return b>c[3]-0},nth:function(a,b,c){return c[3]-0===b},eq:function(a,b,c){return c[3]-0===b}},filter:{PSEUDO:function(a,b,c,d){var e=b[1],f=o.filters[e];if(f)return f(a,c,b,d);if(e==="contains")return(a.textContent||a.innerText||n([a])||"").indexOf(b[3])>=0;if(e==="not"){var g=b[3];for(var h=0,i=g.length;h<i;h++)if(g[h]===a)return!1;return!0}m.error(e)},CHILD:function(a,b){var c,e,f,g,h,i,j,k=b[1],l=a;switch(k){case"only":case"first":while(l=l.previousSibling)if(l.nodeType===1)return!1;if(k==="first")return!0;l=a;case"last":while(l=l.nextSibling)if(l.nodeType===1)return!1;return!0;case"nth":c=b[2],e=b[3];if(c===1&&e===0)return!0;f=b[0],g=a.parentNode;if(g&&(g[d]!==f||!a.nodeIndex)){i=0;for(l=g.firstChild;l;l=l.nextSibling)l.nodeType===1&&(l.nodeIndex=++i);g[d]=f}j=a.nodeIndex-e;return c===0?j===0:j%c===0&&j/c>=0}},ID:function(a,b){return a.nodeType===1&&a.getAttribute("id")===b},TAG:function(a,b){return b==="*"&&a.nodeType===1||!!a.nodeName&&a.nodeName.toLowerCase()===b},CLASS:function(a,b){return(" "+(a.className||a.getAttribute("class"))+" ").indexOf(b)>-1},ATTR:function(a,b){var c=b[1],d=m.attr?m.attr(a,c):o.attrHandle[c]?o.attrHandle[c](a):a[c]!=null?a[c]:a.getAttribute(c),e=d+"",f=b[2],g=b[4];return d==null?f==="!=":!f&&m.attr?d!=null:f==="="?e===g:f==="*="?e.indexOf(g)>=0:f==="~="?(" "+e+" ").indexOf(g)>=0:g?f==="!="?e!==g:f==="^="?e.indexOf(g)===0:f==="$="?e.substr(e.length-g.length)===g:f==="|="?e===g||e.substr(0,g.length+1)===g+"-":!1:e&&d!==!1},POS:function(a,b,c,d){var e=b[2],f=o.setFilters[e];if(f)return f(a,c,b,d)}}},p=o.match.POS,q=function(a,b){return"\\"+(b-0+1)};for(var r in o.match)o.match[r]=new RegExp(o.match[r].source+/(?![^\[]*\])(?![^\(]*\))/.source),o.leftMatch[r]=new RegExp(/(^(?:.|\r|\n)*?)/.source+o.match[r].source.replace(/\\(\d+)/g,q));var s=function(a,b){a=Array.prototype.slice.call(a,0);if(b){b.push.apply(b,a);return b}return a};try{Array.prototype.slice.call(c.documentElement.childNodes,0)[0].nodeType}catch(t){s=function(a,b){var c=0,d=b||[];if(g.call(a)==="[object Array]")Array.prototype.push.apply(d,a);else if(typeof a.length=="number")for(var e=a.length;c<e;c++)d.push(a[c]);else for(;a[c];c++)d.push(a[c]);return d}}var u,v;c.documentElement.compareDocumentPosition?u=function(a,b){if(a===b){h=!0;return 0}if(!a.compareDocumentPosition||!b.compareDocumentPosition)return a.compareDocumentPosition?-1:1;return a.compareDocumentPosition(b)&4?-1:1}:(u=function(a,b){if(a===b){h=!0;return 0}if(a.sourceIndex&&b.sourceIndex)return a.sourceIndex-b.sourceIndex;var c,d,e=[],f=[],g=a.parentNode,i=b.parentNode,j=g;if(g===i)return v(a,b);if(!g)return-1;if(!i)return 1;while(j)e.unshift(j),j=j.parentNode;j=i;while(j)f.unshift(j),j=j.parentNode;c=e.length,d=f.length;for(var k=0;k<c&&k<d;k++)if(e[k]!==f[k])return v(e[k],f[k]);return k===c?v(a,f[k],-1):v(e[k],b,1)},v=function(a,b,c){if(a===b)return c;var d=a.nextSibling;while(d){if(d===b)return-1;d=d.nextSibling}return 1}),function(){var a=c.createElement("div"),d="script"+(new Date).getTime(),e=c.documentElement;a.innerHTML="<a name='"+d+"'/>",e.insertBefore(a,e.firstChild),c.getElementById(d)&&(o.find.ID=function(a,c,d){if(typeof c.getElementById!="undefined"&&!d){var e=c.getElementById(a[1]);return e?e.id===a[1]||typeof e.getAttributeNode!="undefined"&&e.getAttributeNode("id").nodeValue===a[1]?[e]:b:[]}},o.filter.ID=function(a,b){var c=typeof a.getAttributeNode!="undefined"&&a.getAttributeNode("id");return a.nodeType===1&&c&&c.nodeValue===b}),e.removeChild(a),e=a=null}(),function(){var a=c.createElement("div");a.appendChild(c.createComment("")),a.getElementsByTagName("*").length>0&&(o.find.TAG=function(a,b){var c=b.getElementsByTagName(a[1]);if(a[1]==="*"){var d=[];for(var e=0;c[e];e++)c[e].nodeType===1&&d.push(c[e]);c=d}return c}),a.innerHTML="<a href='#'></a>",a.firstChild&&typeof a.firstChild.getAttribute!="undefined"&&a.firstChild.getAttribute("href")!=="#"&&(o.attrHandle.href=function(a){return a.getAttribute("href",2)}),a=null}(),c.querySelectorAll&&function(){var a=m,b=c.createElement("div"),d="__sizzle__";b.innerHTML="<p class='TEST'></p>";if(!b.querySelectorAll||b.querySelectorAll(".TEST").length!==0){m=function(b,e,f,g){e=e||c;if(!g&&!m.isXML(e)){var h=/^(\w+$)|^\.([\w\-]+$)|^#([\w\-]+$)/.exec(b);if(h&&(e.nodeType===1||e.nodeType===9)){if(h[1])return s(e.getElementsByTagName(b),f);if(h[2]&&o.find.CLASS&&e.getElementsByClassName)return s(e.getElementsByClassName(h[2]),f)}if(e.nodeType===9){if(b==="body"&&e.body)return s([e.body],f);if(h&&h[3]){var i=e.getElementById(h[3]);if(!i||!i.parentNode)return s([],f);if(i.id===h[3])return s([i],f)}try{return s(e.querySelectorAll(b),f)}catch(j){}}else if(e.nodeType===1&&e.nodeName.toLowerCase()!=="object"){var k=e,l=e.getAttribute("id"),n=l||d,p=e.parentNode,q=/^\s*[+~]/.test(b);l?n=n.replace(/'/g,"\\$&"):e.setAttribute("id",n),q&&p&&(e=e.parentNode);try{if(!q||p)return s(e.querySelectorAll("[id='"+n+"'] "+b),f)}catch(r){}finally{l||k.removeAttribute("id")}}}return a(b,e,f,g)};for(var e in a)m[e]=a[e];b=null}}(),function(){var a=c.documentElement,b=a.matchesSelector||a.mozMatchesSelector||a.webkitMatchesSelector||a.msMatchesSelector;if(b){var d=!b.call(c.createElement("div"),"div"),e=!1;try{b.call(c.documentElement,"[test!='']:sizzle")}catch(f){e=!0}m.matchesSelector=function(a,c){c=c.replace(/\=\s*([^'"\]]*)\s*\]/g,"='$1']");if(!m.isXML(a))try{if(e||!o.match.PSEUDO.test(c)&&!/!=/.test(c)){var f=b.call(a,c);if(f||!d||a.document&&a.document.nodeType!==11)return f}}catch(g){}return m(c,null,null,[a]).length>0}}}(),function(){var a=c.createElement("div");a.innerHTML="<div class='test e'></div><div class='test'></div>";if(!!a.getElementsByClassName&&a.getElementsByClassName("e").length!==0){a.lastChild.className="e";if(a.getElementsByClassName("e").length===1)return;o.order.splice(1,0,"CLASS"),o.find.CLASS=function(a,b,c){if(typeof b.getElementsByClassName!="undefined"&&!c)return b.getElementsByClassName(a[1])},a=null}}(),c.documentElement.contains?m.contains=function(a,b){return a!==b&&(a.contains?a.contains(b):!0)}:c.documentElement.compareDocumentPosition?m.contains=function(a,b){return!!(a.compareDocumentPosition(b)&16)}:m.contains=function(){return!1},m.isXML=function(a){var b=(a?a.ownerDocument||a:0).documentElement;return b?b.nodeName!=="HTML":!1};var y=function(a,b,c){var d,e=[],f="",g=b.nodeType?[b]:b;while(d=o.match.PSEUDO.exec(a))f+=d[0],a=a.replace(o.match.PSEUDO,"");a=o.relative[a]?a+"*":a;for(var h=0,i=g.length;h<i;h++)m(a,g[h],e,c);return m.filter(f,e)};m.attr=f.attr,m.selectors.attrMap={},f.find=m,f.expr=m.selectors,f.expr[":"]=f.expr.filters,f.unique=m.uniqueSort,f.text=m.getText,f.isXMLDoc=m.isXML,f.contains=m.contains}();var L=/Until$/,M=/^(?:parents|prevUntil|prevAll)/,N=/,/,O=/^.[^:#\[\.,]*$/,P=Array.prototype.slice,Q=f.expr.match.POS,R={children:!0,contents:!0,next:!0,prev:!0};f.fn.extend({find:function(a){var b=this,c,d;if(typeof a!="string")return f(a).filter(function(){for(c=0,d=b.length;c<d;c++)if(f.contains(b[c],this))return!0});var e=this.pushStack("","find",a),g,h,i;for(c=0,d=this.length;c<d;c++){g=e.length,f.find(a,this[c],e);if(c>0)for(h=g;h<e.length;h++)for(i=0;i<g;i++)if(e[i]===e[h]){e.splice(h--,1);break}}return e},has:function(a){var b=f(a);return this.filter(function(){for(var a=0,c=b.length;a<c;a++)if(f.contains(this,b[a]))return!0})},not:function(a){return this.pushStack(T(this,a,!1),"not",a)},filter:function(a){return this.pushStack(T(this,a,!0),"filter",a)},is:function(a){return!!a&&(typeof a=="string"?Q.test(a)?f(a,this.context).index(this[0])>=0:f.filter(a,this).length>0:this.filter(a).length>0)},closest:function(a,b){var c=[],d,e,g=this[0];if(f.isArray(a)){var h=1;while(g&&g.ownerDocument&&g!==b){for(d=0;d<a.length;d++)f(g).is(a[d])&&c.push({selector:a[d],elem:g,level:h});g=g.parentNode,h++}return c}var i=Q.test(a)||typeof a!="string"?f(a,b||this.context):0;for(d=0,e=this.length;d<e;d++){g=this[d];while(g){if(i?i.index(g)>-1:f.find.matchesSelector(g,a)){c.push(g);break}g=g.parentNode;if(!g||!g.ownerDocument||g===b||g.nodeType===11)break}}c=c.length>1?f.unique(c):c;return this.pushStack(c,"closest",a)},index:function(a){if(!a)return this[0]&&this[0].parentNode?this.prevAll().length:-1;if(typeof a=="string")return f.inArray(this[0],f(a));return f.inArray(a.jquery?a[0]:a,this)},add:function(a,b){var c=typeof a=="string"?f(a,b):f.makeArray(a&&a.nodeType?[a]:a),d=f.merge(this.get(),c);return this.pushStack(S(c[0])||S(d[0])?d:f.unique(d))},andSelf:function(){return this.add(this.prevObject)}}),f.each({parent:function(a){var b=a.parentNode;return b&&b.nodeType!==11?b:null},parents:function(a){return f.dir(a,"parentNode")},parentsUntil:function(a,b,c){return f.dir(a,"parentNode",c)},next:function(a){return f.nth(a,2,"nextSibling")},prev:function(a){return f.nth(a,2,"previousSibling")},nextAll:function(a){return f.dir(a,"nextSibling")},prevAll:function(a){return f.dir(a,"previousSibling")},nextUntil:function(a,b,c){return f.dir(a,"nextSibling",c)},prevUntil:function(a,b,c){return f.dir(a,"previousSibling",c)},siblings:function(a){return f.sibling(a.parentNode.firstChild,a)},children:function(a){return f.sibling(a.firstChild)},contents:function(a){return f.nodeName(a,"iframe")?a.contentDocument||a.contentWindow.document:f.makeArray(a.childNodes)}},function(a,b){f.fn[a]=function(c,d){var e=f.map(this,b,c);L.test(a)||(d=c),d&&typeof d=="string"&&(e=f.filter(d,e)),e=this.length>1&&!R[a]?f.unique(e):e,(this.length>1||N.test(d))&&M.test(a)&&(e=e.reverse());return this.pushStack(e,a,P.call(arguments).join(","))}}),f.extend({filter:function(a,b,c){c&&(a=":not("+a+")");return b.length===1?f.find.matchesSelector(b[0],a)?[b[0]]:[]:f.find.matches(a,b)},dir:function(a,c,d){var e=[],g=a[c];while(g&&g.nodeType!==9&&(d===b||g.nodeType!==1||!f(g).is(d)))g.nodeType===1&&e.push(g),g=g[c];return e},nth:function(a,b,c,d){b=b||1;var e=0;for(;a;a=a[c])if(a.nodeType===1&&++e===b)break;return a},sibling:function(a,b){var c=[];for(;a;a=a.nextSibling)a.nodeType===1&&a!==b&&c.push(a);return c}});var V="abbr|article|aside|audio|canvas|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",W=/ jQuery\d+="(?:\d+|null)"/g,X=/^\s+/,Y=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/ig,Z=/<([\w:]+)/,$=/<tbody/i,_=/<|&#?\w+;/,ba=/<(?:script|style)/i,bb=/<(?:script|object|embed|option|style)/i,bc=new RegExp("<(?:"+V+")","i"),bd=/checked\s*(?:[^=]|=\s*.checked.)/i,be=/\/(java|ecma)script/i,bf=/^\s*<!(?:\[CDATA\[|\-\-)/,bg={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_default:[0,"",""]},bh=U(c);bg.optgroup=bg.option,bg.tbody=bg.tfoot=bg.colgroup=bg.caption=bg.thead,bg.th=bg.td,f.support.htmlSerialize||(bg._default=[1,"div<div>","</div>"]),f.fn.extend({text:function(a){if(f.isFunction(a))return this.each(function(b){var c=f(this);c.text(a.call(this,b,c.text()))});if(typeof a!="object"&&a!==b)return this.empty().append((this[0]&&this[0].ownerDocument||c).createTextNode(a));return f.text(this)},wrapAll:function(a){if(f.isFunction(a))return this.each(function(b){f(this).wrapAll(a.call(this,b))});if(this[0]){var b=f(a,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&b.insertBefore(this[0]),b.map(function(){var a=this;while(a.firstChild&&a.firstChild.nodeType===1)a=a.firstChild;return a}).append(this)}return this},wrapInner:function(a){if(f.isFunction(a))return this.each(function(b){f(this).wrapInner(a.call(this,b))});return this.each(function(){var b=f(this),c=b.contents();c.length?c.wrapAll(a):b.append(a)})},wrap:function(a){var b=f.isFunction(a);return this.each(function(c){f(this).wrapAll(b?a.call(this,c):a)})},unwrap:function(){return this.parent().each(function(){f.nodeName(this,"body")||f(this).replaceWith(this.childNodes)}).end()},append:function(){return this.domManip(arguments,!0,function(a){this.nodeType===1&&this.appendChild(a)})},prepend:function(){return this.domManip(arguments,!0,function(a){this.nodeType===1&&this.insertBefore(a,this.firstChild)})},before:function(){if(this[0]&&this[0].parentNode)return this.domManip(arguments,!1,function(a){this.parentNode.insertBefore(a,this)});if(arguments.length){var a=f.clean(arguments);a.push.apply(a,this.toArray());return this.pushStack(a,"before",arguments)}},after:function(){if(this[0]&&this[0].parentNode)return this.domManip(arguments,!1,function(a){this.parentNode.insertBefore(a,this.nextSibling)});if(arguments.length){var a=this.pushStack(this,"after",arguments);a.push.apply(a,f.clean(arguments));return a}},remove:function(a,b){for(var c=0,d;(d=this[c])!=null;c++)if(!a||f.filter(a,[d]).length)!b&&d.nodeType===1&&(f.cleanData(d.getElementsByTagName("*")),f.cleanData([d])),d.parentNode&&d.parentNode.removeChild(d);return this},empty:function()
{for(var a=0,b;(b=this[a])!=null;a++){b.nodeType===1&&f.cleanData(b.getElementsByTagName("*"));while(b.firstChild)b.removeChild(b.firstChild)}return this},clone:function(a,b){a=a==null?!1:a,b=b==null?a:b;return this.map(function(){return f.clone(this,a,b)})},html:function(a){if(a===b)return this[0]&&this[0].nodeType===1?this[0].innerHTML.replace(W,""):null;if(typeof a=="string"&&!ba.test(a)&&(f.support.leadingWhitespace||!X.test(a))&&!bg[(Z.exec(a)||["",""])[1].toLowerCase()]){a=a.replace(Y,"<$1></$2>");try{for(var c=0,d=this.length;c<d;c++)this[c].nodeType===1&&(f.cleanData(this[c].getElementsByTagName("*")),this[c].innerHTML=a)}catch(e){this.empty().append(a)}}else f.isFunction(a)?this.each(function(b){var c=f(this);c.html(a.call(this,b,c.html()))}):this.empty().append(a);return this},replaceWith:function(a){if(this[0]&&this[0].parentNode){if(f.isFunction(a))return this.each(function(b){var c=f(this),d=c.html();c.replaceWith(a.call(this,b,d))});typeof a!="string"&&(a=f(a).detach());return this.each(function(){var b=this.nextSibling,c=this.parentNode;f(this).remove(),b?f(b).before(a):f(c).append(a)})}return this.length?this.pushStack(f(f.isFunction(a)?a():a),"replaceWith",a):this},detach:function(a){return this.remove(a,!0)},domManip:function(a,c,d){var e,g,h,i,j=a[0],k=[];if(!f.support.checkClone&&arguments.length===3&&typeof j=="string"&&bd.test(j))return this.each(function(){f(this).domManip(a,c,d,!0)});if(f.isFunction(j))return this.each(function(e){var g=f(this);a[0]=j.call(this,e,c?g.html():b),g.domManip(a,c,d)});if(this[0]){i=j&&j.parentNode,f.support.parentNode&&i&&i.nodeType===11&&i.childNodes.length===this.length?e={fragment:i}:e=f.buildFragment(a,this,k),h=e.fragment,h.childNodes.length===1?g=h=h.firstChild:g=h.firstChild;if(g){c=c&&f.nodeName(g,"tr");for(var l=0,m=this.length,n=m-1;l<m;l++)d.call(c?bi(this[l],g):this[l],e.cacheable||m>1&&l<n?f.clone(h,!0,!0):h)}k.length&&f.each(k,bp)}return this}}),f.buildFragment=function(a,b,d){var e,g,h,i,j=a[0];b&&b[0]&&(i=b[0].ownerDocument||b[0]),i.createDocumentFragment||(i=c),a.length===1&&typeof j=="string"&&j.length<512&&i===c&&j.charAt(0)==="<"&&!bb.test(j)&&(f.support.checkClone||!bd.test(j))&&(f.support.html5Clone||!bc.test(j))&&(g=!0,h=f.fragments[j],h&&h!==1&&(e=h)),e||(e=i.createDocumentFragment(),f.clean(a,i,e,d)),g&&(f.fragments[j]=h?e:1);return{fragment:e,cacheable:g}},f.fragments={},f.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,b){f.fn[a]=function(c){var d=[],e=f(c),g=this.length===1&&this[0].parentNode;if(g&&g.nodeType===11&&g.childNodes.length===1&&e.length===1){e[b](this[0]);return this}for(var h=0,i=e.length;h<i;h++){var j=(h>0?this.clone(!0):this).get();f(e[h])[b](j),d=d.concat(j)}return this.pushStack(d,a,e.selector)}}),f.extend({clone:function(a,b,c){var d,e,g,h=f.support.html5Clone||!bc.test("<"+a.nodeName)?a.cloneNode(!0):bo(a);if((!f.support.noCloneEvent||!f.support.noCloneChecked)&&(a.nodeType===1||a.nodeType===11)&&!f.isXMLDoc(a)){bk(a,h),d=bl(a),e=bl(h);for(g=0;d[g];++g)e[g]&&bk(d[g],e[g])}if(b){bj(a,h);if(c){d=bl(a),e=bl(h);for(g=0;d[g];++g)bj(d[g],e[g])}}d=e=null;return h},clean:function(a,b,d,e){var g;b=b||c,typeof b.createElement=="undefined"&&(b=b.ownerDocument||b[0]&&b[0].ownerDocument||c);var h=[],i;for(var j=0,k;(k=a[j])!=null;j++){typeof k=="number"&&(k+="");if(!k)continue;if(typeof k=="string")if(!_.test(k))k=b.createTextNode(k);else{k=k.replace(Y,"<$1></$2>");var l=(Z.exec(k)||["",""])[1].toLowerCase(),m=bg[l]||bg._default,n=m[0],o=b.createElement("div");b===c?bh.appendChild(o):U(b).appendChild(o),o.innerHTML=m[1]+k+m[2];while(n--)o=o.lastChild;if(!f.support.tbody){var p=$.test(k),q=l==="table"&&!p?o.firstChild&&o.firstChild.childNodes:m[1]==="<table>"&&!p?o.childNodes:[];for(i=q.length-1;i>=0;--i)f.nodeName(q[i],"tbody")&&!q[i].childNodes.length&&q[i].parentNode.removeChild(q[i])}!f.support.leadingWhitespace&&X.test(k)&&o.insertBefore(b.createTextNode(X.exec(k)[0]),o.firstChild),k=o.childNodes}var r;if(!f.support.appendChecked)if(k[0]&&typeof (r=k.length)=="number")for(i=0;i<r;i++)bn(k[i]);else bn(k);k.nodeType?h.push(k):h=f.merge(h,k)}if(d){g=function(a){return!a.type||be.test(a.type)};for(j=0;h[j];j++)if(e&&f.nodeName(h[j],"script")&&(!h[j].type||h[j].type.toLowerCase()==="text/javascript"))e.push(h[j].parentNode?h[j].parentNode.removeChild(h[j]):h[j]);else{if(h[j].nodeType===1){var s=f.grep(h[j].getElementsByTagName("script"),g);h.splice.apply(h,[j+1,0].concat(s))}d.appendChild(h[j])}}return h},cleanData:function(a){var b,c,d=f.cache,e=f.event.special,g=f.support.deleteExpando;for(var h=0,i;(i=a[h])!=null;h++){if(i.nodeName&&f.noData[i.nodeName.toLowerCase()])continue;c=i[f.expando];if(c){b=d[c];if(b&&b.events){for(var j in b.events)e[j]?f.event.remove(i,j):f.removeEvent(i,j,b.handle);b.handle&&(b.handle.elem=null)}g?delete i[f.expando]:i.removeAttribute&&i.removeAttribute(f.expando),delete d[c]}}}});var bq=/alpha\([^)]*\)/i,br=/opacity=([^)]*)/,bs=/([A-Z]|^ms)/g,bt=/^-?\d+(?:px)?$/i,bu=/^-?\d/,bv=/^([\-+])=([\-+.\de]+)/,bw={position:"absolute",visibility:"hidden",display:"block"},bx=["Left","Right"],by=["Top","Bottom"],bz,bA,bB;f.fn.css=function(a,c){if(arguments.length===2&&c===b)return this;return f.access(this,a,c,!0,function(a,c,d){return d!==b?f.style(a,c,d):f.css(a,c)})},f.extend({cssHooks:{opacity:{get:function(a,b){if(b){var c=bz(a,"opacity","opacity");return c===""?"1":c}return a.style.opacity}}},cssNumber:{fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":f.support.cssFloat?"cssFloat":"styleFloat"},style:function(a,c,d,e){if(!!a&&a.nodeType!==3&&a.nodeType!==8&&!!a.style){var g,h,i=f.camelCase(c),j=a.style,k=f.cssHooks[i];c=f.cssProps[i]||i;if(d===b){if(k&&"get"in k&&(g=k.get(a,!1,e))!==b)return g;return j[c]}h=typeof d,h==="string"&&(g=bv.exec(d))&&(d=+(g[1]+1)*+g[2]+parseFloat(f.css(a,c)),h="number");if(d==null||h==="number"&&isNaN(d))return;h==="number"&&!f.cssNumber[i]&&(d+="px");if(!k||!("set"in k)||(d=k.set(a,d))!==b)try{j[c]=d}catch(l){}}},css:function(a,c,d){var e,g;c=f.camelCase(c),g=f.cssHooks[c],c=f.cssProps[c]||c,c==="cssFloat"&&(c="float");if(g&&"get"in g&&(e=g.get(a,!0,d))!==b)return e;if(bz)return bz(a,c)},swap:function(a,b,c){var d={};for(var e in b)d[e]=a.style[e],a.style[e]=b[e];c.call(a);for(e in b)a.style[e]=d[e]}}),f.curCSS=f.css,f.each(["height","width"],function(a,b){f.cssHooks[b]={get:function(a,c,d){var e;if(c){if(a.offsetWidth!==0)return bC(a,b,d);f.swap(a,bw,function(){e=bC(a,b,d)});return e}},set:function(a,b){if(!bt.test(b))return b;b=parseFloat(b);if(b>=0)return b+"px"}}}),f.support.opacity||(f.cssHooks.opacity={get:function(a,b){return br.test((b&&a.currentStyle?a.currentStyle.filter:a.style.filter)||"")?parseFloat(RegExp.$1)/100+"":b?"1":""},set:function(a,b){var c=a.style,d=a.currentStyle,e=f.isNumeric(b)?"alpha(opacity="+b*100+")":"",g=d&&d.filter||c.filter||"";c.zoom=1;if(b>=1&&f.trim(g.replace(bq,""))===""){c.removeAttribute("filter");if(d&&!d.filter)return}c.filter=bq.test(g)?g.replace(bq,e):g+" "+e}}),f(function(){f.support.reliableMarginRight||(f.cssHooks.marginRight={get:function(a,b){var c;f.swap(a,{display:"inline-block"},function(){b?c=bz(a,"margin-right","marginRight"):c=a.style.marginRight});return c}})}),c.defaultView&&c.defaultView.getComputedStyle&&(bA=function(a,b){var c,d,e;b=b.replace(bs,"-$1").toLowerCase(),(d=a.ownerDocument.defaultView)&&(e=d.getComputedStyle(a,null))&&(c=e.getPropertyValue(b),c===""&&!f.contains(a.ownerDocument.documentElement,a)&&(c=f.style(a,b)));return c}),c.documentElement.currentStyle&&(bB=function(a,b){var c,d,e,f=a.currentStyle&&a.currentStyle[b],g=a.style;f===null&&g&&(e=g[b])&&(f=e),!bt.test(f)&&bu.test(f)&&(c=g.left,d=a.runtimeStyle&&a.runtimeStyle.left,d&&(a.runtimeStyle.left=a.currentStyle.left),g.left=b==="fontSize"?"1em":f||0,f=g.pixelLeft+"px",g.left=c,d&&(a.runtimeStyle.left=d));return f===""?"auto":f}),bz=bA||bB,f.expr&&f.expr.filters&&(f.expr.filters.hidden=function(a){var b=a.offsetWidth,c=a.offsetHeight;return b===0&&c===0||!f.support.reliableHiddenOffsets&&(a.style&&a.style.display||f.css(a,"display"))==="none"},f.expr.filters.visible=function(a){return!f.expr.filters.hidden(a)});var bD=/%20/g,bE=/\[\]$/,bF=/\r?\n/g,bG=/#.*$/,bH=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg,bI=/^(?:color|date|datetime|datetime-local|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,bJ=/^(?:about|app|app\-storage|.+\-extension|file|res|widget):$/,bK=/^(?:GET|HEAD)$/,bL=/^\/\//,bM=/\?/,bN=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,bO=/^(?:select|textarea)/i,bP=/\s+/,bQ=/([?&])_=[^&]*/,bR=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/,bS=f.fn.load,bT={},bU={},bV,bW,bX=["*/"]+["*"];try{bV=e.href}catch(bY){bV=c.createElement("a"),bV.href="",bV=bV.href}bW=bR.exec(bV.toLowerCase())||[],f.fn.extend({load:function(a,c,d){if(typeof a!="string"&&bS)return bS.apply(this,arguments);if(!this.length)return this;var e=a.indexOf(" ");if(e>=0){var g=a.slice(e,a.length);a=a.slice(0,e)}var h="GET";c&&(f.isFunction(c)?(d=c,c=b):typeof c=="object"&&(c=f.param(c,f.ajaxSettings.traditional),h="POST"));var i=this;f.ajax({url:a,type:h,dataType:"html",data:c,complete:function(a,b,c){c=a.responseText,a.isResolved()&&(a.done(function(a){c=a}),i.html(g?f("<div>").append(c.replace(bN,"")).find(g):c)),d&&i.each(d,[c,b,a])}});return this},serialize:function(){return f.param(this.serializeArray())},serializeArray:function(){return this.map(function(){return this.elements?f.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||bO.test(this.nodeName)||bI.test(this.type))}).map(function(a,b){var c=f(this).val();return c==null?null:f.isArray(c)?f.map(c,function(a,c){return{name:b.name,value:a.replace(bF,"\r\n")}}):{name:b.name,value:c.replace(bF,"\r\n")}}).get()}}),f.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "),function(a,b){f.fn[b]=function(a){return this.on(b,a)}}),f.each(["get","post"],function(a,c){f[c]=function(a,d,e,g){f.isFunction(d)&&(g=g||e,e=d,d=b);return f.ajax({type:c,url:a,data:d,success:e,dataType:g})}}),f.extend({getScript:function(a,c){return f.get(a,b,c,"script")},getJSON:function(a,b,c){return f.get(a,b,c,"json")},ajaxSetup:function(a,b){b?b_(a,f.ajaxSettings):(b=a,a=f.ajaxSettings),b_(a,b);return a},ajaxSettings:{url:bV,isLocal:bJ.test(bW[1]),global:!0,type:"GET",contentType:"application/x-www-form-urlencoded",processData:!0,async:!0,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":bX},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},converters:{"* text":a.String,"text html":!0,"text json":f.parseJSON,"text xml":f.parseXML},flatOptions:{context:!0,url:!0}},ajaxPrefilter:bZ(bT),ajaxTransport:bZ(bU),ajax:function(a,c){function w(a,c,l,m){if(s!==2){s=2,q&&clearTimeout(q),p=b,n=m||"",v.readyState=a>0?4:0;var o,r,u,w=c,x=l?cb(d,v,l):b,y,z;if(a>=200&&a<300||a===304){if(d.ifModified){if(y=v.getResponseHeader("Last-Modified"))f.lastModified[k]=y;if(z=v.getResponseHeader("Etag"))f.etag[k]=z}if(a===304)w="notmodified",o=!0;else try{r=cc(d,x),w="success",o=!0}catch(A){w="parsererror",u=A}}else{u=w;if(!w||a)w="error",a<0&&(a=0)}v.status=a,v.statusText=""+(c||w),o?h.resolveWith(e,[r,w,v]):h.rejectWith(e,[v,w,u]),v.statusCode(j),j=b,t&&g.trigger("ajax"+(o?"Success":"Error"),[v,d,o?r:u]),i.fireWith(e,[v,w]),t&&(g.trigger("ajaxComplete",[v,d]),--f.active||f.event.trigger("ajaxStop"))}}typeof a=="object"&&(c=a,a=b),c=c||{};var d=f.ajaxSetup({},c),e=d.context||d,g=e!==d&&(e.nodeType||e instanceof f)?f(e):f.event,h=f.Deferred(),i=f.Callbacks("once memory"),j=d.statusCode||{},k,l={},m={},n,o,p,q,r,s=0,t,u,v={readyState:0,setRequestHeader:function(a,b){if(!s){var c=a.toLowerCase();a=m[c]=m[c]||a,l[a]=b}return this},getAllResponseHeaders:function(){return s===2?n:null},getResponseHeader:function(a){var c;if(s===2){if(!o){o={};while(c=bH.exec(n))o[c[1].toLowerCase()]=c[2]}c=o[a.toLowerCase()]}return c===b?null:c},overrideMimeType:function(a){s||(d.mimeType=a);return this},abort:function(a){a=a||"abort",p&&p.abort(a),w(0,a);return this}};h.promise(v),v.success=v.done,v.error=v.fail,v.complete=i.add,v.statusCode=function(a){if(a){var b;if(s<2)for(b in a)j[b]=[j[b],a[b]];else b=a[v.status],v.then(b,b)}return this},d.url=((a||d.url)+"").replace(bG,"").replace(bL,bW[1]+"//"),d.dataTypes=f.trim(d.dataType||"*").toLowerCase().split(bP),d.crossDomain==null&&(r=bR.exec(d.url.toLowerCase()),d.crossDomain=!(!r||r[1]==bW[1]&&r[2]==bW[2]&&(r[3]||(r[1]==="http:"?80:443))==(bW[3]||(bW[1]==="http:"?80:443)))),d.data&&d.processData&&typeof d.data!="string"&&(d.data=f.param(d.data,d.traditional)),b$(bT,d,c,v);if(s===2)return!1;t=d.global,d.type=d.type.toUpperCase(),d.hasContent=!bK.test(d.type),t&&f.active++===0&&f.event.trigger("ajaxStart");if(!d.hasContent){d.data&&(d.url+=(bM.test(d.url)?"&":"?")+d.data,delete d.data),k=d.url;if(d.cache===!1){var x=f.now(),y=d.url.replace(bQ,"$1_="+x);d.url=y+(y===d.url?(bM.test(d.url)?"&":"?")+"_="+x:"")}}(d.data&&d.hasContent&&d.contentType!==!1||c.contentType)&&v.setRequestHeader("Content-Type",d.contentType),d.ifModified&&(k=k||d.url,f.lastModified[k]&&v.setRequestHeader("If-Modified-Since",f.lastModified[k]),f.etag[k]&&v.setRequestHeader("If-None-Match",f.etag[k])),v.setRequestHeader("Accept",d.dataTypes[0]&&d.accepts[d.dataTypes[0]]?d.accepts[d.dataTypes[0]]+(d.dataTypes[0]!=="*"?", "+bX+"; q=0.01":""):d.accepts["*"]);for(u in d.headers)v.setRequestHeader(u,d.headers[u]);if(d.beforeSend&&(d.beforeSend.call(e,v,d)===!1||s===2)){v.abort();return!1}for(u in{success:1,error:1,complete:1})v[u](d[u]);p=b$(bU,d,c,v);if(!p)w(-1,"No Transport");else{v.readyState=1,t&&g.trigger("ajaxSend",[v,d]),d.async&&d.timeout>0&&(q=setTimeout(function(){v.abort("timeout")},d.timeout));try{s=1,p.send(l,w)}catch(z){if(s<2)w(-1,z);else throw z}}return v},param:function(a,c){var d=[],e=function(a,b){b=f.isFunction(b)?b():b,d[d.length]=encodeURIComponent(a)+"="+encodeURIComponent(b)};c===b&&(c=f.ajaxSettings.traditional);if(f.isArray(a)||a.jquery&&!f.isPlainObject(a))f.each(a,function(){e(this.name,this.value)});else for(var g in a)ca(g,a[g],c,e);return d.join("&").replace(bD,"+")}}),f.extend({active:0,lastModified:{},etag:{}});var cd=f.now(),ce=/(\=)\?(&|$)|\?\?/i;f.ajaxSetup({jsonp:"callback",jsonpCallback:function(){return f.expando+"_"+cd++}}),f.ajaxPrefilter("json jsonp",function(b,c,d){var e=b.contentType==="application/x-www-form-urlencoded"&&typeof b.data=="string";if(b.dataTypes[0]==="jsonp"||b.jsonp!==!1&&(ce.test(b.url)||e&&ce.test(b.data))){var g,h=b.jsonpCallback=f.isFunction(b.jsonpCallback)?b.jsonpCallback():b.jsonpCallback,i=a[h],j=b.url,k=b.data,l="$1"+h+"$2";b.jsonp!==!1&&(j=j.replace(ce,l),b.url===j&&(e&&(k=k.replace(ce,l)),b.data===k&&(j+=(/\?/.test(j)?"&":"?")+b.jsonp+"="+h))),b.url=j,b.data=k,a[h]=function(a){g=[a]},d.always(function(){a[h]=i,g&&f.isFunction(i)&&a[h](g[0])}),b.converters["script json"]=function(){g||f.error(h+" was not called");return g[0]},b.dataTypes[0]="json";return"script"}}),f.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{"text script":function(a){f.globalEval(a);return a}}}),f.ajaxPrefilter("script",function(a){a.cache===b&&(a.cache=!1),a.crossDomain&&(a.type="GET",a.global=!1)}),f.ajaxTransport("script",function(a){if(a.crossDomain){var d,e=c.head||c.getElementsByTagName("head")[0]||c.documentElement;return{send:function(f,g){d=c.createElement("script"),d.async="async",a.scriptCharset&&(d.charset=a.scriptCharset),d.src=a.url,d.onload=d.onreadystatechange=function(a,c){if(c||!d.readyState||/loaded|complete/.test(d.readyState))d.onload=d.onreadystatechange=null,e&&d.parentNode&&e.removeChild(d),d=b,c||g(200,"success")},e.insertBefore(d,e.firstChild)},abort:function(){d&&d.onload(0,1)}}}});var cf=a.ActiveXObject?function(){for(var a in ch)ch[a](0,1)}:!1,cg=0,ch;f.ajaxSettings.xhr=a.ActiveXObject?function(){return!this.isLocal&&ci()||cj()}:ci,function(a){f.extend(f.support,{ajax:!!a,cors:!!a&&"withCredentials"in a})}(f.ajaxSettings.xhr()),f.support.ajax&&f.ajaxTransport(function(c){if(!c.crossDomain||f.support.cors){var d;return{send:function(e,g){var h=c.xhr(),i,j;c.username?h.open(c.type,c.url,c.async,c.username,c.password):h.open(c.type,c.url,c.async);if(c.xhrFields)for(j in c.xhrFields)h[j]=c.xhrFields[j];c.mimeType&&h.overrideMimeType&&h.overrideMimeType(c.mimeType),!c.crossDomain&&!e["X-Requested-With"]&&(e["X-Requested-With"]="XMLHttpRequest");try{for(j in e)h.setRequestHeader(j,e[j])}catch(k){}h.send(c.hasContent&&c.data||null),d=function(a,e){var j,k,l,m,n;try{if(d&&(e||h.readyState===4)){d=b,i&&(h.onreadystatechange=f.noop,cf&&delete ch[i]);if(e)h.readyState!==4&&h.abort();else{j=h.status,l=h.getAllResponseHeaders(),m={},n=h.responseXML,n&&n.documentElement&&(m.xml=n),m.text=h.responseText;try{k=h.statusText}catch(o){k=""}!j&&c.isLocal&&!c.crossDomain?j=m.text?200:404:j===1223&&(j=204)}}}catch(p){e||g(-1,p)}m&&g(j,k,m,l)},!c.async||h.readyState===4?d():(i=++cg,cf&&(ch||(ch={},f(a).unload(cf)),ch[i]=d),h.onreadystatechange=d)},abort:function(){d&&d(0,1)}}}});var ck={},cl,cm,cn=/^(?:toggle|show|hide)$/,co=/^([+\-]=)?([\d+.\-]+)([a-z%]*)$/i,cp,cq=[["height","marginTop","marginBottom","paddingTop","paddingBottom"],["width","marginLeft","marginRight","paddingLeft","paddingRight"],["opacity"]],cr;f.fn.extend({show:function(a,b,c){var d,e;if(a||a===0)return this.animate(cu("show",3),a,b,c);for(var g=0,h=this.length;g<h;g++)d=this[g],d.style&&(e=d.style.display,!f._data(d,"olddisplay")&&e==="none"&&(e=d.style.display=""),e===""&&f.css(d,"display")==="none"&&f._data(d,"olddisplay",cv(d.nodeName)));for(g=0;g<h;g++){d=this[g];if(d.style){e=d.style.display;if(e===""||e==="none")d.style.display=f._data(d,"olddisplay")||""}}return this},hide:function(a,b,c){if(a||a===0)return this.animate(cu("hide",3),a,b,c);var d,e,g=0,h=this.length;for(;g<h;g++)d=this[g],d.style&&(e=f.css(d,"display"),e!=="none"&&!f._data(d,"olddisplay")&&f._data(d,"olddisplay",e));for(g=0;g<h;g++)this[g].style&&(this[g].style.display="none");return this},_toggle:f.fn.toggle,toggle:function(a,b,c){var d=typeof a=="boolean";f.isFunction(a)&&f.isFunction(b)?this._toggle.apply(this,arguments):a==null||d?this.each(function(){var b=d?a:f(this).is(":hidden");f(this)[b?"show":"hide"]()}):this.animate(cu("toggle",3),a,b,c);return this},fadeTo:function(a,b,c,d){return this.filter(":hidden").css("opacity",0).show().end().animate({opacity:b},a,c,d)},animate:function(a,b,c,d){function g(){e.queue===!1&&f._mark(this);var b=f.extend({},e),c=this.nodeType===1,d=c&&f(this).is(":hidden"),g,h,i,j,k,l,m,n,o;b.animatedProperties={};for(i in a){g=f.camelCase(i),i!==g&&(a[g]=a[i],delete a[i]),h=a[g],f.isArray(h)?(b.animatedProperties[g]=h[1],h=a[g]=h[0]):b.animatedProperties[g]=b.specialEasing&&b.specialEasing[g]||b.easing||"swing";if(h==="hide"&&d||h==="show"&&!d)return b.complete.call(this);c&&(g==="height"||g==="width")&&(b.overflow=[this.style.overflow,this.style.overflowX,this.style.overflowY],f.css(this,"display")==="inline"&&f.css(this,"float")==="none"&&(!f.support.inlineBlockNeedsLayout||cv(this.nodeName)==="inline"?this.style.display="inline-block":this.style.zoom=1))}b.overflow!=null&&(this.style.overflow="hidden");for(i in a)j=new f.fx(this,b,i),h=a[i],cn.test(h)?(o=f._data(this,"toggle"+i)||(h==="toggle"?d?"show":"hide":0),o?(f._data(this,"toggle"+i,o==="show"?"hide":"show"),j[o]()):j[h]()):(k=co.exec(h),l=j.cur(),k?(m=parseFloat(k[2]),n=k[3]||(f.cssNumber[i]?"":"px"),n!=="px"&&(f.style(this,i,(m||1)+n),l=(m||1)/j.cur()*l,f.style(this,i,l+n)),k[1]&&(m=(k[1]==="-="?-1:1)*m+l),j.custom(l,m,n)):j.custom(l,h,""));return!0}var e=f.speed(b,c,d);if(f.isEmptyObject(a))return this.each(e.complete,[!1]);a=f.extend({},a);return e.queue===!1?this.each(g):this.queue(e.queue,g)},stop:function(a,c,d){typeof a!="string"&&(d=c,c=a,a=b),c&&a!==!1&&this.queue(a||"fx",[]);return this.each(function(){function h(a,b,c){var e=b[c];f.removeData(a,c,!0),e.stop(d)}var b,c=!1,e=f.timers,g=f._data(this);d||f._unmark(!0,this);if(a==null)for(b in g)g[b]&&g[b].stop&&b.indexOf(".run")===b.length-4&&h(this,g,b);else g[b=a+".run"]&&g[b].stop&&h(this,g,b);for(b=e.length;b--;)e[b].elem===this&&(a==null||e[b].queue===a)&&(d?e[b](!0):e[b].saveState(),c=!0,e.splice(b,1));(!d||!c)&&f.dequeue(this,a)})}}),f.each({slideDown:cu("show",1),slideUp:cu("hide",1),slideToggle:cu("toggle",1),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(a,b){f.fn[a]=function(a,c,d){return this.animate(b,a,c,d)}}),f.extend({speed:function(a,b,c){var d=a&&typeof a=="object"?f.extend({},a):{complete:c||!c&&b||f.isFunction(a)&&a,duration:a,easing:c&&b||b&&!f.isFunction(b)&&b};d.duration=f.fx.off?0:typeof d.duration=="number"?d.duration:d.duration in f.fx.speeds?f.fx.speeds[d.duration]:f.fx.speeds._default;if(d.queue==null||d.queue===!0)d.queue="fx";d.old=d.complete,d.complete=function(a){f.isFunction(d.old)&&d.old.call(this),d.queue?f.dequeue(this,d.queue):a!==!1&&f._unmark(this)};return d},easing:{linear:function(a,b,c,d){return c+d*a},swing:function(a,b,c,d){return(-Math.cos(a*Math.PI)/2+.5)*d+c}},timers:[],fx:function(a,b,c){this.options=b,this.elem=a,this.prop=c,b.orig=b.orig||{}}}),f.fx.prototype={update:function(){this.options.step&&this.options.step.call(this.elem,this.now,this),(f.fx.step[this.prop]||f.fx.step._default)(this)},cur:function(){if(this.elem[this.prop]!=null&&(!this.elem.style||this.elem.style[this.prop]==null))return this.elem[this.prop];var a,b=f.css(this.elem,this.prop);return isNaN(a=parseFloat(b))?!b||b==="auto"?0:b:a},custom:function(a,c,d){function h(a){return e.step(a)}var e=this,g=f.fx;this.startTime=cr||cs(),this.end=c,this.now=this.start=a,this.pos=this.state=0,this.unit=d||this.unit||(f.cssNumber[this.prop]?"":"px"),h.queue=this.options.queue,h.elem=this.elem,h.saveState=function(){e.options.hide&&f._data(e.elem,"fxshow"+e.prop)===b&&f._data(e.elem,"fxshow"+e.prop,e.start)},h()&&f.timers.push(h)&&!cp&&(cp=setInterval(g.tick,g.interval))},show:function(){var a=f._data(this.elem,"fxshow"+this.prop);this.options.orig[this.prop]=a||f.style(this.elem,this.prop),this.options.show=!0,a!==b?this.custom(this.cur(),a):this.custom(this.prop==="width"||this.prop==="height"?1:0,this.cur()),f(this.elem).show()},hide:function(){this.options.orig[this.prop]=f._data(this.elem,"fxshow"+this.prop)||f.style(this.elem,this.prop),this.options.hide=!0,this.custom(this.cur(),0)},step:function(a){var b,c,d,e=cr||cs(),g=!0,h=this.elem,i=this.options;if(a||e>=i.duration+this.startTime){this.now=this.end,this.pos=this.state=1,this.update(),i.animatedProperties[this.prop]=!0;for(b in i.animatedProperties)i.animatedProperties[b]!==!0&&(g=!1);if(g){i.overflow!=null&&!f.support.shrinkWrapBlocks&&f.each(["","X","Y"],function(a,b){h.style["overflow"+b]=i.overflow[a]}),i.hide&&f(h).hide();if(i.hide||i.show)for(b in i.animatedProperties)f.style(h,b,i.orig[b]),f.removeData(h,"fxshow"+b,!0),f.removeData(h,"toggle"+b,!0);d=i.complete,d&&(i.complete=!1,d.call(h))}return!1}i.duration==Infinity?this.now=e:(c=e-this.startTime,this.state=c/i.duration,this.pos=f.easing[i.animatedProperties[this.prop]](this.state,c,0,1,i.duration),this.now=this.start+(this.end-this.start)*this.pos),this.update();return!0}},f.extend(f.fx,{tick:function(){var a,b=f.timers,c=0;for(;c<b.length;c++)a=b[c],!a()&&b[c]===a&&b.splice(c--,1);b.length||f.fx.stop()},interval:13,stop:function(){clearInterval(cp),cp=null},speeds:{slow:600,fast:200,_default:400},step:{opacity:function(a){f.style(a.elem,"opacity",a.now)},_default:function(a){a.elem.style&&a.elem.style[a.prop]!=null?a.elem.style[a.prop]=a.now+a.unit:a.elem[a.prop]=a.now}}}),f.each(["width","height"],function(a,b){f.fx.step[b]=function(a){f.style(a.elem,b,Math.max(0,a.now)+a.unit)}}),f.expr&&f.expr.filters&&(f.expr.filters.animated=function(a){return f.grep(f.timers,function(b){return a===b.elem}).length});var cw=/^t(?:able|d|h)$/i,cx=/^(?:body|html)$/i;"getBoundingClientRect"in c.documentElement?f.fn.offset=function(a){var b=this[0],c;if(a)return this.each(function(b){f.offset.setOffset(this,a,b)});if(!b||!b.ownerDocument)return null;if(b===b.ownerDocument.body)return f.offset.bodyOffset(b);try{c=b.getBoundingClientRect()}catch(d){}var e=b.ownerDocument,g=e.documentElement;if(!c||!f.contains(g,b))return c?{top:c.top,left:c.left}:{top:0,left:0};var h=e.body,i=cy(e),j=g.clientTop||h.clientTop||0,k=g.clientLeft||h.clientLeft||0,l=i.pageYOffset||f.support.boxModel&&g.scrollTop||h.scrollTop,m=i.pageXOffset||f.support.boxModel&&g.scrollLeft||h.scrollLeft,n=c.top+l-j,o=c.left+m-k;return{top:n,left:o}}:f.fn.offset=function(a){var b=this[0];if(a)return this.each(function(b){f.offset.setOffset(this,a,b)});if(!b||!b.ownerDocument)return null;if(b===b.ownerDocument.body)return f.offset.bodyOffset(b);var c,d=b.offsetParent,e=b,g=b.ownerDocument,h=g.documentElement,i=g.body,j=g.defaultView,k=j?j.getComputedStyle(b,null):b.currentStyle,l=b.offsetTop,m=b.offsetLeft;while((b=b.parentNode)&&b!==i&&b!==h){if(f.support.fixedPosition&&k.position==="fixed")break;c=j?j.getComputedStyle(b,null):b.currentStyle,l-=b.scrollTop,m-=b.scrollLeft,b===d&&(l+=b.offsetTop,m+=b.offsetLeft,f.support.doesNotAddBorder&&(!f.support.doesAddBorderForTableAndCells||!cw.test(b.nodeName))&&(l+=parseFloat(c.borderTopWidth)||0,m+=parseFloat(c.borderLeftWidth)||0),e=d,d=b.offsetParent),f.support.subtractsBorderForOverflowNotVisible&&c.overflow!=="visible"&&(l+=parseFloat(c.borderTopWidth)||0,m+=parseFloat(c.borderLeftWidth)||0),k=c}if(k.position==="relative"||k.position==="static")l+=i.offsetTop,m+=i.offsetLeft;f.support.fixedPosition&&k.position==="fixed"&&(l+=Math.max(h.scrollTop,i.scrollTop),m+=Math.max(h.scrollLeft,i.scrollLeft));return{top:l,left:m}},f.offset={bodyOffset:function(a){var b=a.offsetTop,c=a.offsetLeft;f.support.doesNotIncludeMarginInBodyOffset&&(b+=parseFloat(f.css(a,"marginTop"))||0,c+=parseFloat(f.css(a,"marginLeft"))||0);return{top:b,left:c}},setOffset:function(a,b,c){var d=f.css(a,"position");d==="static"&&(a.style.position="relative");var e=f(a),g=e.offset(),h=f.css(a,"top"),i=f.css(a,"left"),j=(d==="absolute"||d==="fixed")&&f.inArray("auto",[h,i])>-1,k={},l={},m,n;j?(l=e.position(),m=l.top,n=l.left):(m=parseFloat(h)||0,n=parseFloat(i)||0),f.isFunction(b)&&(b=b.call(a,c,g)),b.top!=null&&(k.top=b.top-g.top+m),b.left!=null&&(k.left=b.left-g.left+n),"using"in b?b.using.call(a,k):e.css(k)}},f.fn.extend({position:function(){if(!this[0])return null;var a=this[0],b=this.offsetParent(),c=this.offset(),d=cx.test(b[0].nodeName)?{top:0,left:0}:b.offset();c.top-=parseFloat(f.css(a,"marginTop"))||0,c.left-=parseFloat(f.css(a,"marginLeft"))||0,d.top+=parseFloat(f.css(b[0],"borderTopWidth"))||0,d.left+=parseFloat(f.css(b[0],"borderLeftWidth"))||0;return{top:c.top-d.top,left:c.left-d.left}},offsetParent:function(){return this.map(function(){var a=this.offsetParent||c.body;while(a&&!cx.test(a.nodeName)&&f.css(a,"position")==="static")a=a.offsetParent;return a})}}),f.each(["Left","Top"],function(a,c){var d="scroll"+c;f.fn[d]=function(c){var e,g;if(c===b){e=this[0];if(!e)return null;g=cy(e);return g?"pageXOffset"in g?g[a?"pageYOffset":"pageXOffset"]:f.support.boxModel&&g.document.documentElement[d]||g.document.body[d]:e[d]}return this.each(function(){g=cy(this),g?g.scrollTo(a?f(g).scrollLeft():c,a?c:f(g).scrollTop()):this[d]=c})}}),f.each(["Height","Width"],function(a,c){var d=c.toLowerCase();f.fn["inner"+c]=function(){var a=this[0];return a?a.style?parseFloat(f.css(a,d,"padding")):this[d]():null},f.fn["outer"+c]=function(a){var b=this[0];return b?b.style?parseFloat(f.css(b,d,a?"margin":"border")):this[d]():null},f.fn[d]=function(a){var e=this[0];if(!e)return a==null?null:this;if(f.isFunction(a))return this.each(function(b){var c=f(this);c[d](a.call(this,b,c[d]()))});if(f.isWindow(e)){var g=e.document.documentElement["client"+c],h=e.document.body;return e.document.compatMode==="CSS1Compat"&&g||h&&h["client"+c]||g}if(e.nodeType===9)return Math.max(e.documentElement["client"+c],e.body["scroll"+c],e.documentElement["scroll"+c],e.body["offset"+c],e.documentElement["offset"+c]);if(a===b){var i=f.css(e,d),j=parseFloat(i);return f.isNumeric(j)?j:i}return this.css(d,typeof a=="string"?a:a+"px")}}),a.jQuery=a.$=f,typeof define=="function"&&define.amd&&define.amd.jQuery&&define("jquery",[],function(){return f})})(window);

/* End of jquery-1.7.1.min.js */
/*! jQuery Validation Plugin - v1.13.0 - 7/1/2014
 * http://jqueryvalidation.org/
 * Copyright (c) 2014 JÃ¶rn Zaefferer; Licensed MIT */
!function (a) { "function" == typeof define && define.amd ? define(["jquery"], a) : a(jQuery) } (function (a) { a.extend(a.fn, { validate: function (b) { if (!this.length) return void (b && b.debug && window.console && console.warn("Nothing selected, can't validate, returning nothing.")); var c = a.data(this[0], "validator"); return c ? c : (this.attr("novalidate", "novalidate"), c = new a.validator(b, this[0]), a.data(this[0], "validator", c), c.settings.onsubmit && (this.validateDelegate(":submit", "click", function (b) { c.settings.submitHandler && (c.submitButton = b.target), a(b.target).hasClass("cancel") && (c.cancelSubmit = !0), void 0 !== a(b.target).attr("formnovalidate") && (c.cancelSubmit = !0) }), this.submit(function (b) { function d() { var d; return c.settings.submitHandler ? (c.submitButton && (d = a("<input type='hidden'/>").attr("name", c.submitButton.name).val(a(c.submitButton).val()).appendTo(c.currentForm)), c.settings.submitHandler.call(c, c.currentForm, b), c.submitButton && d.remove(), !1) : !0 } return c.settings.debug && b.preventDefault(), c.cancelSubmit ? (c.cancelSubmit = !1, d()) : c.form() ? c.pendingRequest ? (c.formSubmitted = !0, !1) : d() : (c.focusInvalid(), !1) })), c) }, valid: function () { var b, c; return a(this[0]).is("form") ? b = this.validate().form() : (b = !0, c = a(this[0].form).validate(), this.each(function () { b = c.element(this) && b })), b }, removeAttrs: function (b) { var c = {}, d = this; return a.each(b.split(/\s/), function (a, b) { c[b] = d.attr(b), d.removeAttr(b) }), c }, rules: function (b, c) { var d, e, f, g, h, i, j = this[0]; if (b) switch (d = a.data(j.form, "validator").settings, e = d.rules, f = a.validator.staticRules(j), b) { case "add": a.extend(f, a.validator.normalizeRule(c)), delete f.messages, e[j.name] = f, c.messages && (d.messages[j.name] = a.extend(d.messages[j.name], c.messages)); break; case "remove": return c ? (i = {}, a.each(c.split(/\s/), function (b, c) { i[c] = f[c], delete f[c], "required" === c && a(j).removeAttr("aria-required") }), i) : (delete e[j.name], f) } return g = a.validator.normalizeRules(a.extend({}, a.validator.classRules(j), a.validator.attributeRules(j), a.validator.dataRules(j), a.validator.staticRules(j)), j), g.required && (h = g.required, delete g.required, g = a.extend({ required: h }, g), a(j).attr("aria-required", "true")), g.remote && (h = g.remote, delete g.remote, g = a.extend(g, { remote: h })), g } }), a.extend(a.expr[":"], { blank: function (b) { return !a.trim("" + a(b).val()) }, filled: function (b) { return !!a.trim("" + a(b).val()) }, unchecked: function (b) { return !a(b).prop("checked") } }), a.validator = function (b, c) { this.settings = a.extend(!0, {}, a.validator.defaults, b), this.currentForm = c, this.init() }, a.validator.format = function (b, c) { return 1 === arguments.length ? function () { var c = a.makeArray(arguments); return c.unshift(b), a.validator.format.apply(this, c) } : (arguments.length > 2 && c.constructor !== Array && (c = a.makeArray(arguments).slice(1)), c.constructor !== Array && (c = [c]), a.each(c, function (a, c) { b = b.replace(new RegExp("\\{" + a + "\\}", "g"), function () { return c }) }), b) }, a.extend(a.validator, { defaults: { messages: {}, groups: {}, rules: {}, errorClass: "error", validClass: "valid", errorElement: "label", focusInvalid: !0, errorContainer: a([]), errorLabelContainer: a([]), onsubmit: !0, ignore: ":hidden", ignoreTitle: !1, onfocusin: function (a) { this.lastActive = a, this.settings.focusCleanup && !this.blockFocusCleanup && (this.settings.unhighlight && this.settings.unhighlight.call(this, a, this.settings.errorClass, this.settings.validClass), this.hideThese(this.errorsFor(a))) }, onfocusout: function (a) { this.checkable(a) || !(a.name in this.submitted) && this.optional(a) || this.element(a) }, onkeyup: function (a, b) { (9 !== b.which || "" !== this.elementValue(a)) && (a.name in this.submitted || a === this.lastElement) && this.element(a) }, onclick: function (a) { a.name in this.submitted ? this.element(a) : a.parentNode.name in this.submitted && this.element(a.parentNode) }, highlight: function (b, c, d) { "radio" === b.type ? this.findByName(b.name).addClass(c).removeClass(d) : a(b).addClass(c).removeClass(d) }, unhighlight: function (b, c, d) { "radio" === b.type ? this.findByName(b.name).removeClass(c).addClass(d) : a(b).removeClass(c).addClass(d) } }, setDefaults: function (b) { a.extend(a.validator.defaults, b) }, messages: { required: "This field is required.", remote: "Please fix this field.", email: "Please enter a valid email address.", url: "Please enter a valid URL.", date: "Please enter a valid date.", dateISO: "Please enter a valid date ( ISO ).", number: "Please enter a valid number.", digits: "Please enter only digits.", creditcard: "Please enter a valid credit card number.", equalTo: "Please enter the same value again.", maxlength: a.validator.format("Please enter no more than {0} characters."), minlength: a.validator.format("Please enter at least {0} characters."), rangelength: a.validator.format("Please enter a value between {0} and {1} characters long."), range: a.validator.format("Please enter a value between {0} and {1}."), max: a.validator.format("Please enter a value less than or equal to {0}."), min: a.validator.format("Please enter a value greater than or equal to {0}.") }, autoCreateRanges: !1, prototype: { init: function () { function b(b) { var c = a.data(this[0].form, "validator"), d = "on" + b.type.replace(/^validate/, ""), e = c.settings; e[d] && !this.is(e.ignore) && e[d].call(c, this[0], b) } this.labelContainer = a(this.settings.errorLabelContainer), this.errorContext = this.labelContainer.length && this.labelContainer || a(this.currentForm), this.containers = a(this.settings.errorContainer).add(this.settings.errorLabelContainer), this.submitted = {}, this.valueCache = {}, this.pendingRequest = 0, this.pending = {}, this.invalid = {}, this.reset(); var c, d = this.groups = {}; a.each(this.settings.groups, function (b, c) { "string" == typeof c && (c = c.split(/\s/)), a.each(c, function (a, c) { d[c] = b }) }), c = this.settings.rules, a.each(c, function (b, d) { c[b] = a.validator.normalizeRule(d) }), a(this.currentForm).validateDelegate(":text, [type='password'], [type='file'], select, textarea, [type='number'], [type='search'] ,[type='tel'], [type='url'], [type='email'], [type='datetime'], [type='date'], [type='month'], [type='week'], [type='time'], [type='datetime-local'], [type='range'], [type='color'], [type='radio'], [type='checkbox']", "focusin focusout keyup", b).validateDelegate("select, option, [type='radio'], [type='checkbox']", "click", b), this.settings.invalidHandler && a(this.currentForm).bind("invalid-form.validate", this.settings.invalidHandler), a(this.currentForm).find("[required], [data-rule-required], .required").attr("aria-required", "true") }, form: function () { return this.checkForm(), a.extend(this.submitted, this.errorMap), this.invalid = a.extend({}, this.errorMap), this.valid() || a(this.currentForm).triggerHandler("invalid-form", [this]), this.showErrors(), this.valid() }, checkForm: function () { this.prepareForm(); for (var a = 0, b = this.currentElements = this.elements(); b[a]; a++) this.check(b[a]); return this.valid() }, element: function (b) { var c = this.clean(b), d = this.validationTargetFor(c), e = !0; return this.lastElement = d, void 0 === d ? delete this.invalid[c.name] : (this.prepareElement(d), this.currentElements = a(d), e = this.check(d) !== !1, e ? delete this.invalid[d.name] : this.invalid[d.name] = !0), a(b).attr("aria-invalid", !e), this.numberOfInvalids() || (this.toHide = this.toHide.add(this.containers)), this.showErrors(), e }, showErrors: function (b) { if (b) { a.extend(this.errorMap, b), this.errorList = []; for (var c in b) this.errorList.push({ message: b[c], element: this.findByName(c)[0] }); this.successList = a.grep(this.successList, function (a) { return !(a.name in b) }) } this.settings.showErrors ? this.settings.showErrors.call(this, this.errorMap, this.errorList) : this.defaultShowErrors() }, resetForm: function () { a.fn.resetForm && a(this.currentForm).resetForm(), this.submitted = {}, this.lastElement = null, this.prepareForm(), this.hideErrors(), this.elements().removeClass(this.settings.errorClass).removeData("previousValue").removeAttr("aria-invalid") }, numberOfInvalids: function () { return this.objectLength(this.invalid) }, objectLength: function (a) { var b, c = 0; for (b in a) c++; return c }, hideErrors: function () { this.hideThese(this.toHide) }, hideThese: function (a) { a.not(this.containers).text(""), this.addWrapper(a).hide() }, valid: function () { return 0 === this.size() }, size: function () { return this.errorList.length }, focusInvalid: function () { if (this.settings.focusInvalid) try { a(this.findLastActive() || this.errorList.length && this.errorList[0].element || []).filter(":visible").focus().trigger("focusin") } catch (b) { } }, findLastActive: function () { var b = this.lastActive; return b && 1 === a.grep(this.errorList, function (a) { return a.element.name === b.name }).length && b }, elements: function () { var b = this, c = {}; return a(this.currentForm).find("input, select, textarea").not(":submit, :reset, :image, [disabled]").not(this.settings.ignore).filter(function () { return !this.name && b.settings.debug && window.console && console.error("%o has no name assigned", this), this.name in c || !b.objectLength(a(this).rules()) ? !1 : (c[this.name] = !0, !0) }) }, clean: function (b) { return a(b)[0] }, errors: function () { var b = this.settings.errorClass.split(" ").join("."); return a(this.settings.errorElement + "." + b, this.errorContext) }, reset: function () { this.successList = [], this.errorList = [], this.errorMap = {}, this.toShow = a([]), this.toHide = a([]), this.currentElements = a([]) }, prepareForm: function () { this.reset(), this.toHide = this.errors().add(this.containers) }, prepareElement: function (a) { this.reset(), this.toHide = this.errorsFor(a) }, elementValue: function (b) { var c, d = a(b), e = b.type; return "radio" === e || "checkbox" === e ? a("input[name='" + b.name + "']:checked").val() : "number" === e && "undefined" != typeof b.validity ? b.validity.badInput ? !1 : d.val() : (c = d.val(), "string" == typeof c ? c.replace(/\r/g, "") : c) }, check: function (b) { b = this.validationTargetFor(this.clean(b)); var c, d, e, f = a(b).rules(), g = a.map(f, function (a, b) { return b }).length, h = !1, i = this.elementValue(b); for (d in f) { e = { method: d, parameters: f[d] }; try { if (c = a.validator.methods[d].call(this, i, b, e.parameters), "dependency-mismatch" === c && 1 === g) { h = !0; continue } if (h = !1, "pending" === c) return void (this.toHide = this.toHide.not(this.errorsFor(b))); if (!c) return this.formatAndAdd(b, e), !1 } catch (j) { throw this.settings.debug && window.console && console.log("Exception occurred when checking element " + b.id + ", check the '" + e.method + "' method.", j), j } } if (!h) return this.objectLength(f) && this.successList.push(b), !0 }, customDataMessage: function (b, c) { return a(b).data("msg" + c.charAt(0).toUpperCase() + c.substring(1).toLowerCase()) || a(b).data("msg") }, customMessage: function (a, b) { var c = this.settings.messages[a]; return c && (c.constructor === String ? c : c[b]) }, findDefined: function () { for (var a = 0; a < arguments.length; a++) if (void 0 !== arguments[a]) return arguments[a]; return void 0 }, defaultMessage: function (b, c) { return this.findDefined(this.customMessage(b.name, c), this.customDataMessage(b, c), !this.settings.ignoreTitle && b.title || void 0, a.validator.messages[c], "<strong>Warning: No message defined for " + b.name + "</strong>") }, formatAndAdd: function (b, c) { var d = this.defaultMessage(b, c.method), e = /\$?\{(\d+)\}/g; "function" == typeof d ? d = d.call(this, c.parameters, b) : e.test(d) && (d = a.validator.format(d.replace(e, "{$1}"), c.parameters)), this.errorList.push({ message: d, element: b, method: c.method }), this.errorMap[b.name] = d, this.submitted[b.name] = d }, addWrapper: function (a) { return this.settings.wrapper && (a = a.add(a.parent(this.settings.wrapper))), a }, defaultShowErrors: function () { var a, b, c; for (a = 0; this.errorList[a]; a++) c = this.errorList[a], this.settings.highlight && this.settings.highlight.call(this, c.element, this.settings.errorClass, this.settings.validClass), this.showLabel(c.element, c.message); if (this.errorList.length && (this.toShow = this.toShow.add(this.containers)), this.settings.success) for (a = 0; this.successList[a]; a++) this.showLabel(this.successList[a]); if (this.settings.unhighlight) for (a = 0, b = this.validElements(); b[a]; a++) this.settings.unhighlight.call(this, b[a], this.settings.errorClass, this.settings.validClass); this.toHide = this.toHide.not(this.toShow), this.hideErrors(), this.addWrapper(this.toShow).show() }, validElements: function () { return this.currentElements.not(this.invalidElements()) }, invalidElements: function () { return a(this.errorList).map(function () { return this.element }) }, showLabel: function (b, c) { var d, e, f, g = this.errorsFor(b), h = this.idOrName(b), i = a(b).attr("aria-describedby"); g.length ? (g.removeClass(this.settings.validClass).addClass(this.settings.errorClass), g.html(c)) : (g = a("<" + this.settings.errorElement + ">").attr("id", h + "-error").addClass(this.settings.errorClass).html(c || ""), d = g, this.settings.wrapper && (d = g.hide().show().wrap("<" + this.settings.wrapper + "/>").parent()), this.labelContainer.length ? this.labelContainer.append(d) : this.settings.errorPlacement ? this.settings.errorPlacement(d, a(b)) : d.insertAfter(b), g.is("label") ? g.attr("for", h) : 0 === g.parents("label[for='" + h + "']").length && (f = g.attr("id"), i ? i.match(new RegExp("\b" + f + "\b")) || (i += " " + f) : i = f, a(b).attr("aria-describedby", i), e = this.groups[b.name], e && a.each(this.groups, function (b, c) { c === e && a("[name='" + b + "']", this.currentForm).attr("aria-describedby", g.attr("id")) }))), !c && this.settings.success && (g.text(""), "string" == typeof this.settings.success ? g.addClass(this.settings.success) : this.settings.success(g, b)), this.toShow = this.toShow.add(g) }, errorsFor: function (b) { var c = this.idOrName(b), d = a(b).attr("aria-describedby"), e = "label[for='" + c + "'], label[for='" + c + "'] *"; return d && (e = e + ", #" + d.replace(/\s+/g, ", #")), this.errors().filter(e) }, idOrName: function (a) { return this.groups[a.name] || (this.checkable(a) ? a.name : a.id || a.name) }, validationTargetFor: function (a) { return this.checkable(a) && (a = this.findByName(a.name).not(this.settings.ignore)[0]), a }, checkable: function (a) { return /radio|checkbox/i.test(a.type) }, findByName: function (b) { return a(this.currentForm).find("[name='" + b + "']") }, getLength: function (b, c) { switch (c.nodeName.toLowerCase()) { case "select": return a("option:selected", c).length; case "input": if (this.checkable(c)) return this.findByName(c.name).filter(":checked").length } return b.length }, depend: function (a, b) { return this.dependTypes[typeof a] ? this.dependTypes[typeof a](a, b) : !0 }, dependTypes: { "boolean": function (a) { return a }, string: function (b, c) { return !!a(b, c.form).length }, "function": function (a, b) { return a(b) } }, optional: function (b) { var c = this.elementValue(b); return !a.validator.methods.required.call(this, c, b) && "dependency-mismatch" }, startRequest: function (a) { this.pending[a.name] || (this.pendingRequest++, this.pending[a.name] = !0) }, stopRequest: function (b, c) { this.pendingRequest--, this.pendingRequest < 0 && (this.pendingRequest = 0), delete this.pending[b.name], c && 0 === this.pendingRequest && this.formSubmitted && this.form() ? (a(this.currentForm).submit(), this.formSubmitted = !1) : !c && 0 === this.pendingRequest && this.formSubmitted && (a(this.currentForm).triggerHandler("invalid-form", [this]), this.formSubmitted = !1) }, previousValue: function (b) { return a.data(b, "previousValue") || a.data(b, "previousValue", { old: null, valid: !0, message: this.defaultMessage(b, "remote") }) } }, classRuleSettings: { required: { required: !0 }, email: { email: !0 }, url: { url: !0 }, date: { date: !0 }, dateISO: { dateISO: !0 }, number: { number: !0 }, digits: { digits: !0 }, creditcard: { creditcard: !0} }, addClassRules: function (b, c) { b.constructor === String ? this.classRuleSettings[b] = c : a.extend(this.classRuleSettings, b) }, classRules: function (b) { var c = {}, d = a(b).attr("class"); return d && a.each(d.split(" "), function () { this in a.validator.classRuleSettings && a.extend(c, a.validator.classRuleSettings[this]) }), c }, attributeRules: function (b) { var c, d, e = {}, f = a(b), g = b.getAttribute("type"); for (c in a.validator.methods) "required" === c ? (d = b.getAttribute(c), "" === d && (d = !0), d = !!d) : d = f.attr(c), /min|max/.test(c) && (null === g || /number|range|text/.test(g)) && (d = Number(d)), d || 0 === d ? e[c] = d : g === c && "range" !== g && (e[c] = !0); return e.maxlength && /-1|2147483647|524288/.test(e.maxlength) && delete e.maxlength, e }, dataRules: function (b) { var c, d, e = {}, f = a(b); for (c in a.validator.methods) d = f.data("rule" + c.charAt(0).toUpperCase() + c.substring(1).toLowerCase()), void 0 !== d && (e[c] = d); return e }, staticRules: function (b) { var c = {}, d = a.data(b.form, "validator"); return d.settings.rules && (c = a.validator.normalizeRule(d.settings.rules[b.name]) || {}), c }, normalizeRules: function (b, c) { return a.each(b, function (d, e) { if (e === !1) return void delete b[d]; if (e.param || e.depends) { var f = !0; switch (typeof e.depends) { case "string": f = !!a(e.depends, c.form).length; break; case "function": f = e.depends.call(c, c) } f ? b[d] = void 0 !== e.param ? e.param : !0 : delete b[d] } }), a.each(b, function (d, e) { b[d] = a.isFunction(e) ? e(c) : e }), a.each(["minlength", "maxlength"], function () { b[this] && (b[this] = Number(b[this])) }), a.each(["rangelength", "range"], function () { var c; b[this] && (a.isArray(b[this]) ? b[this] = [Number(b[this][0]), Number(b[this][1])] : "string" == typeof b[this] && (c = b[this].replace(/[\[\]]/g, "").split(/[\s,]+/), b[this] = [Number(c[0]), Number(c[1])])) }), a.validator.autoCreateRanges && (b.min && b.max && (b.range = [b.min, b.max], delete b.min, delete b.max), b.minlength && b.maxlength && (b.rangelength = [b.minlength, b.maxlength], delete b.minlength, delete b.maxlength)), b }, normalizeRule: function (b) { if ("string" == typeof b) { var c = {}; a.each(b.split(/\s/), function () { c[this] = !0 }), b = c } return b }, addMethod: function (b, c, d) { a.validator.methods[b] = c, a.validator.messages[b] = void 0 !== d ? d : a.validator.messages[b], c.length < 3 && a.validator.addClassRules(b, a.validator.normalizeRule(b)) }, methods: { required: function (b, c, d) { if (!this.depend(d, c)) return "dependency-mismatch"; if ("select" === c.nodeName.toLowerCase()) { var e = a(c).val(); return e && e.length > 0 } return this.checkable(c) ? this.getLength(b, c) > 0 : a.trim(b).length > 0 }, email: function (a, b) { return this.optional(b) || /^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/.test(a) }, url: function (a, b) { return this.optional(b) || /^(https?|s?ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(a) }, date: function (a, b) { return this.optional(b) || !/Invalid|NaN/.test(new Date(a).toString()) }, dateISO: function (a, b) { return this.optional(b) || /^\d{4}[\/\-](0?[1-9]|1[012])[\/\-](0?[1-9]|[12][0-9]|3[01])$/.test(a) }, number: function (a, b) { return this.optional(b) || /^-?(?:\d+|\d{1,3}(?:,\d{3})+)?(?:\.\d+)?$/.test(a) }, digits: function (a, b) { return this.optional(b) || /^\d+$/.test(a) }, creditcard: function (a, b) { if (this.optional(b)) return "dependency-mismatch"; if (/[^0-9 \-]+/.test(a)) return !1; var c, d, e = 0, f = 0, g = !1; if (a = a.replace(/\D/g, ""), a.length < 13 || a.length > 19) return !1; for (c = a.length - 1; c >= 0; c--) d = a.charAt(c), f = parseInt(d, 10), g && (f *= 2) > 9 && (f -= 9), e += f, g = !g; return e % 10 === 0 }, minlength: function (b, c, d) { var e = a.isArray(b) ? b.length : this.getLength(a.trim(b), c); return this.optional(c) || e >= d }, maxlength: function (b, c, d) { var e = a.isArray(b) ? b.length : this.getLength(a.trim(b), c); return this.optional(c) || d >= e }, rangelength: function (b, c, d) { var e = a.isArray(b) ? b.length : this.getLength(a.trim(b), c); return this.optional(c) || e >= d[0] && e <= d[1] }, min: function (a, b, c) { return this.optional(b) || a >= c }, max: function (a, b, c) { return this.optional(b) || c >= a }, range: function (a, b, c) { return this.optional(b) || a >= c[0] && a <= c[1] }, equalTo: function (b, c, d) { var e = a(d); return this.settings.onfocusout && e.unbind(".validate-equalTo").bind("blur.validate-equalTo", function () { a(c).valid() }), b === e.val() }, remote: function (b, c, d) { if (this.optional(c)) return "dependency-mismatch"; var e, f, g = this.previousValue(c); return this.settings.messages[c.name] || (this.settings.messages[c.name] = {}), g.originalMessage = this.settings.messages[c.name].remote, this.settings.messages[c.name].remote = g.message, d = "string" == typeof d && { url: d} || d, g.old === b ? g.valid : (g.old = b, e = this, this.startRequest(c), f = {}, f[c.name] = b, a.ajax(a.extend(!0, { url: d, mode: "abort", port: "validate" + c.name, dataType: "json", data: f, context: e.currentForm, success: function (d) { var f, h, i, j = d === !0 || "true" === d; e.settings.messages[c.name].remote = g.originalMessage, j ? (i = e.formSubmitted, e.prepareElement(c), e.formSubmitted = i, e.successList.push(c), delete e.invalid[c.name], e.showErrors()) : (f = {}, h = d || e.defaultMessage(c, "remote"), f[c.name] = g.message = a.isFunction(h) ? h(b) : h, e.invalid[c.name] = !0, e.showErrors(f)), g.valid = j, e.stopRequest(c, j) } }, d)), "pending") } } }), a.format = function () { throw "$.format has been deprecated. Please use $.validator.format instead." }; var b, c = {}; a.ajaxPrefilter ? a.ajaxPrefilter(function (a, b, d) { var e = a.port; "abort" === a.mode && (c[e] && c[e].abort(), c[e] = d) }) : (b = a.ajax, a.ajax = function (d) { var e = ("mode" in d ? d : a.ajaxSettings).mode, f = ("port" in d ? d : a.ajaxSettings).port; return "abort" === e ? (c[f] && c[f].abort(), c[f] = b.apply(this, arguments), c[f]) : b.apply(this, arguments) }), a.extend(a.fn, { validateDelegate: function (b, c, d) { return this.bind(c, function (c) { var e = a(c.target); return e.is(b) ? d.apply(e, arguments) : void 0 }) } }) });

/* End of jQuery Validation Plugin */
!function (a) { function b(b, c) { this.container = a(b), this.settings = c, this.timer = 0, this.before = { v: 0, h: 0 }, this.touch = {}, this.pressed = 0, this.vslider = a("<div/>", { class: "rollbar-handle" }), this.vpath = a("<div/>", { class: "rollbar-path-vertical" }), this.hslider = a("<div/>", { class: "rollbar-handle" }), this.hpath = a("<div/>", { class: "rollbar-path-horizontal" }), this.sliders = this.vslider.add(this.hslider), this.container.css({ overflow: "hidden", position: "relative" }).contents().filter(this.settings.contentFilter).wrapAll('<div class="rollbar-content"></div>'), this.content = this.container.children(".rollbar-content").css({ top: 0, left: 0, position: "relative", float: "left" }), "horizontal" == this.settings.scroll ? this.container.prepend(this.hpath.append(this.hslider)) : "vertical" == this.settings.scroll ? this.container.prepend(this.vpath.append(this.vslider)) : this.container.prepend(this.vpath.append(this.vslider), this.hpath.append(this.hslider)), this.vpath.add(this.hpath).css({ "z-index": this.settings.zIndex, display: "none" }), this.vslider.css({ height: this.settings.sliderSize, opacity: this.settings.sliderOpacity }), this.hslider.css({ width: this.settings.sliderSize, opacity: this.settings.sliderOpacity }), this.settings.sliderOpacity && this.sliders.hover(this.fixFn(function () { this.sliders.stop().fadeTo(this.settings.sliderOpacityTime, 1) }), this.fixFn(function () { this.pressed || this.sliders.stop().fadeTo(this.settings.sliderOpacityTime, this.settings.sliderOpacity) })), this.init(), this.pathSize(), this.bindEvent(a(window), "load", function () { setTimeout(this.fixFn(this.checkScroll), 10) }), this.settings.lazyCheckScroll > 0 && setInterval(this.fixFn(function () { this.checkScroll(), this.pathSize() }), this.settings.lazyCheckScroll) } b.prototype.checkScroll = function () { this.vtrack = this.vpath.height() - this.vslider.height(), this.htrack = this.hpath.width() - this.hslider.width(), this.vdiff = this.content.height() - this.container.height(), this.hdiff = this.content.width() - this.container.width(), this.settings.autoHide && (this.vdiff > 0 ? this.vpath.fadeIn(this.settings.autoHideTime) : this.vpath.fadeOut(this.settings.autoHideTime), this.hdiff > 0 ? this.hpath.fadeIn(this.settings.autoHideTime) : this.hpath.fadeOut(this.settings.autoHideTime)) }, b.prototype.pathSize = function () { var a = parseInt(this.settings.pathPadding, 10); this.vpath.css({ top: a + "px", height: this.container.height() - 2 * a + "px" }), this.hpath.css({ left: a + "px", width: this.container.width() - 2 * a + "px" }) }, b.prototype.scroll = function (a, b, c) { var d = 0, e = 0; a < 0 && (a = 0), a > this.vtrack && (a = this.vtrack), this.vslider.css("top", a + "px"), b < 0 && (b = 0), b > this.htrack && (b = this.htrack), this.hslider.css("left", b + "px"), this.vdiff > 0 && (e = a / this.vtrack, this.content.css("top", Math.round(-this.vdiff * e)), c && a && a != this.vtrack && (c.stopPropagation(), c.preventDefault())), this.hdiff > 0 && (d = b / this.htrack, this.content.css("left", Math.round(-this.hdiff * d)), c && b && b != this.htrack && (c.stopPropagation(), c.preventDefault())), this.before.v == e && this.before.h == d || ("function" == typeof this.settings.onscroll && this.settings.onscroll.call(this.container.get(0), e, d), this.before.v = e, this.before.h = d) }, b.prototype.easeScroll = function (b, c) { var d = 0, e = Math.floor(this.settings.scrollTime / this.settings.scrollInterval), f = this.vslider.position().top, g = this.hslider.position().left, h = a.easing[this.settings.scrollEasing] || a.easing.linear; this.sliders.stop().fadeTo(this.settings.sliderOpacityTime, 1), window.clearInterval(this.timer), this.timer = window.setInterval(this.fixFn(function () { this.scroll(f + h(d / e, d, 0, 1, e) * b, g + h(d / e, d, 0, 1, e) * c), ++d > e && (window.clearInterval(this.timer), this.sliders.stop().fadeTo(this.settings.sliderOpacityTime, this.settings.sliderOpacity)) }), this.settings.scrollInterval) }, b.prototype.fixFn = function (a, b) { var c = this; return function () { a.apply(b || c, Array.prototype.slice.call(arguments)) } }, b.prototype.bindEvent = function (a, b, c, d) { return a.bind(b, this.fixFn(c, d)) }, b.prototype.init = function () { var b = a(window.document); this.bindEvent(this.sliders, "mousedown", function (a) { this.pressed = a.target === this.vslider.get(0) ? 1 : 2; var c = a.pageX, d = a.pageY, e = this.vslider.position().top, f = this.hslider.position().left; this.bindEvent(b, "mousemove", function (a) { 1 == this.pressed ? this.scroll(e + (a.pageY - d), f) : this.scroll(e, f + (a.pageX - c)) }), this.bindEvent(b, "selectstart", function (a) { a.preventDefault() }) }), this.bindEvent(b, "mouseup", function (a) { 1 == this.pressed && a.target !== this.vslider.get(0) ? this.vslider.fadeTo(this.settings.sliderOpacityTime, this.settings.sliderOpacity) : 2 == this.pressed && a.target !== this.hslider.get(0) && this.hslider.fadeTo(this.settings.sliderOpacityTime, this.settings.sliderOpacity), this.pressed = 0, b.unbind("mousemove"), b.unbind("selectstart") }); var c, d, e; window.navigator.msPointerEnabled ? a("body").hasClass("ie-10") ? (c = "MSPointerDown", d = "MSPointerMove", e = "MSPointerUp") : (c = "pointerdown", d = "pointermove", e = "pointerup") : (c = "touchstart", d = "touchmove", e = "touchend"), this.bindEvent(this.container, c, function (a) { if (!window.navigator.msPointerEnabled || window.navigator.msPointerEnabled && "touch" == a.originalEvent.pointerType) { var b = a.originalEvent, c = b.changedTouches[0]; this.touch.sx = c.pageX, this.touch.sy = c.pageY, this.touch.sv = this.vslider.position().top, this.touch.sh = this.hslider.position().left, this.sliders.stop().fadeTo(this.settings.sliderOpacityTime, 1), this.settings.blockGlobalScroll && (this.vdiff || this.hdiff) && b.stopPropagation() } }), this.bindEvent(this.container, d, function (a) { if (!window.navigator.msPointerEnabled || window.navigator.msPointerEnabled && "touch" == a.originalEvent.pointerType) { var b = a.originalEvent, c = b.targetTouches[0]; this.scroll(this.touch.sv + (this.touch.sy - c.pageY) * this.settings.touchSpeed, this.touch.sh + (this.touch.sx - c.pageX) * this.settings.touchSpeed, a), this.settings.blockGlobalScroll && (this.vdiff || this.hdiff) && (b.preventDefault(), b.stopPropagation()) } }), this.bindEvent(this.container, e, function (a) { if (!window.navigator.msPointerEnabled || window.navigator.msPointerEnabled && "touch" == a.originalEvent.pointerType) { var b = a.originalEvent; b.changedTouches[0]; this.sliders.stop().fadeTo(this.settings.sliderOpacityTime, this.settings.sliderOpacity), this.settings.blockGlobalScroll && (this.vdiff || this.hdiff) && b.stopPropagation() } }); var f = this.vpath.height(), g = this.hpath.width(); this.bindEvent(a(window), "resize", function () { this.pathSize(), this.checkScroll(), this.vdiff <= 0 && this.content.css("top", 0), this.hdiff <= 0 && this.content.css("left", 0), this.scroll(Math.round(parseInt(this.vslider.css("top"), 10) * this.vpath.height() / f), Math.round(parseInt(this.hslider.css("left"), 10) * this.hpath.width() / g)), f = this.vpath.height(), g = this.hpath.width() }), this.bindEvent(this.container, "mousewheel DOMMouseScroll MozMousePixelScroll", function (a, b, c, d) { var b = "undefined" != typeof a.originalEvent.wheelDelta ? a.originalEvent.wheelDelta / 120 : a.originalEvent.detail / 60 * -1, c = 0, d = b, e = a.target.nodeName; return "TEXTAREA" == e || "SELECT" == e || "OPTION" == e ? void a.stopPropagation() : (this.scroll(this.vslider.position().top - this.settings.wheelSpeed * d, this.hslider.position().left + this.settings.wheelSpeed * c, a), this.sliders.stop().fadeTo(this.settings.sliderOpacityTime, 1), window.clearTimeout(this.timer), this.timer = window.setTimeout(this.fixFn(function () { this.sliders.stop().fadeTo(this.settings.sliderOpacityTime, this.settings.sliderOpacity) }), this.settings.sliderOpacityDelay), void (this.settings.blockGlobalScroll && (this.vdiff || this.hdiff) && (a.preventDefault(), a.stopPropagation()))) }), this.bindEvent(b, "keydown", function (a) { var b = 0, c = 0; c = 38 == a.keyCode ? -this.settings.keyScroll : c, c = 40 == a.keyCode ? this.settings.keyScroll : c, b = 37 == a.keyCode ? -this.settings.keyScroll : b, b = 39 == a.keyCode ? this.settings.keyScroll : b, (c || b) && this.easeScroll(c, b) }), this.bindEvent(this.container, "dragstart", function (a) { a.preventDefault() }), this.bindEvent(this.container, "rollbar", function (a, b, c, d) { return a.stopPropagation(), "reset" === b ? void this.container.find(".rollbar-content, .rollbar-handle").css({ top: 0, left: 0 }) : (b = b || 0, c = c || 0, /^[-\d\.]+$/.test(b) && (b = parseFloat(b), Math.abs(b) <= 1 && !d ? b *= this.vtrack : b += b * (this.vtrack / this.vdiff - 1)), /^[-\d\.]+$/.test(c) && (c = parseFloat(c), Math.abs(c) <= 1 && !d ? c *= this.htrack : c += c * (this.htrack / this.hdiff - 1)), void this.easeScroll(b, c)) }) }, a.fn.rollbar = function (c) { var d = { scroll: "both", autoHide: !0, autoHideTime: "fast", lazyCheckScroll: 1e3, blockGlobalScroll: !0, contentFilter: "*", sliderSize: "30%", sliderOpacity: .5, sliderOpacityTime: 200, sliderOpacityDelay: 1e3, wheelSpeed: 20, touchSpeed: .3, pathPadding: "20px", keyScroll: 100, scrollTime: 500, scrollInterval: 15, scrollEasing: "swing", zIndex: 100, onscroll: function () { } }; return a.extend(d, c), this.each(function () { new b(this, d) }) } }(jQuery);// ----------------------------------------------
// File:		BrowserUtils.js
// Author:		Nathan Derksen
// Description:	Class to provide access to some basic browser utilities 
// Example:
// var width = BrowserUtils.getBrowserWidth();
// ----------------------------------------------


// ----------------------------------------------
// Function:	BrowserUtils()
// Author:		Nathan Derksen
// Description:	Base class
// Inputs:		<None>
// Returns:		<Nothing>
// ----------------------------------------------
function BrowserUtils() {
}

// ----------------------------------------------
// Function:	getBrowserWidth()
// Author:		Nathan Derksen
// Description:	Find out how wide the browser window is
// Inputs:		<None>
// Returns:		<Number>
// ----------------------------------------------
BrowserUtils.getBrowserWidth = function () {
    var width = 0;

    if (typeof (innerWidth) == "number") {
        width = window.innerWidth;
    }
    else if (document.documentElement && document.documentElement.clientWidth) {
        width = document.documentElement.clientWidth;
    }
    else {
        width = document.body.clientWidth;
    }
    return width;
};

// ----------------------------------------------
// Function:	getBrowserHeight()
// Author:		Nathan Derksen
// Description:	Find out how tall the browser page is
// Inputs:		<None>
// Returns:		<Number>
// ----------------------------------------------
BrowserUtils.getBrowserHeight = function () {
    var height = 0;

    if (typeof (innerHeight) == "number") {
        height = window.innerHeight;
    }
    else if (document.documentElement && document.documentElement.clientHeight) {
        height = document.documentElement.clientHeight;
    }
    else {
        height = document.body.clientHeight;
    }
    return height;
};

// ----------------------------------------------
// ----------------------------------------------
BrowserUtils.addOnLoadHandler = function (newHandler) {
    if (typeof (console) != "undefined") {
        console.log("BrowserUtils.addOnLoadHandler is deprecated. Please use jQuery $(document).ready(...); instead.");
    }
};

// ----------------------------------------------
// ----------------------------------------------
BrowserUtils.getPosition = function (elementHandle) {
    var currentLeft = currentTop = 0;
    if (elementHandle.offsetParent) {
        currentLeft = elementHandle.offsetLeft;
        currentTop = elementHandle.offsetTop;
        while (elementHandle = elementHandle.offsetParent) {
            currentLeft += elementHandle.offsetLeft;
            currentTop += elementHandle.offsetTop;
        }
    }
    return { left: currentLeft, top: currentTop };
};

// ----------------------------------------------
// ----------------------------------------------
BrowserUtils.getIsSecure = function () {
    var pageLocation = window.location.href.toLowerCase();
    if (pageLocation.indexOf("https://") == 0) {
        return true;
    }
    return false;
};

BrowserUtils.preloadImages = function (imageArray) {
    var i, n;
    for (i = 0, n = imageArray.length; i < n; i++) {
        $("<img />").attr("src", imageArray[i]);
    }
};

// This function is to support old FAQ content only.  At some point all FAQ content should
// be updated and this function deleted
function MM_openBrWindow(theURL, winName, features) { //v2.0
    window.open(theURL, winName, features);
}

/* End of BrowserUtils.js */
ï»¿// CookieManager.js, for managing browser cookies

function CookieManager() {
}

CookieManager.getCookieValue = function (cookieName) {
    var cookie = document.cookie;
    var chkdCookie = cookie.split(" ").join("");
    var nvpair = chkdCookie.split(";");
    var splitValues;

    for (var i = 0; i < nvpair.length; ++i) {
        splitValues = nvpair[i].split("=");
        if (splitValues[0] == cookieName) {
            return splitValues[1];
        }
    }
    return null;
};

CookieManager.sessionCookie = function (cookieName, cookieValue) {
    var newCookie = cookieName + "=" + cookieValue + "; path=/;";
    window.document.cookie = newCookie;
};

CookieManager.setCookieValue = function (cookieName, cookieValue, cookieExpireDays) {
    var futdate = new Date();		//Get the current time and date
    var expdate = futdate.getTime();  //Get the milliseconds since Jan 1, 1970
    if (!cookieExpireDays || cookieExpireDays == "") {
        cookieExpireDays = 364;
    }
    expdate += cookieExpireDays * 24 * 60 * 60 * 1000; //expires in about one year
    futdate.setTime(expdate);
    var newCookie = cookieName + "=" + cookieValue + "; path=/;";
    newCookie += " expires=" + futdate.toGMTString();
    window.document.cookie = newCookie;
};

CookieManager.eraseCookie = function (cookieName) {
    document.cookie = cookieName + "=;expires=-1; path=/";
};

CookieManager.setCookieModule = function (mylink, qs, css, t) {
    var newCookie = "module_mode=yes;path=/;";// domain=dev.tiffany.us;"	//Set the new cookie values up
    var newCookie2 = "module_url=" + mylink + "; path=/;";// domain=dev.tiffany.us;"	//Set the new cookie values up
    var newCookie3 = "module_css=" + css + "; path=/;";// domain=dev.tiffany.us;"	//Set the new cookie values up
    var newCookie4 = "module_qs=" + qs + "; path=/;";// domain=dev.tiffany.us;"	//Set the new cookie values up
    var newCookie5 = "module_t=" + t + "; path=/;";// domain=dev.tiffany.us;"	//Set the new cookie values up
    window.document.cookie = newCookie;
    window.document.cookie = newCookie2;
    window.document.cookie = newCookie3;
    window.document.cookie = newCookie4;
    window.document.cookie = newCookie5;
};

CookieManager.areCookiesEnabled = function () {
    if (document.forms[0]) {
        if (document.forms[0].areCookiesEnabled) {
            if (document.forms[0].areCookiesEnabled.value.toLowerCase() == "false") {
                return false;
            }
        }
    }
    return true;
};

/* End of CookieManager.js */
// ----------------------------------------------
// File:		HistoryManager.js
// Author:		Nathan Derksen
// Description:	Singleton class used to keep track of what a person has been doing on the page
// Example:
// HistoryManager.getInstance().setState({productId:10001221, thumbnailIndex:5});
// ----------------------------------------------


// ----------------------------------------------
// Function:	HistoryManager
// Author:		Nathan Derksen
// Description:	Base class
// Inputs:		<none>
// Returns:		<nothing>
// ----------------------------------------------
function HistoryManager()
{
	this.pInstance = null;
	this.pCurrentIndex = -1;
	this.pHistoryArray = new Array();
	this.pInternalTrigger = true;
	this.pSafariHistoryLength = 0;
	this.pEnabled = true;
	this.lastHistoryLength = 0; // Needed for Safari use
	this.baseHistoryLength = 0;
	this.lastHash;
	this.pIntervalId = 0;
}

// ----------------------------------------------
// Function:	HistoryManager.getInstance()
// Author:		Nathan Derksen
// Description:	Singleton access method
// Inputs:		<none>
// Returns:		<StateModel> Handle to a single HistoryManager instance
// ----------------------------------------------
HistoryManager.getInstance = function()
{
	if (!this.pInstance)
	{
		this.pInstance = new HistoryManager();
	}
	return this.pInstance;
};

// ----------------------------------------------
// Function:	HistoryManager.initHistory()
// Author:		Nathan Derksen
// Description:	Set up the history manager, using a particular state snapshot as a starting point
// Inputs:		<Object> baseState - A StateSnapshotVO instance holding the data to use for the base state snapshot
// Returns:		<Nothing>
// ----------------------------------------------
HistoryManager.prototype.initHistory = function(initBaseState)
{
	var baseState;
	if (initBaseState)
	{
		baseState = initBaseState;
	}
	else
	{
		if (typeof(StoreLocationsModel) != "undefined" && typeof(LocationsStateSnapshotVO != "undefined"))
		{
			baseState = new LocationsStateSnapshotVO();
		}
		else
		{
			baseState = new StateSnapshotVO();
		}
	}
	
	if (this.pHistoryArray.length == 0)
	{
		this.pHistoryArray = new Array(baseState);
	}
	this.pCurrentIndex = 0;	
	this.lastHistoryLength = history.length;
	this.baseHistoryLength = history.length;
	this.lastHash = baseState;
	
	clearInterval(this.pIntervalId);
	this.pIntervalId = setInterval("checkHash()", 500);
//	this.printDebug();
};

// ----------------------------------------------
// ----------------------------------------------
HistoryManager.prototype.overrideBaseState = function (initBaseState) {
    if (initBaseState) {
        if (this.pHistoryArray != null && this.pHistoryArray.length > 0) {
            this.pHistoryArray[0] = initBaseState;
        }
        else {
            this.pHistoryArray = new Array(initBaseState);
        }
        this.lastHash = initBaseState;
    }
};

// ----------------------------------------------
// Function:	HistoryManager.addHistoryItem()
// Author:		Nathan Derksen
// Description:	Add a new item to the end of the history list
// Inputs:		<StateSnapshotVO> historyState: A StateSnapshotVO instance to use for this particular history step
// Returns:		<Nothing>
// ----------------------------------------------
HistoryManager.prototype.addHistoryItem = function (historyState) {
    if (historyState) {
        if (this.pEnabled == true) {
            currentHistoryItem = HistoryManager.getInstance().getCurrentHistoryItem();

            if (currentHistoryItem != historyState) {
                var scrollYPosition = 0;
                if (this.pCurrentIndex < this.pHistoryArray.length) {
                    this.pHistoryArray.splice(this.pCurrentIndex + 1, this.pHistoryArray.length - this.pCurrentIndex - 1);
                    this.pHistoryArray.push(historyState);
                    this.pCurrentIndex++;
                    this.lastHash = historyState;
                    this.pInternalTrigger = true;
                    this.lastHistoryLength++;


                    this.setHash(historyState);
                }
            }
        }
        else {
            this.setHash(historyState);
        }
    }
    //	this.printDebug();
};

// ----------------------------------------------
// Function:	HistoryManager.getHistoryItem()
// Author:		Nathan Derksen
// Description:	Get the state for a particular step in the history
// Inputs:		<Number> historyIndex: The index of the history state to retrieve
// Returns:		<StateSnapshotVO>: An object containing the properties of that state
// ----------------------------------------------
HistoryManager.prototype.getHistoryItem = function (historyIndex) {
    if (historyIndex < this.pHistoryArray.length) {
        return this.pHistoryArray[historyIndex];
    }
    return null;
};

// ----------------------------------------------
// Function:	HistoryManager.getCurrentHistoryItem()
// Author:		Nathan Derksen
// Description:	Get the state for the current step in the history
// Inputs:		<None>
// Returns:		<StateSnapshotVO>: An object containing the properties of that state
// ----------------------------------------------
HistoryManager.prototype.getCurrentHistoryItem = function()
{
	if (this.pCurrentIndex >= 0 && this.pCurrentIndex < this.pHistoryArray.length)
	{
		return this.pHistoryArray[this.pCurrentIndex];
	}
	return null;
};

// ----------------------------------------------
// Function:	HistoryManager.setHistoryPosition()
// Author:		Nathan Derksen
// Description:	Go back to a particular step in the history
// Inputs:		<Number> historyPosition - The history index to set to
// Returns:		<Nothing>
// ----------------------------------------------
HistoryManager.prototype.setHistoryPosition = function (historyPosition) {
    this.pCurrentIndex = historyPosition;
    var historyItem = this.getHistoryItem(historyPosition);

    // Make sure that the onload event from the history iframe doesn't trigger a second
    // call. The history onload manager will call regardless of whether it is triggered
    // by pressing back/forward or by the history manager, so a flag is set when the trigger
    // to change the history page comes from inside this history class which is then cleared
    // when the onload method is called
    if (historyItem == null) {
        // Do nothing
    }
    else if (this.pInternalTrigger == true) {
        this.pInternalTrigger = false;
    }
    else {
        //		generateEvent("onHistoryChanged", historyPosition, URLFactory.convertHashToState(historyItem));

        if (typeof (StoreLocationsModel) != "undefined" && typeof (LocationsURLFactory != "undefined")) {
            //			StoreLocationsModel.getInstance().setStateSnapshot(LocationsURLFactory.convertHashToState(hist.getHistoryItem(historyIndex)));
        }
        else {
            tempState = URLFactory.convertHashToState(historyItem);
            StateModel.getInstance().setStateSnapshot(tempState);
            $(HistoryManager.getInstance()).trigger("historyChanged", { state: tempState, hash: historyItem });
        }
    }
    //	this.printDebug();
};

// ----------------------------------------------
// Function:	HistoryManager.setHash()
// Author:		Nathan Derksen
// Description:	Set the hash shown in the URL based on the state snapshot
// Inputs:		<String> newHash - URL encoded list of name/value pairs to place in the URL
// Returns:		<Nothing>
// ----------------------------------------------
HistoryManager.prototype.setHash = function(newHash)
{
	if (document.body.scrollTop)
	{
		scrollYPosition = document.body.scrollTop;
	}
	else if (window.pageYOffset)
	{
		scrollYPosition = document.body.pageYOffset;
	}

	window.location.hash = newHash.split("#").join("");

	if (document.body.scrollTop)
	{
		document.body.scrollTop = scrollYPosition;
	}
	else if (window.pageYOffset)
	{
		document.body.pageYOffset = scrollYPosition;
	}
	//	this.printDebug();
};

// ----------------------------------------------
// ----------------------------------------------
function setHashFollowup(newHash)
{
	window.location.hash = newHash;
}

// ----------------------------------------------
// Function:	HistoryManager.disableHistory()
// Author:		Nathan Derksen
// Description:	Disable the history manager's history tracking, but keep the deep links intact
// Inputs:		<None>
// Returns:		<Nothing>
// ----------------------------------------------
HistoryManager.prototype.disableHistory = function()
{
	this.pEnabled = false;
	clearInterval(this.pIntervalId);
};


// ----------------------------------------------
// Function:	checkHash()
// Author:		Nathan Derksen
// Description:	Utility function called by setInterval used to track whether back button pressed through the current URL
// Inputs:		<None>
// Returns:		<Nothing>
// ----------------------------------------------
function checkHash()
{
	var hist = HistoryManager.getInstance();
	var lastHistoryLength = hist.lastHistoryLength;
	var lastHash = hist.lastHash;
	var currentHistoryLength = history.length;
	var currentHash = window.location.hash.split("#").join("");
	var currentHashEscaped = encodeURIComponent(window.location.hash.split("#").join(""));
	var lastHashEscaped = lastHash.replace(/\+/g, "%2B");
	var currentHashWhiteSpaceRemoved = window.location.hash.split("#").join("").replace(/\s/g,"%20");
	var historyIndex = 0;
	var tempState;
	
	if (currentHash == "" && hist.pHistoryArray.length > 0)
	{
		currentHash = hist.pHistoryArray[0];
	}
	
	if (hist.pHistoryArray.length == 0)
	{
		// Do nothing
	}
	else if (hist.pInternalTrigger == true)
	{
		hist.pInternalTrigger = false;
	}
	else
	{
		
		if (navigator.userAgent.indexOf("Safari") != -1 && !isSafari3Plus())
		{
			// Safari version 1 and 2 cannot detect changes to the hash. Get around these bugs
			// by taking advantage of an error in history.length. It will decrease
			// by one when hitting back, and increase by one when hitting next
			if (lastHistoryLength != history.length)
			{
				historyIndex = history.length - hist.baseHistoryLength;
				hist.lastHistoryLength = currentHistoryLength;
				hist.pCurrentIndex = historyIndex;
//				generateEvent("onHistoryChanged", historyIndex, URLFactory.convertHashToState(hist.getHistoryItem(historyIndex)));
				if (typeof(StoreLocationsModel) != "undefined" && typeof(LocationsURLFactory != "undefined"))
				{
//					StoreLocationsModel.getInstance().setStateSnapshot(LocationsURLFactory.convertHashToState(hist.getHistoryItem(historyIndex)));
				}
				else {
					tempState = URLFactory.convertHashToState(hist.getHistoryItem(historyIndex));
					StateModel.getInstance().setStateSnapshot(tempState);
					$(HistoryManager.getInstance()).trigger("historyChanged", { state: tempState, hash: hist.getHistoryItem(historyIndex) });
				}
			}
		}
		else
		{
			if (lastHash != currentHash && lastHash != currentHashEscaped && lastHash != currentHashWhiteSpaceRemoved && lastHashEscaped != currentHashEscaped)
			{
				var historyArray = hist.pHistoryArray;
				for (var i=0; i < historyArray.length; i++)
				{
					if (currentHash == historyArray[i])
					{
						historyIndex = i;
						hist.pCurrentIndex = i;
						break;
					}
				}
				hist.lastHash = currentHash;
//				generateEvent("onHistoryChanged", historyIndex, URLFactory.convertHashToState(hist.getHistoryItem(historyIndex)));
				if (typeof(StoreLocationsModel) != "undefined" && typeof(LocationsURLFactory != "undefined"))
				{
//					StoreLocationsModel.getInstance().setStateSnapshot(LocationsURLFactory.convertHashToState(hist.getHistoryItem(historyIndex)));
				}
				else
				{
				    if (window.history.state != null) {
				        tempState = URLFactory.convertHashToState(hist.getHistoryItem(historyIndex));
				        StateModel.getInstance().setStateSnapshot(tempState);
				        $(HistoryManager.getInstance()).trigger("historyChanged", { state: tempState, hash: hist.getHistoryItem(historyIndex) });
				    }
				}
			}
		}

	}
//	HistoryManager.getInstance().printDebug();
}

// ----------------------------------------------
// Function:	setHistory()
// Author:		Nathan Derksen
// Description:	Utility function called by iframe (for IE implementation) to set a new history position
// Inputs:		<Number> id - The index of the history item to set
// Returns:		<Nothing>
// ----------------------------------------------
function setHistory(id)
{
	HistoryManager.getInstance().setHistoryPosition(Number(id));
}

// ----------------------------------------------
// ----------------------------------------------
/* HistoryManager.prototype.printDebug = function()
{
	var htmlText = "";
	
	for (var i=0; i < this.pHistoryArray.length; i++)
	{
		if (i == this.pCurrentIndex)
		{
			htmlText += "<b>" + i + ") " + this.pHistoryArray[i] + "</b><br />";
		}
		else
		{
			htmlText += i + ") " + this.pHistoryArray[i] + "<br />";
		}
	}
	if (document.getElementById("debug") == null)
	{
		$("body").append('<div id="debug"></div>');
	}
	$("#debug").css({ zIndex:100, backgroundColor:"#fff000", position:"fixed", top:"0px", padding:"5px" });
	$("#debug").html(htmlText);
} */

function HistoryManager_setFlashHistory(historyState)
{
	var model = StateModel.getInstance();
	var currentHistoryItem;

	if (typeof(StoreLocationsModel) != "undefined" && typeof(LocationsURLFactory != "undefined"))
	{
//		currentHistoryItem = LocationsURLFactory.convertHashToState(HistoryManager.getInstance().getCurrentHistoryItem());
	}
	else
	{
		currentHistoryItem = URLFactory.convertHashToState(HistoryManager.getInstance().getCurrentHistoryItem());
	}

	if (currentHistoryItem.flash != historyState)
	{
		model.setBrowseStatesNoSideEffects({flash:historyState});
		HistoryManager.getInstance().addHistoryItem(URLFactory.convertStateToHash(model.getStateSnapshot()));
	}
}

/* End of HistoryManager.js */
// OverlayManager.js, for creating and managing UI overlays
// Currently, it assumes that the modal content exists in the page DOM

//This sets the variable to see how many times the overlay loads a new page before being closed
var overlayLoads = 0;

function OverlayManager() {
    this.pInstance = null;
    this.initialScrollPosition = null;
}

OverlayManager.getInstance = function () {
    if (!this.pInstance) {
        this.pInstance = new OverlayManager();
    }
    return this.pInstance;
};

var deeplink;

OverlayManager.prototype.init = function () {
    var hoverOnEvent;
    var hoverOffEvent;
    var parent = this;

    if (window.navigator.msPointerEnabled) {
        if ($("body").hasClass("ie-10")) {
            hoverOnEvent = "mouseenter";
            hoverOffEvent = "mouseleave";
        } else {
            hoverOnEvent = "pointerenter";
            hoverOffEvent = "pointerleave";
        }
    } else if (window.navigator.pointerEnabled) {
        hoverOnEvent = "pointerenter";
        hoverOffEvent = "pointerleave";
    } else {
        hoverOnEvent = "mouseenter";
        hoverOffEvent = "mouseleave";
    }

    var parent = this;

    //modals
    $("body").on("click", ".open-modal", function () {
        var id = $(this).attr("id");
        deeplink = $(this).attr('href').split('#')[1];

        var suppressHistory = false;
        if ($(this).attr("data-suppress-history") && $(this).attr("data-suppress-history") == "true") {
            suppressHistory = true;
        }

        if (typeof (id) != "undefined" && id != null && id != "") {
            parent.open(id, null, suppressHistory);
        }

        return false;
    });

    $("body").on("click touchstart", ".modal-popup .close, .btn.cancel, #gray-overlay", function () {
        if ($(".modal-popup").hasClass("fullframe")) {
            return;
        }
        if ($("body").hasClass("modal-frame")) {
            window.parent.OverlayManager.getInstance().close();
        }
        else {
            parent.close();
        }
        $("#gray-overlay").removeClass("newVideo");
        return false;
    });

    $(HistoryManager.getInstance()).bind("historyChanged", function (e, data) {
        var overlayId = data.state.popup;
        // We don't want and new overlay to open or close if we have a system generated overlay already open.
        if (!$(".modal-popup").hasClass("fullframe") && $(".modal-popup").css("display") != "none") {
            if (overlayId == "") {
                if ($(".modal-popup").css("display") != "none") {
                    // Don't close an already closed overlay
                    parent.close(null, true);
                }
            }
            else {
                parent.open(overlayId, null, true);
            }
        }
    });

    // Open an overlay if the overlay value in the page hash has been set.
    var storyId;
    var hashOverlayValue = URLFactory.extractValue(window.location.hash.split("#").join(""), "popup");
    if (hashOverlayValue != null && hashOverlayValue != "") {
        if ($("#" + hashOverlayValue).hasClass("jq-open-modal")) {
            $("#" + hashOverlayValue).click();
        }
        else if (hashOverlayValue.indexOf("storyText") == 0) {
            // Override for WMLT stories, overlay needs to be able to be opened without the link being present
            storyId = hashOverlayValue.split("storyText").join("");
            if (ValidationHelper.isValidNumber(storyId) == true) {
                OverlayManager.getInstance().open(hashOverlayValue, {
                    url: "/WorldOfTiffany/WMLT/Stories/Text.aspx?ContentLinkID=" + storyId,
                    size: "full",
                    iframe: false,
                    position: "top"});
            }
        }
        else if (hashOverlayValue.indexOf("storyVideo") == 0) {
            // Override for WMLT stories, overlay needs to be able to be opened without the link being present
            storyId = hashOverlayValue.split("storyVideo").join("");
            if (ValidationHelper.isValidNumber(storyId) == true) {
                OverlayManager.getInstance().open(hashOverlayValue, {
                    url: "/Video/VideoOverlay.aspx?config=/WorldOfTiffany/WMLT/Stories/StoryData.aspx?contentLinkID=" + storyId,
                    size: "full",
                    iframe: true,
                    position: "top"});
            }
        }
        else if (hashOverlayValue.indexOf("video") == 0) {
            var video = hashOverlayValue.split("video").join("");
            var videoName, folder;
            if (video.indexOf("_") >= 0) {
                folder = video.split("_")[0] + "/";
                videoName = video.split("_")[1];
            }
            else {
                folder = "";
                videoName = video;
            }
            $.ajax({
                url: '/Video/VideoOverlay.aspx/GetMarketingYoutubeVideoDetails',
                type: 'POST',
                data: "{'videoId':'" + video + "'}",
                cache: false,
                dataType: "json",
                contentType: "application/json; charset=utf-8",
                success: function (data) {
                    if (data.d != null && data.d.ResponseObject.title != "") {
                        OverlayManager.getInstance().open(hashOverlayValue, {
                            url: "/Video/VideoOverlay.aspx?mode=new&cmsID=" + video,
                            size: "full",
                            iframe: true,
                            position: "top"
                        });
                    }
                    else {
                        OverlayManager.getInstance().open(hashOverlayValue, {
                            url: "/Video/VideoOverlay.aspx?mode=new&config=/shared/videos/config/" + folder + videoName + ".txt",
                            size: "full",
                            iframe: true,
                            position: "top"
                        });
                    }
                },
                error: function (jqXHR, textStatus, errorThrown) {
                }
            });
        }
        else if ($("#" + hashOverlayValue).length > 0) {
            this.open(hashOverlayValue);
        }
    }

};

OverlayManager.prototype.open = function (handleOrName, overrides, suppressHistory) {

    var hash = window.location.hash.split("#").join("");
    var query = "";

    suppressHistory = (typeof (suppressHistory) == "undefined") ? false : suppressHistory;

    if (hash == "") {
        hash = URLFactory.convertStateToHash(StateModel.getInstance().getStateSnapshot());
    }

    var props = {
        url: "",
        size: "",
        iframe: true,
        position: "",
        bgstyle: "",
        height: "auto",
        fullframe: false};

    this.initialScrollPosition = $(window).scrollTop();

    if (typeof (handleOrName) == "string") {

        if (typeof ($("#" + handleOrName).attr("href")) != "undefined") {
            props.url = $("#" + handleOrName).attr("href");
        }
        if (typeof ($("#" + handleOrName).attr("data-iframe")) != "undefined") {
            props.iframe = ($("#" + handleOrName).attr("data-iframe").toLowerCase() == "true") ? true : false;
        }
        if (typeof ($("#" + handleOrName).attr("data-size")) != "undefined") {
            props.size = $("#" + handleOrName).attr("data-size");
        }
        if (typeof ($("#" + handleOrName).attr("data-position")) != "undefined") {
            props.position = $("#" + handleOrName).attr("data-position");
        }
        if (typeof ($("#" + handleOrName).attr("data-bgstyle")) != "undefined") {
            props.bgstyle = $("#" + handleOrName).attr("data-bgstyle");
        }
        if (typeof ($("#" + handleOrName).attr("data-height")) != "undefined") {
            props.height = $("#" + handleOrName).attr("data-height");
        }
        if (typeof ($("#" + handleOrName).attr("data-full-frame")) != "undefined") {
            props.fullframe = ($("#" + handleOrName).attr("data-full-frame").toLowerCase() == "true") ? true : false;
        }

        this.close(null, true); // Make sure to destroy the previous overlay if one is already open

        if (typeof (overrides) != "undefined" && overrides != null) {
            $.extend(props, overrides);
        }

        // Exception for WMLT Stories
        if (props.url.toLowerCase().indexOf("text.aspx") > -1 && props.url.toLowerCase().indexOf("contentlinkid") > -1) {
            query = props.url.split("?").join("&");
            handleOrName = "storyText" + URLFactory.extractQueryStringValue(query, "ContentLinkID");
        }
        else if (props.url.toLowerCase().indexOf("storydata.aspx") > -1 && props.url.toLowerCase().indexOf("contentlinkid") > -1) {
            query = props.url.split("?").join("&");
            handleOrName = "storyVideo" + URLFactory.extractQueryStringValue(query, "ContentLinkID");
        }


        if (suppressHistory == false) {
            if (hash.indexOf("-pu+") == -1) {
                // Hash contains a page anchor instead of valid state data, clear out the old anchor
                // Create a new state object and convert that to a hash to get base state data: p+1-n+1000-c+-s+-r+-t+-ni+1-x+-pu+-f+-lr+-hr+-ri+
                hash = URLFactory.convertStateToHash(new StateSnapshotVO());
            }
            hash = URLFactory.updateHash(hash, "popup", handleOrName);
            window.location.hash = hash;
            HistoryManager.getInstance().addHistoryItem(hash);
        }

        //inject an iframe into the modal if needed
        if (props.iframe) {
            if (isIPad()) {
                $('meta[name="viewport"]').attr('content', 'width=1024px');
            }
            $("html").addClass('hasIframe');
            $(".modal-popup .content").html("<iframe frameBorder='0'></iframe>").attr("id", "overlayiframe");
            $(".modal-popup .content iframe").html("");
            if (props.height.toLowerCase() != "auto" && props.height != "") {
                $(".modal-popup").css("min-height", props.height + "px");
            }
            var isVideo = props.url.indexOf("/Video/VideoOverlay.aspx");
            if (isVideo >= 0) {
                $(".modal-popup .content iframe").attr("scrolling", "no");
                $(".modal-popup .content iframe").attr("allowfullscreen", "");
            }
            $(".modal-popup .content iframe").load(function () {
                if (props.height == "auto" || props.height == "") {
                    $(".modal-popup .content").css("height", "auto").removeClass("rollbar");;
                }
                else {
                    $(".modal-popup .content").css("height", props.height + "px").addClass("rollbar");;
                }
                initRollbar();
                try {
                    $('a[rel="' + deeplink + '"]', $(".modal-popup .content iframe").contents()).click();
                } catch (e) {
                    // this is a crossdomain iframe
                }
                overlayLoads++;
            }).attr("src", props.url);
        } else {
            if (props.height.toLowerCase() != "auto" && props.height != "") {
                $(".modal-popup").css("min-height", props.height + "px");
            }
            $(".modal-popup .content").html("");
            $(".modal-popup .content").load(props.url, function () {
                overlayLoads++;
                if (props.height.toLowerCase() == "auto" || props.height == "") {
                    $(".modal-popup .content").css("height", "auto").removeClass("rollbar");
                }
                else {
                    $(".modal-popup .content").css("height", props.height + "px").addClass("rollbar");
                }
                globalAjaxCallback();
                $('a[rel="' + deeplink + '"]').click();
                // Exception for WMLT stories - once text page loads, check to see if story type has been changed to video.
                if (props.url.toLowerCase().indexOf("text.aspx") > -1 && props.url.toLowerCase().indexOf("contentlinkid") > -1) {
                    if ($("#storyType").val() == "video") {
                        OverlayManager.getInstance().open("storyVideo" + $("#contentLinkId").val(), {
                            url: '/Video/VideoOverlay.aspx?config=/WorldOfTiffany/WMLT/Stories/StoryData.aspx?contentLinkID=' + $("#contentLinkId").val(),
                            size: "full",
                            iframe: true,
                            position: "top"});
                    }
                }
            });
        }

        var topValue;
        if (props.position == "top") {
            topValue = 0;
        } else {
            topValue = 110;
        }

        var borderValue = "";
        if (props.fullframe) {
            borderValue = "fullframe";
        }

        //style and show the modal
        $(".modal-popup").attr("class", "modal-popup").addClass(props.size).addClass(props.bgstyle).addClass(borderValue).css("top", this.initialScrollPosition + topValue + "px").show();
        var isVideo = props.url.indexOf("/Video/VideoOverlay.aspx");
        if (isVideo >= 0) {
            $(".modal-popup").addClass('videoOverlay');

            if (isBrowserIE()) {
                $(".modal-popup.videoOverlay").css("left", $(".modal-popup.videoOverlay").css("margin-left"));
            }
            $(".modal-popup.videoOverlay .close").html("<img src='/shared/images/icons/newVideoControls/close.png' style='width:23px; height:24px'><img src='/shared/images/icons/newVideoControls/close_hover.png' style='width:23px; height:24px; display:none;'>");
            $(".modal-popup.videoOverlay .close").hover(function () {
                $(this).find("img").toggle();
            });
            $("#gray-overlay").addClass("newVideo");
        }
        else {
            if (isBrowserIE()) {
                $(".modal-popup").css("left", "");
            }
            $(".modal-popup .close").html('<i class="icon-font" aria-hidden="true">delete_large</i>');
        }
    }
    else {
        handleOrName.show();
    }
    $("#gray-overlay").show();

    //$(window).scrollTop(0);
};

OverlayManager.prototype.close = function (handle, suppressHistory) {
    if (typeof (handle) != "undefined" && handle != null) {
        handle.hide();
    }

    var closeBack = overlayLoads * -1;

    suppressHistory = (typeof (suppressHistory) == "undefined") ? false : suppressHistory;

    $("html").removeClass("hasIframe");
    var hash = "";
    if ($("body").hasClass("modal-frame")) {
        try {
            hash = window.parent.location.hash.split("#").join("");
        } catch (e) {
            // this fails when trying to close from cross domain
            sendParentMessage("closePopup");
            return;
        }
        if (hash != "") {
            // Setting the hash to blank when it already is blank will result in IE popping the page to the top, so don't do it
            if (suppressHistory == false) {
                if (hash.indexOf("-pu+") == -1) {
                    // Hash contains a page anchor instead of valid state data, clear out the old anchor
                    // Create a new state object and convert that to a hash to get base state data: p+1-n+1000-c+-s+-r+-t+-ni+1-x+-pu+-f+-lr+-hr+-ri+
                    hash = URLFactory.convertStateToHash(new StateSnapshotVO());
                }
                hash = URLFactory.updateHash(hash, "popup", "");
                //window.parent.location.hash = hash;
                overlayLoads = 0;
                if (document.referrer.split("/")[2] == parent.location.hostname) {
                    if (closeBack == -0 || closeBack == 0) {
                        closeBack = -1;
                    }
                    window.history.go(closeBack);
                }
                //window.parent.HistoryManager.getInstance().addHistoryItem(hash);
            }
        }
        //window.parent.$(window).scrollTop(this.initialScrollPosition);
		document.activeElement.blur();
        window.parent.$(".modal-popup").attr("class", "modal-popup").hide();
        window.parent.$("#gray-overlay, .image-overlay").hide();
        // mobile safari crashes if you replace the iframe before the script is done running.  Hiding the iframe instead
        window.parent.$(".modal-popup .content").append('<img class="loading" src="/shared/images/loading.gif" />');
        window.parent.$(".modal-popup iframe").attr("src", "").hide();
    } else {
	    document.activeElement.blur();
        $(".modal-popup").attr("class", "modal-popup").hide();
        $(".modal-popup .content").html('<img class="loading" src="/shared/images/loading.gif" />');
        $("#gray-overlay, .image-overlay").hide();
        hash = window.location.hash.split("#").join("");
        if (hash != "") {
            // Setting the hash to blank when it already is blank will result in IE popping the page to the top, so don't do it
            if (suppressHistory == false) {
                if (hash.indexOf("-pu+") == -1) {
                    // Hash contains a page anchor instead of valid state data, clear out the old anchor
                    // Create a new state object and convert that to a hash to get base state data: p+1-n+1000-c+-s+-r+-t+-ni+1-x+-pu+-f+-lr+-hr+-ri+
                    hash = URLFactory.convertStateToHash(new StateSnapshotVO());
                }
                hash = URLFactory.updateHash(hash, "popup", "");
                //window.location.hash = hash;
                overlayLoads = 0;
                if (document.referrer.split("/")[2] == parent.location.hostname) {
                    if (closeBack == -0 || closeBack == 0) {
                        closeBack = -1;
                    }
                    window.history.go(closeBack);
                }
                //HistoryManager.getInstance().addHistoryItem(hash);
            }
        }
        //$(window).scrollTop(this.initialScrollPosition);
    }
};

OverlayManager.prototype.resize = function (newHeight) {
    if ($(".modal-popup .content iframe").length > 0) {
        $(".modal-popup .content iframe").css("height", parseInt(newHeight, 10) + 10 + 'px');
    }
    else {
        $(".modal-popup .content").css("height", parseInt(newHeight, 10) + 10 + 'px');
    }
};

/* End of OverlayManager.js */
// ----------------------------------------------
// File:		StateModel.js
// Author:		Nathan Derksen
// Description:	Singleton class used to keep track of application data and state.
//				Defines getters and setters used to track and modify state data.
// Example:
// StateModel.getInstance().getProduct("1235345");
// ----------------------------------------------
function StateModel()
{
	this.pInstance = null;

	this.pCachedProducts = {
		list: [],
		lookup: {}
	};
	this.pCachedMarketingTiles	= {
		list: [],
		lookup: {}
	};

	this.pCategoryMenus			= {};
	this.pBrowseState			= URLFactory.convertHashToState(window.location.hash);
	this.pLastHash				= "";
	this.pSKU					= "";
	this.productServiceURL = "";
	this.productServiceType = "GET";
	this.layoutType = "1";
	this.numProducts = 0;
	this.currentPage = 0;
	this.isSearchMode = false;
	this.custom = {};
}

StateModel.LAYOUT_UNIFORM = "0";
StateModel.LAYOUT_TOP_LEFT = "1";
StateModel.LAYOUT_TOP_RIGHT = "2";
StateModel.LAYOUT_MARKETING = "3";
StateModel.SHOW_MORE_THRESHOLD = 72;
StateModel.DEFAULT_IMAGE_CROP = "0.2,0.2,0.6,0.6";
StateModel.SORT_CRITERIA_NEW = 3;
StateModel.SORT_CRITERIA_NAME = 4;
StateModel.SORT_CRITERIA_HIGH_LOW = 1;
StateModel.SORT_CRITERIA_LOW_HIGH = 2;
StateModel.SORT_CRITERIA_DEFAULT = 5;

// ----------------------------------------------
StateModel.getInstance = function ()
{
	if (!this.pInstance)
	{
		this.pInstance = new StateModel();
	}
	return this.pInstance;
};

// ----------------------------------------------
StateModel.prototype.getProduct = function (productId)
{
	if (this.pCachedProducts.lookup[productId])
	{
		return this.pCachedProducts.lookup[productId];
	}
	return null;
};

// ----------------------------------------------
StateModel.prototype.getProducts = function (productId)
{
	return this.pCachedProducts.list;
};

// ----------------------------------------------
StateModel.prototype.appendProducts = function (productArray)
{
	if (productArray)
	{
		var numProducts = productArray.length;

		for (var i = 0; i < numProducts; i++)
		{
			if (productArray[i].id)
			{
				this.pCachedProducts.lookup[productArray[i].id] = productArray[i];
				this.pCachedProducts.list.push(productArray[i]);
			}
		}
	}
};

// ----------------------------------------------
StateModel.prototype.removeAllProducts = function () {
    $(this).trigger("currentPageChangeRequested", { value: this.getCurrentPage() });
    this.pCachedProducts.list = [];
    this.pCachedProducts.lookup = {};
    $(this).trigger("currentPageChangeCompleted", { value: 0 });
};

// ----------------------------------------------
StateModel.prototype.getCurrentPage = function ()
{
	return this.pBrowseState.currentPage;
};

// ----------------------------------------------
StateModel.prototype.getStateSnapshot = function ()
{
	var browseState = this.pBrowseState;
	return browseState;
};

// ----------------------------------------------
StateModel.prototype.setStateSnapshot = function (modelState, reloadBrowseGrid) {
	var updatedProperties = [];
	var networkUpdateNeeded = false;
	var resetProductData = false;
	var parent = this;
	var hashData;
	var url;

	for (var propertyName in modelState) {
		if (typeof (modelState[propertyName]) != "undefined") {
			updatedProperties.push(propertyName);
			if (propertyName == "overlay") {
				if (this.pBrowseState.overlay != modelState.overlay) {
					this.pBrowseState.overlay = modelState.overlay;
					if (modelState.overlay != "") {
						var splitPopupState = modelState.overlay.split("+");
						if (splitPopupState.length == 1) {
							//							openMarketingPopUpFollowup(splitPopupState[0])
						}
						else if (splitPopupState.length >= 2) {
							for (var i = 1; i < splitPopupState.length; i++) {
								splitPopupState[i] = URLFactory.hashUnescape(splitPopupState[i]);
							}
							//							openMarketingPopUpFollowup(splitPopupState[0], splitPopupState);
						}
					}
					else {
						//						closePopUpFollowup();
					}
				}
			}
			else {
				this.pBrowseState[propertyName] = modelState[propertyName];
			}
		}

		// Take a look at which properties have been updated. If any of them require
		// a network call, then set the flag to indicate this. We only want one
		// network call for all products needing updating, which is why the flag is used.
		switch (propertyName) {
			case "currentPage":
				if (modelState[propertyName] >= this.pCachedProducts.list.length) {
					// Only call service if we don't already have the data pre-cached
					networkUpdateNeeded = true;
				}
				break;
			case "category":
			case "sortCriteria":
			case "refinement":
			case "searchTerms":
			case "pkbMipsOptions":
			case "pkbHideIndividual":
			case "pkbClassificationSort":
			case "pkbMipsLocations":
			case "pkbAvailableInventory":
				networkUpdateNeeded = true;
		}

	}

	$(this).trigger("setStateSnapshotRequested", { state: this.pBrowseState, updatedProperties: updatedProperties });

	if (networkUpdateNeeded == true && this.productServiceURL != "" && reloadBrowseGrid != false) {
		hashData = URLFactory.convertStateToServiceHash(this.pBrowseState);
		//		url = "/shared/scripts/ecom/shopping/categoryBrowseJSON_" + this.pBrowseState.currentPage + ".txt";
		url = this.productServiceURL;
		$.ajax({
			url: url,
			type: this.productServiceType,
			data: '{"SearchQueryString": "' + hashData + '", "IsSearchMode": ' + this.isSearchMode + ', "SessionID": "' + browserSessionID + '", "UserID": "' + sessionUserid + '"}',
			dataType: "json",
			contentType: "application/json; charset=utf-8",
			success: function (data) {
				if (data != null) {
					$(parent).trigger("getProductsComplete", { results: data, service: "getProducts", state: URLFactory.convertHashToState(hashData), updatedProperties: updatedProperties });
					$(parent).trigger("setStateSnapshotComplete", { state: URLFactory.convertHashToState(hashData), updatedProperties: updatedProperties });
				} else {
					$(parent).trigger("getProductsError");
					$(parent).trigger("setStateSnapshotComplete", { state: URLFactory.convertHashToState(hashData), updatedProperties: updatedProperties });					
				}
			},
			error: function (jqXHR, status, error) {
				$(parent).trigger("getProductsError", { status: status, message: jqXHR.responseText, service: "getProducts", state: URLFactory.convertHashToState(hashData), updatedProperties: updatedProperties });
				$(parent).trigger("setStateSnapshotComplete", { state: URLFactory.convertHashToState(hashData), updatedProperties: updatedProperties });
			}
		});
	}
	else {
		$(this).trigger("setStateSnapshotComplete", { state: this.pBrowseState, updatedProperties: updatedProperties });
	}

	//	FlashCommBridge.getInstance().send("setFromHistory", modelState.flash); // Should be done in follow-up event handler

};

// ----------------------------------------------
StateModel.prototype.getSKU = function ()
{
	return this.pSKU;
};

// ----------------------------------------------
StateModel.prototype.setSKU = function (sku)
{
	this.pSKU = sku;
};

/* End of StateModel.js */
// URLFactory.js

function StateSnapshotVO() {
    this.numProductsVisible = 0;
    this.currentPage = 0;
    this.pageSize = "1000";
    this.selectedTab = "";
    this.category = "";
    this.sortCriteria = 9999;
    this.refinement = "";
    this.searchTerms = "";
    this.onlyItems = "1";
    this.isNormalized = "";
    this.popup = "";
    this.flash = "";
    this.custom = "";
    this.selectedImage = "";
    this.selectedFilters = "";
    this.lowRange = "";
    this.highRange = "";
    this.pkbMipsOptions = "";
    this.pkbHideIndividual = "";
    this.pkbClassificationSort = "";
    this.pkbMipsLocations = "";
    this.pkbAvailableInventory = "";
    this.relatedItemSku = "";
    this.soldIR = "";
    this.pagePosition = "";
}

// ----------------------------------------------
// File:		URLFactory.js
// Author:		Nathan Derksen
// Description:	Class to handle converting URL parameters to StateSnapshotVO
// Example:
// var stateObj = URLFactory.convertHashToState(window.location.href);
// ----------------------------------------------


// ----------------------------------------------
// Function:	URLFactory()
// Author:		Nathan Derksen
// Description:	Base class
// Inputs:		<None>
// Returns:		<Nothing>
// ----------------------------------------------
function URLFactory() {
}

var intToExtStateMap = {
    currentPage: "p",
    currentProductGrid: "cg",
    category: "c",
    sortCriteria: "s",
    refinement: "r",
    pageSize: "n",
    searchTerms: "t",
    relatedItemSku: "ri",
    onlyItems: "ni",
    isNormalized: "x",
    popup: "pu",
    flash: "f",
    id: "id",
    selectedFilters: "k",
    lowRange: "lr",
    highRange: "hr",
    soldIR: "mi",
    pagePosition: "pp"};

var extToIntStateMap = {
    p: "currentPage",
    cg: "currentProductGrid",
    c: "category",
    s: "sortCriteria",
    r: "refinement",
    n: "pageSize",
    t: "searchTerms",
    ri: "relatedItemSku",
    ni: "onlyItems",
    x: "isNormalized",
    pu: "popup",
    f: "flash",
    id: "id",
    k: "selectedFilters",
    lr: "lowRange",
    hr: "highRange",
    mi: "soldIR",
    pp: "pagePosition"};


// ----------------------------------------------
// Function:	ProductFactory.convertHashToState()
// Author:		Nathan Derksen
// Description:	Converts a URL with parameters in an anchor to fill a StateSnapshotVO object
// Inputs:		<String> url: The URL from the address bar
// Returns:		<StateSnapshotVO>: An object with properties to hold the state values
// ----------------------------------------------
URLFactory.convertHashToState = function (hash) {
    var snapshot = new StateSnapshotVO();
    var splitURL;
    var anchor;
    var hashArray;
    var splitItem;
    var mappedProperty;
    var valueName;

    if (hash) {
        hash = hash.split("#").join("");
        hashArray = hash.split("-");
        for (var i = 0; i < hashArray.length; i++) {
            splitItem = hashArray[i].split("+");
            valueName = splitItem[0];
            if (splitItem.length >= 2) {
                mappedProperty = extToIntStateMap[valueName];
                splitItem.shift();

                if (mappedProperty) {
                    switch (mappedProperty.toLowerCase()) {
                        case "currentpage":
                            snapshot.currentPage = Number(decodeURIComponent(splitItem.join("+"))) - 1;
                            break;
                        case "currentproductgrid":
                            snapshot.currentProductGrid = decodeURIComponent(splitItem.join("+"));
                            break;
                        case "category":
                            snapshot.category = decodeURIComponent(splitItem.join("+"));
                            break;
                        case "sortcriteria":
                            snapshot.sortCriteria = decodeURIComponent(splitItem.join("+"));
                            break;
                        case "refinement":
                            snapshot.refinement = decodeURIComponent(splitItem.join("+"));
                            break;
                        case "pagesize":
                            snapshot.pageSize = decodeURIComponent(splitItem.join("+"));
                            break;
                        case "searchterms":
                            snapshot.searchTerms = decodeURIComponent(splitItem.join("+"));
                            break;
                        case "relateditemsku":
                            snapshot.relatedItemSku = decodeURIComponent(splitItem.join("+"));
                            break;
                        case "onlyitems":
                            snapshot.onlyItems = decodeURIComponent(splitItem.join("+"));
                            break;
                        case "isnormalized":
                            snapshot.isNormalized = decodeURIComponent(splitItem.join("+"));
                            break;
                        case "popup":
                            snapshot.popup = decodeURIComponent(splitItem.join("+"));
                            break;
                        case "flash":
                            snapshot.flash = decodeURIComponent(splitItem.join("+"));
                            break;
                        case "lowrange":
                            snapshot.lowRange = decodeURIComponent(splitItem.join("+"));
                            break;
                        case "highrange":
                            snapshot.highRange = decodeURIComponent(splitItem.join("+"));
                            break;
                        case "soldir":
                            snapshot.soldIR = decodeURIComponent(splitItem.join("+"));
                            break;
                        case "pageposition":
                            snapshot.pagePosition = decodeURIComponent(splitItem.join("+"));
                            break;
                    }
                }
            }
        }
    }
    return snapshot;
};

// ----------------------------------------------
// Function:	ProductFactory.convertStateToHash()
// Author:		Nathan Derksen
// Description:	Converts a StateSnapshotVO object to a URL with parameters in an anchor
// Inputs:		<StateSnapshotVO> stateSnapshot: An object with properties to hold the state values
// Returns:		<String>: The URL from the address bar
// ----------------------------------------------
URLFactory.convertStateToHash = function (stateSnapshot) {
    var stateArray = new Array();
    var newStateStr = "";

    var productGrid = StateModel.getInstance().getProducts();
    var sortCriteria = "";
    var sampleQueryString = "";

    if (productGrid.length > 0) {
        if (typeof (productGrid[0].qs) != "undefined") {
            sampleQueryString = productGrid[0].qs;
        }
        else {
            sampleQueryString = productGrid[0].ItemQS;
        }
        sortCriteria = URLFactory.extractValue(sampleQueryString, "sortCriteria");
    }

    for (var item in stateSnapshot) {
        switch (item.toLowerCase()) {
            case "currentproductgrid":
            case "category":
            case "refinement":
            case "pagesize":
            case "searchterms":
            case "relateditemsku":
            case "soldir":
            case "onlyitems":
            case "isnormalized":
            case "popup":
            case "flash":
            case "lowrange":
            case "highrange":
            case "pageposition":
                stateArray.push(intToExtStateMap[item] + "+" + encodeURIComponent(stateSnapshot[item]));
                break;
            case "currentpage":
                var offsetNum = String(Number(stateSnapshot[item]) + 1);
                stateArray.push(intToExtStateMap[item] + "+" + encodeURIComponent(offsetNum));
                break;
            case "sortcriteria":
                if (stateSnapshot[item] == "9999" || stateSnapshot[item] == 9999) {
                    stateArray.push(intToExtStateMap[item] + "+" + sortCriteria);
                }
                else {
                    stateArray.push(intToExtStateMap[item] + "+" + encodeURIComponent(stateSnapshot[item]));
                }
                break;
        }
    }

    newStateStr = stateArray.join("-");
    return newStateStr;
};

// ----------------------------------------------
// Function:	ProductFactory.convertStateToServiceHash()
// Author:		Nathan Derksen
// Description:	Converts a StateSnapshotVO object to a hash that can be consumed by a service (eg: removes "currentProductGrid" and makes pages 1 based instead of 0 based)
// Inputs:		<StateSnapshotVO> stateSnapshot: An object with properties to hold the state values
// Returns:		<String>: The URL from the address bar
// ----------------------------------------------
URLFactory.convertStateToServiceHash = function (stateSnapshot) {
    var stateArray = new Array();
    var newStateStr = "";

    var productGrid = StateModel.getInstance().getProducts();
    var sortCriteria = "";
    var sampleQueryString = "";

    if (productGrid.length > 0) {
        if (typeof (productGrid[0].qs) != "undefined") {
            sampleQueryString = productGrid[0].qs;
        }
        else {
            sampleQueryString = productGrid[0].ItemQS;
        }
        sortCriteria = URLFactory.extractValue(sampleQueryString, "sortCriteria");
    }

    for (var item in stateSnapshot) {
        switch (item.toLowerCase()) {
            case "category":
            case "refinement":
            case "pagesize":
            case "searchterms":
            case "relateditemsku":
            case "soldir":
            case "onlyitems":
            case "isnormalized":
            case "lowrange":
            case "highrange":
            case "pageposition":
                stateArray.push(intToExtStateMap[item] + "+" + encodeURIComponent(stateSnapshot[item]));
                break;
            case "currentpage":
                var offsetNum = String(Number(stateSnapshot[item]) + 1);
                stateArray.push(intToExtStateMap[item] + "+" + encodeURI(offsetNum));
                break;
            case "sortcriteria":
                if (stateSnapshot[item] == "9999" || stateSnapshot[item] == 9999) {
                    stateArray.push(intToExtStateMap[item] + "+" + sortCriteria);
                }
                else {
                    stateArray.push(intToExtStateMap[item] + "+" + encodeURI(stateSnapshot[item]));
                }
                break;
        }
    }

    newStateStr = stateArray.join("-");
    return newStateStr;
};

// ----------------------------------------------
// Function:	ProductFactory.convertHashToServiceHash()
// Author:		Nathan Derksen
// Description:	Cleans up the hash contents for sending to a service (eg: removes "currentProductGrid" and makes pages 1 based instead of 0 based.
// Inputs:		<StateSnapshotVO> stateSnapshot: An object with properties to hold the state values
// Returns:		<String>: The URL from the address bar
// ----------------------------------------------
URLFactory.convertHashToServiceHash = function (hash) {
    var tempState = URLFactory.convertHashToState(hash);
    return URLFactory.convertStateToServiceHash(tempState);
};


// ----------------------------------------------
// ----------------------------------------------
URLFactory.updateHash = function (inputHash, criteria, value) {
    var hashArray = inputHash.split("-");
    var splitItem;

    for (var i = 0; i < hashArray.length; i++) {
        splitItem = hashArray[i].split("+");
        if (extToIntStateMap[splitItem[0]] == criteria) {
            hashArray[i] = splitItem[0] + "+" + value;
        }
    }
    return hashArray.join("-");
};

// ----------------------------------------------
// ----------------------------------------------
URLFactory.updateQuery = function (inputQuery, criteria, value) {
    var queryArray = inputQuery.split("&");
    var splitItem;
    var itemFound = false;

    for (var i = 0; i < queryArray.length; i++) {
        splitItem = queryArray[i].split("=");
        if (splitItem[0] == criteria) {
            queryArray[i] = splitItem[0] + "=" + value;
            itemFound = true;
        }
    }
    if (itemFound == false) {
        queryArray.push(criteria + "=" + value);
    }
    return queryArray.join("&");
};

// ----------------------------------------------
// ----------------------------------------------
URLFactory.extractValue = function (inputHash, criteria) {
    var hashArray = inputHash.split("-");
    var splitItem;
    var valueName;

    for (var i = 0; i < hashArray.length; i++) {
        splitItem = hashArray[i].split("+");
        valueName = splitItem[0];
        splitItem.shift();
        if (extToIntStateMap[valueName] == criteria) {
            //		alert("extractValue: " + criteria + ":" + splitItem.join("+"));
            return splitItem.join("+");
        }
    }
    return "";
};

// ----------------------------------------------
// ----------------------------------------------
URLFactory.extractQueryStringValue = function (inputQueryString, criteria) {
    if (typeof (inputQueryString) != "undefined") {
        var queryStringArray = inputQueryString.split("?").join("").split("&");
        var splitItem;

        for (var i = 0; i < queryStringArray.length; i++) {
            splitItem = queryStringArray[i].split("=");
            if (splitItem[0].toLowerCase() == criteria.toLowerCase()) {
                return splitItem[1];
            }
        }
    }
    return "";
};

// ----------------------------------------------
// ----------------------------------------------
URLFactory.hashEscape = function (oldHash) {
    var newHash = oldHash;
    newHash = encodeURIComponent(newHash);
    newHash = newHash.split("-").join("%45");
    newHash = newHash.split("+").join("%43");
    return newHash;
};

// ----------------------------------------------
// ----------------------------------------------
URLFactory.hashUnescape = function (oldHash) {
    var newHash = oldHash;
    newHash = newHash.split("%45").join("-");
    newHash = newHash.split("%43").join("+");
    newHash = decodeURIComponent(newHash);
    return newHash;
};

URLFactory.appendQueryString = function (key, value, isFirst) {
    if (isFirst == true) {
        return key + "=" + value;
    } else {
        return "&" + key + "=" + value;
    }
};

URLFactory.scene7ImageURL = function (image, preset, sharpen, crop) {
    var base = templateStrings.baseScene7ImageURL;
    var missingImage = (templateStrings.defaultScene7NoImageName == "") ? "" : "&defaultImage=" + templateStrings.defaultScene7NoImageName + "&&";
    var url = "";

    if (preset.indexOf("$") == -1) {
        preset = "$" + preset + "$";
    }

    if (typeof (image) == "undefined" || image == null || image == "") {
        image = templateStrings.defaultScene7NoImageName;
        sharpen = "";
        crop = "";
    }
    else {
        if (typeof (sharpen) != "undefined" && sharpen != null && sharpen != "") {
            if (sharpen.indexOf("&op_usm=") == -1) {
                sharpen = "&op_usm=" + sharpen;
            }
        }
        else {
            sharpen = "";
        }

        if (typeof (crop) != "undefined" && crop != null && crop != "") {
            if (preset == "$EcomBrowseM$" || preset == "$EcomBrowseL$" || preset == "$EcomInlineM$") {
                crop = "&$cropvalue=" + crop;
            }
            else {
                crop = "&cropN=" + crop;
            }
        }
        else {
            crop = "";
        }

    }
    if (templateStrings.IsScene7SEOFriendlyImageNameEnabled == "True" || templateStrings.IsScene7SEOFriendlyImageNameEnabled == "true") {
        url = base + preset.replace(/\$/g, '') + "/" + image + ".jpg?" + sharpen + crop + missingImage;
        var noImageTerms = templateStrings.scene7SEONoImageTerms.split(",");
        for (var i = 0; i < noImageTerms.length; i++) {
            url = url.replace(noImageTerms[i], templateStrings.defaultScene7NoImageName);
        }
        url = url.replace("?&", "?");
    }
    else {
        url = base + image + "?" + preset + sharpen + crop + missingImage;
    }
    return url;
};

URLFactory.scene7VideoURL = function (video) {
    var base = templateStrings.baseScene7ImageURL.split("/image/").join("/content/");
    var url = base + video;
    return url;
};

URLFactory.scene7EngravingPreviewURL = function (props) {
  
    var url = '';
    if (props.serviceTypeId == 11 && props.isSample) {
        url = templateStrings.baseScene7Server + templateStrings.scene7Image + templateStrings.scene7Server + '/';
        url += props.serviceTypeId+ '_text_options?';
    }
    else {
        // base + s7 image render server
        url = templateStrings.baseScene7Server + templateStrings.scene7Image + templateStrings.scene7ImageRenderServer + '?src=ir{' + templateStrings.scene7ImageRenderServer + '/';

        // vnt asset
        if (props.vnt && props.vnt != '') {
            url += props.vnt;
        } else {
            url += 'default_vnt';
        }

        // Symbol Object Rotation
        if (props.hasSymbolObj && props.serviceTypeId == 11 && props.styleCode != '$styleId$') {// symbols with rotation
            url += '?obj=symbol&show';
        }
        else {
            url += '?obj=engrave&show';
        }

        // s7 image server
        url += '&decal&src=is{' + templateStrings.scene7Server + '/';

        // style/font
        if (props.serviceTypeId == 11 && props.styleCode != '$styleId$') { // symbols
            url += props.serviceTypeId + '_text?scl=1}}';
        } else { // text
            url += props.styleCode + '_' + props.serviceTypeId + '_text?scl=1}}';
        }
    }
    
    // letters/symbol ligature
    if (props.serviceTypeId == 11) { // symbols
        url += '&$text1c=' + props.letters.toLowerCase();
    } else { // text
        var lettersImg = props.letters;

        if (props.letters && props.letters != '') {
            // validate letters
            if (props.regex) {
                var regex = new RegExp(props.regex, "g");
                lettersImg = lettersImg.replace(regex, '');
            }

            // sample letters if needed
            if (props.isSample && lettersImg.length == 0) {
                if (props.styleCode == 290) {
                    lettersImg = 'abc';
                } else {
                    lettersImg = 'ABC';
                }                
            }

            // split letters into array and adjust case as needed
            if (props.isTrueType) {
                lettersImg = lettersImg.split("");
            } else {
                lettersImg = lettersImg.toUpperCase().split(""); // force uppercase for non-truetype to support BYO 1.0 fonts
            }            

            if (typeof (lettersImg[0]) == "undefined") {
                lettersImg[0] = '';
            }
            if (typeof (lettersImg[1]) == "undefined") {
                lettersImg[1] = '';
            }
            if (typeof (lettersImg[2]) == "undefined") {
                lettersImg[2] = '';
            }
        } else {
            lettersImg = [];
            lettersImg[0] = '';
            lettersImg[1] = '';
            lettersImg[2] = '';
        }

        //special case for 201,202,203,204 Style to add dots
        if (props.styleCode == "201" || props.styleCode == "202" || props.styleCode == "203" || props.styleCode == "204") {
            if (lettersImg[0] != '') {
                if (props.styleCode != "201") {
                    lettersImg[0] = lettersImg[0] + ".";
                }
                else {
                    lettersImg[0] = lettersImg[0] + "\u00b7";
                }
            }
            if (lettersImg[1] != '') {
                if (props.styleCode != "201") {
                    lettersImg[1] = lettersImg[1] + ".";
                }
                else {
                    lettersImg[1] = lettersImg[1] + "\u00b7";
                }
            }
            if (lettersImg[2] != '' && props.styleCode != "201") {
                lettersImg[2] = lettersImg[2] + ".";
            }
        }

        // add letters to url string
        url += '&$text1l=' + this.fixedEncodeURIComponent(lettersImg[0]) + '&$text1c=' + this.fixedEncodeURIComponent(lettersImg[1]) + '&$text1r=' + this.fixedEncodeURIComponent(lettersImg[2]);
    }    

    // preset
    url += '&$' + props.preset + '$';

    return url;
};

URLFactory.fixedEncodeURIComponent = function (str) {
    return encodeURIComponent(str).replace(/[!'()*]/g, function (c) {
        return '%' + c.charCodeAt(0).toString(16);
    });
};

URLFactory.hasSubDomain = function (url) {
    // IF THERE, REMOVE WHITE SPACE FROM BOTH ENDS
    url = url.replace(new RegExp(/^\s+/), ""); // START
    url = url.replace(new RegExp(/\s+$/), ""); // END

    // IF FOUND, CONVERT BACK SLASHES TO FORWARD SLASHES
    url = url.replace(new RegExp(/\\/g), "/");

    // IF THERE, REMOVES 'http://', 'https://' or 'ftp://' FROM THE START
    url = url.replace(new RegExp(/^http\:\/\/|^https\:\/\/|^ftp\:\/\//i), "");

    // IF THERE, REMOVES 'www.' FROM THE START OF THE STRING
    url = url.replace(new RegExp(/^www\./i), "");

    // REMOVE COMPLETE STRING FROM FIRST FORWARD SLASH ON
    url = url.replace(new RegExp(/\/(.*)/), "");

    // REMOVES '.??.??' OR '.???.??' FROM END - e.g. '.CO.UK', '.COM.AU'
    if (url.match(new RegExp(/\.[a-z]{2,3}\.[a-z]{2}$/i))) {
        url = url.replace(new RegExp(/\.[a-z]{2,3}\.[a-z]{2}$/i), "");

        // REMOVES '.??' or '.???' or '.????' FROM END - e.g. '.US', '.COM', '.INFO'
    } else if (url.match(new RegExp(/\.[a-z]{2,4}$/i))) {
        url = url.replace(new RegExp(/\.[a-z]{2,4}$/i), "");
    }
    // CHECK TO SEE IF THERE IS A DOT '.' LEFT IN THE STRING
    var subDomain = (url.match(new RegExp(/\./g))) ? true : false;

    return (subDomain);
};

/* End of URLFactory.js */

var isRetail = "False";
var locale = 'en-US';
var qString = '';

//JIRA#42 - HTTPS Migration
var rootUrl = 'https://www.tiffany.com';
var isStmtInternal = "False";
var originalPageTitle = document.title;
var configExpTime = 30;
var isMobilePopupOverlay = false;

/*if (typeof (s_account) == "undefined") {
    var s_account = 'tiffanyrus';
}*/

//browser detect for NN 4.xx and IE 4.xx and below, if so redirect to upgrade page.
var agt = navigator.userAgent.toLowerCase();
var appVer = navigator.appVersion.toLowerCase();
var is_minor = parseFloat(appVer);
var is_major = parseInt(is_minor);

// If Mac platform, also use the Macintosh style sheet.
if (navigator.platform.indexOf('Mac') != -1) {
    //document.write('<link rel="stylesheet" href="/Shared/css/screen_mac.css?v=7">');
    //document.write('<link rel="stylesheet" href="/Local/'+locale+'/css/local_mac.css?v=7.1">');
}

if (isStmtInternal.toLowerCase() == "true") {
    //document.write('<link rel="stylesheet" href="/Local/'+locale+'/css/internal.css?v=7.1">');
}

function isIEUnsupported() {
    var iePos = appVer.indexOf('msie');
    if (iePos != -1) {
        is_minor = parseFloat(appVer.substring(iePos + 5, appVer.indexOf(';', iePos)));
        is_major = parseInt(is_minor);
    }
    if ((iePos != -1) && is_major < 6) {
        if (isRetail.toLowerCase() == "true") { return false; }
        else { return true; }
    }
    else { return false; }
}

function isSafariUnsupported() {
    if ((agt.indexOf('safari') > 0) && agt.indexOf('mac') > 0) {
        is_minor = parseFloat(agt.substring(agt.indexOf('safari') + 7, agt.indexOf('safari') + 12));
        is_major = parseInt(is_minor);
        if (is_major < 412) { return true; }
        else { return false; }
    }
}

function isSafari3Plus() {
    if (agt.indexOf('safari') > 0) {
        is_minor = parseFloat(agt.substring(agt.indexOf('safari') + 7, agt.indexOf('safari') + 12));
        is_major = parseInt(is_minor);
        if (is_major >= 500) { return true; }
        else { return false; }
    }
    return false;
}
function changeShippingOption(elem) {
    if ($("#shipToAddress").attr("checked") == true) {
        $("#pickupAddresses").hide();
        $("#shippingAddresses").fadeIn(300);
        $("#shippingMethods").fadeIn(300);
        if (!isSmallMobile()) {
            $("#inStorePickupInfo").hide();
            $("#shippingInfo").show();
        }
    } else {
        var option = $(elem).attr("id").split("pickupInPerson")[1];
        $("#shippingAddresses").hide();
        $("#pickupAddresses").fadeIn(300);
        $("#shippingMethods").hide();
        $("#pickupAddresses .shipToAddress").hide();
        $("#pickupAddress" + option).fadeIn(300);
        if (!isSmallMobile()) {
            $("#shippingInfo").hide();
            $("#inStorePickupInfo").show();
            $("#pickupAddrSummarybox").hide();
            $("#pickupAddrSummarybox").html($("#pickupAddress" + option).html()).fadeIn(300);
        }
    }
}

var browserName = navigator.appName;
var browserVer = parseInt(navigator.appVersion);
var isMac = (navigator.appVersion.indexOf("Mac") != -1);
//Do Object detection
if (document.getElementById) {
    if ((browserName == "Netscape" && browserVer < 5) || isIEUnsupported() || isSafariUnsupported() || (browserName == "Microsoft Internet Explorer" && isMac)) {
        document.location.href = "/Common/errors/upgrade.aspx";
    }
}
else { document.location.href = "/Common/errors/upgrade.aspx"; }


function shouldPriceBeVisible() {
    if ((locale.toLowerCase() == "intl" && isRetail.toLowerCase() == "false") || (locale.toLowerCase() == "zh-cn") || (locale.toLowerCase().indexOf("watch") > -1)) {
        return false;
    }
    return true;
}

function Redirect(url) {
    window.location = url;
}

// ND: Added so that tIFR could access user agent through ExternalInterface
function getUserAgent() {
    return navigator.userAgent.toLowerCase();
}

// ND: Added so that tIFR could access browser detection through ExternalInterface
function isBrowserIE() {
    var iePos = appVer.indexOf('msie');
    if (iePos != -1) {
        is_minor = parseFloat(appVer.substring(iePos + 5, appVer.indexOf(';', iePos)));
        is_major = parseInt(is_minor);
    }

    if ((iePos != -1) && is_major >= 4) {
        return true;
    }
    else {
        return false;
    }
}

function isIPhone() {
    if (navigator.userAgent.match(/iPhone/i) != null) {
        return true;
    }
    return false;
}

function isIPad() {
    if (navigator.userAgent.match(/iPad/i) != null) {
        return true;
    }
    return false;
}

function isIPod() {
    if (navigator.userAgent.match(/iPod/i) != null) {
        return true;
    }
    return false;
}

function isAndroid() {
    if (navigator.userAgent.match(/Android/i) != null) {
        return true;
    }
    return false;
}
function isAndroidMobile() {
    if (navigator.userAgent.match(/Android/i) != null && navigator.userAgent.match(/Mobile/i) != null) {
        return true;
    }
    return false;
}
function isAndroidTablet() {
    if (navigator.userAgent.match(/Android/i) != null && navigator.userAgent.match(/Mobile/i) == null) {
        return true;
    }
    return false;
}
function isBlackBerry() {
    if (navigator.userAgent.match(/BlackBerry/i) != null) {
        return true;
    }
    return false;
}

function isKindle() {
    if (navigator.userAgent.match(/Kindle/i) != null) {
        return true;
    }
    else if (navigator.userAgent.match(/Silk-Accelerated/i) != null) {
        return true;
    }
    return false;
}
function isKindleFire() {
    if (navigator.userAgent.match(/Kindle Fire/i) != null) {
        return true;
    }
    else if (navigator.userAgent.match(/Silk-Accelerated/i) != null) {
        return true;
    }
    return false;
}
function isWindowsPhone() {
    if (navigator.userAgent.match(/Windows Phone/i) != null) {
        return true;
    }
    return false;
}

function isMobile() {
    return isIPhone() || isIPad() || isIPod() || isAndroid();
}

function isSmallMobile() {
    return isIPhone() || isIPod() || isAndroidMobile();
}

function isTablet() {
    return isIPad() || isAndroidTablet();
}

function isMobileDomain() {
    var url = document.location.href;
    url = url.split("http://").join("").split("https://").join("");
    if (url.indexOf("m") == 0) {
        return true;
    }
    return false;
}

if (isMobile()) {
    //document.write('<link rel="stylesheet" type="text/css" href="css/mobile.css">');
}
if (isSmallMobile()) {
    document.write('<link rel="stylesheet" type="text/css" href="/Shared/css/chkout_mobile.css?v=6">');
    document.write('<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" name="viewport">');
    document.write('<style>input[type="radio"]  {background-color:#000}</style>');
    isMobilePopupOverlay = true;
}
if (isTablet()) {
    document.write('<link rel="stylesheet" type="text/css" href="/Shared/css/chkout_tablet.css">');
    document.write('<meta name = "viewport" content = "width = 1024,user-scalable=no">');
    document.write('<style>input[type="radio"]  {background-color:#000}</style>');
}
var ns = {};
ns.CheckOut = {};
var validation = null;
var errorMessages;
var rotateBanner;
var shippingAddressObj = null;
var lookUpTimeOut = 0;
var telMask = "(___) ___-____";
var phoneNumberBuffer = "";
var engravingAlphaMapping = { a: 0, b: 1, c: 2, d: 3, e: 4, f: 5, g: 6, h: 7, i: 8, j: 9, k: 10, l: 11, m: 12, n: 13, o: 14, p: 15, q: 16, r: 17, s: 18, t: 19, u: 20, v: 21, w: 22, x: 23, y: 24, z: 25 };
var errorMsgArray = [];
var shippingAddressObjMapping = {
    ShippingAddressInputCtl_ctl00_ddlTitle_Summary: "PreName",
    ShippingAddressInputCtl_ctl00_txtFirstName_Summary: "GivenName",
    ShippingAddressInputCtl_ctl00_txtLastName_Summary: "FamilyName",
    ShippingAddressInputCtl_ctl00_txtKanjiLastName_Summary: "FamilyName",
    ShippingAddressInputCtl_ctl00_txtKanjiFirstName_Summary: "GivenName",
    ShippingAddressInputCtl_ctl00_txtKanaLastName_Summary: "FamilyNameKana",
    ShippingAddressInputCtl_ctl00_txtKanaFirstName_Summary: "GivenNameKana",
    ShippingAddressInputCtl_ctl00_txtAddress_Summary: "Address1",
    ShippingAddressInputCtl_ctl00_txtAddress1_Summary: "Address1",
    ShippingAddressInputCtl_ctl00_txtAddress2_Summary: "Address2",
    ShippingAddressInputCtl_ctl00_txtAddress3_Summary: "Address3",
    //ShippingAddressInputCtl_ctl00_txtZipCodeUS1_Summary: "PostalCode",
    ShippingAddressInputCtl_ctl00_txtZipCode_Summary: "PostalCode",
    ShippingAddressInputCtl_ctl00_txtZipCodeEU2_Summary: "PostalCode2",
    ShippingAddressInputCtl_ctl00_txtZipCode2_Summary: "PostalCode2",
    //ShippingAddressInputCtl_ctl00_txtZipCodeGB1_Summary: "PostalCode",
    ShippingAddressInputCtl_ctl00_txtZipCodeGB2_Summary: "PostalCode2",
    //ShippingAddressInputCtl_ctl00_txtPostCodeAU_Summary: "PostalCode",
    ShippingAddressInputCtl_ctl00_txtCity_Summary: "City",
    ShippingAddressInputCtl_ctl00_ddlState_Summary: "Region",
    ShippingAddressInputCtl_ctl00_ddlPrefecture_Summary: "Region",
    ShippingAddressInputCtl_ctl00_ddlCountry_Summary: "CountryName"};

var billingAddressObjMapping = {
    BillingAddressInputCtl_ctl00_ddlTitle: "PreName",
    BillingAddressInputCtl_ctl00_txtFirstName: "GivenName",
    BillingAddressInputCtl_ctl00_txtLastName: "FamilyName",
    BillingAddressInputCtl_ctl00_txtKanjiLastName: "FamilyName",
    BillingAddressInputCtl_ctl00_txtKanjiFirstName: "GivenName",
    BillingAddressInputCtl_ctl00_txtKanaLastName: "FamilyNameKana",
    BillingAddressInputCtl_ctl00_txtKanaFirstName: "GivenNameKana",
    BillingAddressInputCtl_ctl00_txtAddress: "Address1",
    BillingAddressInputCtl_ctl00_txtAddress1: "Address1",
    BillingAddressInputCtl_ctl00_txtAddress2: "Address2",
    BillingAddressInputCtl_ctl00_txtAddress3: "Address3",
    BillingAddressInputCtl_ctl00_txtZipCodeUS1: "PostalCode",
    BillingAddressInputCtl_ctl00_txtZipCode: "PostalCode",
    BillingAddressInputCtl_ctl00_txtZipCodeGB1: "PostalCode",
    BillingAddressInputCtl_ctl00_txtZipCodeGB2: "PostalCode2",
    BillingAddressInputCtl_ctl00_txtPostCodeAU: "PostalCode",
    BillingAddressInputCtl_ctl00_txtZipCodeEU1: "PostalCode",
    BillingAddressInputCtl_ctl00_txtZipCodeEU2: "PostalCode2",
    BillingAddressInputCtl_ctl00_txtZipCode2: "PostalCode2",
    BillingAddressInputCtl_ctl00_txtCity: "City",
    BillingAddressInputCtl_ctl00_ddlState: "Region",
    BillingAddressInputCtl_ctl00_ddlRegion: "Region",
    BillingAddressInputCtl_ctl00_ddlPrefecture: "Region",
    BillingAddressInputCtl_ctl00_txtCountry: "CountryName",
    BillingAddressInputCtl_ctl00_txtDaytimeTelephone0: "Phone1",
    BillingAddressInputCtl_ctl00_chkGender_0: "Gender",
    BillingAddressInputCtl_ctl00_chkGender_1: "Gender"};

function copyShippingInputFields(elem) {
    if (!$(elem).attr("id")) { return; }
    var name = $(elem).attr("id");
    if (name.indexOf("Country") >= 0) {
        var value = $(elem).find("option:selected").text();
    } else {
        var value = $(elem).val();
    }
    var content = $.trim(value) + " ";
    if (name == "ShippingAddressInputCtl_ctl00_txtCity" && value != "" && ($("body").hasClass("en-US") || $("body").hasClass("en-CA") || $("body").hasClass("fr-CA") || $("body").hasClass("en-US-EStr"))) {
        content = $.trim(content) + ", ";
    }
    if ((name.indexOf("ZipCode") >= 0 || name.indexOf("PostCode") >= 0) && name.indexOf("EU2") == -1 && name.indexOf("ZipCode2") == -1 && name.indexOf("Billing") < 0) {
        name = "ShippingAddressInputCtl_ctl00_txtZipCode";
        if ($("#zipInputWrapper").length > 0) {
            var tempZipArray = [];
            $("#zipInputWrapper input").each(function () {
                tempZipArray[tempZipArray.length] = $.trim($(this).val());
            });
            content = value = tempZipArray.join(" ");
        }
    }
    if (name.toLowerCase().indexOf("shipping") != -1) {
        if (value != "") {
            $("#" + name + "_Summary").text(content).fadeIn(300);
            $("#shippingInfo").show();
            $("#shipAddrSummarybox").show();
        } else {
            $("#" + name + "_Summary").text("");
        }
    }
}
function copyShippingAddressObj(elem) {
    if (!$(elem).attr("id")) { return; }
    var name = $(elem).attr("id");
    var mapping = shippingAddressObjMapping[name];
    var value = shippingAddressObj[mapping];
    var content = $.trim(value) + " ";
    if (name == "ShippingAddressInputCtl_ctl00_txtCity" && value != "") {
        content = $.trim(content) + ", ";
    }
    if (name.toLowerCase().indexOf("shipping") != -1) {
        if (value != "") {
            $("#" + name).html(content).fadeIn(300);
            $("#shippingInfo").show();
            $("#shipAddrSummarybox").show();
        } else {
            $("#" + name).html("");
        }
    }
}

function addOrderSummaryValue(id, value) {
    $("#" + id).html(value);
}
function copyShippingMethod(elem) {
    var name = $(elem).attr("name");
    var content = $.trim($("input[id=" + $(elem).attr("id") + "]").parent().html().split("</span>")[1].split("<p>")[0]) + " ";
    $("#shipMethod_Summary, #ctlOrderSummary_pnlGrandShippingTotal .label").html(content);
    $("#shippingInfo").show();
    $("#shipMethodSummarybox").fadeIn(300);
    addOrderSummaryValue("shippingCostValue", $("#" + $(elem).attr("id").split("Radio")[0] + "Cost").val());

}
function showShippingMethodSummary() {
    $("#shipMethodSummarybox").show();
}
function doAriaChecked(group, elem) {
    $("#" + group + " input").each(function () { $(this).attr("aria-checked", "false"); });
    $(elem).attr("aria-checked", "true");
}
function confirmZip(cityId, cityCode, stateId, stateCode) {
    //if ($("#" + cityId).val() == "") {
        $("#" + cityId).val(cityCode).prop("disabled", false).valid();
        copyShippingInputFields($("#" + cityId));
    //}
    //if (typeof stateId != "undefined" && stateId != null && $("#" + stateId).val() == "") {
        if (typeof stateId != "undefined" && stateId != null) {
            $("#" + stateId).val(stateCode).prop("disabled", false).valid();
            $("#" + stateId).trigger("change");
            //updateCustomDrop("stateDrop");
            if (!isMobile() && !isTablet()) {
                $("#" + stateId).parent().next().removeClass("disabled").addClass("hasSelection");
            }
            copyShippingInputFields($("#" + stateId));
        }
   // }
}
function changeTabletView() {
    //viewport = document.querySelector("meta[name=viewport]");
    if (window.orientation == 0 || window.orientation == 180) {
        //viewport.setAttribute('content', 'width=670, minimum-scale=1.0, maximum-scale=1.0, initial-scale=1.0');
        $("body").addClass("portraitView");
        if (typeof canMoveOrderSummary != "undefined" && canMoveOrderSummary == true) {
            moveOrderSummaryTablet("portrait");
        }
    } else {
        //viewport.setAttribute('content', 'width=980, minimum-scale=1.0, maximum-scale=1.0, initial-scale=1.0');
        $("body").removeClass("portraitView");
        if (typeof canMoveOrderSummary != "undefined" && canMoveOrderSummary == true) {
            moveOrderSummaryTablet("landscape");
        }
    }
}
function clearAllErrors() {
    if (validation != null) {
        validation.resetForm();
    }
    $(".errorWrapper").removeClass("errorWrapper");
}
function clearError(elem) {
    $(elem).closest(".inputCol").removeClass("errorWrapper").next().removeClass("errorWrapper").find(".error").remove();
}
function validateAndSubmit(evt) {
    var isValid = true;

    // Get Validator & Settings
    var settings = validation.settings;

    // Find the parent control that contains the elements to be validated
    if (typeof evt.currentTarget != "undefined") {
        var $group = $(evt.currentTarget).parents(".validationGroup");
    } else {
        var $group = $("body").first(".validationGroup");
    }

    // Grab all the input elements (minus items listed below)
    $group
        .find(":input")
        .not(":submit, :reset, :image, [disabled]")
        .not(settings.ignore)
        .each(function (i, item) {
            // Don't validate items without rules
            if (!validation.objectLength($(item).rules())) {
                return true;
            }
            if (!$(item).valid()) {
                isValid = false;
            }
        });

    // Must manually validate any select using the custom dropdown since the select element is hidden 
    $group.find(".custom-drop").each(function () {
        if ($(this).is(":visible")) {
            if (typeof $(this).attr("rel") != "undefined") {
                if (!$("#" + $(this).attr("rel")).find("select").valid()) {
                    isValid = false;
                }
            }
        }
    });

    // If any control is the group fails, prevent default actions (aka: Submit)
    if (!isValid) {
        evt.preventDefault();
        window.scrollTo(0, 0);
        if (errorMsgArray.length > 0) {
            trackErrors(errorMsgArray);
            errorMsgArray = [];
        }        
        return false;
    }
    else { //enable the city and state controls that the server can read the populated values from zip lookup.
        if ($('input:text[id*="AddressInputCtl_ctl00_txtCity"]').length > 0) {
            $('input:text[id*="AddressInputCtl_ctl00_txtCity"]').prop("disabled", false);
        }

        if ($('input:text[id*="AddressInputCtl_ctl00_ddlState"]').length > 0) {
            $('input:text[id*="AddressInputCtl_ctl00_ddlState"]').prop("disabled", false);
            if ($("div.stateInput.disabled").length > 0) {
                $(".stateInput.disabled").removeClass("disabled");
            }
        }
        if ($('input:text[id*="AddressInputCtl_ctl00_ddlPrefecture"]').length > 0) {
            $('input:text[id*="AddressInputCtl_ctl00_ddlPrefecture"]').prop("disabled", false);
            if ($("div.stateInput.disabled").length > 0) {
                $(".stateInput.disabled").removeClass("disabled");
            }
        }
        return true;

    }
}

function noValidation(value, element) {
    return true;
}
function displayServerSideError(value, element) {
    return false;
}
function showServerSideErrors(errors) {   
    for (var i = 0; i < errors.length; i++) {
        var fieldId = errors[i].fieldId;
        var message = "";
        if (fieldId == null || fieldId == "") {
            break;
        }
        var fieldIDGenerated = fieldId.split("$").join("_");
        if (errors[i].errorMessage) {
            message = errors[i].errorMessage;
        } else if (errors[i].errorName) {
            message = validation.settings.messages[errors[i].fieldId][errors[i].errorName];
        } else {
            break;
        }
        var obj = new Object();
        if ($("#" + fieldIDGenerated).hasClass("sectionError")) {
            $("#" + fieldIDGenerated).append('<input type="hidden" name="' + fieldId + '" />');
        }
        obj[fieldId] = message;
        validation.showErrors(obj);
        errorMsgArray.push({ "message": message });
    }
    if (errorMsgArray.length > 0) {
        trackErrors(errorMsgArray);
        errorMsgArray = [];
    }
    $("label.error").each(function () {
        $(this).removeClass("error").addClass("serverError");
        if ($(this).parent().hasClass("sectionError")) {
            $(this).parent().addClass("serverErrorWrapper");
        } else if ($(this).parents("#signInForm").length > 0) {
            $(this).parent().addClass("serverErrorWrapper");
        } else {
            $(this).parent().addClass("serverErrorWrapper");
            $(this).parent().prev().addClass("serverErrorWrapper");
        }
       
    });
}

function clearServerSideError(id) {
    $("#" + id).closest(".serverErrorWrapper").removeClass("serverErrorWrapper errorWrapper").next().removeClass("serverErrorWrapper errorWrapper").find(".serverError").remove();
}

function copyGiftMsg(elem) {
    if ($(".giftMessage").length == 0) {
        return false;
    }
    var summMsgId = "giftMsgSummary" + $(elem).closest(".giftMessage").attr("id").split("giftMsg")[1];
    var msgText = "";
    var tempArr = new Array();
    $(elem).closest(".messageText").find("input").each(function () {
        tempArr[tempArr.length] = $(this).val();
    });
    while (tempArr.length > 0) {
        if (tempArr[tempArr.length - 1] == "") {
            tempArr.length = tempArr.length - 1;
        } else {
            break;
        }
    }
    // Don't just blindly take the input values and put them on screen, any malicious script 
    // will be executed. Set as text so that all HTML is stripped and then later add in the BRs.
    msgText = tempArr.join("$br$");
    $("#" + summMsgId).text(msgText);
    $("#" + summMsgId).html($("#" + summMsgId).html().split("$br$").join("<br />"));

}
function addValidationRule(ruleName, func) {
    jQuery.validator.addMethod(ruleName, func);
}

function addControlValidation(obj) {
    if ($("[name='" + obj.fieldName + "']:first").length > 0) {
        $("[name='" + obj.fieldName + "']:first").rules("add", obj.rules);
    }
}

function passMod10(number) {
    var doubled = [];
    for (var i = number.length - 2; i >= 0; i = i - 2) {
        var subNum = number.substring(i, i + 1);
        if (!isNaN(subNum)) {
            doubled[doubled.length] = (2 * parseInt(subNum));
        }
    }
    var total = 0;
    for (var i = ((number.length % 2) == 0 ? 1 : 0) ; i < number.length; i = i + 2) {
        var subNum = number.substring(i, i + 1);
        if (!isNaN(subNum)) {
            total += parseInt(subNum);
        }
    }
    for (var i = 0; i < doubled.length; i++) {
        var num = doubled[i];
        var digit;
        while (num != 0) {
            digit = num % 10;
            num = parseInt(num / 10);
            total += digit;
        }
    }
    if (total % 10 == 0) {
        return (true);
    } else {
        return (false);
    }
}

function isMaestroCard(number) {
    var first4Char = (number.substring(0, 4));

    if (number.length >= 4 && (first4Char == "5018" || first4Char == "5020" || first4Char == "5038" || first4Char == "6304" || first4Char == "6759" || first4Char == "6761")) {
        return true;
    } else {
        return false;
    }
}

function isVisa(number) {
    if (number.charAt(0) == "4") {
        return true;
    } else {
        return false;
    }
}

function isMastercard(number) {
    var first2Char = (number.substring(0, 2));
    var first3Char = (number.substring(0, 3));
    var first4Char = (number.substring(0, 4));

    if (number.length >= 2 && ((first2Char >= 23 && first2Char <= 26) || (first2Char >= 51 && first2Char <= 55))) {
        return true;
    } else if (number.length >= 3 && (first3Char >= 270 && first3Char <= 271)) {
        return true;
    } else if (number.length >= 4 && ((first4Char >= 2221 && first4Char <= 2229) || (first4Char == 2720))) {
        return true;
    } else {
        return false;
    }
}

function isAmex(number) {
    if ((number.charAt(0) == "3") && (number.charAt(1) == "4" || number.charAt(1) == "7")) {
        return true;
    } else {
        return false;
    }
}
function isDiscover(number) {
    if (number.length >= 8) {
        var firstEight = parseInt(number.substring(0, 8));
        if (firstEight >= 36000000 && firstEight <= 36999999) {
            return true;
        } else if (firstEight >= 60110000 && firstEight <= 60110999) {
            return true;
        } else if (firstEight >= 60112000 && firstEight <= 60114999) {
            return true;
        } else if (firstEight >= 60117400 && firstEight <= 60117499) {
            return true;
        } else if (firstEight >= 60117700 && firstEight <= 60117999) {
            return true;
        } else if (firstEight >= 60118600 && firstEight <= 60119999) {
            return true;
        } else if (firstEight >= 62212600 && firstEight <= 62292599) {
            return true;
        } else if (firstEight >= 64400000 && firstEight <= 64999999) {
            return true;
        } else if (firstEight >= 65000000 && firstEight <= 65999999) {
            return true;
        } else {
            return false;
        }
    }
}
function isJCB(number) {
    if (number.length == 15 && (number.indexOf("2131") == 0 || number.indexOf("1800") == 0)) {
        return true;
    } else if (number.length == 16 && number.charAt(0) == "3") {
        return true;
    } else {
        return false;
    }
}
function isTCO(number) {
    if (number.indexOf("60104404") == 0) {
        if (number.substring(8, 15) != "00000000" && number.substring(8, 15) != "12121212") {
            return true;
        }
    }
    return false;
}
function checkCreditCard(number, e) {
    var isAmexCard = false;
    if (number.length >= 1 && !isNaN(number)) {
        if (isVisa(number)) {
            if ($("#ddlTenderTypes option[value='VISA']").length > 0) {
                $("#ddlTenderTypes").val("VISA").trigger("change");
            } else {
                $("#ddlTenderTypes").val(0).trigger("change");
            }
        } else if (isMastercard(number)) {
            if ($("#ddlTenderTypes option[value='MC']").length > 0) {
                $("#ddlTenderTypes").val("MC").trigger("change");
            } else {
                $("#ddlTenderTypes").val(0).trigger("change");
            }
        } else if (isAmex(number)) {
            isAmexCard = true;
            if ($("#ddlTenderTypes option[value='AMEX']").length > 0) {
                $("#ddlTenderTypes").val("AMEX").trigger("change");
            } else {
                $("#ddlTenderTypes").val(0).trigger("change");
            }
        } else if (isDiscover(number)) {
            if ($("#ddlTenderTypes option[value='NOVS']").length > 0) {
                $("#ddlTenderTypes").val("NOVS").trigger("change");
            } else {
                $("#ddlTenderTypes").val(0).trigger("change");
            }
        } else if (isJCB(number)) {
            if ($("#ddlTenderTypes option[value='JCB']").length > 0) {
                $("#ddlTenderTypes").val("JCB").trigger("change");
            } else {
                $("#ddlTenderTypes").val(0).trigger("change");
            }
        } else if (isTCO(number)) {
            if ($("#ddlTenderTypes option[value='TCO']").length > 0) {
                $("#ddlTenderTypes").val("TCO").trigger("change");
            } else {
                $("#ddlTenderTypes").val(0).trigger("change");
            }
        } else if (isMaestroCard(number)) {
            if ($("#ddlTenderTypes option[value='MA']").length > 0) {
                $("#ddlTenderTypes").val("MA").trigger("change");
            } else {
                $("#ddlTenderTypes").val(0).trigger("change");
            }
        }

        //masking
        if (e.keyCode != 8 && e.keyCode != 46) {
            var input = $("#txtCreditCardNumber");
            var numberToMask = number.split(" ").join("");

            if (isAmexCard) {
                numberToMask = numberToMask.slice(0, 4) + " " + numberToMask.slice(4, 10) + " " + numberToMask.slice(10, 15);
            } else {
                numberToMask = numberToMask.slice(0, 4) + " " + numberToMask.slice(4, 8) + " " + numberToMask.slice(8, 12) + " " + numberToMask.slice(12, 16);
            }
            numberToMask = numberToMask.trim();

            if (input.val() != numberToMask) {
                input.val(numberToMask);
            }
        }

    } else {
        $("#ddlTenderTypes").val("").trigger("change");
    }
}

function isValidMaestroCard(number) {
    if (number.length >= 12) //12 is minimum for maestro
    {
        var first4Char = (number.substring(0, 4));
        if (((number.length >= 12 && number.length <= 16)
                || number.length == 18 || number.length == 19)
            && (first4Char == "5018" || first4Char == "5020"
                || first4Char == "5038" || first4Char == "6304"
                || first4Char == "6759" || first4Char == "6761")) {
            return true;
        }
    } else {
        return false;
    }
}

function isValidVisa(number) {
    if ((number.length == 13 || number.length == 16) && number.charAt(0) == "4") {
        return true;
    } else {
        return false;
    }
}

function isValidMastercard(number) {
    var first6Char = (number.substring(0, 6));
    if ((number.length == 16) && (number.charAt(0) == 5) && (parseInt(number.charAt(1)) >= 1 && parseInt(number.charAt(1)) <= 5)) {
        return true;
    }
    else if ((number.length == 16) && (number.charAt(0) == 2) && (parseInt(first6Char) >= 222100 && parseInt(first6Char) <= 272099)) {
        return true;
    }
    else {
        return false;
    }
}

function isValidAmex(number) {
    if ((number.length == 15) && (number.charAt(0) == "3") && (number.charAt(1) == "4" || number.charAt(1) == "7")) {
        return true;
    } else {
        return false;
    }
}
function isValidDiscover(number) {
    if (number.length == 16) {
        var firstEight = parseInt(number.substring(0, 8));
        if (firstEight >= 36000000 && firstEight <= 36999999) {
            return true;
        } else if (firstEight >= 60110000 && firstEight <= 60110999) {
            return true;
        } else if (firstEight >= 60112000 && firstEight <= 60114999) {
            return true;
        } else if (firstEight >= 60117400 && firstEight <= 60117499) {
            return true;
        } else if (firstEight >= 60117700 && firstEight <= 60117999) {
            return true;
        } else if (firstEight >= 60118600 && firstEight <= 60119999) {
            return true;
        } else if (firstEight >= 62212600 && firstEight <= 62292599) {
            return true;
        } else if (firstEight >= 64400000 && firstEight <= 64999999) {
            return true;
        } else if (firstEight >= 65000000 && firstEight <= 65999999) {
            return true;
        } else {
            return false;
        }
    }
}
function isValidJCB(number) {
    if (number.length == 15 && (number.indexOf("2131") == 0 || number.indexOf("1800") == 0)) {
        return true;
    } else if (number.length == 16 && number.charAt(0) == "3") {
        return true;
    } else {
        return false;
    }
}
function isValidTCO(number) {
    if (number.length == 16 && number.indexOf("60104404") == 0) {
        if (number.substring(8, 15) != "00000000" && number.substring(8, 15) != "12121212") {
            return true;
        }
    }
    return false;
}

function checkFullCreditCard(number) {
    number = number.split(" ").join("");
    $("#txtCreditCardNumber").parent().removeClass("errorWrapper").find("label.error, label.serverError").remove();

    if (number.length >= 13 && !isNaN(number)) {        
        $("#ddlTenderTypes").parent().hide();

        if (isValidVisa(number) && passMod10(number) && $("#ddlTenderTypes option[value='VISA']").length > 0) {
            
            return;
        } else if (isValidMastercard(number) && passMod10(number) && $("#ddlTenderTypes option[value='MC']").length > 0) {
            
            return;
        } else if (isValidAmex(number) && passMod10(number) && $("#ddlTenderTypes option[value='AMEX']").length > 0) {
            
            return;
        } else if (isValidDiscover(number) && passMod10(number) && $("#ddlTenderTypes option[value='NOVS']").length > 0) {
            
            return;
        } else if (isValidJCB(number) && passMod10(number) && $("#ddlTenderTypes option[value='JCB']").length > 0) {
            
            return;
        } else if (isValidTCO(number) && passMod10("0000000" + number.substring(number.length - 9, number.length)) && $("#ddlTenderTypes option[value='TCO']").length > 0) {
            
            return;
        } else if (isValidMaestroCard(number) && passMod10(number) && $("#ddlTenderTypes option[value='MA']").length > 0) {
            
            return;
        } else {
            $("#txtCreditCardNumber").parent().addClass("errorWrapper").append('<label for="txtCreditCardNumber" class="error">' + invalidCreditCardMessage + '</label>');
            grayOutCCLogos();
            $("#ddlTenderTypes").parent().show();
        }
    } else if (number.length == 0) {
        $("#txtCreditCardNumber").parent().removeClass("errorWrapper").find("label.error, label.serverError").remove();
        $("#ddlTenderTypes").parent().hide();
    } else {
        $("#txtCreditCardNumber").parent().addClass("errorWrapper").append('<label for="txtCreditCardNumber" class="error">' +invalidCreditCardMessage + '</label>');
        grayOutCCLogos();
        $("#ddlTenderTypes").parent().show();
    }
}

function selectCreditCard(elem) {
    ccVal = $(elem).val();
    switch (ccVal) {
        case "VISA": showCCLogo("visa");
            break;
        case "MC": showCCLogo("mastercard");
            break;
        case "AMEX": showCCLogo("amex");
            break;
        case "NOVS": showCCLogo("discover");
            break;
        case "JCB": showCCLogo("jcb");
            break;
        case "TCO": showCCLogo("tco");
            break;
        case "MA": showCCLogo("maestro");
            break;
        case "": clearCCLogo();
    }
}
function enableCCValidation() {
    $("#pnlCardValidationCode").show();
    $("#txtCardValidationCode").attr("disabled", false);
}
function disableCCValidation() {
    $("#pnlCardValidationCode").hide();
    $("#txtCardValidationCode").attr("disabled", true);
    $("#txtCardValidationCode").parents(".inputCol").removeClass("errorWrapper").find("label.error").remove();
}
function enableExpDate() {
    $("#pnlExpirationDate").show();
    $("#ddlCreditCardExpirationMonth").prop("disabled", false);
    $("#ddlCreditCardExpirationYear").prop("disabled", false);
}
function disableExpDate() {
    $("#pnlExpirationDate").hide();
    $("#ddlCreditCardExpirationMonth").prop("disabled", true);
    $("#ddlCreditCardExpirationYear").prop("disabled", true);
}
function clearCCLogo() {
    $(".activeCC img").attr("alt", "");
    $(".activeCC").removeClass("activeCC");    
    //$("#ccInfo").removeClass("showCC");
    disableCCValidation();
    enableExpDate();
    ShowHideCreditCardAuthInfoSection("");
    grayOutCCLogos();
}
function grayOutCCLogos() {
    $(".credit-card-logos img").each(function () {
        var img = $(this);
        var src = img.attr("src");
        var newSrc = src.split("-selected").join("");
        img.attr("src", newSrc);
    });
}
function showCCLogo(type) {
    $(".activeCC img").attr("alt", "");
    $(".activeCC").removeClass("activeCC");
    //$("#ccInfo").addClass("showCC");
    enableExpDate();
    disableCCValidation();
    //$(".credit-card-logos").attr("src", "/shared/images/icons/credit-cards-" + type + ".png");

    grayOutCCLogos();

    var img = $("#" + type + "Logo img")
    var src = img.attr("src");
    var newSrc = src.split(".png").join("-selected.png");
    img.attr("src", newSrc);

    switch (type) {
        case "visa": $("#visaLogo").addClass("activeCC");
            $(".activeCC img").attr("alt", "Visa Highlighted");
            enableCCValidation();
            setCVVLength(3);
            ShowHideCreditCardAuthInfoSection("VISA");
            break;
        case "mastercard": $("#mastercardLogo").addClass("activeCC");
            $(".activeCC img").attr("alt", "MasterCard Highlighted");
            enableCCValidation();
            setCVVLength(3);
            ShowHideCreditCardAuthInfoSection("MC");
            break;
        case "discover": $("#discoverLogo").addClass("activeCC");
            $(".activeCC img").attr("alt", "Discover Highlighted");
            enableCCValidation();
            setCVVLength(3);
            ShowHideCreditCardAuthInfoSection("NOVS");
            break;
        case "tco": $("#tcoLogo").addClass("activeCC");
            $(".activeCC img").attr("alt", "TCO Highlighted");
            disableExpDate();
            ShowHideCreditCardAuthInfoSection("TCO");
            break;
        case "amex": $("#amexLogo").addClass("activeCC");
            $(".activeCC img").attr("alt", "American Express Highlighted");
            enableCCValidation();
            setCVVLength(4);
            ShowHideCreditCardAuthInfoSection("AMEX");
            break;
        case "jcb": $("#jcbLogo").addClass("activeCC");
            $(".activeCC img").attr("alt", "JCB Highlighted");
            ShowHideCreditCardAuthInfoSection("JCB");
            break;
        case "maestro": $("#maestroLogo").addClass("activeCC");
            $(".activeCC img").attr("alt", "Maestro Highlighted");
            enableCCValidation();
            setCVVLength(3);
            ShowHideCreditCardAuthInfoSection("MA");
            break;
    }
}
function setCVVLength(length) {
    if (validation != null) {
        //$("#txtCardValidationCode").attr("minlength", 4).attr("maxlength", 4);
        $("#txtCardValidationCode").rules("add", { minlength: length, maxlength: length });
    } else {
        //$("#txtCardValidationCode").attr("minlength", length).attr("maxlength", length);
    }
}

function updateBillingSameAsShipping() {
    //Start for  iTrack#29251 - Tanu
    if (locale == "en-US" || locale == "en-CA" || locale == "fr-CA") {
        CopyShipToBillingAddress($("#chkBillToSameAsShipTo"));
        $("#billingSameAsShipping").hide();
        $("#guestAddressFields .addressSection").show();
    }
    else {
        var isChecked = $("#chkBillToSameAsShipTo").prop("checked");
        if (isChecked) {
            $("#guestAddressFields .addressSection").hide();
            $("#billingSameAsShipping").show();
        }
        else {
            $("#guestAddressFields .addressSection").show();
            $("#billingSameAsShipping").hide();
        }
    }
    //End for  iTrack#29251 - Tanu
}

function validateButtonState() {
    var isDisabled = false;
    if ($("#chkTermsOfSale").length > 0 && !($("#chkTermsOfSale").is(":checked"))) {
        isDisabled = true;
    }
    if ($("#CustomerPrivacyPolicy_ctl00_chkGppAccepted").length > 0 && $("#CustomerPrivacyPolicy_ctl00_chkGppAccepted").is(":visible") && !($("#CustomerPrivacyPolicy_ctl00_chkGppAccepted").is(":checked"))) {
        isDisabled = true;
    }
    if ($("#CustomerPrivacyPolicy_ctl00_radYes").length > 0 && $("#CustomerPrivacyPolicy_ctl00_radYes").is(":visible") && !($("#CustomerPrivacyPolicy_ctl00_radYes").is(":checked"))) {
        isDisabled = true;
    }
    if (isDisabled == false) {
        $("#btnComplete").removeClass("disabled");
    } else {
        $("#btnComplete").addClass("disabled");
    }
}

$(document).ready(function () {
    if ($("#zipInputWrapper input").length == 2) {
        $("#zipInputWrapper input").eq(0).on("keyup", function (e) {
            if ($(this).val().length == $(this).attr("size")) {
                $("#zipInputWrapper input").eq(1).focus();
            }
        });
    }
    var sbItemCount = CookieManager.getCookieValue("shoppingbagcnt");
    if (sbItemCount == 0) {
        sbItemCount = "";
    }
    $(".back-to-sb-link--count").html(sbItemCount);

    if (isSmallMobile()) {
        $(".right .additionalInfo").insertBefore("#checkoutFooterNumber");
        $(".bag-right .accordion").appendTo("#mainContent");
    }
    if (!isSmallMobile() || $("body").attr("id") == "paymentPage") {
        $("#guestAddressFields input, #guestAddressFields select").blur(function () {
            copyShippingInputFields(this);
        });
        $("#guestAddressFields input, #guestAddressFields select").change(function () {
            copyShippingInputFields(this);
        });
        $("#shippingMethods input").click(function () {
            copyShippingMethod(this);
            doAriaChecked("shippingMethods", this);
        });
        if ($("#shipMethod_Summary").text().length > 0) {
            showShippingMethodSummary();
        }

        if (shippingAddressObj && shippingAddressObj != "undefined") {
            $("#shipAddrSummarybox span").each(function () {
                copyShippingAddressObj(this);
            });
        } else if ($("#guestAddressFields").is(":visible")) {
            $("#guestAddressFields input, #guestAddressFields select").each(function () {
                copyShippingInputFields(this);
            });
        }
        $("#shippingMethods input:checked").each(function () {
            copyShippingMethod(this);
            doAriaChecked("shippingMethods", this);
        });
    }
    $("input.btn").mouseover(function () { $(this).addClass("mouseover"); });
    $("input.btn").mouseout(function () { $(this).removeClass("mouseover"); });
    $("input.btn").mousedown(function () { $(this).addClass("mousedown"); });
    $("input.btn").mouseup(function () { $(this).removeClass("mousedown"); });

    //Zip Code
    //$("#zipInputWrapper input").keyup(function () {
    //    var elem = $(this);
    //    //alert(elem.valid() > 0);
    //    if (elem.val().length > 0 && elem.valid() == 1) {
    //        validateZip(elem.val());
    //    } else {
    //        clearError(elem);
    //    }
    //});

    $("#ShippingAddressInputCtl_ctl00_txtAddress1, #ShippingAddressInputCtl_ctl00_txtAddress2, #ShippingAddressInputCtl_ctl00_txtCity").blur(function () {
        var elem = $(this);
        if (elem.val() != "" && elem.valid() == 1) {
            CalculateTax($('#ShippingAddressInputCtl_ctl00_txtAddress1').val(), $('#ShippingAddressInputCtl_ctl00_txtAddress2').val(), $('#ShippingAddressInputCtl_ctl00_txtCity').val(), $('#ShippingAddressInputCtl_ctl00_ddlState').val(), $('#zipInputWrapper input').val(), false, "", false, "", false);
        }
    });

    $('#ShippingAddressInputCtl_ctl00_ddlState').change(function () {
        var elem = $(this);
        if (elem.valid() == 1) {
            CalculateTax($('#ShippingAddressInputCtl_ctl00_txtAddress1').val(), $('#ShippingAddressInputCtl_ctl00_txtAddress2').val(), $('#ShippingAddressInputCtl_ctl00_txtCity').val(), $('#ShippingAddressInputCtl_ctl00_ddlState').val(), $('#zipInputWrapper input').val(), false, "", false, "", false);
        }
    });


    $("#ddlPrefDeliveryDay").change(function () {
        addOrderSummaryValue("ltDeliveryDay", $(this).find('option:selected').text());
    });
    $("#ddlPrefDeliveryTime").change(function () {
        addOrderSummaryValue("ltDeliveryTime", $(this).find('option:selected').text());
    });

    //Zip Code Lookup on blur. This is added keyup function does not fires when user selects zip code from the saved list. 
    $("#zipInputWrapper input").blur(function () {
        var elem = $(this);
        //alert(elem.valid() > 0);
        if (elem.val().length > 0 && elem.valid() == 1) {
            if ($("#zipInputWrapper").length > 0) {
                var tempZipArray = [];
                $("#zipInputWrapper input").each(function () {
                    tempZipArray[tempZipArray.length] = $.trim($(this).val());
                });
            }
            var combinedZipvalue = tempZipArray.join("");
            validateZip(combinedZipvalue);
            CalculateTax($('#ShippingAddressInputCtl_ctl00_txtAddress1').val(), $('#ShippingAddressInputCtl_ctl00_txtAddress2').val(), $('#ShippingAddressInputCtl_ctl00_txtCity').val(), $('#ShippingAddressInputCtl_ctl00_ddlState').val(), $('#zipInputWrapper input').val(), false, "", false, "", false);

        }
    });

    //Sign In Button Listener
    $("#ctlSignIN_signInBtn").click(function (evt) {
        var loginBox = $("#loginFields");
        var signInCancel = $("#signInCancel");
        // If the login inputs are hidden, we want to show and prohibit the form submit.  Otherwise we want to submit.
        if (loginBox.is(":visible")) {
            validateAndSubmit(evt);
            return true;
        } else {
            loginBox.slideDown(200);
            signInCancel.css("display", "block").hide().slideDown(200);
            return false;
        }
    });

    //Cancel Sign In Link Listener
    $("#signInCancel").click(function () {
        $("#loginFields").slideUp(200, function () {
            $("#loginFields input").each(function () { $(this).val(""); });
            $("#loginFields .errorWrapper").each(function () { $(this).removeClass("errorWrapper"); });
            $("#loginFields .error").each(function () { $(this).hide(); });
        });
        $(this).slideUp(200);
        return false;
    });

    $(".validationGroup").find("input:text, [type=email], input:password").keydown(function (evt) {
        var code = (evt.keyCode ? evt.keyCode : evt.which);
        if (code == 13) { //Enter keycode
            validateAndSubmit(evt);
        }
    });

    $("input:radio[name=shippingAddress]").click(function () {
        if ($("#divBOPSAddress").is(":visible")) {
            $("#inStorePickupInfo").show();
            $("#shippingInfo").hide();                   
        } else {
            $("#inStorePickupInfo").hide();
            $("#shippingInfo").show();
        }
    });

    if ($("#divBOPSAddress").is(":visible")) {
        $("#inStorePickupInfo").show();
        $("#shippingInfo").hide();
        //$("#pickupAddrSummarybox").html($("#divBOPSAddress").html());    	
    }

    if (isTablet()) {
        var viewportmeta = document.querySelector('meta[name="viewport"]');
        if (viewportmeta) {
            //viewportmeta.content = 'width=device-width, minimum-scale=1.0, maximum-scale=1.0, initial-scale=1.0';
            //document.body.addEventListener('gesturestart', function () {
            //viewportmeta.content = 'width=device-width, minimum-scale=0.25, maximum-scale=1.6';
            //}, false);
        }
    }
    if (isTablet()) {
        changeTabletView();
    }

    // Fix for a bug in jQuery Validate puglin which validates optional fields with a maxlength as failed if they are empty
    $.validator.addMethod("maxlength", function (value, element, len) {
        return value == "" || value.length <= len;
    });
    $(".messageText input").focus(function () {
        $(this).parent().addClass("active");
    });

    $(".messageText input").blur(function () {
        $(this).parent().removeClass("active");
        if (!isSmallMobile()) {
            copyGiftMsg(this);
        }
    });

    $(".messageText input").keydown(function (evt) {
        var code = (evt.keyCode ? evt.keyCode : evt.which);
        if (code == 13) { //Enter keycode
            $(this).parent().next().find("input").focus();
            evt.preventDefault();
            return false;
        }
        if (code == 8 && $(this).val().length == 0) { //Backspace Keycode
            var prevInput = $(this).parent().prev().find("input").focus();
            var tmpString = $(prevInput).val();
            $(prevInput).val('');
            $(prevInput).val(tmpString);
            return false;
        }
    });
    $(".messageText input").keypress(function (evt) {
        var code = (evt.keyCode ? evt.keyCode : evt.which);
        if (code == 59) { return false; } // AS 400 rule - do not accept semicolon (;)
        if (code == 126) { return false; } // AS 400 rule - do not accept tilda (~) 
    });
    $(".messageText input").keyup(function (evt) {
        if ($(this).val().indexOf("") != -1) {
            $(this).val($(this).val().replace(//g, "'")); // replacing "&#8220" to single quote, it's not allowed on as 400
        }
        if ($(this).val().indexOf("") != -1) {
            $(this).val($(this).val().replace(//g, "...")); // replacing "&#8230" to three periods, it's not allowed on as 400
        }
        if (/ @([!-~])/.test($(this).val())) {
            $(this).val($(this).val().replace(/ @([!-~])/g, " $1")); //replacing " @" to " " 
        }
        if (($(this).val().length == $(this).attr("maxlength")) && ($(this).parent().next().find("input")) && ($(this).parent().next().find("input").val() < 1)) {
            var nextLineValue = "";
            if (locale != "ja-JP") {
                if ($(this).val().indexOf(" ") > 0) {
                    var myWords = $(this).val().split(" ");
                    nextLineValue = myWords[myWords.length - 1];
                    myWords.length = myWords.length - 1;
                    $(this).val(myWords.join(" "));
                }
                $(this).parent().next().find("input").focus().val(nextLineValue);
            }
        }
    });
    if ($("#rdoNoSplitGiftMessage").length > 0) {
        if ($("#rdoNoSplitGiftMessage").prop("checked")) {
            $("#giftMessages").hide();
            if (!isSmallMobile()) {
                $(".orderSummary .giftMsgTitle, .orderSummary .giftMessageSummary").each(function () {
                    $(this).hide();
                });
            }
        } else {
            $("#giftMessages").show();
            if (!isSmallMobile()) {
                $(".orderSummary .giftMsgTitle, .orderSummary .giftMessageSummary").each(function () {
                    $(this).show();
                });
            }
            copyGiftMsg($("#giftMessages .messageText input").first());
        }
    }

    $(".giftMessage .selectType input[type=radio]").click(function () {
        if ($(this).attr("id").search(/goudy/i) > 0) {
            $(this).closest(".giftMessage").find(".messageText").removeClass("snell").addClass("goudy");
        } else {
            $(this).closest(".giftMessage").find(".messageText").removeClass("goudy").addClass("snell");
        }
    });

    //On error scenario, make sure the correct font type style is selected
    $(".giftMessage .selectType input:checked").each(function () {
        if ($(this).attr("id").search(/goudy/i) > 0) {
            $(this).closest(".giftMessage").find(".messageText").removeClass("snell").addClass("goudy");
        } else {
            $(this).closest(".giftMessage").find(".messageText").removeClass("goudy").addClass("snell");
        }
    });

    /*
    $("#snellRadio").click(function(){
    $(this).closest(".giftMessage").find(".messageText").removeClass("goudy").addClass("snell");
    });
    $("#goudyRadio").click(function(){
    $(this).closest(".giftMessage").find(".messageText").removeClass("snell").addClass("goudy");
    });
    */

    $("#noGiftMsgRadio").click(function () {
        $("#giftMessages").fadeOut(300);
        if (!isSmallMobile()) {
            $(".orderSummary .giftMsgTitle, .orderSummary .giftMessageSummary").each(function () {
                $(this).fadeOut(300);
            });
        }
    });
    $("#giftMsgRadio").click(function () {
        $("#giftMessages").fadeIn(300);
        if (!isSmallMobile()) {
            $(".orderSummary .giftMsgTitle, .orderSummary .giftMessageSummary").each(function () {
                $(this).fadeIn(300);
            });
        }
    });
    $("#rdoWhiteRibbon").click(function () {
        $("#imgRedRibbon").hide();
        $("#imgWhiteRibbon").show();
    });
    $("#rdoRedRibbon").click(function () {
        $("#imgWhiteRibbon").hide();
        $("#imgRedRibbon").show();
    });
    if ($("#rdoWhiteRibbon").prop("checked")) {
        $("#imgRedRibbon").hide();
        $("#imgWhiteRibbon").show();
    } else {
        $("#imgWhiteRibbon").hide();
        $("#imgRedRibbon").show();
    }

    // change credit card dropdown
    $("#ddlTenderTypes").change(function () {
        selectCreditCard(this);
        //if (!isMobile()) {
        //    updateCustomDrop("ddlTenderTypesWrapper");
        //}
    });

    $("#txtCreditCardNumber").keyup(function (e) { checkCreditCard(this.value.replace(/ /g, ''), e); });

    $("body").on("blur", "#txtCreditCardNumber", function () {
        checkFullCreditCard($(this).val());
    });

    $("#txtCreditCardExpiration").on("keyup", function (e) {
        var input = $(this);
        var value = input.val().split(" ").join("").split("/").join("");

        if (value.length >= 3) {
            value = value.slice(0, 2) + "/" + value.slice(2, value.length);
            input.val(value);
        }

        if (value.length == 5) {
            $("#txtCardValidationCode").focus();
        }
    });

    if ($("#ddlTenderTypes").val() != 0) {
        $("#ddlTenderTypes").trigger("change");
    } else if ($("#txtCreditCardNumber").length > 0) {
        checkCreditCard($("#txtCreditCardNumber").val());
    }
    //Load Pref data
    if ($("#ddlPrefDeliveryDay").length > 0) {
        addOrderSummaryValue("ltDeliveryDay", $("#ddlPrefDeliveryDay").find('option:selected').text());
    }

    if ($("#ddlPrefDeliveryTime").length > 0) {
        addOrderSummaryValue("ltDeliveryTime", $("#ddlPrefDeliveryTime").find('option:selected').text());
    }

    //Start for  iTrack#29251 - Tanu
    $("#chkBillToSameAsShipTo").click(function () {
        if (locale == "en-US" || locale == "en-CA" || locale == "fr-CA") {
            CopyShipToBillingAddress(this);
            $("#billingSameAsShipping").hide();
            $("#guestAddressFields .addressSection").show();
        }
        else {
            if ($(this).is(":checked")) {
                $("#guestAddressFields .addressSection").hide();
                $("#billingSameAsShipping").show();
            }
            else {
                $("#guestAddressFields .addressSection").show();
                $("#billingSameAsShipping").hide();
            }
        }
    });
    //End for  iTrack#29251 - Tanu

    updateBillingSameAsShipping();

    // Disable City and State Fields for Countries that support zip lookup

    /* Disabling these fields causes the users not to be able to complete checkout in some situations.  Disabling
	if (typeof isZipLookUpApplicable != "undefined" && isZipLookUpApplicable && $("#zipInputWrapper input").length > 0) {
        if ($("#zipInputWrapper input").val() == "") {
            disableCityState();
        }
    }
	*/

    // Phone number Mask items
    if (!isAndroid()) {
        $("#BillingAddressInputCtl_ctl00_txtTelephone.USCAPhone").focus(function () { phoneFocus(this); });
        $("#BillingAddressInputCtl_ctl00_txtTelephone.USCAPhone").blur(function () { phoneBlur(this); });
        $("#BillingAddressInputCtl_ctl00_txtTelephone.USCAPhone").keydown(function (event) { formatPhoneNumber(this, event); });
    } else {
        $("#BillingAddressInputCtl_ctl00_txtTelephone.USCAPhone").focus(function () { prePhoneFormat(this) });
        $("#BillingAddressInputCtl_ctl00_txtTelephone.USCAPhone").blur(function () { postPhoneFormat(this) });
    }

    // Custom validation Rules
    addValidationRule("notEqual", function (value, element, param) { return this.optional(element) || value != param; });
    addValidationRule("isValidUSZip", function (value, element, param) { return (/^\d{5}(-\d{4})?$/).test(value); });
    addValidationRule("isValidCAZip", function (value, element, param) { return (/^[ABCEGHJKLMNPRSTVXY]{1}\d{1}[A-Z]{1} *\d{1}[A-Z]{1}\d{1}$/i).test(value); });
    addValidationRule("isValidUSPhone", function (value, element, param) { return (value.replace(/[^0-9]/g, "").length == 10); });
    addValidationRule("hasOnlyRomanChars", function (value, element, param) { return !((/[^\u0000-\u007f]/).test(value)); });
    addValidationRule("isAlphaNumeric", function (value, element, param) { return (/^[a-zA-Z0-9 ]*$/).test(value); });
    addValidationRule("isValidCC", function (value, element, param) { var rawVal = value.replace(/ /g, ''); return (Math.floor(rawVal) == rawVal && $.isNumeric(rawVal)); });
    addValidationRule("isNumberOrEmpty", function (value, element, param) { return (value == "" || (Math.floor(value) == value && $.isNumeric(value))); });
    /* TCO BT#23262 - Allow # in the address fields*/
    //iTrack # 29012 - Checkout - Whitelisting additional special characters
    addValidationRule("isValidAddress", function (value, element, param) { return (/^[a-zA-Z0-9\u00C0-\u00ff.,:;#!&()/'\-\s]*$/).test(value); });

    addValidationRule("isValidCCExpMonth", function (value, element, param) { return (/^(0?[1-9]|1[012])\u002F[\w]*$/).test(value); });
    addValidationRule("isValidCCExpYear", function (value, element, param) { return (/^[\w]*\u002F[\u0030-\u0039]{2}$/).test(value); });

    //Email Address copy listener
    $("#BillingAddressInputCtl_ctl00_txtEmail").blur(function () {
        if ($(this).valid()) {
            if ($("#emailInfo").length > 0) {
                $("#emailInfo").hide();
            }
            $("#confirmEmailAddress").text($(this).val());
            $("#confirmEmailAddressMsg").show();
        } else {
            $("#confirmEmailAddressMsg").hide();
        }
    });
    //prevent default action if button is disabled
    $(".btn_majorAction").click(function (e) {
        if ($(this).hasClass("disabled")) {
            e.preventDefault();
            return false;
        }
    });

    // Disabled main button if chkTermsOfSale is on the page
    validateButtonState();

    $("#chkTermsOfSale, #CustomerPrivacyPolicy_ctl00_chkGppAccepted, input[name='CustomerPrivacyPolicy$ctl00$radAcceptGpp']").click(function () {
        validateButtonState();
    });
    // fix for IE7 showing one li bullet when there is one empty li in a ul wrapper.  this is a workaround fix, if should be
    // cleaned up server side
    $("ul").each(function () { if ($(this).find("li").length == 1) { if ($(this).find("li").text() == "") { $(this).hide(); } } });
    //custom drop down
    $("body").on("click", ".custom-drop div.choice:not(.reset)", function () {
        if (!$(this).parent().hasClass("disabled")) {
            $(".custom-drop div.rollbar").hide();
            $(this).siblings("div.rollbar").show();
        }
    });

    $("body").on("mouseleave", ".custom-drop .rollbar", function () {
        $(this).hide();
    });

    $(".custom-drop div.choice:not(.preselected)").each(function () {
        //ITrack-19012-- Changes begin
        var activeElem = $(this).siblings("div.rollbar").find(".active");
        if (activeElem.length == 0) {
            $(this).html($(this).siblings("div.rollbar").find("li:first").addClass("active").html()).css("padding-right", "15px");
        }
        //ITrack-19012-- Changes End
    });

    $(".custom-drop div.choice.preselected").each(function () {
        $(this).css("padding-right", "15px");
    });

    $("body").on("click", ".custom-drop ul li", function () {
        if ($(this).hasClass("separator") == false) {
            // IBM BT# 9462 : change done so that default menu "SORT BY" selection does not trigger any action or change in selected menu
            if ($(this).hasClass("non-selectable") == false) {
                var selectid = $(this).parents(".custom-drop").attr("rel");
                var index = $(this).index();
                var value = $(this).attr("rel");
                $("#" + selectid + " select option[value='" + value + "']").prop('selected', true);
                $("#" + selectid + " select").trigger("change");
                $(this).parents("div.custom-drop").find("div.choice").html($(this).html());
                $(this).siblings().removeClass("active");
                $(this).addClass("active");
            }
            $(this).closest("div.rollbar").hide();
        }
    });

    //end custom drop down 

    // back to top
    $("body").on("click", ".back-to-top", function () {
        $("body, html").animate({ scrollTop: 0 }, 300);
        return false;
    });

    // unselected vs selected styling
    $("select").change(function () {
        if (!$(this).hasClass("mobile-dropdown")) {
            if ($(this).val() == "" || $(this).val() == "0" || $(this).val() == "- -") {
                $(this).parent().next().removeClass("hasSelection");
            } else {
                $(this).parent().next().addClass("hasSelection");
            }
        }
        $(this).valid();
    });

    $("select").each(function () {
        if (!$(this).hasClass("mobile-dropdown")) {
            if ($(this).val() != "") {
                $(this).parent().next().addClass("hasSelection");
            }
        }
    });

    if (!isMobile() && !isTablet()) {
        applyCustomDropdown();
    }

    //Customer Privacy Policy logic
    if ($("#divSaveInformation input").prop("checked") == true || $("#divEmailSubscribe input").prop("checked") == true) {
        $("#customerPrivacyPolicy").show();
        validateButtonState();
    }
    $("body").on("click", "#divSaveInformation input, #divEmailSubscribe input", function () {
        if ($("#divSaveInformation input").prop("checked") == true || $("#divEmailSubscribe input").prop("checked") == true) {
            $("#customerPrivacyPolicy").show();
        } else {
            $("#customerPrivacyPolicy").hide();
            $("#CustomerPrivacyPolicy_ctl00_chkGppAccepted").prop("checked", false);
            $("#CustomerPrivacyPolicy_ctl00_radNo").prop("checked", "true");
            clearError($("#CustomerPrivacyPolicy_ctl00_chkGppAccepted"));
            clearError($("#CustomerPrivacyPolicy_ctl00_radYes"));
        }
        validateButtonState();
    });

    //show CC logos based on populated drop down options
    $("#ddlTenderTypes option").each(function () {
        $('.credit-card-logos span[data-ddl-val=' + $(this).attr("value") + ']').addClass("ccLogo--visible");
    });
    
    setTimeout(function () { OverlayManager.getInstance().init(); }, 10);
});

function resizeIframe(newHeight) {
    OverlayManager.getInstance().resize(newHeight);
}

if (isTablet()) {
    window.onorientationchange = changeTabletView;
    //document.write('<meta name = "viewport" content="width=670, minimum-scale=1.0, maximum-scale=1.0, initial-scale=1.0">');
}

function displayRegistryInGiftOptions(summary) {
    $("#shippingInfo").show();
    $("#registrySummary").html(summary);
    $("#registrySummaryBox").show();
    $("#tblShippingInformation").show();
}

function CopyShipToBillingAddress(This) {
    if ($(This).is(":checked")) {
        populateBillingFromShipping();
    } else {
        releaseBillingFields();
    }
}

// Stub Function for zip validation Ajax call
function validateZip(zipCode) {
    if (isZipLookUpApplicable != false) {
        //on success call the following functions:
        var success = function (data) {
            if (data.d != null) {
                var addresses = (typeof data.d.ResponseObject != "undefined") ? data.d.ResponseObject : null;
            } else {
                var addresses = null;
            }
            if (addresses != null && addresses.length > 0) {
                clearServerSideError($('input:text[id*="_txtZipCodeUS1"]').attr("id"));
                var cityID = $('input:text[id*="_txtCity"]').attr("id");
                var regionID = $('select[id*="_ddlState"]').attr("id");
                if (typeof regionID == "undefined") {
                    regionID = $('select[id*="_ddlPrefecture"]').attr("id");
                }
                if (typeof regionID == "undefined") {
                    regionID = $("#ShippingAddressInputCtl_ctl00_txtCounty").attr("id");
                }
                if (addresses.length > 1) { // testing multiple addresses
                    var errorMessage = "<p>" + multipleAddressErrorMessage + "</p><p>";
                    for (var i = 0; i < addresses.length; i++) {
                        errorMessage += '<a href="#" onclick=\'confirmZip("' + cityID + '", "' + addresses[i].City + '", "' + regionID + '", "' + addresses[i].Region + '"); return false;\'>' + addresses[i].City + ', ' + addresses[i].Region + '</a><br/>';
                    }
                    errorMessage += "</p>";
                    //$("#zipInputWrapper").next().html("");
                    if ($("#ShippingAddressInputCtl_ctl00_txtZipCodeUS1").length > 0) {
                        showServerSideErrors([{ "fieldId": "ShippingAddressInputCtl$ctl00$txtZipCodeUS1", "errorMessage": errorMessage }]);
                    } else if ($("#BillingAddressInputCtl_ctl00_txtZipCodeUS1").length > 0) {
                        showServerSideErrors([{ "fieldId": "BillingAddressInputCtl$ctl00$txtZipCodeUS1", "errorMessage": errorMessage }]);
                    }
                } else {
                    confirmZip(cityID, addresses[0].City, regionID, addresses[0].Region);
                    if ($("#zipCodeNDDMessage").length > 0) {
                        if (addresses[0].NDDOptionAvailable) {
                            $("#zipCodeNDDMessage").show();
                        }
                        else {
                            $("#zipCodeNDDMessage").hide();
                        }
                    }

                    if (cityID != null && cityID.indexOf('Billing') == -1) {
                        CalculateTax($('#ShippingAddressInputCtl_ctl00_txtAddress1').val(), $('#ShippingAddressInputCtl_ctl00_txtAddress2').val(), addresses[0].City, addresses[0].Region, zipCode, false, "", false, "", false);
                    }
                }
            }
            else {
                /* enableCityState(); */
                if ($("#zipCodeNDDMessage").length > 0) { $("#zipCodeNDDMessage").hide(); }
            }

        };
        var error = function () { if ($("#zipCodeNDDMessage").length > 0) { $("#zipCodeNDDMessage").hide(); } };
        ns.CheckOut.ZipCode = zipCode;
        LookupZipCode(zipCode, success, error);
    }
}

function LookupZipCode(zipCode, success, error) {
    var data;
    if (typeof IsNDDApplicable == "undefined") {
        data = "{postalCode:'" + zipCode.toString() + "',isNDDApplicable:'false'}";
    }
    else {
        data = "{postalCode:'" + zipCode.toString() + "',isNDDApplicable:'" + IsNDDApplicable.toString() + "'}";
    }
    postServerCall(this.locationsServiceURL, data, success, error);
}

function error(jqXHR, status, error) {
    console.log("Shipping address/tax lookupService ajax error: " + status);
}

function taxSuccess(data) {
    $("#ctlOrderSummary_pnlVertexError").hide();
    addOrderSummaryValue("grand_ship_total_value", data.d.ShippingTotal);
    addOrderSummaryValue("engrave_total", data.d.ServiceTotal);
    addOrderSummaryValue("ctlOrderSummary_pnlTax", data.d.AllTaxes);
    addOrderSummaryValue("grand_total_value", data.d.GrandTotal);
    addOrderSummaryValue("orderDetailsGrandTotal", data.d.GrandTotal);
    addOrderSummaryValue("daibikiFee_value", data.d.DaibikiFee);
    addOrderSummaryValue("ctlOrderSummary_lblOrderSummaryGrandTotal", data.d.LblTotal);
    if (data.d.IsConnectionFailure)
    {
        $("#ctlOrderSummary_pnlVertexError").show();
    }
}

function CalculateTax(address1, address2, city, region, zipcode, isRegistry, registryID, isStorePickup, storeID, forceCalculateTax) {

    if (isTaxLookUpApplicable == false && forceCalculateTax == false) {
        return;
    }

    var isValueChanged = true;
    var shipData = new JSONshippingData();

    if (isTaxLookUpApplicable == true) {

        if (isRegistry && !CheckNullOrEmpty(registryID)) {

            if (ns.CheckOut.ShipData != null && ns.CheckOut.ShipData.IsShipToRegistry == isRegistry && ns.CheckOut.ShipData.RegistryID == registryID) {
                isValueChanged = false;
            }
            shipData.IsShipToRegistry = true;
            shipData.RegistryID = registryID;
        }
        else if (isStorePickup && !CheckNullOrEmpty(storeID)) {
            if (ns.CheckOut.ShipData != null && ns.CheckOut.ShipData.IsStorePickup == isStorePickup && ns.CheckOut.ShipData.storeNumber == storeID) {
                isValueChanged = false;
            }
            shipData.IsStorePickup = true;
            shipData.storeNumber = storeID;
        }
        else if (!CheckNullOrEmpty(address1) && !CheckNullOrEmpty(city) && !CheckNullOrEmpty(region) && !CheckNullOrEmpty(zipcode)) {
            if (ns.CheckOut.ShipData != null && ns.CheckOut.ShipData.ShipAddress1 == address1
        && ns.CheckOut.ShipData.ShipAddress2 == address2 && ns.CheckOut.ShipData.ShipCity == city && ns.CheckOut.ShipData.ShipRegion == region && ns.CheckOut.ShipData.ShipZipCode == zipcode) {
                isValueChanged = false;
            }
            shipData.ShipAddress1 = address1;
            shipData.ShipAddress2 = address2;
            shipData.ShipCity = city;
            shipData.ShipRegion = region;
            shipData.ShipZipCode = zipcode;
        }
        else {
            isValueChanged = false;
        }
    }

    if (ns.CheckOut.ShipData == undefined || (ns.CheckOut.ShipData.ShippingOptionId != document.getElementById('hdnSingleSelectedShippingOptionDetailID').value)) {
        isValueChanged = true;
    }

    if (isStorePickup) {
        shipData.ShippingOptionId = 0;
    }
    else {
        shipData.ShippingOptionId = document.getElementById('hdnSingleSelectedShippingOptionDetailID').value;
    }

    if (isValueChanged || forceCalculateTax) {
        ns.CheckOut.ShipData = shipData;
        postServerCall(taxServiceURL, shipData.getData(), taxSuccess, error);
    }
}


function CheckNullOrEmpty(val) {
    if (val == null || val == undefined || val == '') {
        return true;
    }
    else {
        return false;
    }
}

function postServerCall(url, data, successfn, errorfun) {
    $.ajax({
        url: url,
        type: "POST",
        contentType: "application/json; charset=utf-8",
        dataType: "json",
        data: data,
        timeout: lookUpTimeOut,
        success: successfn,
        error: errorfun });
}

var JSONshippingData = function () {


    //region "ship to an address"        
    this.ShipAddress1 = "";
    this.ShipAddress2 = "";
    this.ShipAddress3 = "";
    this.ShipCity = "";
    this.ShipRegion = "";
    this.ShipZipCode = "";
    //endregion

    //region "store pickup"        
    this.IsStorePickup = false;
    this.storeNumber = "";
    //endregion

    //region "registry shipping"
    this.IsShipToRegistry = false;
    this.RegistryID = "";
    //endregion

    //region "Shipping method"
    this.ShippingOptionId = "";
    //endregion

};


JSONshippingData.prototype.getData = function () {
    //return "{\"shippingInfo\":" + JSON.stringify(this) + "}";
    return "{\"shippingInfo\":{\"ShipAddress1\":\"" + this.ShipAddress1 + "\",\"ShipAddress2\":\"" + this.ShipAddress2 +
                "\",\"ShipAddress3\":\"" + this.ShipAddress3 + "\",\"ShipCity\":\"" + this.ShipCity + "\",\"ShipRegion\":\"" + this.ShipRegion +
                "\",\"ShipZipCode\":\"" + this.ShipZipCode + "\",\"IsStorePickup\":" + this.IsStorePickup + ",\"storeNumber\":\"" + this.storeNumber +
                "\",\"IsShipToRegistry\":" + this.IsShipToRegistry + ",\"RegistryID\":\"" + this.RegistryID + "\",\"ShippingOptionId\":\"" + this.ShippingOptionId + "\"}}"};

function chkoutErrorPlacement(error, element) {
    if ($(element).parent().hasClass("sectionError")) {
        error.appendTo(element.parent());
    } else if ($(element).parents("#signInForm").length > 0) {
        error.appendTo(element.parent());
    } else {
        if (element.attr("type") == "radio") {
            error.appendTo(element.parent().parent());
        } else if (element.parent().next().hasClass("custom-drop")) {
            error.appendTo(element.parent().parent());
        } else {
            error.appendTo(element.closest(".inputCol"));
        }
    }
}

function chkoutShowErrors(errorMap, errorList) {
    /*
    for (var i=0;i<errorList.length;i++) {
        errorList[i].message = "*" + errorList[i].message;
    }
    */
    
    for (var i = 0; i < errorList.length; i++) {
        if ((errorList[i].element.id.indexOf("txtZipCodeEU1") > 0 || errorList[i].element.id.indexOf("txtZipCodeEU2") > 0) && errorList[i].message.length > 0) {
            clearServerSideError($('input:text[id*="_txtZipCodeEU1"]').attr("id"));
            break;
        }
        else if ((errorList[i].element.id.indexOf("txtZipCodeGB1") > 0 || errorList[i].element.id.indexOf("txtZipCodeGB2") > 0) && errorList[i].message.length > 0) {
            clearServerSideError($('input:text[id*="_txtZipCodeGB1"]').attr("id"));
            break;
        }
        else if ((errorList[i].element.id.indexOf("txtPostCodeAU") > 0) && errorList[i].message.length > 0) {
            clearServerSideError($('input:text[id*="_txtPostCodeAU"]').attr("id"));
            break;
        }
        else if ((errorList[i].element.id.indexOf("txtZipCodeUS1") > 0) && errorList[i].message.length > 0) {
            clearServerSideError($('input:text[id*="_txtZipCodeUS1"]').attr("id"));
            break;
        }
        errorMsgArray.push({ "message": (errorList[i].message) });
    }

    this.defaultShowErrors();

    if ($("#errorMain").is(':visible')) {
        $("#pnlErrorMessageIndicator").hide();
    }
    if ($('label[for="ShippingAddressInputCtl_ctl00_txtZipCodeEU1"]').is(':visible')) {
        $('label[for="ShippingAddressInputCtl_ctl00_txtZipCodeEU2"]').hide();
    }

}

function chkoutHighlight(element) {
    if ($(element).parent().hasClass("sectionError")) {
        $(element).parent().addClass("errorWrapper");
    } else if ($(element).parents("#signInForm").length > 0) {
        $(element).parent().addClass("errorWrapper");
    } else if ($(element).parent().next().hasClass("custom-drop") || $(element).attr("type") == "radio") {
        $(element).parent().parent().addClass("errorWrapper").next().addClass("errorWrapper");
    } else if (typeof $(element).attr("id") != "undefined" && $(element).attr("id") == "CustomerPrivacyPolicy_ctl00_chkGppAccepted") {
        $(element).parent().parent().addClass("errorWrapper").next().addClass("errorWrapper");
    } else {
        $(element).parent().addClass("errorWrapper");
    }
    chkoutToggleGlobalError();
}

function chkoutUnhighlight(element) {
    if ($(element).parent().hasClass("sectionError")) {
        $(element).parent().removeClass("errorWrapper");
    } else if ($(element).parents("#signInForm").length > 0) {
        $(element).parent().removeClass("errorWrapper");
    } else if ($(element).parent().next().hasClass("custom-drop") || $(element).attr("type") == "radio") {
        $(element).parent().parent().removeClass("errorWrapper").next().removeClass("errorWrapper");
    } else if (typeof $(element).attr("id") != "undefined" && $(element).attr("id") == "CustomerPrivacyPolicy_ctl00_chkGppAccepted") {
        $(element).parent().parent().removeClass("errorWrapper").next().removeClass("errorWrapper");
    } else {
        $(element).parent().removeClass("errorWrapper").next().removeClass("errorWrapper");
    }
    chkoutToggleGlobalError();
}

function chkoutToggleGlobalError() {
    if ($("#pnlGlobalError").length > 0) {
        return;
    }
    var errors = validation.numberOfInvalids();
    if (errors) {
        $("#errorMain").show();
    } else {
        $("#errorMain").hide();
    }
}

function populateBillingFromShipping() {
    var mapping;
    for (var key in billingAddressObjMapping) {
        mapping = billingAddressObjMapping[key];
        //alert(key + " " + billingAddressObjMapping[key]);
        if (mapping != "Gender") {
            $("#" + key).val(shippingAddressObj[mapping]).prop("disabled", true);
        } else {
            if (key.split("BillingAddressInputCtl_ctl00_chkGender_")[1] == (shippingAddressObj[mapping] - 1)) {
                $("#" + key).prop("checked", true);
            }
            $("#" + key).prop("disabled", true);
        }
    }
}

function releaseBillingFields() {
    $("#guestAddressFields input, #guestAddressFields select").prop("disabled", false);
}
function disableCityState() {
    $("input.cityInput").prop("disabled", true);
    $("select.stateInput").prop("disabled", true);
    $("#ShippingAddressInputCtl_ctl00_txtCounty").prop("disabled", true);
    $("#BillingAddressInputCtl_ctl00_txtCounty").prop("disabled", true);
    if ($("div.stateInput").length > 0) {
        $("div.stateInput").addClass("disabled");
    }
}
function enableCityState() {
    $("input.cityInput").prop("disabled", false);
    $("select.stateInput").prop("disabled", false);
    $("#ShippingAddressInputCtl_ctl00_txtCounty").prop("disabled", false);
    $("#BillingAddressInputCtl_ctl00_txtCounty").prop("disabled", false);
    if ($("div.stateInput.disabled").length > 0) {
        $(".stateInput.disabled").removeClass("disabled");
    }
}
function phoneFocus(elem) {
    if (elem.value == "") {
        elem.value = telMask;
    }
    setPhoneNumCursor(elem);
}
function phoneBlur(elem) {
    if (elem.value == telMask) {
        elem.value = "";
    }

}
function setPhoneNumCursor(elem) {
    var position = $(elem).val().indexOf("_");
    if (position < 0) { position = $(elem).val().length; }
    if (elem.setSelectionRange) {
        elem.focus();
        elem.setSelectionRange(position, position);
    }
    else if (elem.createTextRange) {
        var range = elem.createTextRange();
        range.collapse(true);
        range.moveEnd('character', position);
        range.moveStart('character', position);
        range.select();
    }

}
function mergePhoneMask() {
    var tempMask = telMask;
    var tempPos;
    for (var i = 0; i < phoneNumberBuffer.length; i++) {
        tempPos = tempMask.indexOf("_");
        tempMask = tempMask.substr(0, tempPos) + phoneNumberBuffer.charAt(i) + tempMask.substr(tempPos + 1);
    }
    return tempMask;
}
function formatPhoneNumber(elem, e) {
    var tempMask = telMask;
    var tempPos;
    if (e.which == 8) {
        phoneNumberBuffer = phoneNumberBuffer.substr(0, phoneNumberBuffer.length - 1);
        elem.value = mergePhoneMask();
    }
    if ((e.which > 47 && e.which < 58) || (e.which > 95 && e.which < 106)) {
        if (phoneNumberBuffer.length < 10) {
            // numpad keys don't match to charcode
            if (e.which > 95 && e.which < 106) {
                phoneNumberBuffer += (e.which - 96).toString();
            } else {
                phoneNumberBuffer += String.fromCharCode(e.which);
            }
            elem.value = mergePhoneMask();
        }
    }
    e.preventDefault();
    if (phoneNumberBuffer.length == 10 || e.which == 9) {
        $(elem).parent().next().next().find("input").focus();
    } else {
        setPhoneNumCursor(elem);
    }
}
function prePhoneFormat(elem) {
    $(elem).val($(elem).val().replace(/[^0-9]/g, ''));
}
function postPhoneFormat(elem) {
    var phoneNum = $(elem).val().replace(/[^0-9]/g, '');
    var newPhone = "(";
    if (typeof phoneNum.substring(0, 1) != "undefined" && phoneNum.substring(0, 1) == "1") {
        phoneNum = phoneNum.substring(1, phoneNum.length);
    }
    for (var i = 0; i < 10; i++) {
        if (i == 3) { newPhone += ") "; }
        if (i == 6) { newPhone += "-"; }
        if (typeof phoneNum.substring(i, i + 1) != "undefined") {
            newPhone += phoneNum.substring(i, i + 1);
        } else {
            newPhone += "_";
        }
    }
    $(elem).val(newPhone);
    $(elem).valid();
}
function initRollbar() {
    $(".rollbar").each(function () {
        if (!$(this).find(".rollbar-content").length) {
            $(this).rollbar({
                scroll: 'vertical',
                pathPadding: '10px',
                zIndex: 2,
                sliderOpacity: 1,
                touchSpeed: 1});
        }
    });
}

function updateRollbar(rollbarElem) {
    var rollbarContent = $(rollbarElem).find('.rollbar-content');
    var rollbarHandle = $(rollbarElem).find('.rollbar-handle');
    var maxTopValue = rollbarContent.prop('scrollHeight') - $(rollbarElem).height();
    var handleTop = ((rollbarContent.position().top) * -100) / maxTopValue;
    var numPixels = Math.floor((handleTop - handleTop * .3) * maxTopValue * .01);
    if (handleTop < 0) {
        handleTop = 0;
    } else if (handleTop > 100) {
        handleTop = 100;
        rollbarContent.animate({ top: "-" + maxTopValue + "px" });
    }
    if ($("body").hasClass("ie-7") || $("body").hasClass("ie-8")) {
        rollbarHandle.css("top", numPixels + "px");
    } else {
        rollbarHandle.animate({ top: (handleTop - handleTop * .3) + "%" }, 200);
    }
}

function applyCustomDropdown() {
    if (!$("body").hasClass("ie-7")) {
        $(".apply-custom-drop").each(function () {
            var select = $(this).find("select");

            if (select.length == 0) {
                $(this).hide().removeClass("apply-custom-drop");
                return;
            }

            var options = select.find("option");

            var list = "";
            var noleftmargin = "";
            var colordrop = false;
            var color = "";
            var disabled = "";
            var additionalClasses = "";

            if ($(this).hasClass("no-left-margin")) {
                noleftmargin = " no-left-margin";
            }

            if ($(this).hasClass("color")) {
                color = " color";
                colordrop = true;
            }
            if ($(this).find("select").prop("disabled") == true) {
                disabled = " disabled";
            }
            if (typeof $(this).attr("data-css") != "undefined") {
                additionalClasses = " " + $(this).attr("data-css");
            }

            list += '<div class="custom-drop l6' + noleftmargin + color + disabled + additionalClasses + '" rel="' + $(this).attr("id") + '"><div class="choice"></div><div class="rollbar"><ul>';

            options.each(function () {
                if ($(this).attr("value") == "---") {
                    list += '<li rel="' + $(this).attr("value") + '" class="separator">';
                } else if ($(this).prop("selected") != "undefined" && $(this).prop("selected") == true) {
                    list += '<li class="active" rel="' + $(this).attr("value") + '">';
                } else {
                    list += '<li rel="' + $(this).attr("value") + '">';
                }
                if (colordrop) {
                    if ($(this).attr("data-swatch") != null && $(this).attr("data-swatch") != "") {
                        list += '<img src="' + $(this).attr("data-swatch") + '" />';
                    }
                    else {
                        list += '<img src="images/item-views/' + $(this).text().replace(/ /g, '').toLowerCase() + '.png" />';
                    }
                }
                list += $(this).text();
                list += '</li>';
            });

            list += '</ul></div></div>';

            $(this).hide().removeClass("apply-custom-drop").after(list);

            $(".custom-drop div.choice:not(.preselected)").each(function () {
                var activeElem = $(this).siblings("div.rollbar").find(".active");
                if (activeElem.length == 0) {
                    activeElem = $(this).siblings("div.rollbar").find("li:first");
                    activeElem.addClass("active");
                }
                $(this).html($(activeElem).html()).css("padding-right", "15px");
            });

            initRollbar();
        });
    }
}
function updateCustomDrop(styledSelectId) {
    var options = $("#" + styledSelectId).find("option");
    var selectedOption = $("#" + styledSelectId).find("select").val();
    var list = "";
    var selectedLabel = "";
    options.each(function () {
        if ($(this).attr("value") == "---") {
            list += '<li rel="' + $(this).attr("value") + '" class="separator">';
        } else {
            list += '<li rel="' + $(this).attr("value") + '">';
        }
        list += $(this).text();
        list += '</li>';
        if ($(this).val() == selectedOption) {
            selectedLabel = $(this).text();
        }
    });
    $("div[rel=" + styledSelectId + "] ul").html(list);
    if ($("div[rel=" + styledSelectId + "] ul").find('li[rel="' + selectedOption + '"]').length > 0) {
        $("div[rel=" + styledSelectId + "] ul").find('li[rel="' + selectedOption + '"]').addClass("active");
    }
    if (selectedLabel != "") {
        // Update selected item
        $("#" + styledSelectId).parent().find(".choice").text(selectedLabel);
    }
}

// checkout redesign
function displayBOPSAddres() {
    var ddl = document.getElementById('ddlPickupStoreAddress');
    if (ddl != null) {
        var opt;
        for (var i = 0, len = ddl.options.length; i < len; i++) {
            opt = ddl.options[i];
            if (opt.selected === true) {
                break;
            }
        }
        var bAddress = opt.getAttribute("address");
        var bLink = opt.getAttribute("link");
        var bStoreNumber = opt.getAttribute("data-text");
        // display bops address
        displayBOPS(true, bAddress, bLink, bStoreNumber, opt);
        // update order summary
        if ($("#divBOPSAddress").is(":visible")) {
            $("#inStorePickupInfo").show();
            $("#shippingInfo").hide();
            $("#pickupAddrSummarybox").html($("#divBOPSAddress").html());
            //document.getElementById("ctlOrderSummary_ancInStorePickupInfo").href = document.getElementById("lnkAboutInStorePickup").href;
        } else {
            $("#inStorePickupInfo").hide();
            $("#shippingInfo").show();
        }
        // hide store drop down 
        if (ddl.options.length == 1) {
            document.getElementById('divPickup').style.display = "none";
        }

    }
}


// Shipping Banner

function getBannerText() {
    var bannerClosedCookie = CookieManager.getCookieValue("IsBannerClosed");
    var bannerInnerDiv = '<div style="flex: 1 0 100%;"><span class="banner__banner-text {3} type-eb1-i">{0}</span><div class="banner__learn-more-container {2}">&#8212; <a href="#" class="avenir type-cta jq-open-modal" data-type="static" data-size="small">' + bannerLearnMore + '</a><div class="modal-static-content banner__learn-more-text" aria-hidden="true">{1}</div></div></div>';
    if ((bannerClosedCookie == '0' || bannerClosedCookie == null) && (typeof bannerText != "undefined" && bannerText.length > 0)) {
        var oneShown = false;
        var count = 0;
        for (var i = 0; i < bannerText.length; i++) {
            var tempBannerInnerDiv = bannerInnerDiv;
            if (bannerText[i].BannerText && bannerText[i].BannerText != "" && bannerText[i].BannerType == "shipping") {
                count++;
                if (!oneShown) {
                    oneShown = true;
                }
                tempBannerInnerDiv = tempBannerInnerDiv.split("{0}").join(bannerText[i].BannerText);
                if (bannerText[i].LearnMoreText && bannerText[i].LearnMoreText != "") {
                    var modalHtml = bannerText[i].LearnMoreWrapper;
                    modalHtml = modalHtml.split("$LearnMoreContent$").join(bannerText[i].LearnMoreText);

                    $(".banner").addClass("banner--clickable");
                    tempBannerInnerDiv = tempBannerInnerDiv.split("{1}").join(modalHtml);
                    tempBannerInnerDiv = tempBannerInnerDiv.split("{2}").join("banner__learn-more-container--visible");
                }
                if ((typeof isChooseYourCountry != "undefined" && isChooseYourCountry == 'True') || (typeof isPageNotFound != "undefined" && isPageNotFound == 'True')) {
                    tempBannerInnerDiv = tempBannerInnerDiv.split("{3}").join("banner--type-" + bannerText[i].BannerType);
                }
                else {
                    tempBannerInnerDiv = tempBannerInnerDiv.split("{2}").join("banner--type-" + bannerText[i].BannerType);
                }
                tempBannerInnerDiv = tempBannerInnerDiv.split("{2}").join("").split("{3}").join("");
                $(".banner .banner__container").append(tempBannerInnerDiv);
                // Remove any tracking on impression request by Acronym
                //   trackBannerImpression(data.d.BannerType, data.d.DtmDMCode);
            }
        }
        if (oneShown) {
            $shippingBanner = $(".banner");
            bannerPosition = 0;
            $(".banner").addClass("banner--visible");
            if (count > 1) {
                $(".banner__right-arrow").addClass("banner__right-arrow--visible");
                rotateBanner = setInterval(function () {
                    var oldBannerPosition = bannerPosition;
                    if (bannerPosition == ($shippingBanner.find(".banner__container > div").length - 1)) {
                        bannerPosition = 0;
                    } else {
                        bannerPosition++;
                    }
                    $($shippingBanner.find(".banner__container > div")[oldBannerPosition]).fadeOut("fast", function () {
                        $($shippingBanner.find(".banner__container > div")[bannerPosition]).fadeIn("fast");
                    });

                    if (bannerPosition == 0) {
                        $(".banner__left-arrow").removeClass("banner__left-arrow--visible");
                    }
                    else if (!$(".banner__left-arrow").hasClass("banner__left-arrow--visible")) {
                        $(".banner__left-arrow").addClass("banner__left-arrow--visible");
                    }

                    if (bannerPosition == ($shippingBanner.find(".banner__container > div").length - 1)) {
                        $(".banner__right-arrow").removeClass("banner__right-arrow--visible");
                    }
                    else if (!$(".banner__right-arrow").hasClass("banner__right-arrow--visible")) {
                        $(".banner__right-arrow").addClass("banner__right-arrow--visible");
                    }
                }, 4000);
            }
        }
    }
    else {
        $(".banner").removeClass("banner--visible");
    }
}

function hideBanner() {
    CookieManager.sessionCookie("IsBannerClosed", 1);
    $(".banner").removeClass("banner--visible");
}

$(document).ready(function () {
    getBannerText();

    $("body").on("click", ".jq-banner__close", function () {
        hideBanner();
        return false;
    });
});

// Shipping Page
$(document).ready(function () {
    $("body").on("click", ".SendTo .order-details--header", function () {
        $(".order-details").toggleClass("expanded");
        if($(".order-details").hasClass("expanded")){
            TrackSiteInteractions("expand order summary", "checkout");
        }
        return false;
    });
});

//fix order summary on payment page
$(window).on("load", function () {
    fixOrderSummary();
});

$(window).on("scroll", function () {
    fixOrderSummary();
});

function fixOrderSummary() {
    if ($("#paymentPage").length && isMobileSite) {
        var scrollTop = $(window).scrollTop() + 5;
        var orderSummaryTop = $(".payment-total-sticky-holder").offset().top;
        var emptyHeight = $(".payment-total-sticky").outerHeight();

        if (scrollTop > orderSummaryTop && orderSummaryTop != 0) {
            $(".payment-total-sticky").addClass("payment-total-sticky--fixed");
            $(".payment-total-sticky-holder").css("padding-bottom", emptyHeight + "px");
        } else {
            $(".payment-total-sticky").removeClass("payment-total-sticky--fixed");
            $(".payment-total-sticky-holder").css("padding-bottom", "0");
        }
    }
}

function isDNT() {
    var DNT = 'no';
    if (navigator.doNotTrack == "yes" || navigator.doNotTrack == "1" || navigator.msDoNotTrack == "1" || window.doNotTrack == "yes" || window.doNotTrack == "1" || window.msDoNotTrack == "1") {
        DNT = 'yes';
    }
    return DNT;
}
$(document).ready(function () {

    $("select").each(function () {
        checkSelect($(this));
    });

    $("body").on("change", "select", function () {
        checkSelect($(this));
    });

});

function checkSelect(select) {
    if (select.val() && select.val() != "") {
        select.addClass("select--has-value");
    } else {
        select.removeClass("select--has-value");
    }
}
$(document).ready(function () {

    initAccordions();

    $("body").on("click", ".jq-accordion__toggle", function () {
        var link = $(this);
        var container = link.parents(".accordion__item");
        var content = container.find(".accordion__item-content");

        container.toggleClass("accordion__item--open");

        if (container.hasClass("accordion__item--open")) {
            link.attr("aria-expanded", "true");
            content.attr("aria-expanded", "true").attr("aria-hidden", "false");
        } else {
            link.attr("aria-expanded", "false");
            content.attr("aria-expanded", "false").attr("aria-hidden", "true");
        }

        return false;
    });

});

var accordionCount = 0;

function initAccordions() {
    $(".accordion:not(.accordion--intialized)").each(function () {
        accordionCount++;
        var accordion = $(this);

        accordion.addClass("accordion--intialized");

        accordion.attr("id", "accordion" + accordionCount).attr("role", "tablist").attr("aria-multiselectable", "true");
        accordion.find(".accordion__toggle").attr("aria-expanded", "false");
        accordion.find(".accordion__item-content").attr("aria-expanded", "false").attr("aria-hidden", "true");

        var accordionItemCount = 0;

        accordion.find(".accordion__item").each(function () {
            accordionItemCount++;
            var accordionItem = $(this);

            accordionItem.find(".accordion__toggle").attr("aria-controls", "accordion__item" + accordionItemCount);
            accordionItem.find(".accordion__item-content").attr("id", "accordion__item" + accordionItemCount);
        });
    });
}$(document).ready(function () {
    animatedTileScrollCheck();

    $("body").on("mouseenter", ".animated-tile", function () {
        var link = $(this).find(".jq-toggle-tile-animation");
        if (link.attr("data-action") == "stop") {
            $(this).addClass("animated-tile--paused");
        }
    });

    $("body").on("mouseleave", ".animated-tile", function () {
        var link = $(this).find(".jq-toggle-tile-animation");
        if (link.attr("data-action") == "stop") {
            $(this).removeClass("animated-tile--paused");
        }
    });

    $("body").on("click", ".jq-toggle-tile-animation", function () {
        var link = $(this);
        var span = link.find("span");
        var icon = link.find("i");
        var container = link.parents(".animated-tile");
        var action = link.attr("data-action");

        if (action == "stop") {
            link.attr("data-action", "start");
            span.text("Start Animation");
            icon.text("play");
            container.addClass("animated-tile--paused");
        } else {
            link.attr("data-action", "stop");
            span.text("Stop Animation");
            icon.text("pause");
            container.removeClass("animated-tile--paused");
        }

        return false;
    });
});

$(window).on("scroll", function () {
    animatedTileScrollCheck();
});

function initAnimatedTile(tile) {
    if (!tile.hasClass("animated-tile--initialized")) {
        var slides = tile.children("div").length;

        tile.addClass("animated-tile--initialized").addClass("animated-tile--paused");

        tile.children("div:first").addClass("animated-tile__slide--ready");
        setTimeout(function () {
            tile.children("div:first").addClass("animated-tile__slide--active").attr("aria-hidden", "false");
        }, 20);

        setInterval(function () {
            if (!tile.hasClass("animated-tile--paused") && tile.is(":visible")) {
                var curSlide = tile.children(".animated-tile__slide--active");
                var nextSlide = curSlide.next();
                if (nextSlide.length == 0) {
                    nextSlide = tile.children("div:first");
                }

                curSlide.removeClass("animated-tile__slide--active").attr("aria-hidden", "true");

                setTimeout(function () {
                    curSlide.removeClass("animated-tile__slide--ready");
                    nextSlide.addClass("animated-tile__slide--ready");
                    setTimeout(function () {
                        nextSlide.addClass("animated-tile__slide--active").attr("aria-hidden", "false");
                    }, 20);
                }, 500);
            }
        }, 5000);
    }
}

function animatedTileScrollCheck() {
    var viewportScrollTop = $(window).scrollTop();
    var viewportScrollBottom = viewportScrollTop + $(window).height();

    $(".animated-tile:visible").each(function () {
        var tile = $(this);
        var tileHeight = tile.outerHeight();
        var tileTop = tile.offset().top;
        var tileBottom = tileTop + tileHeight;
        var topThreshold = .5;
        var botThreshold = .5;

        if ((tileTop + (tileHeight * topThreshold)) < viewportScrollTop) {
            tile.addClass("animated-tile--paused");
        } else {
            if ((tileBottom - (tileHeight * botThreshold)) < viewportScrollBottom) {
                initAnimatedTile(tile);
                tile.removeClass("animated-tile--paused");
            } else {
                tile.addClass("animated-tile--paused");
            }
        }
    });
}
var focusableElementsString = "a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), iframe, object, embed, *[tabindex], *[contenteditable]";
var focusedElementBeforeModal = null;

$(document).ready(function () { 

    $("body").on("click", ".jq-open-modal", function (e) {
        e.preventDefault();

        var link = $(this);

        var props = {
            link: link,
            source: link.attr("href"),
            type: link.attr("data-type"),
            size: link.attr("data-size"),
            closeWarning: link.attr("data-close-warning")
        };

        openModalOverlay(props);
    });

    $("body").on("click", ".jq-close-modal", function (e) {
        e.preventDefault();

        if ($(".modal-container").hasClass("modal__close-warning")) {
            //checks to see if cofirmCloseModal is set (should be in the footer, but this is just in case we use this somewhere else), if it is not it will use english text.
            cofirmCloseModal = (typeof cofirmCloseModal != "undefined") ? cofirmCloseModal : "Are you sure you want to close? Any unsaved changes will be lost.";
            if (confirm(cofirmCloseModal)) {
                closeModalOverlay();
            }
        } else {
            closeModalOverlay();
        }
    });

    $("body").on("mousedown touchstart", ".modal-container", function (e) {
        if ($(e.target).hasClass("modal-container")) {
            if ($(".modal-container").hasClass("modal__close-warning")) {
                //checks to see if cofirmCloseModal is set (should be in the footer, but this is just in case we use this somewhere else), if it is not it will use english text.
                cofirmCloseModal = (typeof cofirmCloseModal != "undefined") ? cofirmCloseModal : "Are you sure you want to close? Any unsaved changes will be lost.";
                if (confirm(cofirmCloseModal)) {
                    closeModalOverlay();
                }
            } else {
                closeModalOverlay();
            }
        }
    });

    $("body").on("keydown", function (e) {
        if (e.keyCode == 27 && $(".modal-container").length) {
            if ($(".modal-container").hasClass("modal__close-warning")) {
                //checks to see if cofirmCloseModal is set (should be in the footer, but this is just in case we use this somewhere else), if it is not it will use english text.
                cofirmCloseModal = (typeof cofirmCloseModal != "undefined") ? cofirmCloseModal : "Are you sure you want to close? Any unsaved changes will be lost.";
                if (confirm(cofirmCloseModal)) {
                    closeModalOverlay();
                }
            } else {
                closeModalOverlay();
            }
        }
    });

    $("body").on("keydown", ".modal-container", function (e) {
        trapTabKey($(this), e);
    });

});

$(window).on("resize", function () {
    checkModalSize();
});

function checkModalSize() {
    var viewportHeight = $(window).height();
    var modalHeight = $(".modal-inner").outerHeight();

    if (modalHeight > viewportHeight - 40) {
        $(".modal-container").addClass("modal-container--overflow");
    } else {
        $(".modal-container").removeClass("modal-container--overflow");
    }
}

function openModalOverlay(props) {
    var closeDelay = 0;
    if (!$(".modal-container").length) {
        if (props.link) {
            focusedElementBeforeModal = props.link;
        }
    } else {
        closeDelay = 300;
        closeModalOverlay();
    }

    setTimeout(function () {

    	if (!props.type || props.type == "ajax") {
    		$.ajax({
    			url: props.source,
    			type: "GET",
    			success: function (data) {
    				$(".modal-content").html(data);

    				checkModalSize();
    				setFocusToFirstItemInModal($(".modal-container"));
    				if (props.source.split("#")[1] != "undefined") {
    					$("#" + props.source.split("#")[1])[0].scrollIntoView()
    				}
    			}
    		});
    	}

        var closeWarningClass = '';
        if (props.closeWarning || props.closeWarning == "true") {
            closeWarningClass = ' modal__close-warning';
        }

        var modalHtml = '';
        modalHtml += '<div class="modal-container' + closeWarningClass + '" aria-labelledby="modalTitle" aria-describedby="modalDescription" role="dialog">';
        modalHtml += '<div class="modal-inner" role="document">';
        modalHtml += '<a href="#" class="close-modal-x jq-close-modal" title="Close Modal"><i class="icon-font" aria-hidden="true">delete_large</i></a>';
        modalHtml += '<div class="modal-content">';

        if (props.type == "static") {
            modalHtml += props.link.siblings(".modal-static-content").html();
        }

        modalHtml += '</div>'; //content
        modalHtml += '</div>'; //inner
        modalHtml += '</div>'; //container

        $("body").append(modalHtml);

        $("body > form").attr("aria-hidden", "true");

        if (props.size == "small") {
            $(".modal-container").addClass("modal-small");
        } else if (props.size == "large") {
            $(".modal-container").addClass("modal-large");
        }

        if (props.type && props.type != "ajax") {
            checkModalSize();
            setFocusToFirstItemInModal($(".modal-container"));
        }

        setTimeout(function () {
            $(".modal-container").addClass("visible");
        }, 10);

    }, closeDelay);
}

function closeModalOverlay() {
    $(".modal-container").removeClass("visible");
    $("body > form").attr("aria-hidden", "false");

    setTimeout(function () {
        $(".modal-container").remove();
        if (focusedElementBeforeModal) {
            focusedElementBeforeModal.focus();
            focusedElementBeforeModal = null;
        }
    }, 300);
}

function trapTabKey(obj, evt) {
    // if tab or shift-tab pressed
    if (evt.which == 9) {
        // get list of all children elements in given object
        var o = obj.find('*');

        // get list of focusable items
        var focusableItems;
        focusableItems = o.filter(focusableElementsString).filter(':visible')

        // get currently focused item
        var focusedItem;
        focusedItem = jQuery(':focus');

        // get the number of focusable items
        var numberOfFocusableItems;
        numberOfFocusableItems = focusableItems.length

        // get the index of the currently focused item
        var focusedItemIndex;
        focusedItemIndex = focusableItems.index(focusedItem);

        if (evt.shiftKey) {
            //back tab
            // if focused on first item and user preses back-tab, go to the last focusable item
            if (focusedItemIndex == 0) {
                focusableItems.get(numberOfFocusableItems - 1).focus();
                evt.preventDefault();
            }
        } else {
            //forward tab
            // if focused on the last item and user preses tab, go to the first focusable item
            if (focusedItemIndex == numberOfFocusableItems - 1) {
                focusableItems.get(0).focus();
                evt.preventDefault();
            }
        }
    }
}

function setInitialFocusModal(obj) {
    // get list of all children elements in given object
    var o = obj.find('*');

    // set focus to first focusable item
    var focusableItems;
    focusableItems = o.filter(focusableElementsString).filter(':visible').first().focus();
}

function setFocusToFirstItemInModal(obj) {
    // get list of all children elements in given object
    var o = obj.find('*');

    // set the focus to the first keyboard focusable item
    o.filter(focusableElementsString).filter(':visible').first().focus();
}
//touch carousel
$(document).ready(function () {
    initTouchCarousel();

    $("body").on("click", ".touch-carousel .thumb", function () {
        var touchCarousel = $(this).parents(".touch-carousel");
        var carouselItems = touchCarousel.find(".container > div").length;
        if (!touchCarousel.hasClass("ring-images")) {
            $(this).addClass("active").attr("aria-selected", "true").attr("tabindex", "0").siblings().removeClass("active").attr("aria-selected", "false").attr("tabindex", "-1");
        }

        var itemWidth = 100;
        if (touchCarousel.attr("data-itemwidth")) {
            itemWidth = touchCarousel.attr("data-itemwidth");
        }

        var index = $(this).index();
        var xPercent = index * itemWidth * -1;

        touchCarousel.find("div.current").removeClass("current");
        $(touchCarousel.find(".container > div")[index]).addClass("current");

        if (touchCarousel.attr("data-scroll") && touchCarousel.attr("data-scroll") == "noScroll") {
            if (index == 0) {
                touchCarousel.find(".touchcarousel-prev").addClass("endArrows");
                touchCarousel.find(".touchcarousel-next").removeClass("endArrows");
            } else if (index == carouselItems - 1) {
                touchCarousel.find(".touchcarousel-prev").removeClass("endArrows");
                touchCarousel.find(".touchcarousel-next").addClass("endArrows");
            } else {
                touchCarousel.find(".touchcarousel-prev").removeClass("endArrows");
                touchCarousel.find(".touchcarousel-next").removeClass("endArrows");
            }
        }

        if (typeof touchCarousel.attr("data-track-id") != "undefined") {
            trackCarousel(touchCarousel.attr("data-track-id"), "Page " + index, "Thumb");
        }

        touchCarousel.find(".container").css("transform", "translate3d(" + xPercent + "%,0,0)");

        return false;
    });

    $("body").on("keydown", ".touch-carousel .thumb", function (e) {
        if (e.keyCode == 13 || e.keyCode == 32) {
            $(this).trigger("click");
            e.preventDefault();
        }
    });

    $("body").on("focus", ".touch-carousel .thumb", function () {
        var touchCarousel = $(this).parents(".touch-carousel");
        touchCarousel.find(".thumbs").addClass("thumbs--focused");
    });

    $("body").on("blur", ".touch-carousel .thumb", function () {
        var touchCarousel = $(this).parents(".touch-carousel");
        if (!touchCarousel.find(".thumbs .thumb:focus").length) {
            touchCarousel.find(".thumbs").removeClass("thumbs--focused");
        }
    });

    $(document).keydown(function (e) {
        if ($(".touch-carousel .thumb:focus").length) {
            var touchCarousel = $(".touch-carousel .thumb:focus").parents(".touch-carousel");
            if (e.keyCode == 37 || e.keyCode == 38) {
                //up/left
                handleCarouselLeft(touchCarousel);
                e.preventDefault();
            } else if (e.keyCode == 39 || e.keyCode == 40) {
                //down/right
                handleCarouselRight(touchCarousel);
                e.preventDefault();
            }
        }
    });

    $("body").on("click", ".touchcarousel-next", function (e) {
        var touchCarousel = $(this).parents(".touch-carousel");
        handleCarouselRight(touchCarousel);

        return false;
    });
    $("body").on("keydown", ".touchcarousel-next", function (e) {
        if (e.keyCode == 13 || e.keyCode == 32) {
            var touchCarousel = $(this).parents(".touch-carousel");
            handleCarouselRight(touchCarousel);
            e.preventDefault();
        }
    });

    $("body").on("click", ".touchcarousel-prev", function (e) {
        var touchCarousel = $(this).parents(".touch-carousel");
        handleCarouselLeft(touchCarousel);

        return false;
    });
    $("body").on("keydown", ".touchcarousel-prev", function (e) {
        if (e.keyCode == 13 || e.keyCode == 32) {
            var touchCarousel = $(this).parents(".touch-carousel");
            handleCarouselLeft(touchCarousel);
            e.preventDefault();
        }
    });

    var touchCarousel, currentDiv, nextDiv, prevDiv, contentWidth;
    var minimumDistance = 20;
    var count;

    $("body").on("touchstart", ".touch-carousel", function (e) {
        if (e.originalEvent.touches.length == 2) {
            count = 2;
        }

        start = e.originalEvent.pageX || e.originalEvent.targetTouches[0].pageX;
        end = start;

        touchCarousel = $(this);
        currentDiv = touchCarousel.find("div.current");
        nextDiv = currentDiv.next("div");
        prevDiv = currentDiv.prev("div");
        contentWidth = touchCarousel.width();
    });

    $("body").on("touchmove", ".touch-carousel", function (e) {
        if (count > 0) {
            return false;
        }

        end = e.originalEvent.pageX || e.originalEvent.targetTouches[0].pageX;

        var container = $(this).find(".container");

        var itemWidth = 100;
        if (touchCarousel.attr("data-itemwidth")) {
            itemWidth = touchCarousel.attr("data-itemwidth");
        }

        var index = touchCarousel.find("div.current").index();
        var xPercent = index * itemWidth * -1;

        var move = end - start;
        var moveAbs = Math.abs(move);
        var movePercent = xPercent + (move / contentWidth * itemWidth);

        if (moveAbs > minimumDistance) {
            e.preventDefault();
            touchCarousel.find(".container").addClass("moving");

            if (end > start && prevDiv.length) { //swipe right
                container.css("transform", "translate3d(" + movePercent + "%,0,0)");
            } else if (end < start && nextDiv.length) { //swipe left
                container.css("transform", "translate3d(" + movePercent + "%,0,0)");
            }
        }
    });

    $("body").on("touchend", ".touch-carousel", function (e) {
        if (count > 0) {
            count = count - 1;
            return false;
        }

        var threshold = contentWidth * .15;

        touchCarousel.find(".container").removeClass("moving");

        if (end > (start + threshold) && prevDiv.length) { //swipe right
            handleCarouselLeft(touchCarousel);
        } else if (end < (start - threshold) && nextDiv.length) { //swipe left
            handleCarouselRight(touchCarousel);
        } else {
            var itemWidth = 100;
            if (touchCarousel.attr("data-itemwidth")) {
                itemWidth = touchCarousel.attr("data-itemwidth");
            }

            var index = touchCarousel.find("div.current").index();
            var xPercent = index * itemWidth * -1;

            touchCarousel.find(".container").css("transform", "translate3d(" + xPercent + "%,0,0)");
        }
        if (touchCarousel.attr("data-scroll") && touchCarousel.attr("data-scroll") == "noScroll") {
            var currentDiv = touchCarousel.find(".current");

            if (currentDiv.prev().length == 0) {
                touchCarousel.find(".touchcarousel-prev").addClass("endArrows");
                touchCarousel.find(".touchcarousel-next").removeClass("endArrows");
            } else if (currentDiv.next().length == 0) {
                touchCarousel.find(".touchcarousel-next").addClass("endArrows");
                touchCarousel.find(".touchcarousel-prev").removeClass("endArrows");
            } else {
                touchCarousel.find(".touchcarousel-next, .touchcarousel-prev").removeClass("endArrows");
            }
        }
    });
});

var carouselsId = 0;

function initTouchCarousel() {
    $(".apply-touch-carousel").each(function () {
        var touchCarousel = $(this);
        if (!touchCarousel.parents("#cachedMarketingTiles").length) {
            var carouselItemsObj = touchCarousel.find(".container > div");
            var carouselItems = carouselItemsObj.length;

            if (carouselItems > 0) {
                touchCarousel.find(".container").cleanWhitespace();
                touchCarousel.removeClass("apply-touch-carousel").addClass("touch-carousel");
                var itemWidth = 100;
                var firstItemOffset = 0;
                var carouselId = "touchCarousel-" + carouselsId;

                // accessibility
                touchCarousel.attr("id", carouselId).attr("role", "complementary").attr("aria-describedby", carouselId + "-desc").attr("aria-labelledby", carouselId + "-title");
                touchCarousel.prepend('<p id="' + carouselId + '-desc" class="visually-hidden">A carousel is a rotatable set of images and/or content. Use the tabs or the previous and next buttons to change the displayed slide.</p>');
                touchCarousel.prepend('<h2 id="' + carouselId + '-title" class="visually-hidden">Carousel content with ' + carouselItems + ' slides.</h2>');
                touchCarousel.find(".thumbs").attr("role", "tablist");
                //end accessibility

                if (touchCarousel.attr("data-itemwidth")) {
                    itemWidth = touchCarousel.attr("data-itemwidth");
                    if (itemWidth < 100) {
                        firstItemOffset = (100 - itemWidth) / 2;
                    }
                }
                touchCarousel.find(".container > div").css("width", itemWidth + "%");
                touchCarousel.find(".container > div:first").addClass("current").css("margin-left", firstItemOffset + "%");

                if (carouselItems > 1) {
                    touchCarousel.append('<a href="#' + carouselId + '" class="touchcarousel-prev" role="button" aria-label="Previous Slide"><i class="icon-font" aria-hidden="true">directional_left</i></a><a href="#' + carouselId + '" class="touchcarousel-next" role="button" aria-label="Next Slide"><i class="icon-font" aria-hidden="true">directional_right</i></a>');
                    if (touchCarousel.attr("data-arrow-type") && touchCarousel.attr("data-arrow-type") == "minimal") {
                        touchCarousel.addClass("minimal-arrows");
                    }
                    if (touchCarousel.attr("data-scroll") && touchCarousel.attr("data-scroll") == "noScroll") {
                        touchCarousel.find(".touchcarousel-prev").addClass("endArrows");
                    }
                }

                if (touchCarousel.attr("data-arrow-offset")) {
                    touchCarousel.find(".touchcarousel-prev, .touchcarousel-next").css("margin-top", touchCarousel.attr("data-arrow-offset"));
                }

                if (
                  touchCarousel.attr("data-arrow-placement") &&
                  touchCarousel.attr("data-arrow-placement") == "bottom"
                ) {
                  touchCarousel
                    .find(".touchcarousel-prev, .touchcarousel-next")
                    .addClass("next-prev-bottom");
                }

                if (touchCarousel.attr("data-pager-style") && touchCarousel.attr("data-pager-style") == "numbers") {
                    touchCarousel.find(".thumbs").addClass("visually-hidden");
                    touchCarousel.append('<div class="touch-carousel__pages"><span class="touch-carousel__current-page-num">1</span> / <span class="touch-carousel__total-page-num">' + carouselItems + '</span></div>');
                }

                if (touchCarousel.find(".thumbs").html() == "" && carouselItems > 1) {
                    var dotsHtml = "";
                    for (i = 0; i < carouselItems; i++) {
                        var tabId = carouselId + '-tab-' + i;
                        var tabPanelId = carouselId + '-tabpanel-' + i;

                        if (i == 0) {
                            dotsHtml += '<span id="' + tabId + '" class="thumb active" role="tab" aria-selected="true" tabindex="0" data-target="#' + carouselId + '" aria-controls="' + tabPanelId + '"><span class="visually-hidden">Tab ' + i + '</span></span>';
                        } else {
                            dotsHtml += '<span id="' + tabId + '" class="thumb" role="tab" aria-selected="false" tabindex="-1" data-target="#' + carouselId + '" aria-controls="' + tabPanelId + '"><span class="visually-hidden">Tab ' + i + '</span></span>';
                        }

                        $(carouselItemsObj[i]).attr("role", "tabpanel").attr("id", tabPanelId).attr("aria-labelledby", tabId);
                    }
                    touchCarousel.find(".thumbs").attr("role", "tablist").html(dotsHtml);
                } else {
                    var i = 0;
                    touchCarousel.find(".thumbs .thumb").each(function () {
                        var tabId = carouselId + '-tab-' + i;
                        var tabPanelId = carouselId + '-tabpanel-' + i;

                        if (i == 0) {
                            $(this).attr("role", "tab").attr("aria-selected", "true").attr("tabindex", "0").attr("data-target", "#" + carouselId).attr("aria-controls", tabPanelId).html('<span class="visually-hidden">Tab ' + i + '</span>');
                        } else {
                            $(this).attr("role", "tab").attr("aria-selected", "false").attr("tabindex", "-1").attr("data-target", "#" + carouselId).attr("aria-controls", tabPanelId).html('<span class="visually-hidden">Tab ' + i + '</span>');
                        }
                        i++;
                    });
                }

                // auto advance carousel
                if (touchCarousel.hasClass("touch-carousel--auto-advance")) {
                    touchCarousel.append('<a href="#" class="touch-carousel__toggle-pause jq-touch-carousel__toggle-pause"><i class="icon-font">pause</i></a>');

                    var delayTime = 8000;
                    if (touchCarousel.attr("data-auto-delay")) {
                        delayTime = touchCarousel.attr("data-auto-delay");
                    }

                    var autoAdvanceInterval = setInterval(function () {
                        handleCarouselRight(touchCarousel);
                    }, delayTime);

                    touchCarousel.on("mouseenter", function () {
                        clearInterval(autoAdvanceInterval);
                        autoAdvanceInterval = null;
                    });

                    touchCarousel.on("mouseleave", function () {
                        if (!autoAdvanceInterval && !touchCarousel.hasClass("touch-carousel--paused")) {
                            autoAdvanceInterval = setInterval(function () {
                                handleCarouselRight(touchCarousel);
                            }, delayTime);
                        }
                    });

                    touchCarousel.find(".jq-touch-carousel__toggle-pause").on("click", function (e) {
                        e.preventDefault();

                        touchCarousel.toggleClass("touch-carousel--paused");

                        if (touchCarousel.hasClass("touch-carousel--paused")) {
                            $(this).find("i").html("play");
                            clearInterval(autoAdvanceInterval);
                            autoAdvanceInterval = null;
                        } else {
                            $(this).find("i").html("pause");
                            autoAdvanceInterval = setInterval(function () {
                                handleCarouselRight(touchCarousel);
                            }, 2000);
                        }
                    });
                }

                carouselsId++;

                if ($("body").attr("id") == "itemPage" && touchCarousel.hasClass("mainImages")) {
                    touchCarousel.find(".thumbs").append("<span class='thumb zoomIMG'>+</span>");
                }
            }
        }
    });
}

function handleCarouselLeft(touchCarousel, ignoreTracking) {
    currentDiv = touchCarousel.find("div.current");
    prevDiv = currentDiv.prev("div");

    if (prevDiv.length) {
        prevDiv.addClass("current");
        currentDiv.removeClass("current");

        var itemWidth = 100;
        if (touchCarousel.attr("data-itemwidth")) {
            itemWidth = touchCarousel.attr("data-itemwidth");
        }

        var index = touchCarousel.find("div.current").index();
        var xPercent = index * itemWidth * -1;

        touchCarousel.find(".container").css("transform", "translate3d(" + xPercent + "%,0,0)");

        if (touchCarousel.hasClass("ring-images")) {
            var thumb = $(".more-images .thumbs .thumb.active").prev();
            thumb.trigger("click");
        } else {
            touchCarousel.find(".thumb.active").removeClass("active").attr("aria-selected", "false").attr("tabindex", "-1").prev(".thumb").addClass("active").attr("aria-selected", "true").attr("tabindex", "0");
        }
    } else {
        if (!touchCarousel.attr("data-scroll") || touchCarousel.attr("data-scroll") != "noScroll") {
            var lastThumb = touchCarousel.find(".thumb:last");
            if (lastThumb.hasClass("zoomIMG")) {
                lastThumb = lastThumb.prev();
            }
            lastThumb.trigger("click");
        }
    }

    var index = touchCarousel.find("div.current").index();
    touchCarousel.find(".touch-carousel__current-page-num").html(index + 1);

    if (touchCarousel.attr("data-scroll") && touchCarousel.attr("data-scroll") == "noScroll") {
        touchCarousel.find(".touchcarousel-next").removeClass("endArrows");
        if (prevDiv.prev().length == 0) {
            touchCarousel.find(".touchcarousel-prev").addClass("endArrows");
        }
    }

    if (typeof touchCarousel.attr("data-track-id") != "undefined" && !ignoreTracking) {
        var index = touchCarousel.find("div.current").index();
        trackCarousel(touchCarousel.attr("data-track-id"), "Page " + index, "Left");
    }

    if ($("body").attr("id") == "itemPage" && touchCarousel.hasClass("mainImages")) {
        TrackItemDisplayOption("itemPage", $(".touch-carousel .current span").attr("data-type"), $("h1.itemTitle:not(h1.itemTitle div)").text().trim().replace(/[\n\r]/g, '').replace(/ +(?= )/g, '').replace(/\s\s+/g, " "), $(".touch-carousel .current img").attr("src").split("?")[0].split("/EcomItemL2/")[1]);
    }
}

function handleCarouselRight(touchCarousel, ignoreTracking) {
    currentDiv = touchCarousel.find("div.current");
    nextDiv = currentDiv.next("div");

    if (nextDiv.length) {
        nextDiv.addClass("current");
        currentDiv.removeClass("current");

        var itemWidth = 100;
        if (touchCarousel.attr("data-itemwidth")) {
            itemWidth = touchCarousel.attr("data-itemwidth");
        }

        var index = touchCarousel.find("div.current").index();
        var xPercent = index * itemWidth * -1;

        touchCarousel.find(".container").css("transform", "translate3d(" + xPercent + "%,0,0)");

        if (touchCarousel.hasClass("ring-images")) {
            var thumb = $(".more-images .thumbs .thumb.active").next();
            thumb.trigger("click");
        } else {
            touchCarousel.find(".thumb.active").removeClass("active").attr("aria-selected", "false").attr("tabindex", "-1").next(".thumb").addClass("active").addClass("active").attr("aria-selected", "true").attr("tabindex", "0");
        }
    } else {
        if (!touchCarousel.attr("data-scroll") || touchCarousel.attr("data-scroll") != "noScroll") {
            touchCarousel.find(".thumb:first").trigger("click");
        }
    }

    var index = touchCarousel.find("div.current").index();
    touchCarousel.find(".touch-carousel__current-page-num").html(index + 1);

    if (touchCarousel.attr("data-scroll") && touchCarousel.attr("data-scroll") == "noScroll") {
        touchCarousel.find(".touchcarousel-prev").removeClass("endArrows");
        if (nextDiv.next().length == 0) {
            touchCarousel.find(".touchcarousel-next").addClass("endArrows");
        }
    }

    if (typeof touchCarousel.attr("data-track-id") != "undefined" && !ignoreTracking)  { 
        var index = touchCarousel.find("div.current").index();
        trackCarousel(touchCarousel.attr("data-track-id"), "Page " + index, "Right");
    }

    if ($("body").attr("id") == "itemPage" && touchCarousel.hasClass("mainImages")) {
        TrackItemDisplayOption("itemPage", $(".touch-carousel .current span").attr("data-type"), $("h1.itemTitle:not(h1.itemTitle div)").text().trim().replace(/[\n\r]/g, '').replace(/ +(?= )/g, '').replace(/\s\s+/g, " "), $(".touch-carousel .current img").attr("src").split("?")[0].split("/EcomItemL2/")[1]);
    }
}

jQuery.fn.cleanWhitespace = function () {
    textNodes = this.contents().filter(
        function () { return (this.nodeType == 3 && !/\S/.test(this.nodeValue)); })
        .remove();
    return this;
};
$(document).ready(function() {
	lazyLoad();
});

$(window).on("scroll", function() {
	lazyLoad();
});

function lazyLoad() {
	var threshold = 200;
	var scrollTop = $(window).scrollTop() + $(window).height();
	var loadPoint = scrollTop + threshold;

	$("img:not(.lazy-loaded):visible").each(function() {
		var img = $(this);

		if (img.offset().top <= loadPoint && img.attr("data-src")) {
			img.addClass("lazy-loaded");
			img.attr("src", img.attr("data-src"));
			img.attr("srcset", img.attr("data-srcset"));
		}
	});

	$("video:not(.lazy-loaded):visible").each(function() {
		var video = $(this);
		var videoOrig = video[0];

		if (video.offset().top <= loadPoint && video.attr("preload") && video.attr("preload") == "none") {
			video.addClass("lazy-loaded");
			video.attr("poster", video.attr("data-poster"));

			videoOrig.load();
			videoOrig.play();
		}
	});
}
// Marketing Module Functions
switch (locale){	
  case "en-US":
	localFolder="en-US";
	break;
  case "ja-JP":
	localFolder="ja-JP";
	break;
  case "zh-CN":
	localFolder="zh-CN";
	break;	
  default:
	localFolder="en-US";
	break;
}

function openMarketingPopUp(popUpName)
{
	var foundPopUp = openMarketingPopUpFollowup(popUpName, arguments);
	if (foundPopUp == true)
	{
		var popupState = popUpName;
		if (typeof(ProductModel) == "undefined") {return;}
		var model = ProductModel.getInstance();
		
		if (typeof(StoreLocationsModel) != "undefined" && typeof(LocationsURLFactory != "undefined"))
		{
			for (var i=1; i < arguments.length; i++)
			{
				popupState += "+" + LocationsURLFactory.hashEscape(arguments[i]);
			}
	
			if (isSafari3Plus() == false)
			{
				model.setBrowseStatesNoSideEffects({popup:popupState});
				HistoryManager.getInstance().addHistoryItem(LocationsURLFactory.convertStateToHash(model.getStateSnapshot()));
			}
		}
		else
		{
			for (var i=1; i < arguments.length; i++)
			{
				popupState += "+" + URLFactory.hashEscape(arguments[i]);
			}
	
			if (isSafari3Plus() == false)
			{
				model.setBrowseStatesNoSideEffects({popup:popupState});
				HistoryManager.getInstance().addHistoryItem(URLFactory.convertStateToHash(model.getStateSnapshot()));
			}
		}
	}
}

function openMarketingPopUpFollowup(popUpName, popupArguments)
{
	var foundPopUp = false;
	var isParentSecure = false;
	switch(popUpName.toLowerCase())
	{
		case "linktiffanygold":
			createPopUp(780,477,true,this,105,'/Expertise/Material/AboutTiffanyGold.aspx');
			foundPopUp = true;
			break;
		case "linktiffanysilver":
			createPopUp(780,477,true,this,105,'/Expertise/Material/AboutTiffanySilver.aspx');
			foundPopUp = true;
			break;
		case "linktiffanyplatinum":
			createPopUp(780,477,true,this,105,'/Expertise/Material/AboutTiffanyPlatinum.aspx');
			foundPopUp = true;
			break;
		case "linkhistorytimeline":
			createPopUp(768,425,true,this,60,'/About/Timeline.aspx');
			foundPopUp = true;
			break;
		case "linkjewelrycare":
			switch (locale) {
	            case "ja-JP-Trade":
	                createPopUp(780, 477, true, this, 105, '/Service/Care/AboutGeneralCare.aspx');
	                break;
				default:
					createPopUp(780, 477, true, this, 105, '/Service/Care/AboutDefault.aspx');
					break;
			}
			foundPopUp = true;
			break;
		case "linkmetalcare":
			createPopUp(780,477,true,this,105,'/Service/Care/AboutPreciousMetals.aspx');
			foundPopUp = true;
			break;
		case "linkgemstonecare":
			createPopUp(780,477,true,this,105,'/Service/Care/AboutGemstones.aspx');
			foundPopUp = true;
			break;
		case "linkwoodcare":
			createPopUp(780,477,true,this,105,'/Service/Care/AboutWood.aspx');
			foundPopUp = true;
			break;
		case "linkperettibio":
			createPopUp(780,477,true,this,105,'/About/Designers/AboutElsaPeretti.aspx');
			foundPopUp = true;
			break;
		case "linkpicassobio":
			createPopUp(780,477,true,this,105,'/About/Designers/AboutPalomaPicasso.aspx');
			foundPopUp = true;
			break;
		case "linkschlumbergerbio":
			createPopUp(780,477,true,this,105,'/About/Designers/AboutJeanSchlumberger.aspx');
			foundPopUp = true;
			break;
		case "linkgehrybio":
			createPopUp(780,477,true,this,105,'/About/Designers/AboutFrankGehry.aspx');
			foundPopUp = true;
			break;
		case "linkatd":
		    createBlueOverlay(860,548,true,this,59,'/Expertise/Diamond/Default.aspx');
			foundPopUp = true;
			break;
		case "linkatdbeauty":
			createPopUp(860,548,true,this,59,'/Expertise/Diamond/Brilliance/Default.aspx');
			foundPopUp = true;
			break;
		case "linkatdringsetting":
			createPopUp(860,548,true,this,59,'/Expertise/Diamond/Setting/Default.aspx');
			foundPopUp = true;
			break;
		case "linkatdcertification":
			createPopUp(860,548,true,this,59,'/Expertise/Diamond/Certification/Default.aspx');
			foundPopUp = true;
			break;
		case "linkatdhistory":
			createPopUp(860,548,true,this,59,'/Expertise/Diamond/History/Default.aspx');
			foundPopUp = true;
			break;
		case "linkatdglossary":
			createPopUp(860,548,true,this,59,'/Expertise/Diamond/Glossary/Default.aspx');
			foundPopUp = true;
			break;
		case "linkatdpricing":
			createPopUp(860,548,true,this,59,'/Expertise/Diamond/Pricing/Default.aspx');
			foundPopUp = true;
			break;
		case "linkatd7points":
			createPopUp(860,548,true,this,59,'/Expertise/Diamond/7_Points/Default.aspx');
			foundPopUp = true;
			break;
		case "linkgroomsguide4cs":
			createPopUp(860,548,true,this,59,'/Engagement/GroomsGuide/4Cs.aspx');
			foundPopUp = true;
			break;
		case "linkatdwaranty":
			createPopUp(860,548,true,this,59,'/Expertise/Diamond/Certification/Promise.aspx');
			foundPopUp = true;
			break;
		case "linkatdengravingcleaning":
			createPopUp(860,548,true,this,59,'/Expertise/Diamond/certification/engraving_and_cleaning.aspx');
			foundPopUp = true;
			break;

//Text Overlays
		case "c":
			createPopUp(860,548,true,this,59,'/Expertise/Diamond/Certification/Default.aspx');
			foundPopUp = true;
			break;

        case "linkprivacypolicy":
            if (typeof isMobilePopupOverlay != "undefined" && isMobilePopupOverlay == true) {
            	  createPopUp(300, 490, false, this, 105, '/Customer/Checkout/PrivacyPolicy.aspx');
            } else {
                createPopUp(400, 490, false, this, 105, '/Customer/Checkout/PrivacyPolicy.aspx');
            }
            foundPopUp = true;
            break;
           
		case "linkgemstonecareenhancement":
			createPopUp(780,500,false,this,105,'/Customer/Checkout/GemstoneCare.aspx');
			foundPopUp = true;
			break;
		 
        case "linkprop65":
        case "linkcreditcard":
        case "linkstoreconsultation":
        case "linkpaymentoptions":        
        case "linkhowtoshop":
        case "linkorderstatus":
        case "linkaboutengraving":
        case "linkbops":
        case "linkbops5thave":
	    case "linkbopssoho":
	    case "linkbopsukcanarywharf":
	    case "linkbopsukoldbond":
	    case "linkbopsukroyalexchange":
	    case "linkbopsuksloanesquare":
	    case "linkbopsukwestfield":
        case "linkcounterfeitwarning":
        case "linkbluebox":
        case "linkspecialevents":
        case "linkverifybyvisa":
        case "linkmastercode":  
		case "linkestorepoliciesguidelines":
	    case "linkestorewebsitepolicies":
	    case "linkcustomerservicehours":
						if (typeof isMobilePopupOverlay != "undefined" && isMobilePopupOverlay == true) {
							  createPopUp(300, 490, false, this, 105, '/Service/FaqOverlay.aspx?faqCode=' + popUpName.toLowerCase());
						} else {
                createPopUp(400, 490, false, this, 105, '/Service/FaqOverlay.aspx?faqCode=' + popUpName.toLowerCase());
            }
            //document.getElementById("divPopUp").style.left = "-5000px";
            foundPopUp = true;
            break;
        case "linkshippingratestimes":       
            if (typeof isMobilePopupOverlay != "undefined" && isMobilePopupOverlay == true) {
                createPopUp(300, 490, false, this, 105, '/Service/FaqOverlay.aspx?faqCode=' + popUpName.toLowerCase() + '&showBnr=true&redesign=false');
            } else {
                createPopUp(400, 490, false, this, 105, '/Service/FaqOverlay.aspx?faqCode=' + popUpName.toLowerCase() + '&showBnr=true&redesign=false');
            }
            //document.getElementById("divPopUp").style.left = "-5000px";
            foundPopUp = true;
            break;
        case "linkdeliveryoptions":
        case "linkshiptopobox":
            //linkdeliveryoptions, linkshiptopobox & linkshippingratestimes share the FAQ and it is stored with FAQCode linkshippingratestimes.            
            createPopUp(400, 490, false, this, 105, '../../Service/FaqOverlay.aspx?faqCode=' + 'linkshippingratestimes');
//            document.getElementById("divPopUp").style.left = "-5000px";
            foundPopUp = true;
            break;
        case "linkaboutgiftmessage":
            if (typeof isMobilePopupOverlay != "undefined" && isMobilePopupOverlay == true) {
                createPopUp(300, 50, false, this, 105, '/Service/FaqOverlay.aspx?faqCode=' + popUpName.toLowerCase()); 
            } else {
            	  createPopUp(400, 500, false, this, 105, '/Service/FaqOverlay.aspx?faqCode=' + popUpName.toLowerCase());
            }
//            document.getElementById("divPopUp").style.left = "-5000px";
            foundPopUp = true;
            break;
        case "linkaboutcod":
            createPopUp(400, 50, false, this, 105, '/Service/FaqOverlay.aspx?faqCode=cashondelivery');
            foundPopUp = true;
            break;
        case "linkaboutjpdeliverypreference":
            createPopUp(400, 50, false, this, 105, '/Service/FaqOverlay.aspx?faqCode=deliverypreference');
            foundPopUp = true;
            break; 
        
		case "linkscheduleconsultation":
			createPopUp(400,490,false,this,105,'/Registry/ScheduleConsult.aspx');
			foundPopUp = true;
			break;
		case "linkreturnpolicy":
		  if (typeof isMobilePopupOverlay != "undefined" && isMobilePopupOverlay == true) {
		  	  createPopUp(300,490,false,this,105,'/Customer/Checkout/AboutReturnPolicy.aspx');
		  } else {
			    createPopUp(400,490,false,this,105,'/Customer/Checkout/AboutReturnPolicy.aspx');
		  }
			//document.getElementById("divPopUp").style.left = "-5000px";
			foundPopUp = true;
			break;
		case "linktermsofuse":
		    switch (locale) {
	            case "ja-JP-EStr":
		            createPopUp(400, 490, false, this, 105, '/Service/FaqOverlay.aspx?faqCode=' + 'linkEstoreWebsitePolicies');
                    document.getElementById("divPopUp").style.left = "-5000px";
	                break;
				default:
					createPopUp(400,490,false,this,105,'/Customer/Checkout/AboutTermsOfUse.aspx');
					break;
			}
		
			foundPopUp = true;
			break;
		case "linkshoppingfaqs":
					createPopUp(400,490,false,this,105,'/Customer/Checkout/ShoppingFaq.aspx');
			foundPopUp = true;
			break;		
		
		case "linkspeaktodiamondexpert":
			createPopUp(400,490,false,this,105,'/Customer/Request/popup_expert.aspx');
			foundPopUp = true;
			break;
		case "linkscheduleconsult":
			  	if(top==self) { 
			     createPopUp(500,490,false,this,105,'/Customer/Request/PopUpScheduleConsult.aspx');	
				 foundPopUp = true;
				}
				else if (typeof(parent.divEmailPopupHolder) != "undefined") {
				    parent.document.getElementById("iframeMiniContent").style.width = "500px";
				    parent.document.getElementById("iframeMiniContent").style.height = "490px";
					parent.document.getElementById("divMiniPopUp").style.width = "500px";
					parent.document.getElementById("divMiniPopUp").style.marginLeft = "-390px";
					parent.document.getElementById("divMiniPopUp").style.left = "50%";
					window.location = "/Customer/Request/PopUpScheduleConsult.aspx";
				}
				else {
				    parent.document.getElementById("iframeContent").style.width = "500px";
				    parent.document.getElementById("iframeContent").style.height = "490px";
					parent.document.getElementById("divPopUp").style.width = "500px";
					parent.document.getElementById("divPopUp").style.marginLeft = "-305px";
					parent.document.getElementById("divPopUp").style.left = "50%";
					window.location = "/Customer/Request/PopUpScheduleConsult.aspx";
					 foundPopUp = false;
				}
			break;
		
		case "linkcreditcardvalidation":
			createPopUp(400,490,false,this,105,'/Customer/Checkout/AboutCardValidation.aspx');
			foundPopUp = true;
			break;


        case "getfaq":
            var omnicode = "";
            if (popupArguments[2] != "" && popupArguments[2] != null) {
                omnicode = "&hppromo=" + popupArguments[2];
            }
            createPopUp(400, 490, false, this, 105, '/Service/FaqOverlay.aspx?faq_id=' + popupArguments[1] + omnicode);
			document.getElementById("divPopUp").style.left = "-5000px";
			foundPopUp = true;
			break;

        case "getbluefaq":
			var omnicode ="";
            if (popupArguments[2] != "" && popupArguments[2] != null) {
                omnicode = "&hppromo=" + popupArguments[2];
            }
            createBlueOverlay(400, 490, true, this, 105, '/Service/FaqOverlay.aspx?faq_id=' + popupArguments[1] + omnicode, '', false);
            document.getElementById("divPopUp").style.left = "-5000px";
            foundPopUp = true;
            break;	
			
		case "linkemailmarketingspecialoffer":
			createPopUp(400,300,false,this,105,'/seasonal/ja-JP/marketing_modules/email_marketing/about.aspx');
			foundPopUp = true;
			break;
		case "linkaboutringsizes":
			createPopUp(400,490,false,this,105,'/Shopping/AboutRingSizes.aspx');
			foundPopUp = true;
			break;
        case "linkaboutglovesizes":
            createPopUp(400, 365, false, this, 105, '/Shopping/AboutGloveSizes.aspx');
            foundPopUp = true;
            break;
// Modules
		case "linkgehrymodule":
			createPopUp(860,548,true,this,54,'/Seasonal/'+localFolder+'/marketing_modules/FOG/index.aspx','e0e0e0',false);
			foundPopUp = true;
			break;
		case "linkgehrymovie":
			createPopUp(860,548,true,this,54,'/Seasonal/en-US/marketing_modules/FOG/select_video_size.aspx','e0e0e0',false);
			foundPopUp = true;
			break;
		case "linklargegehrymovie":
			createPopUp(786,548,true,this,54,'/Seasonal/'+localFolder+'/marketing_modules/FOG/FOGVideo_lg.aspx','e0e0e0',false);
			foundPopUp = true;
			break;
		case "linksmallgehrymovie":
			switch (locale){
				case "ja-JP":
					overlayHeight = 340;
					break;
				case "zh-CN":
					overlayHeight = 340;
					break;
				default:
					overlayHeight = 290;
					break;
			}
			createPopUp(370,overlayHeight,true,this,54,'/Seasonal/'+localFolder+'/marketing_modules/FOG/FOGVideo.aspx','e0e0e0',false);
			foundPopUp = true;
			break;
		case "linkoverlaygehrymodule":
			closePopUp();
			openMarketingPopUp("linkGehryModule");
			foundPopUp = true;
			break;
		case "linkoverlaygehrymovie":
			closePopUp();
			openMarketingPopUp("linkLargeGehryMovie");
			foundPopUp = true;
			break;
		case "linksimply":
			createPopUp(540,500,true,this,105,'/Seasonal/Modules/Simply/default.aspx');
			foundPopUp = true;
			break;
		case "linkt57":
			createPopUp(768,415,true,this,59,'/Expertise/T57/default.aspx','565656');
			foundPopUp = true;
			break;
		case "linktiffanymarkmovie":
			createPopUp(574,500,true,this,59,'/Local/en-US/flash/expertise/TiffanyMark/Video.aspx','',false);
			foundPopUp = true;
			break;
		case "linkwatchheritage":
			createPopUp(768,424,true,this,59,'/Local/'+localFolder+'/flash/expertise/TiffanyMark/Heritage.aspx');
			foundPopUp = true;
			break;
		case "linkwatchpromise":
			createPopUp(768,424,true,this,59,'/Local/'+localFolder+'/flash/expertise/TiffanyMark/Promise.aspx');
			foundPopUp = true;
			break;
		case "linkwatchdesign":
			createPopUp(768,424,true,this,59,'/Local/'+localFolder+'/flash/expertise/TiffanyMark/DesignInspiration.aspx');
			foundPopUp = true;
			break;
		case "linkemailmarketingmodule":
			createPopUp(400,300,false,this,59,'/Customer/Request/ProcessEmailMarketingRequest.aspx');
			foundPopUp = true;
			break;
		case "linkcelebrationrings":
			celebrationRings();
			break;	
		case "linkcrstacks":
			crStacks();
			break;
			
		case "linkcarvedhearts":
			createPopUp(660,614,true,this,54,'/seasonal/en-us/marketing_modules/carved_hearts/Default.aspx');
			foundPopUp = true;
			break;	
			
		case "linkemailsignup":
			setTimeout("linkEmailMarketing()", 1000);
			foundPopUp = true;
			break;	
		case "linkemailsignuppromo":
			setTimeout("subscribeFooter2()", 1000);
			foundPopUp = true;
			break;	
		case "linkgiftcardbalance":
			isParentSecure = BrowserUtils.getIsSecure();
			createPopUp(400,490,false,this,105,popupArguments[1] + '/Customer/Request/GiftCardBalance.aspx?ps=' + isParentSecure);			
			foundPopUp = true;
			break;
		case "linkaboutgiftcards":
			isParentSecure = BrowserUtils.getIsSecure();
			createPopUp(400,490,false,this,105,'/Service/AboutGiftCards.aspx?ps=' + isParentSecure);
			foundPopUp = true;
			break;
		case "linkgiftcardterms":
			isParentSecure = BrowserUtils.getIsSecure();
			createPopUp(400,490,false,this,105,'/Service/AboutGiftCardTerms.aspx?ps=' + isParentSecure);
			foundPopUp = true;
			break;
		case "linkfogqrcode":
			if (typeof divPopupHolder != "undefined") {closePopUp();}
			createPopUp(408,308,false,this,105,'/seasonal/ja-jp/marketing_modules/fog/qrcode.aspx');
			foundPopUp = true;
			break;
		case "linkemailthispage":			
			createEmailPopUp('/Customer/Request/' + popupArguments[1],1,400,360,105,275,'ffffff','e0e0e0',5);
			foundPopUp = true;
			break;
		case "linkemailhint":
		    //createEmailPopUp(popupArguments[1], 1, 950, 620, 20, 0, 'ffffff', 'e0e0e0', 5);
		    createBlueOverlay(950, 620, true, this, 80, popupArguments[1], 'e0e0e0', true, 5);
			foundPopUp = true;
			break;
		case "linkemailcustomerservice":
			createPopUp(400,400,false,this,105,'/Customer/Request/EmailCustSvr.aspx');
			break;
		case "linkengagementemailthispage":
			createPopUp(400,400,false,this,105,'/Customer/Request/EmailThisPage.aspx?engagementSku=' + popupArguments[1]);
			foundPopUp = true;
			break;				
		case "linkaboutquickorder":
			createPopUp(400,490,false,this,105,'/Catalogues/AboutQuickOrder.aspx');
			foundPopUp = true;
			break;				
		case "linkemailwishlist":
			var session = "";
			if (popupArguments[2] != "" && popupArguments[2] != null)
			{
				session = "&mysid2=" + popupArguments[2];
			}
			createPopUp(400,400,false,this,105,'/Customer/wishlist/EmailWishList.aspx?idList=' + popupArguments[1] + session);
			foundPopUp = true;
			break;
        case "linkbejewelled":
            var omnicode = "";
			switch (locale){	
			  case "ja-JP":
	  			localFolder="ja-JP";
				break;
			  default:
	  			localFolder="Intl";
	  			omnicode = "?hppromo=" + popupArguments[1];
				break;
			}
			createPopUp(820,471,true,this,105,'/Seasonal/'+localFolder+'/marketing_modules/bejewelled/default.aspx' + omnicode);
			foundPopUp = true;
			break;
		case "linktiffanyengraving":
		    createBlueOverlay(780, 475, true, this, 105, '/Shopping/AboutEngraving.aspx', '', false);
			foundPopUp = true;
			break;	
		case "linktrophies":
		    createPopUp(780, 475, true, this, 105, '/Shopping/AboutTrophies.aspx');
			foundPopUp = true;
			break;	
		case "linkabout37wallstreet":
		    createPopUp(780, 480, true, this, 105, '/Seasonal/en-US/marketing_modules/wall_street_bops/v1/About37WallStreet.aspx');
			foundPopUp = true;
			break;	
		case "linkinstorepickup":
		    createPopUp(780, 479, true, this, 105, '/Seasonal/en-US/marketing_modules/wall_street_bops/v4/InStorePickup.aspx');
			foundPopUp = true;
			break;		
		case "linkcrstorytop":
			celebrationStories('storytop');
			break;
		case "linkcrcelebring01":
			celebrationStories('celebring01');
			break;	
		case "linkcrcelebring02":
			celebrationStories('celebring02');
			break;
		case "linkcrcelebring03":
			celebrationStories('celebring03');
			break;
		case "linkcrcelebring04":
			celebrationStories('celebring04');
			break;
		case "linkcrcelebring05":
			celebrationStories('celebring05');
			break;
		case "linkcrcelebring06":
			celebrationStories('celebring06');
			break;
		case "linkcrcelebring07":
			celebrationStories('celebring07');
			break;
		case "linkcrcelebring08":
			celebrationStories('celebring08');
			break;
		case "linkholiday":
			createPopUp(744,532,true,this,105,'/Seasonal/Holiday2007/Video/HolidayVideo.aspx');
			foundPopUp = true;
			break;	
		case "link2008springvideo":
			createPopUp(744,532,true,this,105,'/Seasonal/Videos/2008Spring/Default.aspx');
			foundPopUp = true;
			break;	
		case "linkholidaymakingof":
			createPopUp(744,532,true,this,105,'/Seasonal/Holiday2007/Video/HolidayMakingOfVideo.aspx');
			foundPopUp = true;
			break;	
		case "linkskatesomerset":
		    var omnicode = "";
		    if (popupArguments[1]){
		        omnicode = "?hppromo=" + popupArguments[1];
		        }
		    createBlueOverlay(912, 592, true, this, 84, '/Seasonal/en-GB/SkateSommerset/Default.aspx' + omnicode, '', false);
			foundPopUp = true;
			break;	
		case "linkskatesomersetvideo":
		    var omnicode = "";
		    if (popupArguments[1]){
		        omnicode = "?hppromo=" + popupArguments[1];
		        }
		    createPopUp(744, 532, true, this, 105, '/Seasonal/en-GB/SkateSommerset/VideoLayer.aspx' + omnicode);
			foundPopUp = true;
			break;
		case "linkskatesomersetvideo09":
		    var omnicode = "";
		    if (popupArguments[1]){
		        omnicode = "?hppromo=" + popupArguments[1];
		        }
		    createPopUp(744, 532, true, this, 105, '/Seasonal/en-GB/SkateSommerset/VideoLayer09.aspx' + omnicode);
			foundPopUp = true;
			break;
		case "linkskatesomersetvideo10":
		    var omnicode = "";
		    if (popupArguments[1]){
		        omnicode = "?hppromo=" + popupArguments[1];
		        }
		    createPopUp(744, 532, true, this, 105, '/Seasonal/en-GB/SkateSommerset/VideoLayer10.aspx' + omnicode);
			foundPopUp = true;
			break;
        case "linkskatesomersetvideo11":
            var omnicode = "";
            if (popupArguments[1]) {
                omnicode = "?hppromo=" + popupArguments[1];
            }
            createBlueOverlay(910, 627, true, this, 58, '/Seasonal/en-GB/SkateSommerset/VideoLayer11.aspx' + omnicode, '', false);
            foundPopUp = true;
            break;
		case "linkholidayqr":
			createPopUp(312,291,false,this,105,'/Seasonal/Holiday2007/Wallpapers/qrCode.aspx');
			foundPopUp = true;
			break;
		case "linkvalentineqr":
			createPopUp(402,318,false,this,105,'/Seasonal/Valentine2008/qrCode/qrCode.aspx');
			foundPopUp = true;
			break;
		case "linkheathrowstore":
			createPopUp(779,477,true,this,105,'/Seasonal/en-GB/HeathrowStore/Default.aspx?hppromo=' + popupArguments[1]);
			foundPopUp = true;
			break;
		case "linkpatekphilippegrandexpo":
		    var omnicode = "";
		    if (popupArguments[1]){
		        omnicode = "?hppromo=" + popupArguments[1];
		        }
			createPopUp(783,481,true,this,105,'/Seasonal/en-US/marketing_modules/PatekPhilippe/GrandExpo.aspx' + omnicode);
			foundPopUp = true;
			break;
		case "linkpatekphilippesalonopening":
		    var omnicode = "";
		    if (popupArguments[1]){
		        omnicode = "?hppromo=" + popupArguments[1];
		        }
			createPopUp(783,482,true,this,105,'/Seasonal/en-US/marketing_modules/PatekPhilippe/AboutTheSalon.aspx' + omnicode);
			foundPopUp = true;
			break;
		case "linkpatekphilippeexclusive":
		    var omnicode = "";
		    if (popupArguments[1]){
		        omnicode = "?hppromo=" + popupArguments[1];
		        }
			createPopUp(861,550,true,this,105,'/Seasonal/en-US/marketing_modules/PatekPhilippe/Exclusive.aspx' + omnicode);
			foundPopUp = true;
			break;
		case "linkchainclaspdemo":
			createPopUp(480,467,false,this,105,'/Seasonal/en-US/marketing_modules/ChainClaspDemo/Default.aspx');
			foundPopUp = true;
			break;
		case "linkjpcharmstories":
		    var omnicode = "";
		    if (popupArguments[1]){
		        omnicode = "?hppromo=" + popupArguments[1];
		        }
			createPopUp(875,552,true,this,105,'/Seasonal/ja-JP/marketing_modules/charms_stories/Default.aspx' + omnicode);
			foundPopUp = true;
			break;
		
		case "linksingaporestore":
		    var omnicode = "";
		    if (popupArguments[1]){
		        omnicode = "?hppromo=" + popupArguments[1];
		        }
			createPopUp(910,471,true,this,105,'/Seasonal/Intl/marketing_modules/SingaporeStore/Default.aspx' + omnicode);
			foundPopUp = true;
			break;
		case "linkglamour":
			createPopUp(768,565,true,this,95,'/seasonal/zh-CN/marketing_modules/glamour/default.aspx');
			//createTestChrome(768,20,75,0,'#E2E0DB');
			foundPopUp = true;
			break;			
		case "linksdr":
			createPopUp(862,550,true,this,59,'/Engagement/LearnMore/SDR.aspx','',false);
			foundPopUp = true;
			break;
		case "linklucida":
			createPopUp(862,550,true,this,59,'/Engagement/LearnMore/Lucida.aspx','',false);
			foundPopUp = true;
			break;
		case "linketoile":
			createPopUp(862,550,true,this,59,'/Engagement/LearnMore/Etoile.aspx','',false);
			foundPopUp = true;
			break;
		case "linklegacy":
			createPopUp(862,550,true,this,59,'/Engagement/LearnMore/Legacy.aspx','',false);
			foundPopUp = true;
			break;
		case "linknovo":
			createPopUp(862,550,true,this,59,'/Engagement/LearnMore/Novo.aspx','',false);
			foundPopUp = true;
			break;
		case "linkhonten":
			createPopUp(744,532,true,this,105,'/Seasonal/ja-JP/marketing_modules/Honten/VideoLayer.aspx');
			foundPopUp = true;
			break;
		case "linkbridewars":
		    var omnicode = "";
		    if (popupArguments[1]){
		        omnicode = "?hppromo=" + popupArguments[1];
		        }
			createPopUp(744,532,true,this,105,'/Seasonal/en-US/marketing_modules/BrideWars/Default.aspx' + omnicode);
			foundPopUp = true;
			break;
		case "linkjpbezet":
		    var omnicode = "";
		    if (popupArguments[1]){
		        omnicode = "?hppromo=" + popupArguments[1];
		        }
			createPopUp(860,523,true,this,105,'/Seasonal/ja-JP/marketing_modules/Bezet/Default.aspx' + omnicode);
			foundPopUp = true;
			break;
        /*
		case "linklocketphotosizer":
			var omnicode =""
		    if (popupArguments[1]){
		        omnicode = "?hppromo=" + popupArguments[1];
		        }
			createPopUp(784,546,true,this,105,'/Seasonal/Modules/LocketPhotoSizer/Default.aspx' + omnicode);
			foundPopUp = true;
			break;
        */
		case "linkkeysvideo":
		    var omnicode = "";
		    if (popupArguments[1]){
		        omnicode = "?hppromo=" + popupArguments[1];
		        }
			createPopUp(640,616,true,this,58,'/Seasonal/Videos/Keys/Default.aspx' + omnicode);
			foundPopUp = true;
			break;
		case "linkperettibritishmuseum":
		    var omnicode = "";
		    if (popupArguments[1]){
		        omnicode = "?hppromo=" + popupArguments[1];
		        }
			createPopUp(833,516,true,this,58,'/Seasonal/en-GB/PerettiBritishMuseum/Default.aspx' + omnicode);
			foundPopUp = true;
			break;
		case "linkcantonstore":
		    var omnicode = "";
		    if (popupArguments[1]){
		        omnicode = "?hppromo=" + popupArguments[1];
		        }
			createPopUp(835,560,true,this,68,'/Seasonal/zh-CN/marketing_modules/CantonStore/Default.aspx' + omnicode);
			foundPopUp = true;
			break;
		case "linkhkplazastore":
		    var omnicode = "";
		    if (popupArguments[1]){
		        omnicode = "?hppromo=" + popupArguments[1];
		        }
			createPopUp(835,560,true,this,68,'/Seasonal/zh-CN/marketing_modules/HKPlazaStore/Default.aspx' + omnicode);
			foundPopUp = true;
			break;
		case "linkfedexcuptrophyvideo":
		    var omnicode = "";
		    if (popupArguments[1]){
		        omnicode = "?hppromo=" + popupArguments[1];
		        }
			createPopUp(680,616,true,this,58,'/Seasonal/Videos/FedExCupTrophy/Default.aspx' + omnicode);
			foundPopUp = true;
			break;
		case "linktfbbenefits":
		    var omnicode = "";
		    if (popupArguments[1]){
		        omnicode = "?hppromo=" + popupArguments[1];
		        }
			createPopUp(784,478,true,this,118,'/Seasonal/en-US/marketing_modules/TFB/Default.aspx' + omnicode);
			foundPopUp = true;
			break;
		case "linksharapovagehry":
		    var omnicode = "";
		    if (popupArguments[1]){
		        omnicode = "?hppromo=" + popupArguments[1];
		        }
			createPopUp(883,504,true,this,105,'/Seasonal/Modules/SharapovaGehry/Default.aspx' + omnicode);
			foundPopUp = true;
			break;			
		case "linkgivevoicetoyourheartvideo":
		    var omnicode = "";
		    if (popupArguments[1]){
		        omnicode = "?hppromo=" + popupArguments[1];
		        }
		    createPopUp(744, 532, true, this, 105, '/Seasonal/Modules/Holiday2009/Video/Default.aspx' + omnicode);
			foundPopUp = true;
			break;	
		case "linkyellowdiamondsjp":
		    var omnicode = "";
		    if (popupArguments[1]){
		        omnicode = "?hppromo=" + popupArguments[1];
		        }
		    createPopUp(349, 294, true, this, 105, '/Seasonal/Modules/YellowDiamonds/Overlay/Default.aspx' + omnicode);
			foundPopUp = true;
			break;
        case "linkyellowdiamondsvideo":
            var omnicode = "";
            if (popupArguments[1]) {
                omnicode = "?hppromo=" + popupArguments[1];
                }
            createBlueOverlay(910, 627, true, this, 58, '/Seasonal/Modules/YellowDiamonds/Video/Default.aspx' + omnicode, '', false);
                foundPopUp = true;
            break;
        case "linkyellowdiamondspartyvideo":
            var omnicode = "";
           	if (popupArguments[1]) {
           		omnicode = "?hppromo=" + popupArguments[1];
           	}
           	createBlueOverlay(860, 550, true, this, 58, '/Seasonal/Modules/YellowDiamonds/PartyVideo/Default.aspx' + omnicode, '', false);
           	foundPopUp = true;
           	break;
        case "linkyellowdiamondswinslet":
            var omnicode = "";
           	if (popupArguments[1]) {
           		omnicode = "?hppromo=" + popupArguments[1];
           	}
           	createBlueOverlay(412, 496, true, this, 58, '/Seasonal/Modules/YellowDiamonds/Winslet/Default.aspx' + omnicode, '', false);
           	foundPopUp = true;
           	break;
        case "linkyellowdiamondsabout":
            var omnicode = "";
           	if (popupArguments[1]) {
           		omnicode = "?hppromo=" + popupArguments[1];
           	}
           	createBlueOverlay(862, 548, true, this, 58, '/Seasonal/Modules/YellowDiamonds/About/Default.aspx' + omnicode, '', false);
           	foundPopUp = true;
           	break;
        
        case "linkyellowdiamondspartyphoto":
            var omnicode = "";
		    if (popupArguments[1]){
		        omnicode = "?hppromo=" + popupArguments[1];
		        }
			createBlueOverlay(833,558,true,this,68,'/Seasonal/Modules/YellowDiamonds/PartyPhotos/Default.aspx' + omnicode, '', false);
			foundPopUp = true;
			break;
		case "linkiphoneengagementpromo":
		    var omnicode = "";
			var topPosition = 200;
			if (isIPhone() == true || isIPad() == true)
			{
				var orientation = window.orientation;
				if (orientation == 90 || orientation == -90) 
				{
					topPosition = 50;
				}

				if (popupArguments[1])
				{
					omnicode = "?hppromo=" + popupArguments[1];
				}
				window.onorientationchange = function()
				{
					orientation = window.orientation;
					switch (orientation)
					{
						case 0:
							document.getElementById("divPopUp").style.top = "200px";
							break;
						case 90:
						case -90:
							document.getElementById("divPopUp").style.top = "50px";
							break;
					}
				}
			}

			switch (locale)
			{
				case "ja-JP":
				    createBlueOverlay(760, 539, true, this, topPosition, '/Seasonal/Custom/iPhoneApp/EngagementApp/DefaultJP.aspx' + omnicode, 'dedee0', true, 14,'divWhiteMask');
					break;
				case "zh-CN":
				case "cn-CN":
				case "zh-Hant":
				    createBlueOverlay(760, 539, true, this, topPosition, '/Seasonal/Custom/iPhoneApp/EngagementApp/DefaultCN.aspx' + omnicode, 'dedee0', true, 14,'divWhiteMask');
					break;
				default:
				    createBlueOverlay(739, 614, true, this, topPosition, '/Seasonal/Custom/iPhoneApp/EngagementApp/Default.aspx' + omnicode, 'dedee0', true, 14,'divWhiteMask');
					break;
			}
			foundPopUp = true;
			break;
		case "linkengagementapppreview":
		    var omnicode = "";
           	if (popupArguments[1]) {
           		omnicode = "?hppromo=" + popupArguments[1];
           	}
           	createBlueOverlay(860, 550, true, this, 58, '/Seasonal/Custom/iPhoneApp/EngagementApp/PreviewTheApp.aspx' + omnicode, '', false);
           	foundPopUp = true;
           	break;
		case "linkleatherretailstores":
		    var omnicode = "";
           	if (popupArguments[1]) {
           		omnicode = "?hppromo=" + popupArguments[1];
           	}
           	createBlueOverlay(862, 548, true, this, 58, '/Seasonal/Modules/Leather/RetailStores/Default.aspx' + omnicode, '', false);
           	foundPopUp = true;
           	break;
        case "linkstatementvideo": 

            var omnicode = "";
            if (popupArguments[1]) {
                omnicode = "?hppromo=" + popupArguments[1];
                }
            createBlueOverlay(960, 664, true, this, 55, '/Seasonal/Videos/Statement/Default.aspx' + omnicode, '', false);
                foundPopUp = true;
                break;
		case "linksomestyleislegendaryvideo":
		    var omnicode = "";
                if (popupArguments[1]) {
                    omnicode = "?hppromo=" + popupArguments[1];
                }
                createBlueOverlay(860, 550, true, this, 58, '/Seasonal/Videos/SomeStyleIsLegendary/Default.aspx' + omnicode, '', false);
                foundPopUp = true;
                break;
            case "linkleatherabout":		        
			//var omnicode = ""
			//if (popupArguments[1]) {
				//	omnicode = "?hppromo=" + popupArguments[1];
				//}
				//createBlueOverlay(922, 603, true, this, 58, '/Seasonal/Modules/Leather/About/Default.aspx?initState=/0' + omnicode, '', false)
                //foundPopUp = true;
				
				break;
		case "linkleatheraboutmaterials":
		    var omnicode = "";
			if (popupArguments[1]) {
					omnicode = "?hppromo=" + popupArguments[1];
				}
			createBlueOverlay(922, 603, true, this, 58, '/Seasonal/modules/Leather/About/default.aspx?initState=/1' + omnicode, '', false);
				foundPopUp = true;
				break;
		case "linkleatheraboutcraft":
		    var omnicode = "";
			if (popupArguments[1]) {
					omnicode = "?hppromo=" + popupArguments[1];
				}
			createBlueOverlay(922, 603, true, this, 58, '/Seasonal/modules/Leather/About/default.aspx?initState=/2' + omnicode, '', false);
				foundPopUp = true;
				break;
		case "linkleatheraboutdesigners":
		    var omnicode = "";
			if (popupArguments[1]) {
					omnicode = "?hppromo=" + popupArguments[1];
				}
			createBlueOverlay(922, 603, true, this, 58, '/Seasonal/modules/Leather/About/default.aspx?initState=/3' + omnicode, '', false);
				foundPopUp = true;
				break;
        case "linkthetiffanystoryvideo":
            var omnicode = "";
            if (popupArguments[1]) {
                omnicode = "?hppromo=" + popupArguments[1];
            }
            createBlueOverlay(910, 627, true, this, 58, '/Seasonal/Videos/TheTiffanyStory/Default.aspx' + omnicode, '', false);
            foundPopUp = true;
            break;
	    case "linkholiday2010video":
	        var omnicode = "";
                if (popupArguments[1]) {
                    omnicode = "?hppromo=" + popupArguments[1];
                }
                createBlueOverlay(910, 627, true, this, 58, '/Seasonal/Videos/Holiday2010/Default.aspx' + omnicode, '', false);
                foundPopUp = true;
                break;

		case "linkmilanopening":
		    var omnicode = "";
                if (popupArguments[1]) {
                    omnicode = "?hppromo=" + popupArguments[1];
                }
                createBlueOverlay(919, 575, true, this, 58, '/Seasonal/it-IT/MilanOpening/Default.aspx' + omnicode, '', false);
                foundPopUp = true;
                break;		
        case "linkchinaworldstore":
            var omnicode = "";
            if (popupArguments[1]) {
                omnicode = "?hppromo=" + popupArguments[1];
            }
            createBlueOverlay(910, 627, true, this, 58, '/Seasonal/zh-CN/marketing_modules/ChinaWorldStore/Default.aspx' + omnicode, '', false);
            foundPopUp = true;
            break;
        case "linkspring2011video":
            var omnicode = "";
            if (popupArguments[1]) {
                omnicode = "?hppromo=" + popupArguments[1];
            }
            createBlueOverlay(910, 627, true, this, 58, '/Seasonal/Videos/Spring2011/Default.aspx' + omnicode, '', false);
            foundPopUp = true;
            break;
        case "linkfall2011video":
            var omnicode = "";
            if (popupArguments[1]) {
                omnicode = "?hppromo=" + popupArguments[1];
            }
            createBlueOverlay(910, 627, true, this, 58, '/Seasonal/Videos/Fall2011/Default.aspx' + omnicode, '', false);
            foundPopUp = true;
            break;
        case "linkholiday2011video":
            var omnicode = "";
            if (popupArguments[1]) {
                omnicode = "?hppromo=" + popupArguments[1];
            }
            createBlueOverlay(910, 627, true, this, 58, '/Seasonal/Videos/Holiday2011/Default.aspx' + omnicode, '', false);
            foundPopUp = true;
            break;
        case "linkrubedovideo":
            var omnicode = "";
            if (popupArguments[1]) {
                omnicode = "?hppromo=" + popupArguments[1];
            }
            createBlueOverlay(910, 627, true, this, 58, '/Seasonal/Videos/Rubedo/Default.aspx' + omnicode, '', false);
            foundPopUp = true;
            break;
        case "linkperettivideo":
            var omnicode = "";
            if (popupArguments[1]) {
                omnicode = "?hppromo=" + popupArguments[1];
            }
            createBlueOverlay(910, 627, true, this, 58, '/Seasonal/Videos/Peretti/Default.aspx' + omnicode, '', false);
            foundPopUp = true;
            break;
        case "linkcsrvideo":
            var omnicode = "";
            if (popupArguments[1]) {
                omnicode = "?hppromo=" + popupArguments[1];
            }
            createBlueOverlay(910, 627, true, this, 58, '/Seasonal/Videos/CSR/Default.aspx' + omnicode, '', false);
            foundPopUp = true;
            break;
        case "linkdiamondvideo":
            var omnicode = "";
            if (popupArguments[1]) {
                omnicode = "?hppromo=" + popupArguments[1];
            }
            createBlueOverlay(910, 627, true, this, 58, '/Seasonal/Videos/TiffanyDiamond/Default.aspx', '', false);
            foundPopUp = true;
            break;
	case "linkjpbridalfair":
	    var omnicode = "";
            if (popupArguments[1]) {
                omnicode = "?hppromo=" + popupArguments[1];
            }
	    createBlueOverlay(750,384,true,this,157,'/Seasonal/ja-JP/marketing_modules/bridalfair/bridalFairOverlay.aspx' + omnicode, '', false);
	    foundPopUp = true;
	    break;
	    
	//Re added this case for bug id: 724
        case "linkitradeemailthispage":
            //Added for Email popup from itrade
            createEmailPopUp('/Trade/Customer/Request/' + popupArguments[1], 1, 400, 360, 105, 275, 'ffffff', 'e0e0e0', 5);
            foundPopUp = true;
            break;

        //for item demand
        case "linkitradeitemdemandpage":            
            createEmailPopUp('/shopping/' + popupArguments[1], 1, 400, 360, 105, 275, 'ffffff', 'e0e0e0', 5);
            foundPopUp = true;
            break;

        case "linknewsarticle":
            var omnicode = "";
            if (popupArguments[2] != "" && popupArguments[2] != null) {
                omnicode = "&hppromo=" + popupArguments[2];
            }
            createBlueOverlay(910, 627, true, this, 58, '/About/News/Article.aspx?id=' + popupArguments[1] + omnicode, '', false);
            foundPopUp = true;
            break;

        case "linkwmltconfirm":
            var omnicode = "";
            if (popupArguments[1]) {
                omnicode = "?id=" + popupArguments[1];
            }
            createBlueOverlay(498, 372, true, this, 109, '/Seasonal/Modules/WhatMakesLoveTrue/Confirm.aspx' + omnicode, '', false);
            foundPopUp = true;
            break;
        case "linkengravingfairjp":
            var omnicode = "";
            if (popupArguments[1]) {
                omnicode = "?hppromo=" + popupArguments[1];
            }
            createBlueOverlay(902, 624, true, this, 58, "/Seasonal/ja-JP/marketing_modules/engravingfair/engravingFairJP.aspx" + omnicode, '', false);
            foundPopUp = true;
            break;
        case "linkstorereopeningau":
            var omnicode = "";
            if (popupArguments[1]) {
                omnicode = "?hppromo=" + popupArguments[1];
            }
            createBlueOverlay(730, 481, true, this, 58, "/Seasonal/en-AU/storeReOpening/StoreReOpening.aspx" + omnicode, '', false);
            foundPopUp = true;
            break;
	}
	return foundPopUp;
}

function continueToWMLT() {
    //alert("test");

    window.open("http://www.whatmakeslovetrue.com/");
    parent.closePopUp();

}

function createTestChrome(pwidth,pheight,ptop,pBorderWidth,borderColor) {
	divPopupChrome = document.createElement("div");
	document.body.insertBefore(divPopupChrome, document.body.firstChild);
	divPopupChrome.id = "divPopupChrome";
	divPopupChrome.className = "divPopup";
	divPopupChrome.style.position = "absolute";
	divPopupChrome.style.width = pwidth +"px";
	divPopupChrome.style.marginLeft = Math.round((pwidth+(pBorderWidth*2))/2)*-1 + "px";
	divPopupChrome.style.left = "50%";
	divPopupChrome.style.top = ptop +"px";
	divPopupChrome.style.borderWidth = pBorderWidth +"px";
	divPopupChrome.style.borderColor = borderColor;
	divPopupChrome.style.borderStyle ="solid";
	divPopupChrome.style.zIndex ="999";
	txtPopUpChromeContent = '<div><div style="float:left"><a href="#">Shop</a></div><div style="float:right"><a href="#">Close</a></div></div>';
	divPopupChrome.innerHTML = txtPopUpChromeContent;
}

function initPopoverHistory()
{
	if (typeof(StoreLocationsModel) != "undefined" && typeof(LocationsURLFactory != "undefined"))
	{
		HistoryManager.getInstance().initHistory(LocationsURLFactory.convertStateToHash(StoreLocationsModel.getInstance().getStateSnapshot()));
	}
    else 
    {
	    if (typeof ProductModel != "undefined") {
	        HistoryManager.getInstance().initHistory(URLFactory.convertStateToHash(ProductModel.getInstance().getStateSnapshot()));
	    }
	}
}
if (typeof(BrowserUtils) != "undefined")
{
	if (typeof(HistoryManager) != "undefined") {
		$(document).ready(function () {
			initPopoverHistory();
		});
	}
}

// The functions below are just to keep pages from breaking. The preferred way now to call a popup is to use
// openMarketingPopUp("popupName");
// This will allow popups to integrate with history management, and will allow them to be triggered through query string parameters.
// We should migrate pages away from the functions below, and remove each function once calling pages are migrated.
function linkTiffanyGold() {openMarketingPopUp("linkTiffanyGold");}
function linkTiffanySilver() {openMarketingPopUp("linkTiffanySilver");}
function linkTiffanyPlatinum() {openMarketingPopUp("linkTiffanyPlatinum");}
function linkHistoryTimeline() {openMarketingPopUp("linkHistoryTimeline");}
function linkJewelryCare() {openMarketingPopUp("linkJewelryCare");}
function linkMetalCare() {openMarketingPopUp("linkMetalCare");}
function linkGemstoneCare() {openMarketingPopUp("linkGemstoneCare");}
function linkWoodCare() {openMarketingPopUp("linkWoodCare");}
function linkPerettiBio() {openMarketingPopUp("linkPerettiBio");}
function linkPicassoBio() {openMarketingPopUp("linkPicassoBio");}
function linkSchlumbergerBio() {openMarketingPopUp("linkSchlumbergerBio");}
function linkGehryBio() {openMarketingPopUp("linkGehryBio");}
function linkATD() {openMarketingPopUp("linkATD");}
function linkAtdBeauty() {openMarketingPopUp("linkAtdBeauty");}
function linkAtdRingSetting() {openMarketingPopUp("linkAtdRingSetting");} 
function linkAtdCertification() {openMarketingPopUp("linkAtdCertification");}
function linkAtdHistory() {openMarketingPopUp("linkAtdHistory");}
function linkAtdGlossary() {openMarketingPopUp("linkAtdGlossary");}
function linkAtdPricing() {openMarketingPopUp("linkAtdPricing");}
function linkAtd7Points() {openMarketingPopUp("linkAtd7Points");}
function linkGroomsGuide4Cs() {openMarketingPopUp("linkGroomsGuide4Cs");}
function linkATDWaranty(){openMarketingPopUp("linkATDWaranty");}
function linkATDPricing(){openMarketingPopUp("linkATDPricing");}
function linkATDEngravingCleaning(){openMarketingPopUp("linkATDEngravingCleaning");}
//Text Overlays
function c(){openMarketingPopUp("c");}
function linkPrivacyPolicy() {openMarketingPopUp("linkPrivacyPolicy");}
function linkProp65() {openMarketingPopUp("linkProp65");}
function linkGemstoneCareEnhancement() {openMarketingPopUp("linkGemstoneCareEnhancement");}
function linkShippingRatesTimes() {openMarketingPopUp("linkShippingRatesTimes");}
function linkCreditCard() {openMarketingPopUp("linkCreditCard");}
function linkStoreConsultation() {openMarketingPopUp("linkStoreConsultation");}
function linkScheduleConsultation() {openMarketingPopUp("linkScheduleConsultation");}
function linkReturnPolicy() {openMarketingPopUp("linkReturnPolicy");}
function linkTermsOfUse() {openMarketingPopUp("linkTermsOfUse");}
function linkShoppingFAQs() {openMarketingPopUp("linkShoppingFAQs");}
function linkHowToShop() {openMarketingPopUp("linkHowToShop");}
function linkPaymentOptions() {openMarketingPopUp("linkPaymentOptions");}
function linkDeliveryOptions() {openMarketingPopUp("linkDeliveryOptions");}
function linkShipToPOBox() {openMarketingPopUp("linkShipToPOBox");}
function linkSpeakToDiamondExpert() { openMarketingPopUp("linkSpeakToDiamondExpert"); GATrackItemActivity('linkSpeakToDiamondExpert'); }
function linkScheduleConsult() {openMarketingPopUp("linkScheduleConsult");}
function linkAboutGiftMessage() {openMarketingPopUp("linkAboutGiftMessage");}
function linkOrderStatus() {openMarketingPopUp("linkOrderStatus");}
function linkAboutEngraving() {openMarketingPopUp("linkAboutEngraving");}
function linkBOPS() {openMarketingPopUp("linkBOPS");}
function linkBOPS5thAve() { openMarketingPopUp("linkBOPS5thAve"); }
function linkBOPSSoHo() { openMarketingPopUp("linkBOPSSoHo"); }
function linkBOPSUKCanaryWharf() { openMarketingPopUp("linkBOPSUKCanaryWharf"); }
function linkBOPSUKOldBond() { openMarketingPopUp("linkBOPSUKOldBond"); }
function linkBOPSUKRoyalExchange() { openMarketingPopUp("linkBOPSUKRoyalExchange"); }
function linkBOPSUKSloaneSquare() { openMarketingPopUp("linkBOPSUKSloaneSquare"); }
function linkBOPSUKWestfield() { openMarketingPopUp("linkBOPSUKWestfield"); }
function linkCounterfeitWarning() { openMarketingPopUp("linkCounterfeitWarning"); }
function linkCreditCardValidation() {openMarketingPopUp("linkCreditCardValidation");}
function linkBlueBox() {openMarketingPopUp("linkBlueBox");}
function linkSpecialEvents() {openMarketingPopUp("linkSpecialEvents");}

function getFAQ(faqId, omnid) { openMarketingPopUp("getFAQ", faqId, omnid); }
function getBlueFAQ(faqId, omnid) { openMarketingPopUp("getBlueFAQ", faqId, omnid); }
function linkEmailMarketingSpecialOffer() {openMarketingPopUp("linkEmailMarketingSpecialOffer");}
function linkAboutRingSizes() {openMarketingPopUp("linkAboutRingSizes");}
function linkHolidayQr() {openMarketingPopUp("linkHolidayQr");}
function linkValentineQr() { openMarketingPopUp("linkValentineQr"); }
function linkAboutGloveSizes(omnid) { openMarketingPopUp("linkAboutGloveSizes", omnid); }
function linkCustomerServiceHours() { openMarketingPopUp("linkcustomerservicehours"); }
function linkDiamondExpertHours() { openMarketingPopUp("linkdiamondexperthours"); }
// Modules
function linkGehryModule() {openMarketingPopUp("linkGehryModule");}
function linkGehryMovie() {openMarketingPopUp("linkGehryMovie");}
function linkLargeGehryMovie() {openMarketingPopUp("linkLargeGehryMovie");}
function linkSmallGehryMovie() {openMarketingPopUp("linkSmallGehryMovie");}
function linkOverlayGehryModule() {openMarketingPopUp("linkOverlayGehryModule");}
function linkOverlayGehryMovie() {openMarketingPopUp("linkOverlayGehryMovie");}
function linkSimply() {openMarketingPopUp("linkSimply");}
function linkT57() {openMarketingPopUp("linkT57");}
function linkTiffanyMarkMovie(){openMarketingPopUp("linkTiffanyMarkMovie");}
function linkWatchHeritage(){openMarketingPopUp("linkWatchHeritage");}
function linkWatchPromise(){openMarketingPopUp("linkWatchPromise");}
function linkWatchDesign(){openMarketingPopUp("linkWatchDesign");}
function linkEmailMarketingModule() {openMarketingPopUp("linkEmailMarketingModule");}
function linkCelebrationRings() {openMarketingPopUp("linkCelebrationRings");}
function linkCRStacks() {openMarketingPopUp("linkCRStacks");}
function linkCarvedHearts() {openMarketingPopUp("linkCarvedHearts");}
function linkEmailSignUp() {openMarketingPopUp("linkEmailSignUp");}
function linkEmailSignUpPromo() {openMarketingPopUp("linkEmailSignUpPromo");}
function linkGiftCardBalance(secureURL) {openMarketingPopUp("linkGiftCardBalance", secureURL);}
function linkAboutGiftCards() {openMarketingPopUp("linkAboutGiftCards");}
function linkGiftCardTerms() {openMarketingPopUp("linkGiftCardTerms");}
function linkfogqrcode() {openMarketingPopUp("linkfogqrcode");}
function linkEmailThisPage(linkSrc) { openMarketingPopUp("linkEmailThisPage", linkSrc); }
function linkEmailHint(linkSrc) { openMarketingPopUp("linkEmailHint", linkSrc); }
function linkEmailCustomerService() { openMarketingPopUp("linkEmailCustomerService"); }
function linkEngagementEmailThisPage(sku) {openMarketingPopUp("linkEngagementEmailThisPage", sku);}
function linkAboutQuickOrder() {openMarketingPopUp("linkAboutQuickOrder");}
function linkEmailWishList(id, sessionId) {openMarketingPopUp("linkEmailWishList", id, sessionId);}
function linkbejewelled(omnid) {openMarketingPopUp("linkbejewelled", omnid);}
function linkTiffanyEngraving() {openMarketingPopUp("linkTiffanyEngraving");}
function linkTrophies() {openMarketingPopUp("linkTrophies");}
function linkAbout37WallStreet() {openMarketingPopUp("linkAbout37WallStreet");}
function linkInStorePickup() {openMarketingPopUp("linkInStorePickup");}
function linkCRstorytop() {openMarketingPopUp("linkCRstorytop");}
function linkCRcelebring01() {openMarketingPopUp("linkCRcelebring01");}
function linkCRcelebring02() {openMarketingPopUp("linkCRcelebring02");}
function linkCRcelebring03() {openMarketingPopUp("linkCRcelebring03");}
function linkCRcelebring04() {openMarketingPopUp("linkCRcelebring04");}
function linkCRcelebring05() {openMarketingPopUp("linkCRcelebring05");}
function linkCRcelebring06() {openMarketingPopUp("linkCRcelebring06");}
function linkCRcelebring07() {openMarketingPopUp("linkCRcelebring07");}
function linkCRcelebring08() {openMarketingPopUp("linkCRcelebring08");}
function linkHoliday() {openMarketingPopUp("linkHoliday");}
function link2008SpringVideo() {openMarketingPopUp("link2008SpringVideo");}
function linkHolidayMakingOf() {openMarketingPopUp("linkHolidayMakingOf");}
function linkSkateSomerset(omnid) {openMarketingPopUp("linkSkateSomerset", omnid);}
function linkSkateSomersetVideo(omnid) {openMarketingPopUp("linkSkateSomersetVideo", omnid);}
function linkSkateSomersetVideo09(omnid) {openMarketingPopUp("linkSkateSomersetVideo09", omnid);}
function linkSkateSomersetVideo10(omnid) { openMarketingPopUp("linkSkateSomersetVideo10", omnid); }
function linkSkateSomersetVideo11(omnid) { openMarketingPopUp("linkSkateSomersetVideo11", omnid); }
function linkHeathrowStore(omnid) {openMarketingPopUp("linkHeathrowStore", omnid);}
function linkPatekPhilippeGrandExpo(omnid) {openMarketingPopUp("linkPatekPhilippeGrandExpo", omnid);}
function linkPatekPhilippeSalonOpening(omnid) {openMarketingPopUp("linkPatekPhilippeSalonOpening", omnid);}
function linkPatekPhilippeExclusive(omnid) {openMarketingPopUp("linkPatekPhilippeExclusive", omnid);}
function linkChainClaspDemo() {openMarketingPopUp("linkChainClaspDemo");}
function linkJPCharmStories(omnid) {openMarketingPopUp("linkJPCharmStories", omnid);}
function linkVerifyByVisa() {openMarketingPopUp("linkVerifyByVisa");}
function linkMasterCode() {openMarketingPopUp("linkMasterCode");}
function linkSingaporeStore(omnid) {openMarketingPopUp("linkSingaporeStore", omnid);}
function linkGlamour() {openMarketingPopUp("linkGlamour");}
function linkSDR() {openMarketingPopUp("linkSDR");}
function linkLucida() {openMarketingPopUp("linkLucida");}
function linkEtoile() {openMarketingPopUp("linkEtoile");}
function linkLegacy() {openMarketingPopUp("linkLegacy");}
function linkNovo() {openMarketingPopUp("linkNovo");}
function linkHonten() {openMarketingPopUp("linkHonten");}
function linkBrideWars(omnid) {openMarketingPopUp("linkBrideWars", omnid);}
function linkJPBezet(omnid) {openMarketingPopUp("linkJPBezet", omnid);}
function linkLocketPhotoSizer(omnid) {openMarketingPopUp("linkLocketPhotoSizer", omnid);}
function linkKeysVideo(omnid) {openMarketingPopUp("linkKeysVideo", omnid);}
function linkPerettiBritishMuseum(omnid) {openMarketingPopUp("linkPerettiBritishMuseum", omnid);}
function linkCantonStore(omnid) {openMarketingPopUp("linkCantonStore", omnid);}
function linkHKPlazaStore(omnid) {openMarketingPopUp("linkHKPlazaStore", omnid);}
function linkFedExCupTrophyVideo(omnid) {openMarketingPopUp("linkFedExCupTrophyVideo", omnid);}
function linkTFBBenefits(omnid) {openMarketingPopUp("linkTFBBenefits", omnid);}
function linkSharapovaGehry(omnid) {openMarketingPopUp("linkSharapovaGehry", omnid);}
function linkGiveVoiceToYourHeartVideo(omnid) {openMarketingPopUp("linkGiveVoiceToYourHeartVideo", omnid);}
function linkYellowDiamondsJP(omnid) {openMarketingPopUp("linkYellowDiamondsJP", omnid);}
function linkYellowDiamondsVideo(omnid) { openMarketingPopUp("linkYellowDiamondsVideo", omnid); }
function linkYellowDiamondsPartyVideo(omnid) { openMarketingPopUp("linkYellowDiamondsPartyVideo", omnid); }
function linkYellowDiamondsWinslet(omnid) { openMarketingPopUp("linkYellowDiamondsWinslet", omnid); }
function linkYellowDiamondsAbout(omnid) { openMarketingPopUp("linkYellowDiamondsAbout", omnid); }
function linkYellowDiamondsPartyPhoto(omnid) {openMarketingPopUp("linkYellowDiamondsPartyPhoto", omnid);}
function linkIphoneEngagementPromo(omnid) { openMarketingPopUp("linkIphoneEngagementPromo", omnid); }
function linkEngagementAppPreview(omnid) { openMarketingPopUp("linkEngagementAppPreview", omnid); }
function linkLeatherRetailStores(omnid) {openMarketingPopUp("linkLeatherRetailStores", omnid);}
function linkEstoreWebsitePolicies(omnid) { openMarketingPopUp("linkEstoreWebsitePolicies", omnid); }
function linkEstorePoliciesGuidelines(omnid) { openMarketingPopUp("linkEstorePoliciesGuidelines", omnid); }
function linkStatementVideo(omnid) { openMarketingPopUp("linkStatementVideo", omnid); }
function linkSomeStyleIsLegendaryVideo(omnid) { openMarketingPopUp("linkSomeStyleIsLegendaryVideo", omnid); }
function linkLeatherAbout(omnid) { openMarketingPopUp("linkLeatherAbout", omnid); }
function linkLeatherAboutMaterials(omnid) { openMarketingPopUp("linkLeatherAboutMaterials", omnid); }
function linkLeatherAboutCraft(omnid) { openMarketingPopUp("linkLeatherAboutCraft", omnid); }
function linkLeatherAboutDesigners(omnid) { openMarketingPopUp("linkLeatherAboutDesigners", omnid); }
function linkTheTiffanyStoryVideo(omnid) { openMarketingPopUp("linkTheTiffanyStoryVideo", omnid); }
function linkHoliday2010Video(omnid) { openMarketingPopUp("linkHoliday2010Video", omnid); }
function linkMilanOpening(omnid) { openMarketingPopUp("linkMilanOpening", omnid); }
function linkChinaWorldStore(omnid) { openMarketingPopUp("linkChinaWorldStore", omnid); }
function linkSpring2011Video(omnid) { openMarketingPopUp("linkSpring2011Video", omnid); }
function linkFall2011Video(omnid) { openMarketingPopUp("linkFall2011Video", omnid); }
function linkHoliday2011Video(omnid) { openMarketingPopUp("linkHoliday2011Video", omnid); }
function linkRubedoVideo(omnid) { openMarketingPopUp("linkRubedoVideo", omnid); }
function linkPerettiVideo(omnid) { openMarketingPopUp("linkPerettiVideo", omnid); }
function linkjpBridalFair(omnid) { openMarketingPopUp("linkjpBridalFair", omnid); }
function linkNewsArticle(articleId, omnid) { openMarketingPopUp("linkNewsArticle", articleId, omnid); }
function linkWMLTConfirm(omnid) { openMarketingPopUp("linkWMLTConfirm", omnid); }
function linkEngravingFairJP(omnid) { openMarketingPopUp("linkEngravingFairJP", omnid); }
function linkStoreReOpeningAU(omnid) { openMarketingPopUp("linkStoreReOpeningAU", omnid); }
function linkCSRVideo(omnid) { openMarketingPopUp("linkCSRVideo", omnid); }
function linkDiamondVideo(omnid) { openMarketingPopUp("linkDiamondVideo", omnid); }
function linkAboutCOD() { openMarketingPopUp("linkAboutCOD"); }
function linkaboutJPDeliveryPreference() { openMarketingPopUp("linkaboutJPDeliveryPreference"); }

//Resolved bug 724
function linkitradeemailthispage(linkSrc) { openMarketingPopUp("linkitradeemailthispage", linkSrc); }
//724 end
//for item demand page
function linkItradeItemDemandPage(linkSrc) {openMarketingPopUp("linkItradeItemDemandPage", linkSrc); }

function linkOverlays(overlayLink){
	closePopUp();
	openMarketingPopUp(overlayLink);
}

function ptRegistrySearch() {
	if (document.getElementById("ptTxtRegistryLastName").value.length > 0){
		hide("ptRegistrySearchError");
		window.location.href="/Registry/Search.aspx?OtherSearch=1&fn="+document.getElementById("ptTxtRegistryFirstName").value+"&ln="+document.getElementById("ptTxtRegistryLastName").value}
	else {show("ptRegistrySearchError")};
}

function msgOkCancel(confirmMsg, extLink) {
    if (confirm(confirmMsg)) {window.open(extLink,'externalWebsite');}
}

//Begin Email Request
	
	//Function href,layerType,layerWidth,layerHeight,layerTop,layerLeft, layerBackgroundColor, layerBorderColor, layerBorderWidth
function createEmailPopUp (href,layerType,pwidth,pheight,ptop,pleft,pbgcolor,pbrdrcolor,pbrdrwidth,blnPopupMask) {
	//change('btnSendVideo','selectOn');
	
	divEmailPopupHolderTop = ptop;
	divEmailPopupHolderHeight = pheight;
	var destURL = href;
	txtPopUpContent = '<iframe id="iframeMiniContent" name="iframeMiniContent" src="' + destURL + '" style="border:0; width:' + pwidth + 'px; height:' + pheight + 'px" frameborder="0" scrolling="no" allowtransparency="true"></iframe>';
	divEmailPopupHolder = document.createElement("div");
	document.body.insertBefore(divEmailPopupHolder, document.body.firstChild);
	divEmailPopupHolder.id = "divMiniPopUp";
	divEmailPopupHolder.className = "divMiniPopUp";
	divEmailPopupHolder.style.position = "absolute";
	divEmailPopupHolder.style.width = pwidth +"px";
	divEmailPopupHolder.style.marginLeft = "0px";
	divEmailPopupHolder.style.left = pleft +"px";
	divEmailPopupHolder.style.top = ptop +"px";
	divEmailPopupHolder.style.borderWidth = pbrdrwidth + "px";
	divEmailPopupHolder.style.borderColor = "#" + pbrdrcolor;
	divEmailPopupHolder.style.backgroundColor = "#" + pbgcolor;
	
	if(top==self) {
	divEmailPopupHolder.style.top = ptop +"px";
	divEmailPopupHolder.style.left = "50%";
	divEmailPopupHolder.style.marginLeft = (pleft-480)+"px";
	divEmailPopupHolder.style.borderWidth = pbrdrwidth + "px";
	divEmailPopupHolder.style.borderColor = "#" + pbrdrcolor;
	divEmailPopupHolder.style.backgroundColor = "#" + pbgcolor;
	}
	
	divEmailPopupHolder.innerHTML = txtPopUpContent;
	
		//Create Mask to cover contents below
	divEmailMaskHolder = document.createElement("div");
	document.body.insertBefore(divEmailMaskHolder, document.body.firstChild);
	divEmailMaskHolder.id = "divMiniMask";
	if (blnPopupMask) {divEmailMaskHolder.className= "divMask";} else {divEmailMaskHolder.className= "divClearMask";}
	divEmailMaskHolder.style.height = (getPageHeight()) + "px";
	divEmailMaskHolder.style.top = "0px";
	divEmailMaskHolder.innerHTML = "&nbsp;";
	divEmailMaskHolder.onclick = closeEmailPopUp;
    
}


function closeEmailPopUp() {
    if (typeof (divEmailPopupHolder) != "undefined") {
        if (document.getElementById(divEmailPopupHolder.id) != null) {
            divEmailPopupHolder.innerHTML = "";
            document.body.removeChild(divEmailPopupHolder);
            divEmailMaskHolder.innerHTML = "";
            document.body.removeChild(divEmailMaskHolder);
        }
	}
		
}
function initScrollLayer() {

	checkOverlaySize();
}
function checkOverlaySize()
{
	if((document.getElementById("divText").offsetHeight) > 150) {resizeOverlay();}
}
function resizeOverlay()
{
	if (parent.document.getElementById("iframeMiniContent") != null)
	{
		var newOverlayOffSetHeight = document.getElementById("divText").offsetHeight + 20;
		parent.document.getElementById("iframeMiniContent").style.height = newOverlayOffSetHeight + "px";
	}
}
// End Email Request
window['s'] = window['s'] || {
        t: function() {},
        tl: function() {}
    };
/**
 * @author Sandeep Rudrawar  
 *Dt 4/10/2009
 * Copyright 2009 IBM Corp
 *
 */
 /*  Begin Helper Functions */
 //pageview connector 
 /* Start Comstants */
 var CATEGORY_ITEM_PAGE_ACTIVITIES = 'Item Page Activities';
 var ITEM_EMAIL_ACTIVITIES = 'Item Email Activities'; 
 var ITEM_EMAIL_ACTIVITIES ='Item Email Activities';
 var BROWSE_RELATED = 'Browse Related';
 var USER_ACTIVITIES = 'User Activities';
 var ADVANCED_SEARCH = 'Advanced Search';
 var DEVICE_INFO = 'Device Info';
 var LABEL_VISITED_LINKS = 'Links Visited';
 var SIGN_OUT = 'Sign Out';
 var SIGNIN_STATUS = 'SignIn Status';
 var CREATE_ACCOUNT = 'Create New Account';


 // Start Custom Variable related constants

 // Slot of the variables
 
 var STORE_LOCATION_SEARCH_SLOT = 2;
 var SAVE_ITEM_SLOT = 3;
 var EMAIL_SIGNUP_SLOT = 8;
 // Name of the variables
 var EMAIL_SIGNUP_NAME = 'Email_Signup';
 var SAVE_ITEM_NAME = 'Save_Item';
 var STORE_LOCATION_SEARCH_NAME = 'Store_Search';
 // End Name Section

 // Scope of the variables
 var VISITOR_LEVEL_SCOPE = 1;
 var VISIT_LEVEL_SCOPE = 2;
 var PAGE_LEVEL_SCOPE = 3;
 // End Scope Section

 // End Custom Variable Constants

 /* End Constants */
 function SetCustomVariable(custVarSlot, custVarName, custVarValue, custVarScope,requiresPageView) {
	 if(console && console.error) { console.error('SetCustomVariable called by ' + ((arguments.callee && arguments.callee.caller && arguments.callee.caller.name) ? arguments.callee.caller.name :'' )); }
 }
 
 function GetVirtualPageViewPath(level0,level1,level2,level3)
 {	var slash = '/';
	var retVal;
	if(IsDefined(level0) && IsDefined(level1) && IsDefined(level2) && IsDefined(level3))
	{
		retVal= slash + level0 + slash + level1 + slash +level2 + slash +level3;
	}
	else if (IsDefined(level0) && IsDefined(level1) && IsDefined(level2))
	{
		retVal= slash + level0 + slash + level1 + slash +level2 ;
	}
	else if(IsDefined(level0) && IsDefined(level1) )
	{
		retVal= slash + level0 + slash + level1;
	}
	else if(IsDefined(level0) )
	{
		retVal= slash + level0;
	}
	// All virtual pageviews should go under /Virtual Folder/ in GA reports.
	retVal = slash + 'Virtual' +retVal ; 
	return retVal;
	
 }
function IsDefined( variable)
{

    if (typeof(variable) != 'undefined' && variable != null && variable != 'undefined') { return true; }
	else{return false;}
	

}
function IsNullOrEmpty(variable)
{
	if(variable ==null || variable =='undefined' || variable =='')
	{ return true;}
	else {return false;}
}
 /*  End Helper Functions */
function TrackEvent(category, action, label,value) {
	if(console && console.error) { console.error('TrackEvent called by ' + ((arguments.callee && arguments.callee.caller && arguments.callee.caller.name) ? arguments.callee.caller.name :'' )); }
}
function TrackEventAction(category, action, label,value) {
	if(console && console.error) { console.error('TrackEventAction called by ' + ((arguments.callee && arguments.callee.caller && arguments.callee.caller.name) ? arguments.callee.caller.name :'' )); }
}
function TrackPageView(drillDownPath) {
	if(console && console.error) { console.error('TrackPageView called by ' + ((arguments.callee && arguments.callee.caller && arguments.callee.caller.name) ? arguments.callee.caller.name :'' )); }
}
function SetVar(varName){
	if(console && console.error) { console.error('SetVar called by ' + ((arguments.callee && arguments.callee.caller && arguments.callee.caller.name) ? arguments.callee.caller.name :'' )); }
}
function GATrackBannerActivity(linkname){
	if(console && console.error) { console.error('GATrackBannerActivity called by ' + ((arguments.callee && arguments.callee.caller && arguments.callee.caller.name) ? arguments.callee.caller.name :'' )); }
}
function GATrackFileDownLoad(downloadName) {
	if(console && console.error) { console.error('GATrackFileDownLoad called by ' + ((arguments.callee && arguments.callee.caller && arguments.callee.caller.name) ? arguments.callee.caller.name :'' )); }
}
function GATrackExitLink(exitLinkName) {
	if(console && console.error) { console.error('GATrackExitLink called by ' + ((arguments.callee && arguments.callee.caller && arguments.callee.caller.name) ? arguments.callee.caller.name :'' )); }
}
// Change the name as GATrackActivity(linkname)
function GATrackItemActivity(linkname) {
	if(console && console.error) { console.error('GATrackItemActivity called by ' + ((arguments.callee && arguments.callee.caller && arguments.callee.caller.name) ? arguments.callee.caller.name :'' )); }
}
function GATrackItemEmailActivity(omie) {
	if(console && console.error) { console.error('GATrackItemEmailActivity called by ' + ((arguments.callee && arguments.callee.caller && arguments.callee.caller.name) ? arguments.callee.caller.name :'' )); }
}
function TrackEngagementBrowseWithRefinements() {
	if(console && console.error) { console.error('TrackEngagementBrowseWithRefinements called by ' + ((arguments.callee && arguments.callee.caller && arguments.callee.caller.name) ? arguments.callee.caller.name :'' )); }
}
// Shpng Bag Tracking
function GATrackActionAddToShoppingBag(sourceOfAdd ) {
	if(console && console.error) { console.error('GATrackActionAddToShoppingBag called by ' + ((arguments.callee && arguments.callee.caller && arguments.callee.caller.name) ? arguments.callee.caller.name :'' )); }
}
//saved items 
function GATrackActionAddToSavedItems (sourceOfAdd) {
	if(console && console.error) { console.error('GATrackActionAddToSavedItems called by ' + ((arguments.callee && arguments.callee.caller && arguments.callee.caller.name) ? arguments.callee.caller.name :'' )); }
}
function GATrackActionEngagementAdd() {
	if(console && console.error) { console.error('GATrackActionEngagementAdd called by ' + ((arguments.callee && arguments.callee.caller && arguments.callee.caller.name) ? arguments.callee.caller.name :'' )); }
}
function GATrackAction(argPageTitleSource , argAction,skuValue) {
	if(console && console.error) { console.error('GATrackAction called by ' + ((arguments.callee && arguments.callee.caller && arguments.callee.caller.name) ? arguments.callee.caller.name :'' )); }
}
function GATrackCategoryBrowseEvent(viewAllAction) {
	if(console && console.error) { console.error('GATrackCategoryBrowseEvent called by ' + ((arguments.callee && arguments.callee.caller && arguments.callee.caller.name) ? arguments.callee.caller.name :'' )); }
}
function GATrackSearchTerm(searchTerm) {
	if(console && console.error) { console.error('GATrackSearchTerm called by ' + ((arguments.callee && arguments.callee.caller && arguments.callee.caller.name) ? arguments.callee.caller.name :'' )); }
}

function GATrackAdvancedSearchTerm(searchTerm, searchCriteriaForTracking) {
	if(console && console.error) { console.error('GATrackAdvancedSearchTerm called by ' + ((arguments.callee && arguments.callee.caller && arguments.callee.caller.name) ? arguments.callee.caller.name :'' )); }
}
// Track to click event on Search icon in Mobile site.
function GATrackMobileSearchClick(category,action,labelName) {
	if(console && console.error) { console.error('GATrackMobileSearchClick called by ' + ((arguments.callee && arguments.callee.caller && arguments.callee.caller.name) ? arguments.callee.caller.name :'' )); }
}

function AddTransaction(OrderID,Affiliation,Total,Tax,Shipping ,City ,State,Country) {
	if(console && console.error) { console.error('AddTransaction called by ' + ((arguments.callee && arguments.callee.caller && arguments.callee.caller.name) ? arguments.callee.caller.name :'' )); }
}
function AddItem(OrderID, SKU ,ProductName , Category, UnitPrice, Quantity) {
	if(console && console.error) { console.error('AddItem called by ' + ((arguments.callee && arguments.callee.caller && arguments.callee.caller.name) ? arguments.callee.caller.name :'' )); }
}
function TrackTransaction() {
	if(console && console.error) { console.error('TrackTransaction called by ' + ((arguments.callee && arguments.callee.caller && arguments.callee.caller.name) ? arguments.callee.caller.name :'' )); }
}

function GATrackModuleEvent(moduleName, flashTitle) {
	if(console && console.error) { console.error('GATrackModuleEvent called by ' + ((arguments.callee && arguments.callee.caller && arguments.callee.caller.name) ? arguments.callee.caller.name :'' )); }
}

//New method for Carosel swipe and nav link clicks
function GATrackCaroselEvent(eventName) {
	if(console && console.error) { console.error('GATrackCaroselEvent called by ' + ((arguments.callee && arguments.callee.caller && arguments.callee.caller.name) ? arguments.callee.caller.name :'' )); }
}

// Function to track device info properties
function GATrackDeviceInfo(category, data)  {
	if(console && console.error) { console.error('GATrackDeviceInfo called by ' + ((arguments.callee && arguments.callee.caller && arguments.callee.caller.name) ? arguments.callee.caller.name :'' )); }
}

/* Functions related to Custom Variable */

// Function to set custom variable for Save Item.
function SetCustomVariableForSaveItem(skuValue)  {
	if(console && console.error) { console.error('SetCustomVariableForSaveItem called by ' + ((arguments.callee && arguments.callee.caller && arguments.callee.caller.name) ? arguments.callee.caller.name :'' )); }
}

// Function to set custom variable for Store Location.
function SetCustomVariableForStoreLocation(searchTerm)  {
	if(console && console.error) { console.error('SetCustomVariableForStoreLocation called by ' + ((arguments.callee && arguments.callee.caller && arguments.callee.caller.name) ? arguments.callee.caller.name :'' )); }
}

function ReplaceSpacesWithUnderScore(custVarValue) 
{
    custVarValue = custVarValue.replace(" ", "_");
    return custVarValue;
}

function TrimString(contentToTrim) 
{
	 var finalContent = contentToTrim.match(/^\s*(\S+(\s+\S+)*)\s*$/);
	 return (finalContent == null) ? "" : finalContent[1];
}


function GATrackCompleteSearch(searchTerm) {
	if(console && console.error) { console.error('GATrackCompleteSearch called by ' + ((arguments.callee && arguments.callee.caller && arguments.callee.caller.name) ? arguments.callee.caller.name :'' )); }
}

function GATrackHomePagePromo(promo) {
	if(console && console.error) { console.error('GATrackHomePagePromo called by ' + ((arguments.callee && arguments.callee.caller && arguments.callee.caller.name) ? arguments.callee.caller.name :'' )); }
}
function GATrackCreateAccount(label1, label2) {
	if(console && console.error) { console.error('GATrackCreateAccount called by ' + ((arguments.callee && arguments.callee.caller && arguments.callee.caller.name) ? arguments.callee.caller.name :'' )); }
}
function GATrackSignInStatus(label) {
	if(console && console.error) { console.error('GATrackSignInStatus called by ' + ((arguments.callee && arguments.callee.caller && arguments.callee.caller.name) ? arguments.callee.caller.name :'' )); }
}
function GATrackOrderHistory(label) {
	if(console && console.error) { console.error('GATrackOrderHistory called by ' + ((arguments.callee && arguments.callee.caller && arguments.callee.caller.name) ? arguments.callee.caller.name :'' )); }
}
function GATrackSignOut() {
	if(console && console.error) { console.error('GATrackSignOut called by ' + ((arguments.callee && arguments.callee.caller && arguments.callee.caller.name) ? arguments.callee.caller.name :'' )); }
}
function GATrackEmailSignUp() {
	if(console && console.error) { console.error('GATrackEmailSignUp called by ' + ((arguments.callee && arguments.callee.caller && arguments.callee.caller.name) ? arguments.callee.caller.name :'' )); }
}
// Commented due to issue of custom variables of the slots after 5  
// Function to set custom variable for Email Signup.
//function SetCustomVariableForEmailSignup() 
//{
//   SetCustomVariable(EMAIL_SIGNUP_SLOT, EMAIL_SIGNUP_NAME, GA_SUBMIT_DATE, VISITOR_LEVEL_SCOPE, false);
//}
//--------------------------------------------------------------------------

/* End Functions related to Custom Variable */
/* End of SiteTrackingGA.js */
/**
* @author Partha Banerjee  
* Dt 9/14/2011
*/
/*  Begin Helper Functions */

// Function to track click on Header and Footer links.
/* Start Constants*/
var ENDECA_FILTERS_ADD = 'add';
var ENDECA_FILTERS_REMOVE = 'remove';
var ENDECA_FILTERS_RETAIN = 'retain';
var ENDECA_FILTERS_RESETALL = 'resetAll';
var SWIPE_MORE = 'swipe more: ';
var GG_MOM = 'mom';
var GG_DAD = 'dad';
var GG_GRAD = 'grad';
var GG_INTERACTION_TYPE = 'spring gift HP';
var BLUEBOOK = 'blue book';
var CAROUSEL_CLICK = 'carousel click';
var SPACER = ' ';
var SWIPE = 'swipe: ';
var TTY = 'This is Tiffany Main';
var TTY_INTERACTION_TYPE = 'this is tiffany';
var DA_INTERACTION_TYPE= 'diamond guide';

function TrackMobileHeaderAndFooter(linkName) {
    if (!IsNullOrEmpty(linkName)) {
        s.eVar8 = linkName;
        s.prop74 = 'TrackMobileHeaderAndFooter';
        s.t();
    }
}

// Function to track click on the Master category links of mobile site
function TrackMobileMasterCategoryLink(masterCategoryName) { 
    OmnitureTrackNavigationalLinks(masterCategoryName);}
// Function to track click on the category links in Master Category landing page.
function TrackMobileCategoryLink(categoryName) {
    if (!IsNullOrEmpty(categoryName)) {
        s.prop4 = categoryName;
        s.prop74 = 'TrackMobileCategoryLink';
        s.t();
    }
}

// Function to track click on the "Load More Results" link on category browse page.
function TrackMobileLoadMoreResults(valueToPost) {
    // Its required new eVar and since we don't have eVar31 yet so, I am assigning the value to the same below
    if (!IsNullOrEmpty(valueToPost)) {
        var dataObject = {
            'events': {
                'loadMoreResults': true}};
        trackData(dataObject);
    }
}

function TrackMobileCarousel(value) {
    if (console && console.error) { console.error('TrackMobileCarousel called by ' + ((arguments.callee && arguments.callee.caller && arguments.callee.caller.name) ? arguments.callee.caller.name : '')); }
}

function omnitureTrackDeviceInfo(category, data) {
    if (console && console.error) { console.error('omnitureTrackDeviceInfo called by ' + ((arguments.callee && arguments.callee.caller && arguments.callee.caller.name) ? arguments.callee.caller.name : '')); }
}
// Redesign Browsing
function OmnitureTrackNavigationalLinks(menu, location) {
    var arrLink = menu.split(",");
    if (!IsNullOrEmpty(menu)) {
        var dataObject = {
            'events': {
                'navClick': true},
            'nav': {
                'link': arrLink,
                'location': location}};
        trackData(dataObject);
    }
}

function OmnitureTrackNavigationalExitLinkEvent(location, linkName, exitLinkText,isTelephoneNo) {
    if (isTelephoneNo)
    {
        exitLinkText = "tel:" + exitLinkText;
    }
    if (!IsNullOrEmpty(location) && !IsNullOrEmpty(linkName) && !IsNullOrEmpty(exitLinkText)) {
        var arrayLink = [linkName];
        var dataObject = {
            'events': {
                'navClick': true,
                'exit':true
            },
            'nav': {
                'link': arrayLink,
                'location': location
            },
            'exit': {
                'linkURL': exitLinkText
            }
        };
        trackData(dataObject);
    }
}

function OmnitureTrackQuickViewHeaderLinks(menu, location) {
    
    if (!IsNullOrEmpty(menu)) {
        var arrayLink = [menu];
        var dataObject = {
            'events': {
                'navClick': true
            },
            'nav': {
                'link': arrayLink,
                'location': location
            }
        };
        trackData(dataObject);
    }
}

function OmnitureTrackHeaderMenuItem(menu, menuLabel, menuItemName) {
    if (!IsNullOrEmpty(menu)) {
        var arrLink = [menu.toLowerCase()];
        if (!IsNullOrEmpty(menuLabel)) {
            arrLink.push(menuLabel.toLowerCase())
        }
        if (!IsNullOrEmpty(menuItemName)) {
            arrLink.push(menuItemName.toLowerCase())
        }
        var dataObject = {
            'events': {
                'navClick': true},
            'nav': {
                'link': arrLink,
                'location': 'header'}};
        trackData(dataObject);
    }
}

function OmnitureTrackExploreAllLink(masterCategoryName) {
    if (console && console.error) { console.error('OmnitureTrackExploreAllLink called by ' + ((arguments.callee && arguments.callee.caller && arguments.callee.caller.name) ? arguments.callee.caller.name : '')); }
}

function OmnitureTrackingHeadlineOrImage(masterCategory) {
    if (console && console.error) { console.error('OmnitureTrackingHeadlineOrImage called by ' + ((arguments.callee && arguments.callee.caller && arguments.callee.caller.name) ? arguments.callee.caller.name : '')); }
}

function OmnitureTrackFooterLinkClick(link) {
    if (!IsNullOrEmpty(link)) {
        var dataObject = {
            'events': {
                'navClick': true},
            'nav': {
                'link': link,
                'location': 'footer'}};
        trackData(dataObject);
    }
}

function OmnitureTrackViewMoreStore() {
    if (console && console.error) { console.error('OmnitureTrackViewMoreStore called by ' + ((arguments.callee && arguments.callee.caller && arguments.callee.caller.name) ? arguments.callee.caller.name : '')); }
}

function OmnitureTrackViewAllStoresInCountry(countryandLoc) {
    if (console && console.error) { console.error('OmnitureTrackViewAllStoresInCountry called by ' + ((arguments.callee && arguments.callee.caller && arguments.callee.caller.name) ? arguments.callee.caller.name : '')); }
}

function OmnitureTrackSortOptions(pageName, sortOption, sortTool) {
    if (!IsNullOrEmpty(sortOption)) {
        if (isValidDataObject(dataLayer.search)) {
            var dataObject = new Object();
            dataObject.search = dataLayer.search;
            dataObject.search.sortMethod = sortOption.toLowerCase();
            if (!IsNullOrEmpty(sortTool)) {
                dataObject.search.sortTool = sortTool.toLowerCase();
            }
            else {
                delete dataObject.search.sortTool;
            }
            dataObject.events = new Object();
            dataObject.events.sortUpdate = true;
        }
        else {
            var dataObject = {
                'events': {
                    'sortUpdate': true
                },
                'search': {
                    'sortMethod': sortOption.toLowerCase()
                }
            };
            if (!IsNullOrEmpty(sortTool)) {
                dataObject.search.sortTool = sortTool.toLowerCase();
            }
        }
        trackData(dataObject);
    }
}

function OmnitureTrackEndecaDimensions(searchFilters) {
    // Invalid data - exit function without tracking
    if ((!isValidDataObject(searchFilters) || IsNullOrEmpty(searchFilters.filterType) ||
            IsNullOrEmpty(searchFilters.filterName) || IsNullOrEmpty(searchFilters.action)) && searchFilters.action !== ENDECA_FILTERS_RESETALL) {
        return false;
    }
    var filterType = "";
    switch(searchFilters.filterType.trim()){
        case 'gift finder':
            filterType = "gift finder"
            break;
        case 'visual':
            filterType = "visual"
            break;
        default:
            filterType = 'filter'
    }
  
    // create dataObject to submit tracking
    var dataObject = {
        'search': {
            'filters': [{
                'name': searchFilters.filterType.trim(),
                'value': searchFilters.filterName.trim(),
                'order': 1,
                'action': searchFilters.action,
                'type': filterType
            }]
        }
    };
    if (searchFilters.action === ENDECA_FILTERS_REMOVE || searchFilters.action === ENDECA_FILTERS_RESETALL) {
        dataObject.events = {
            'filterRemoved': true};
    }
    if (searchFilters.action === ENDECA_FILTERS_ADD) {
        dataObject.events = {
            'filterAdded': true};
    }
    // Check if search is already present in dataLayer, if yes, add the filters to the existing filters
    if (isValidDataObject(dataLayer.search)) {
        var tempSearch = dataLayer.search;
        if (typeof tempSearch.filters == "undefined") {
            tempSearch.filters = [];
        }

        var i = tempSearch.filters.length;
        while (i--) {
            if (tempSearch.filters[i].action === ENDECA_FILTERS_REMOVE) {
                tempSearch.filters.splice(i, 1);
            }
        }
        // if "reset all" filters is sent from mobile - set all filters action to remove         
        if (dataObject.search.filters[0].action === ENDECA_FILTERS_RESETALL) {
            tempSearch.filters.forEach(function (entry) {
                entry.action = ENDECA_FILTERS_REMOVE;
            });
        }
        // Set "retain" action for remaining filters
        if (dataObject.search.filters[0].action !== ENDECA_FILTERS_RESETALL) {
            tempSearch.filters.forEach(function (entry) {
                entry.action = ENDECA_FILTERS_RETAIN;
            });
        }
        // Get the max order to assign to new filter
        var order = getMaxOrder(tempSearch) + 1;
        // add the new filter to the existing filters if action is "add" else remove from the list
        if (dataObject.search.filters[0].action === ENDECA_FILTERS_ADD) {
            dataObject.search.filters[0].order = order.toString();
            tempSearch.filters.push(dataObject.search.filters[0]);

        }
        else if (dataObject.search.filters[0].action === ENDECA_FILTERS_REMOVE && (typeof tempSearch.filters[0] == "undefined")) {
            dataObject.search.filters[0].order = order.toString();
            tempSearch.filters.push(dataObject.search.filters[0]);
        }
        else {
            tempSearch.filters.forEach(function (entry) {
                if (entry.name === dataObject.search.filters[0].name && entry.value === dataObject.search.filters[0].value) {
                    entry.action = ENDECA_FILTERS_REMOVE;
                }
            });
        }
        dataObject.search = tempSearch;
    }
    trackData(dataObject);
}

function getMaxOrder(array) {
    var values = [0];
    array.filters.forEach(function (entry) {
        if (!isNaN(entry.order)) {
            values.push(entry.order);
        }
    });
    return Math.max.apply(Math, values);
}

function OmnitureTrackEngagementFilters(searchFilters) {
    // Invalid data - exit function without tracking
    if ((!isValidDataObject(searchFilters) || IsNullOrEmpty(searchFilters.filterType) ||
            IsNullOrEmpty(searchFilters.filterName) || IsNullOrEmpty(searchFilters.action)) && searchFilters.action !== ENDECA_FILTERS_RESETALL) {
        return false;
    }
    // create dataObject to submit tracking
    var dataObject = {
        'search': {
            'filters': [{
                'name': searchFilters.categoryName.trim(),
                'value': searchFilters.filterName.trim(),
                'order': 1,
                'action': searchFilters.action}]}};

    if (searchFilters.action === ENDECA_FILTERS_REMOVE || searchFilters.action === ENDECA_FILTERS_RESETALL) {
        dataObject.events = {
            'filterRemoved': true};
    }
    if (searchFilters.action === ENDECA_FILTERS_ADD) {
        dataObject.events = {
            'filterAdded': true};
    }
    // Check if search is already present in dataLayer, if yes, add the filters to the existing filters
    if (isValidDataObject(dataLayer.search)) {
        var tempSearch = dataLayer.search;
        if (typeof tempSearch.filters == "undefined") {
            tempSearch.filters = [];
        }

        var i = tempSearch.filters.length;
        while (i--) {
            if (tempSearch.filters[i].action === ENDECA_FILTERS_REMOVE) {
                tempSearch.filters.splice(i, 1);
            }
        }
        // if "reset all" filters is sent from mobile - set all filters action to remove         
        if (dataObject.search.filters[0].action === ENDECA_FILTERS_RESETALL) {
            tempSearch.filters.forEach(function (entry) {
                entry.action = ENDECA_FILTERS_REMOVE;
            });
        }
        // Set "retain" action for remaining filters
        if (dataObject.search.filters[0].action !== ENDECA_FILTERS_RESETALL) {
            tempSearch.filters.forEach(function (entry) {
                entry.action = ENDECA_FILTERS_RETAIN;
            });
        }
        // Get the max order to assign to new filter
        var order = getMaxOrder(tempSearch) + 1;
        // add the new filter to the existing filters if action is "add" else remove from the list
        if (dataObject.search.filters[0].action === ENDECA_FILTERS_ADD) {
            dataObject.search.filters[0].order = order.toString();
            tempSearch.filters.push(dataObject.search.filters[0]);

        }
        else if (dataObject.search.filters[0].action === ENDECA_FILTERS_REMOVE && (typeof tempSearch.filters[0] == "undefined")) {
            dataObject.search.filters[0].order = order.toString();
            tempSearch.filters.push(dataObject.search.filters[0]);
        }
        else {
            tempSearch.filters.forEach(function (entry) {
                if (entry.name === dataObject.search.filters[0].name && entry.value === dataObject.search.filters[0].value) {
                    entry.action = ENDECA_FILTERS_REMOVE;
                }
            });
        }
        dataObject.search = tempSearch;
    }
    trackData(dataObject);
}

function omnitureTrackStoreFilters(searchFilters) {
    // Invalid data - exit function without tracking
   if (isValidDataObject(searchFilters))
   {
       
       var dataObject = { 'search': { 'filters': [] } };
       
       
        if (searchFilters.length>0) {
             
            
            for (var i = 0; i < searchFilters.length; i++)
            {
                
                if((IsNullOrEmpty(searchFilters[i].filterType) || IsNullOrEmpty(searchFilters[i].filterName)|| 
                    IsNullOrEmpty(searchFilters[i].filterValue) || IsNullOrEmpty(searchFilters[i].filterOrder) || IsNullOrEmpty(searchFilters[i].filterAction)) && searchFilters[i].filterAction !== ENDECA_FILTERS_RESETALL)
                {
                    return false;
                }
                else
                {
                    var tempObj = {
                        'name': searchFilters[i].filterName.trim().toLowerCase(),
                        'type': searchFilters[i].filterType.trim().toLowerCase(),
                        'value': searchFilters[i].filterValue.trim().toLowerCase(),
                        'order': searchFilters[i].filterOrder,
                        'action': searchFilters[i].filterAction.trim().toLowerCase()

                    };
                    
                    dataObject.search.filters.push(tempObj);
                }

                              
                if (searchFilters[i].filterAction === ENDECA_FILTERS_REMOVE || searchFilters[i].filterAction === ENDECA_FILTERS_RESETALL) {
                    dataObject.events = {
                        'filterRemoved': true
                    };
                }
                if (searchFilters[i].filterAction === ENDECA_FILTERS_ADD) {
                    dataObject.events = {
                        'filterAdded': true
                    };
                }
                    
            }
       
        }
        trackData(dataObject);
    }
    
    }
   


function OmnitureTrackLoadMoreResults(pageName, linkName) {
    if (console && console.error) { console.error('OmnitureTrackLoadMoreResults called by ' + ((arguments.callee && arguments.callee.caller && arguments.callee.caller.name) ? arguments.callee.caller.name : '')); }
}


function OmnitureTrackSKUInRecentlyViewedItems(pageName, skuDescription) {
    if (console && console.error) { console.error('OmnitureTrackSKUInRecentlyViewedItems called by ' + ((arguments.callee && arguments.callee.caller && arguments.callee.caller.name) ? arguments.callee.caller.name : '')); }
}

function OmnitureTrackSeeItOn(pageName, action, value) {

    if (!IsNullOrEmpty(pageName) && !IsNullOrEmpty(action) && !IsNullOrEmpty(value)) {
        s.prop74 = 'OmnitureTrackSeeItOn';
        s.tl(true, 'o', pageName + ' -> ' + action + '->' + value);
        ClearlinkTrackVars();
    }

}

function OmnitureTrackLearnMoreLink(pageName, value) {
    if (console && console.error) { console.error('OmnitureTrackLearnMoreLink called by ' + ((arguments.callee && arguments.callee.caller && arguments.callee.caller.name) ? arguments.callee.caller.name : '')); }
}

function OmnitureTrackScheduleVisit(pageName, action) {
    if (console && console.error) { console.error('OmnitureTrackScheduleVisit called by ' + ((arguments.callee && arguments.callee.caller && arguments.callee.caller.name) ? arguments.callee.caller.name : '')); }
}

function OmnitureTrackCarouselClick(pageName, carousalName, slideNumber) {
    if (console && console.error) { console.error('OmnitureTrackCarouselClick called by ' + ((arguments.callee && arguments.callee.caller && arguments.callee.caller.name) ? arguments.callee.caller.name : '')); }
}


function OmnitureTrackLinkClickFromGridOrCarousel(pageName, action, linkValue) {
    if (console && console.error) { console.error('OmnitureTrackLinkClickFromGridOrCarousel called by ' + ((arguments.callee && arguments.callee.caller && arguments.callee.caller.name) ? arguments.callee.caller.name : '')); }
}

function OmnitureTrackInlineCustomerSelectionPaginate(pageName, pageNumber) {
    if (console && console.error) { console.error('OmnitureTrackInlineCustomerSelectionPaginate called by ' + ((arguments.callee && arguments.callee.caller && arguments.callee.caller.name) ? arguments.callee.caller.name : '')); }
}

function OmnitureTrackWishListViewBy(value) {
    if (console && console.error) { console.error('OmnitureTrackWishListViewBy called by ' + ((arguments.callee && arguments.callee.caller && arguments.callee.caller.name) ? arguments.callee.caller.name : '')); }
}

function OmnitureTrackFullSaveItemLinkClick(linkName) {
    if (console && console.error) { console.error('OmnitureTrackFullSaveItemLinkClick called by ' + ((arguments.callee && arguments.callee.caller && arguments.callee.caller.name) ? arguments.callee.caller.name : '')); }
}


function omnitureTrackActionAddToShoppingBag(argPageTitle, argItem, gridPosition,tileAttr) {
    var addToCartMethod = "";
    var productFindingMethod = "";
    var isHighlight = false;
    var isNew = false;
    var isSurprise = false;
    if (!IsNullOrEmpty(argPageTitle)) {
        switch (argPageTitle) {
            case "Item Page":
                addToCartMethod = "product details";
                break;
            case "Category Browse":
                addToCartMethod = "browse grid";
                productFindingMethod = "add to bag - browse grid";
                break;
            case "Full Saved Item":
            case "Inline Saved Items":
                addToCartMethod = "saved items";
                break;
            case "ring finder":
                addToCartMethod = "ring finder";
                break;
            case "Mini PDP - Digital Catalogue":
                addToCartMethod = "mini pdp";
                break;
            case "sbpr":
                addToCartMethod = "product recommendations - cart";
                break;
            case "Search Results Grid":
                addToCartMethod = "search results";
                productFindingMethod = "add to bag - search";
                break;
            case "charm builder":
                addToCartMethod = "charm builder";
                break;
        }
        
    }
    var navCid = URLFactory.extractQueryStringValue(window.location.search.split("?").join(""), "fromcid");
    if (!IsNullOrEmpty(tileAttr)) {        
        tileAttr.split("|").forEach(function (entry) {
            switch (entry) {
                case 'highlight':
                    isHighlight = true;
                    break;
                case 'new':
                    isNew = true;
                    break;
                case 'surprise':
                    isSurprise = true;
                    break;
            }
        });
        
    }
    if (typeof (argItem) !== "undefined" && !IsNullOrEmpty(argItem)) {
        var dataObject = JSON.parse(argItem);
        if (typeof (dataObject.products) === "object" && dataObject.products !== null) {
            dataObject.products.forEach(function (entry) {
                entry.addToCartMethod = addToCartMethod;
                if (!IsNullOrEmpty(gridPosition)) { 
                    entry.position = gridPosition;                                    
                }
                if (!IsNullOrEmpty(navCid) && navCid != "-1" ) {
                    entry.navigationalCategoryID = navCid;
                }
                if (isHighlight) {
                    entry.isHighlight = true;
                }
                if (isNew) {
                    entry.isNew = true;
                }
                if (isSurprise) {
                    entry.isSurprise = true;
                }
                if (!IsNullOrEmpty(productFindingMethod)) {
                    entry.findingMethod = productFindingMethod;
                }
            });
        }
        trackData(dataObject);
    }

}
function omnitureTrackMobileLoadMoreResults(pageName, action) {
    if (!IsNullOrEmpty(action)) {
        var dataObject = {
            'events': {
                'loadMoreResults': true}};
        trackData(dataObject);
    }
}
function omnitureTrackMobileCarousel(value) {
    if (console && console.error) { console.error('omnitureTrackMobileCarousel called by ' + ((arguments.callee && arguments.callee.caller && arguments.callee.caller.name) ? arguments.callee.caller.name : '')); }
}
function OmnitureExitLinkTracking(linkObject, linkName) {
    if (!IsNullOrEmpty(linkObject)) {
        var dataObject = {
            'events': {
                'exit': true},
            'exit': {
                'linkURL': linkObject.href.replace(/.*?:\/\//g, "")}};
        trackData(dataObject);
    }
}

function omnitureTrackAction(argPageTitle, argAction, skuValue) {
    var pageName;
    var company = "Tiffany & Co. | ";
    if (locale == "en-us-ird") {
        company = "IRIDESSE Pearls | ";
    }
    pageName = company + argPageTitle + " | ACTION | " + argAction;
    //Set Omniture variables   
    s.prop8 = argPageTitle + " -> " + argAction;
    //Submit Omniture variable
    s.prop74 = 'omnitureTrackAction';
    s.t();
    GATrackAction(argPageTitle, argAction, skuValue);
}

function OmnitureTrackSearchTerm(searchTerm, count) {

    var dataObject = new Object;
    dataObject.events = new Object;
    dataObject.events.search = true;
    if (typeof (dataLayer.search) == "undefined") {
        dataObject.search = new Object;
        if (!IsNullOrEmpty(searchTerm)) {
            dataObject.search.keyword = searchTerm.toLowerCase();
        }
        if (IsNullOrEmpty(count) || typeof (count) == "undefined") {
            count = "0";
        }
        dataObject.search.resultCount = count;
        trackData(dataObject);
    }

}

function omnitureTrackStoreSearchTerm(searchTerm) {

    if (!IsNullOrEmpty(searchTerm)) {
        var dataObject = {
            'events': {
                'storeLocatorSearch': true},
            'storeLocator': {
                'keyword': searchTerm.toLowerCase()}};
        trackData(dataObject);
    }
}

function omnitureTrackPrepopulatedSearchTerm(searchTerm) {
    if (!IsNullOrEmpty(searchTerm)) {
        var prePopulatedSearch = "prepopulated|" + searchTerm;
        var dataObject = {
            'events': {
                'storeLocatorSearch': true
            },
            'storeLocator': {
                'keyword': prePopulatedSearch.toLowerCase()
            }
        };
        trackData(dataObject);
    }
}

function omnitureTrackViewRemainingItems(pageName, linkName) {
    if (console && console.error) { console.error('omnitureTrackViewRemainingItems called by ' + ((arguments.callee && arguments.callee.caller && arguments.callee.caller.name) ? arguments.callee.caller.name : '')); }
}

function omnitureTrackVideo(videoName, action, value, videoTotalTime) {
    action = String(action).toLowerCase();
    value = String(value).toLowerCase();
    videoName = String(videoName).toLowerCase();
    var tempVideoName = videoName.split("-");
    var videoFriendlyName = "";
    var videoID = "";
    if (typeof (tempVideoName[1]) !== "undefined" && tempVideoName[1] != "") {
        if (typeof (tempVideoName[0]) !== "undefined" && tempVideoName[0] != "") {
            videoFriendlyName = tempVideoName[0].trim();
        }
        videoID = tempVideoName[1].trim();
    }
    else {
        videoID = videoName;
    }
    var dataObject = {
        'video': {
            'ID': videoID,
            'name': videoFriendlyName}};


    if (!IsNullOrEmpty(videoTotalTime)) {
        dataObject.video.length = parseInt(videoTotalTime);
    }

    if (action == 'play') {
        dataObject.video.milestone = new Object;
        dataObject.events = new Object;
        switch (value.toLowerCase()) {
            case 'started':
                dataObject.events.videoStart = true;
                break;
            case '25%':
                dataObject.events.videoMilestone = true;
                dataObject.video.milestone.ID = value.toLowerCase();
                break;
            case '50%':
                dataObject.events.videoMilestone = true;
                dataObject.video.milestone.ID = value.toLowerCase();
                break;
            case '75%':
                dataObject.events.videoMilestone = true;
                dataObject.video.milestone.ID = value.toLowerCase();
                break;
            case 'complete':
                dataObject.events.videoMilestone = true;
                dataObject.events.videoComplete = true;
                dataObject.video.milestone.ID = value.toLowerCase();
                break;
            case 'replay':
                dataObject.events.videoReplay = true;
                dataObject.events.videoStart = true;
                break;
        }

    }
    trackData(dataObject);
}

function omnitureTrackMasterCategoryShopLinks(masterCategory, linkValue) {
    if (console && console.error) { console.error('omnitureTrackMasterCategoryShopLinks called by ' + ((arguments.callee && arguments.callee.caller && arguments.callee.caller.name) ? arguments.callee.caller.name : '')); }
}

function OmnitureClickEvent(linkname) {
    s.eVar16 = "";
    s.eVar17 = "";
    s.eVar18 = "";
    s.eVar19 = "";
    s.eVar20 = "";
    s.eVar21 = "";
    s.prop19 = "";
    s.eVar46 = "";
    s.prop39 = "";
    s.eVar47 = "";
    s.eVar57 = "";
    s.eVar48 = "";
    s.prop43 = "";

    if (linkname == "Engraving Available") {
        if (!IsNullOrEmpty(s.pageName)) {
            s.eVar16 = s.pageName + " -> " + linkname;
            s.events = "event16";
            SetlinkTrackVars("eVar16,events", "event16");
        }
    }
    else if (linkname == "View Specifications") {
        s.eVar17 = linkname;
        s.events = "event48";
        SetlinkTrackVars("eVar17,events", "event48");
    }
    else if (linkname == "View Relative Size") {
        s.eVar18 = linkname;
        SetlinkTrackVars("eVar18");
    }
    else if (linkname == "Print Item Information") {
        s.eVar19 = linkname;
        SetlinkTrackVars("eVar19");
    }
    else if (linkname == "Pick Up at Wall Street Store") {
        s.eVar20 = linkname;
        s.events = "event45";
        SetlinkTrackVars("eVar20,events", "event45");
    }
    else if (linkname == "View Holiday Banner Detail") {
        s.eVar21 = linkname;
        SetlinkTrackVars("eVar21");
    }
    else if (linkname == "Email This Item") {
        window['dataLayer'].events = { 'socialShare': true };
        _satellite.setVar('_newProducts', true);
        s.prop19 = linkname;
        s.events = "event14";
        s.eVar46 = linkname;
        s.prop39 = linkname;
        SetlinkTrackVars("products,prop19,prop39,eVar46,events", "event14");
    }
    else if (linkname == "CSR Print All Information" || linkname == "CSR Gender Diversity Graph" ||
                linkname == "CSR Generation and Gender Graph" || linkname == "CSR Grants Graph" ||
                     linkname == "CSR Employee Diversity Graph") {
        s.events = "event32";
        s.eVar47 = linkname;
        SetlinkTrackVars("eVar47,events", "event32");
    }
    else if (linkname == "Post to Facebook" || linkname == "Post to Pinterest" || linkname == "Post to Tumblr" ||
                linkname == "Post to Twitter" || linkname == "Email All Item Icon" || linkname == "EMAIL Saved Item" || linkname == "Email This Ring" || linkname == "Share Saved Item" || linkname == "Post to Google" || linkname == "Copy this Link") {
        _satellite.setVar('_newProducts', true);
        OmnitureTrackSocialSharing(linkname);
        _satellite.setVar('_newProducts', false);
        return;

    }
    else if (linkname == "Print All Item Icon" || linkname == "Print Item Information" || linkname == "PRINT Saved Item" || linkname == "Print This Ring") {
        s.events = "event37";
        s.eVar57 = linkname;
        SetlinkTrackVars("eVar57,events", "event37");
    }
    else if (linkname == "Save This Item") {
        s.events = "event15";
        SetlinkTrackVars("events", "event15");
    }
    else if (linkname == "Save This Ring") {
        s.events = "event40";
        SetlinkTrackVars("events", "event40");
    }
    else if (linkname == "Discover the Story of This Collection" || linkname == "Discover the Story of This Design" || linkname == "Additional Items" ||
                    linkname == "Recently Viewed Items") {
        // DTM batch-2 changes   
        OmnitureTrackPDPTabInteraction(linkname);
    }
    else if (linkname == "Shipping & Returns") {
        s.events = "event47";
        SetlinkTrackVars("events", "event47");
    }
    else if (linkname == "EMAIL Engagement Ring") {
        s.events = "event25";
        SetlinkTrackVars("events", "event25");
    }
    else if (linkname == "PRINT Engagement Ring") {
        s.events = "event26";
        SetlinkTrackVars("events", "event26");
    }
    else if (linkname == "EMAIL ShoppingBag") {
        s.events = "event28";
        SetlinkTrackVars("events", "event28");
    }
    else if (linkname == "PRINT ShoppingBag") {
        s.events = "event29";
        SetlinkTrackVars("events", "event29");
    }

    s.prop74 = 'OmnitureClickEvent';
    s.tl(true, 'o', linkname);
    ClearlinkTrackVars();
    _satellite.setVar('_newProducts', false);
}

function omnitureItemEmailClicks(omie) {
    if (console && console.error) { console.error('omnitureItemEmailClicks called by ' + ((arguments.callee && arguments.callee.caller && arguments.callee.caller.name) ? arguments.callee.caller.name : '')); }
}

function omnitureTrackWeddingBandDetailsLink(pageName, action, value) {
    if (console && console.error) { console.error('omnitureTrackWeddingBandDetailsLink called by ' + ((arguments.callee && arguments.callee.caller && arguments.callee.caller.name) ? arguments.callee.caller.name : '')); }
}

function omnitureTrackSkinToneSeeItOn(pageName, action, value) {
    if (console && console.error) { console.error('omnitureTrackSkinToneSeeItOn called by ' + ((arguments.callee && arguments.callee.caller && arguments.callee.caller.name) ? arguments.callee.caller.name : '')); }
}

function omnitureTrackCaratSizeSeeItOn(pageName, action, value) {
    if (console && console.error) { console.error('omnitureTrackCaratSizeSeeItOn called by ' + ((arguments.callee && arguments.callee.caller && arguments.callee.caller.name) ? arguments.callee.caller.name : '')); }
}

function omnitureTrackInlineShoppingBagViewItems(argPageTitle, argAction, argItems) {
    var cookieCnt = parseInt(CookieManager.getCookieValue("shoppingbagcnt"));
    if (!isNaN(cookieCnt) && cookieCnt > 0) {
        s.events = "scView,event22";
    } else {

    }
    if (!IsNullOrEmpty(argItems)) {
        SetlinkTrackVars("prop8,events", "scView,event22");
    } else {
        SetlinkTrackVars("prop8");
    }

    s.prop8 = argPageTitle + " -> " + argAction;
    s.prop74 = 'omnitureTrackInlineShoppingBagViewItems';
    s.tl(true, 'o', argPageTitle + " | ACTION | " + argAction);
    ClearlinkTrackVars();
}

function omnitureTrackInlineViewSavedItems(argPageTitle, argAction) {
    if (console && console.error) { console.error('omnitureTrackInlineViewSavedItems called by ' + ((arguments.callee && arguments.callee.caller && arguments.callee.caller.name) ? arguments.callee.caller.name : '')); }
}

function omnitureTrackInlineRemoveShoppingBagItem(argPageTitle, argAction, argItem) {
    if (typeof (argItem) !== "undefined" && !IsNullOrEmpty(argItem)) {
        var dataObject = JSON.parse(argItem);
        trackData(dataObject);
    }
}

function omnitureTrackInlineRemoveSavedItem(argItem) {

    if (typeof (argItem) !== "undefined" && !IsNullOrEmpty(argItem)) {
        var dataObject = JSON.parse(argItem);
        trackData(dataObject);
    }

}

function omnitureTrackInlineShoppingBagLinksClick(argPageTitle, argAction) {
    if (console && console.error) { console.error('omnitureTrackInlineShoppingBagLinksClick called by ' + ((arguments.callee && arguments.callee.caller && arguments.callee.caller.name) ? arguments.callee.caller.name : '')); }
}

function omnitureTrackInlineSavedItemsLinkClick(argPageTitle, argAction) {
    if (console && console.error) { console.error('omnitureTrackInlineSavedItemsLinkClick called by ' + ((arguments.callee && arguments.callee.caller && arguments.callee.caller.name) ? arguments.callee.caller.name : '')); }
}

function omnitureTrackSavedItemsViewBy(pageName, viewbyOption) {
    if (console && console.error) { console.error('omnitureTrackSavedItemsViewBy called by ' + ((arguments.callee && arguments.callee.caller && arguments.callee.caller.name) ? arguments.callee.caller.name : '')); }
}

function omnitureTrackSavedItemsViewByImageSize(pageName, viewbyOption) {
    if (console && console.error) { console.error('omnitureTrackSavedItemsViewByImageSize called by ' + ((arguments.callee && arguments.callee.caller && arguments.callee.caller.name) ? arguments.callee.caller.name : '')); }
}
function OmnitureTrackSKUInRecentlyViewedItemPageItems(ItemViewSource, skuDescription) {
    if (console && console.error) { console.error('OmnitureTrackSKUInRecentlyViewedItemPageItems called by ' + ((arguments.callee && arguments.callee.caller && arguments.callee.caller.name) ? arguments.callee.caller.name : '')); }
}
function OmnitureTrackCompleteSearch(pageName, searchTerm) {
    if (console && console.error) { console.error('OmnitureTrackCompleteSearch called by ' + ((arguments.callee && arguments.callee.caller && arguments.callee.caller.name) ? arguments.callee.caller.name : '')); }
}
function OmnitureTrackScheduleVisitWithRings(pageName, action, value) {
    if (console && console.error) { console.error('OmnitureTrackScheduleVisitWithRings called by ' + ((arguments.callee && arguments.callee.caller && arguments.callee.caller.name) ? arguments.callee.caller.name : '')); }
}

function OmnitureTrackActionAddToSavedItems(argItem, gridPosition, tileAttr) {
    var isHighlight = false;
    var isNew = false;
    if (!IsNullOrEmpty(tileAttr)) {
        tileAttr.split("|").forEach(function (entry) {
            switch (entry) {
                case 'highlight':
                    isHighlight = true;
                    break;
                case 'new':
                    isNew = true;
                    break;
                case 'surprise':
                    isSurprise = true;
                    break;
            }
        });

    }
    if (typeof (argItem) !== "undefined" && !IsNullOrEmpty(argItem)) {
        var dataObject = JSON.parse(argItem);
        if (typeof (dataObject.products) === "object" && dataObject.products !== null) {
            dataObject.products.forEach(function (entry) {
                if (!IsNullOrEmpty(gridPosition)) {
                    entry.position = gridPosition;
                }
                if (isHighlight) {
                    entry.isHighlight = true;
                }
                if (isNew) {
                    entry.isNew = true;
                }
            });
        }
        trackData(dataObject);
    }

}

function OmnitureTrackProductZoom(action, ImgName) {
    s.events = "event9";
    s.eVar36 = pageName + '->' + action + '->' + skuDescription;
    SetlinkTrackVars("eVar36,events", "event9");
    s.prop74 = 'OmnitureTrackProductZoom';
    s.tl(true, 'o', pageName + '->' + action + '->' + skuDescription);
    ClearlinkTrackVars();
}

function OmnitureTrackImageInteraction(interactionName, fileName) {

    if (interactionName.toLowerCase() == "view|seeiton") interactionName = "view|see it on";
    if (interactionName.toLowerCase() == "view|product") interactionName = "view|product image";

    if (!IsNullOrEmpty(interactionName)) {
        var dataObject = {
            'events': {
                'productImageInteraction': true},
            'interaction': {
                'name': interactionName,
                'file': fileName,
                'type': 'product image'}};
        // to prevent multiple calls submitting from zoom control. 
        var result = true;
        if (isValidDataObject(dataLayer) && isValidDataObject(dataLayer.interaction) && dataObject.interaction.name.indexOf("zoom") > -1) {
            if (JSON.stringify(dataLayer.interaction) === JSON.stringify(dataObject.interaction)) {
                result = false;
            }
        }
        if (result) {
            trackData(dataObject);
        }
    }
}

function OmnitureTrackItemOnRollOver(level1) {
    if (console && console.error) { console.error('OmnitureTrackItemOnRollOver called by ' + ((arguments.callee && arguments.callee.caller && arguments.callee.caller.name) ? arguments.callee.caller.name : '')); }
}

function OmnitureTrackExpandCollapseMarketingTiles(pageName, action, sectionName) {
    if (console && console.error) { console.error('OmnitureTrackExpandCollapseMarketingTiles called by ' + ((arguments.callee && arguments.callee.caller && arguments.callee.caller.name) ? arguments.callee.caller.name : '')); }
}

function OmnitureTrackItemPageShareType(linkName) {
    if (console && console.error) { console.error('OmnitureTrackItemPageShareType called by ' + ((arguments.callee && arguments.callee.caller && arguments.callee.caller.name) ? arguments.callee.caller.name : '')); }
}

function OmnitureTrackPDPTabActivity(linkName, itemDesc) {
    if (console && console.error) { console.error('OmnitureTrackPDPTabActivity called by ' + ((arguments.callee && arguments.callee.caller && arguments.callee.caller.name) ? arguments.callee.caller.name : '')); }
}

function OmnitureTrackDeviceInfo(category, data) {
    if (console && console.error) { console.error('OmnitureTrackDeviceInfo called by ' + ((arguments.callee && arguments.callee.caller && arguments.callee.caller.name) ? arguments.callee.caller.name : '')); }
}

function SetlinkTrackVars(vars, evts) {
    if (!IsNullOrEmpty(vars)) { s.linkTrackVars = vars; }
    if (!IsNullOrEmpty(evts)) { s.linkTrackEvents = evts; }
}

function ClearlinkTrackVars() {
    s.linkTrackVars = "None";
    s.linkTrackEvents = "None";
}
function OmnitureTrackRemoveSavedItem(argItem) {
    if (typeof (argItem) !== "undefined" && !IsNullOrEmpty(argItem)) {
        var dataObject = JSON.parse(argItem);
        trackData(dataObject);
    }
}
function OmnitureTrackRemoveSavedEngagementItem(argPageTitle, argAction) {
    if (!IsNullOrEmpty(argPageTitle) && !IsNullOrEmpty(argAction)) {
        s.events = "event23";
        SetlinkTrackVars("events", "event23");
        s.prop74 = 'OmnitureTrackRemoveSavedEngagementItem';
        s.tl(true, 'o', argPageTitle + " | ACTION | " + argAction);
        ClearlinkTrackVars();
    }
}
function OmnitureTrackMapLink(link) {
    if (!IsNullOrEmpty(link)) {
        s.prop74 = 'OmnitureTrackMapLink';
        s.tl(link, 'o', s.pageName + ' : Map It');
    }

}
function OmnitureTrackHomePagePromo(promo) {
    if (!IsNullOrEmpty(promo)) {
        s.eVar3 = promo;
        s.eVar3 = s.cleanParams(s.eVar3);
        SetlinkTrackVars("eVar3");
        s.prop74 = 'OmnitureTrackHomePagePromo';
        s.tl(true, 'o', ' hppromo: ' + promo);
    }

}

function OmnitureTrackCreateAccount(relationshipStatus, signupDate) {
    var dataObject = {
        'user': {
            'relationship': relationshipStatus,
            'createdOn': signupDate}};
    if (isValidDataObject(dataLayer.user)) {
        dataObject.user = dataLayer.user;
        dataObject.user.relationship = relationshipStatus;
        dataObject.user.createdOn = signupDate;
    }
    trackData(dataObject);
}

function OmnitureTrackSignOut() {
    s.events = "event50";
    s.prop74 = 'OmnitureTrackSignOut';
    s.t();
}
function OmnitureTrackAccountActivation() {
    s.events = "event3";
    s.prop74 = 'OmnitureTrackAccountActivation';
    s.t();
}
function OmnitureTrackSignIn() {
    s.events = "event2";
    s.prop74 = 'OmnitureTrackSignIn';
    s.t();
}
function OmnitureTrackEmailSignUp() {
    s.linkType = "o";
    s.linkName = "Link to E-mail Marketing - Footer Thank You";
    s.events = "event11";

    SetlinkTrackVars("events", "event11");
    s.prop74 = 'OmnitureTrackEmailSignUp';
    s.tl(true, 'o', "Link to E-mail Marketing - Footer Thank You");
    ClearlinkTrackVars();
}
function trackData(dataLayer) {
    try {
        _trackData(dataLayer);
    }
    catch (err) { }
}
function OmnitureTrackErrors(errors) {
    var dataObj = new Object;
    if (typeof (dataLayer) !== "undefined" && dataLayer !== null && typeof (dataLayer.page) !== "undefined" && dataLayer.page !== null) {
        dataObj.page = dataLayer.page;
        if (isValidDataObject(dataObj.page.errors)) {
            if (JSON.stringify(errors) === JSON.stringify(dataObj.page.errors)) {
                return;
            }
        }
        dataObj.page.errors = new Object;
        dataObj.page.errors = errors;
        dataObj.events = {
            'error': true};
    }
    else {
        dataObj.page = new Object;
        dataObj.page.errors = new Object;
        dataObj.page.errors = errors;
        dataObj.events = {
            'error': true};
    }
    trackData(dataObj);
}

//function OmnitureTrackMinificationErrors(errors) {
//    var dataObj = new Object;
//    if (typeof (dataLayer) !== "undefined" && dataLayer !== null && typeof (dataLayer.page) !== "undefined" && dataLayer.page !== null) {
//        dataObj.page = dataLayer.page;
//        if (isValidDataObject(dataObj.page.errors)) {
//            if (JSON.stringify(errors) === JSON.stringify(dataObj.page.errors)) {
//                return;
//            }
//        }
//        dataObj.page.errors = new Object;
//        dataObj.page.errors = errors;
//        dataObj.events = {
//            'error': true
//        };
//    }
//    else {
//        dataObj.page = new Object;
//        dataObj.page.errors = new Object;
//        dataObj.page.errors = errors;
//        dataObj.events = {
//            'error': true
//        };
//    }
//    trackData(dataObj);
//}

function OmnitureTrackVirtualPageViews(dataObj) {
    if (isValidDataObject(dataObj)) {
        var virtualPageName = dataObj.page.name;
        if (isValidDataObject(dataLayer)) {
            dataObj.page = dataLayer.page;
            var pn = dataObj.page.name.split(":");
            if (pn[0] !== null) {
                dataObj.page.name = pn[0] + ":" + virtualPageName;
            }
            else {
                dataObj.page.name = dataObj.page.name + ":" + virtualPageName;
            }

        }
    }
    else if (!IsNullOrEmpty(dataObj)) {
        var virtualPageName = dataObj;
        var dataObj = {
            'events': {
                'pageView': true}};
        if (isValidDataObject(dataLayer)) {
            dataObj.page = dataLayer.page;
            dataObj.translated = dataLayer.translated;
            dataObj.page.name = virtualPageName;
            dataObj.translated.page.name = virtualPageName;
        }
        
    }
    if (isValidDataObject(dataObj)) {
        trackData(dataObj);
    }
}
function isValidDataObject(dataObj) {
    if (typeof (dataObj) !== "undefined" && dataObj !== null && typeof (dataObj) === "object") {
        return true;
    }
    return false;
}
function OmnitureTrackSocialSharing(shareType) {
    if (!IsNullOrEmpty(shareType)) {
        var dataObject = {
            'events': {
                'share': true},
            'share': {
                'type': shareType}};
        trackData(dataObject);
    }
}
function OmnitureTrackFileDownload(fileName) {
    if (!IsNullOrEmpty(fileName)) {
        var dataObject = {
            'events': {
                'download': true},
            'download': {
                'filename': fileName}};
        trackData(dataObject);
    }
}
function OmnitureTrackPDPTabInteraction(tabName) {
    if (!IsNullOrEmpty(tabName)) {
        var dataObject = {
            'events': {
                'viewProductTab': true},
            'interaction': {
                'name': tabName.toLowerCase(),
                'type': 'tab'}};
        trackData(dataObject);
    }
}

function OmnitureTrackSiteInteractions(name, type, id) {
    if (!IsNullOrEmpty(name) && !IsNullOrEmpty(type)) {
        var dataObject = {
            'events': {
                'siteInteraction': true},
            'interaction': {
                'name': name,
                'type': type}};
        trackData(dataObject);
    }
}

function OmnitureTrackExitLinkSiteInteraction(name, type, exitURL) {
    if(!IsNullOrEmpty(name) && !IsNullOrEmpty(type) && !IsNullOrEmpty(exitURL))
    {
        var dataObject = {
            'events': {
                'siteInteraction': true,
                'exit':true
            },
            'interaction': {
                'name': name.toLowerCase(),
                'type': type.toLowerCase()
            },
            'exit': {
                'linkURL': exitURL.replace(/^(https?:|)\/\//, '')
            }
        };
        trackData(dataObject);
    }

}


function OmnitureTrackBreadcrumbInteractions(name, type, isGoBackLink) {
    var dtmCategoryBrowsePageName = 'product landing page';
    var dtmPDPPageName = 'product detail page - refresh';
    var dtmStoreDetailsPageName = 'store location detail';
    var pageName;
    if (!IsNullOrEmpty(name) && !IsNullOrEmpty(type)) {
        switch (name.toLowerCase())
        {
            case 'categorybrowse':
                pageName = dtmCategoryBrowsePageName;
                break;
            case 'item':
                pageName = dtmPDPPageName;
                break;
            case 'store':
                pageName = [dtmStoreDetailsPageName];
                break;
        }
        if (isGoBackLink)
        {
            switch (name.toLowerCase()) {
               
                case 'categorybrowse':
                case 'item':
                    pageName = "|" + pageName + "|" + "go back";
                    break;
                case 'store':
                    pageName =  pageName + "|" + "go back";

                    break;
                
            }
        }
        else {
            switch (name.toLowerCase()) {
                case 'categorybrowse':
                case 'item':
                    pageName = "|" + pageName;
                    break;
               }
        }
                    
         var dataObject = {
                'events': {
                    'siteInteraction': true
                },
                'interaction': {
                    'name': pageName,
                    'type': type
                }
         };
         trackData(dataObject);
        }
       
    }
function OmnitureTrackStoreSelection()
{
    var dataObject = {
        'events': {
            'selectStore': true
        }
    };
       trackData(dataObject);
}
 
function OmnitureTrackScheduleDiamondConsultation() {
    var dataObject = {
        'events': {
            'diamondVisit': true
        }
    };
    trackData(dataObject);
}

function OmnitureTrackViewMoreStoreEvents(eventID) {
    var dataObject = {
        'events': {
            'viewStoreEvent': true
        }
    };
    if (isValidDataObject(dataLayer) && isValidDataObject(dataLayer.storeLocator)) {
        dataObject.storeLocator = dataLayer.storeLocator;
    }
    if (!isValidDataObject(dataObject.storeLocator) && !IsNullOrEmpty(eventID)) {
        dataObject.storeLocator = new Object();
    }
    if (!IsNullOrEmpty(eventID)) {
        dataObject.storeLocator.eventID = eventID;
    }

    trackData(dataObject);

}



function OmnitureTrackStoreLocInteractions(name, type, storeID, eventID) {
    if (!IsNullOrEmpty(name) && !IsNullOrEmpty(type)) {
        var dataObject = {
            'events': {
                'siteInteraction': true},
            'interaction': {
                'name': name,
                'type': type}};
        if (isValidDataObject(dataLayer) && isValidDataObject(dataLayer.storeLocator)) {
            dataObject.storeLocator = dataLayer.storeLocator;
        }
        if (!isValidDataObject(dataObject.storeLocator) && (!IsNullOrEmpty(storeID) || !IsNullOrEmpty(eventID))) {
            dataObject.storeLocator = new Object();
        }
        if (!IsNullOrEmpty(storeID)) {
            dataObject.storeLocator.storeID = storeID;
        }
        if (!IsNullOrEmpty(eventID)) {
            dataObject.storeLocator.eventID = eventID;
        }

        trackData(dataObject);
    }
}

function omnitureTrackSearchFindItemInStore(keyword) {
    var dataObject = {
        'events': {
            'findInStoreSearch': true
        },
        'storeLocator': {
            'keyword': keyword.toLowerCase()
        }
    };
    trackData(dataObject);
}
function omnitureTrackSelectFindItemInStore(storeName) {
    var dataObject = {
        'events': {
            'selectStore': true
        },
        'storeLocator': {
            'storeID': storeName
        }
    };
    trackData(dataObject);
}
function omnitureTrackLoadMore() {
    var dataObject = {
        'events': {
            'loadMoreResults': true
        }
    };
    trackData(dataObject);
}
function OmnitureTrackHolidaySiteInteractions(name, type, id) {
    if (!IsNullOrEmpty(name) && !IsNullOrEmpty(type)) {
        var dataObject = {
            'events': {
                'siteInteraction': true
            },
            'interaction': {
                'name': "viewed section " + name,
                'type': type
            }
        };
        if (isValidDataObject(dataLayer)) {
            dataObject.page = dataLayer.page;
            if (!IsNullOrEmpty(dataObject.page.hierarchy) && !IsNullOrEmpty(dataObject.page.hierarchy[0])) {
                dataObject.page.hierarchy = [dataObject.page.hierarchy[0], name];
            }
        }
        trackData(dataObject);
    }
}
function omnitureTrackBannerImpression(bannerType, bannerCode) {
   
    var dataObject = {
        'events': {
            'bannerImpression': true
        }
    };
    if (isValidDataObject(dataLayer)) {
        dataObject.page = dataLayer.page;
        dataObject.page.bannerType = bannerType;
        if (!IsNullOrEmpty(bannerCode)) {
            dataObject.page.bannerCode = bannerCode;
        }

    }
    trackData(dataObject);
}
function omnitureTrackGiftMessageStart() {
    var dataObject = {
        'events': {
            'giftMessageStart': true
        }
    };
    if (isValidDataObject(dataLayer) && isValidDataObject(dataLayer.products)) {
        dataObject.products = dataLayer.products;   
    }
    trackData(dataObject);
}
function omnitureTrackModalPageView(pageObj) {
    if (isValidDataObject(pageObj)) {
        var dataObj = {
            'events': {
                'pageView': true
            }
        };
        dataObj.page = pageObj;
        trackData(dataObj);
    }  
}

function omnitureTrackCartMerge(pageObj) {
    if (isValidDataObject(pageObj)) {
        var dataObj = {
            'events': {
                'pageView': true,
                'cartView': true
            }
        };
        dataObj.page = pageObj;
        trackData(dataObj);
    }
}
function omnitureTrackCarousel(trackId, pageId, direction) {   
    if (IsNullOrEmpty(pageId)) {
        pageId = "";
    }
    if (!IsNullOrEmpty(trackId)) {
        var iName = "";
        var iType = "";
        switch (trackId.toLowerCase()) {
            case 'giftguidemomcarousel':
                iName = SWIPE_MORE + GG_MOM;
                iType = GG_INTERACTION_TYPE;
                break;
            case 'giftguidedadcarousel':
                iName = SWIPE_MORE + GG_DAD;
                iType = GG_INTERACTION_TYPE;
                break;
            case 'giftguidegradcarousel':
                iName = SWIPE_MORE + GG_GRAD;
                iType = GG_INTERACTION_TYPE;
                break;
            case 'bluebookexplorecarousel':
            case 'bluebookproductcarousel':
                if (!IsNullOrEmpty(direction)) {
                    iName = CAROUSEL_CLICK + SPACER + direction.toLowerCase();
                    iType = BLUEBOOK;
                }                
                break;
        }
       

        if (!IsNullOrEmpty(trackId) && trackId.indexOf("tty", 0) == 0) {
                iName = SWIPE + trackId.replace("tty_","").toLowerCase() + ": " + pageId.toLowerCase();
                iType = TTY_INTERACTION_TYPE;          
        }
        else if (!IsNullOrEmpty(trackId) && trackId.indexOf("da", 0) == 0 && !IsNullOrEmpty(pageId)) {
            switch (pageId) {
                case 'Page 0' :
                    pageId='Table';
                    break;
                case 'Page 1':
                    pageId='Girdle';
                    break;
                case 'Page 2' :
                    pageId='Pavilion';
                    break;
                case 'Page 3' :
                    pageId='Cutlet';
                    break;
                case 'Page 4' :
                    pageId='Crown';
                    break;
            }
            iName = trackId.replace("da_", "").toLowerCase() + "_" + pageId.toLowerCase();
            iType = DA_INTERACTION_TYPE;

}
        if (!IsNullOrEmpty(iName) && !IsNullOrEmpty(iType)) {
            OmnitureTrackSiteInteractions(iName, iType);
        }        
    }
}
function omnitureTrackBGSortMethod(dtmSortMethod, count) {     
    if (isValidDataObject(dataLayer) && isValidDataObject(dataLayer.search)) {
        var dataObj = {
            'events': {
                'pageView': true
            }
        };

        dataObj.events.search = dataLayer.events.search;
        dataObj.search = dataLayer.search;

        if (dataObj.events.search === true && !IsNullOrEmpty(count)) {
            dataObj.search.resultCount = count;
        }
        if (!IsNullOrEmpty(dtmSortMethod)) {
            // iTrack#30584
            dataObj.search.sortTool = dtmSortMethod.toLowerCase();
        }
        // track sortMethod as default on initial load
        dataObj.search.sortMethod = 'default';
        trackData(dataObj)
    }    
}

function omnitureTrackBYOSiteInteractions(name, type) {
    if (!IsNullOrEmpty(name) && !IsNullOrEmpty(type)) {
        var dataObject = {
            'events': {
                'siteInteraction': true               
            },
            'interaction': {
                'name': name,
                'type': type
            }
        };
        trackData(dataObject);
    }
}
function omnitureTrackBYOSaveAndPreview() {    
        var dataObject = {
            'events': {
                'charmSave': true
            }           
        };
        trackData(dataObject);    
}
// track vday tattoo virtual page views and site interactions together
function omnitureTrackVirtualPageAndSiteInteractions(dataObj) {     
    if (isValidDataObject(dataObj) && !IsNullOrEmpty(dataObj.interactionName) && !IsNullOrEmpty(dataObj.type)) {
        var dataObject = {
            'events': {
                'pageView': true,
                'siteInteraction': true
            },
            'interaction': {
                'name': dataObj.interactionName,
                'type': dataObj.type
            }
        };

        if (isValidDataObject(dataLayer) && isValidDataObject(dataLayer.page)) {
            dataObject.page = dataLayer.page;
        }
        if (isValidDataObject(dataLayer) && isValidDataObject(dataLayer.translated) && isValidDataObject(dataLayer.translated.page)) {
            dataObject.translated = dataLayer.translated;
        }
        var virtualPageName = dataObj.pageName + ":" + dataObj.interactionName;
        dataObject.page.name = virtualPageName;
        dataObject.translated.page.name = virtualPageName;
        trackData(dataObject);
    }
}



/**
* @author Partha Banerjee  
* Dt 11/10/2011
*/
/*  Begin Helper Functions */

// This function tracks data for header menus
function TrackHeaderMenuEvent(menu) {
    //Omniture
    if (Is_Omniture_Enabled == 'true') {
        if (!IsNullOrEmpty(menu)) {
            menu = menu.toLowerCase();
            OmnitureTrackNavigationalLinks(menu, 'header');
        }
    }
}

// This function tracks data for menu items such as categories.
function TrackHeaderMenuItemEvent(menu, menuLabel, menuItemName) {
    //Omniture
    if (Is_Omniture_Enabled == 'true') {
        OmnitureTrackHeaderMenuItem(menu, menuLabel, menuItemName);
    }
}
function TrackQuickViewHeaderLinks(menu) {
    if (Is_Omniture_Enabled == 'true') {
        if (!IsNullOrEmpty(menu)) {
            menu = menu.toLowerCase();
            OmnitureTrackQuickViewHeaderLinks(menu, 'header');
        }
    }
}

// This function tracks data for click event on footer links.
function TrackFooterClickEvent(link) {
    // Omniture tracking for Footer link click
    if (Is_Omniture_Enabled == 'true') {
        OmnitureTrackNavigationalLinks(link, 'footer');
    }
}

// Function to track Explore All link
function TrackExploreAll(masterCategoryName) {
}

// Function to track Headline/Image click in Header Flyout
function TrackHeadlineOrImage(masterCategoryName) {
}
// Function to track "View More Stores and Events" link. 
function TrackViewMoreStoreEvents(eventID) {
    if (Is_Omniture_Enabled == 'true') {
        OmnitureTrackViewMoreStoreEvents(eventID);
    }
}

function TrackStoreSelection()
{
  if (Is_Omniture_Enabled == 'true') {
        OmnitureTrackStoreSelection();
    }
}

function TrackScheduleDiamondConsultation() {
    if (Is_Omniture_Enabled == 'true') {
        OmnitureTrackScheduleDiamondConsultation();
    }
}

function TrackViewAllStoresInCountry(countryandLoc) {
}

// Function to track sort options from different page
// Here pageName will contain the name of the page from where request is coming
// and sortOption will contain the option value that was selected. 
function TrackSortOptions(pageName, sortOption, sortTool) {
    if (Is_Omniture_Enabled == 'true') {
        OmnitureTrackSortOptions(pageName, sortOption, sortTool);
    }
}
function TrackEndecaDimensions(searchFilters) {
    var endecaDimension = searchFilters.filterType;
    var selectedValue = searchFilters.filterName;
    var categoryName = searchFilters.categoryName;
    if (Is_Omniture_Enabled == 'true') {
        OmnitureTrackEndecaDimensions(searchFilters);
    }
}

function TrackEngagementFilters(searchFilters) {
    var endecaDimension = searchFilters.filterType;
    var selectedValue = searchFilters.filterName;
    var categoryName = searchFilters.categoryName;
    if (Is_Omniture_Enabled == 'true') {
        OmnitureTrackEngagementFilters(searchFilters);
    }
}

function trackStoreFilters(searchFilters) {
    //var endecaDimension = searchFilters.filterType;
    //var selectedValue = searchFilters.filterName;
    //var categoryName = searchFilters.categoryName;
    if (Is_Omniture_Enabled == 'true') {
        omnitureTrackStoreFilters(searchFilters);
    }
}

// Function to track "View All Link" click.
function TrackLoadMoreResults(pageName, linkName) {
}

// This function is used to track different display modes that are used to see items in different way
// pagename - Name of the page from where request is made.
// action - Example "Full screen overlay", "Video overlay"
// skuDescription - SKU description of the item.
function TrackItemDisplayOption(pageName, action, skuDescription, imgName) {
    if (Is_Omniture_Enabled == 'true') {
        // OmnitureTrackItemDisplayOption(pageName, action, skuDescription);
        if (!IsNullOrEmpty(action) && !IsNullOrEmpty(imgName)) {
            var interactionName = "view|" + action;
            OmnitureTrackImageInteraction(interactionName, imgName);
        }

    }
}

// This function is responsible to track click event on links in item pages and also from some other pages. 
// Since this function is being used from several pages so we have kept this as it is now. But, in future  we need to shift omniture code to SiteTrackingOmniture.js and 
// GA related code to SiteTrackingGA.js file.

function sendOmnitureClickEvent(linkname) {
    if (Is_Omniture_Enabled == 'true') {
        OmnitureClickEvent(linkname);
    }
}

// This function is responsible to track any activities done from Item Emails.
function sendOmnitureItemEmailClicks(omie) {
}

// Function to track click count on items in Recently Viewed items.
// pageName - Name of the page from where the request is made
// skuDescription - SKU description
function TrackSKUInRecentlyViewedItems(pageName, skuDescription) {
}

function TrackSeeItOn(pageName, action, value) {

    if (Is_Omniture_Enabled == 'true') {
        OmnitureTrackSeeItOn(pageName, action, value);
    }

}

// This function tracks "Learn More" links in scheduled diamond consultation.
function TrackLearnMoreLink(pageName, value) {
}

// This function tracks click on "Schedule Visit" link.
function TrackScheduleVisit(pageName, action) {
}

//This function tracks Carousel links click
// pageName - Name of the page
// carousalName - Name of the Carousal
// slideNumber - Number of clicked slide.  
function TrackCarouselClick(pageName, carousalName, slideNumber) {
}

// Action can be Grid Link Click or Carousel Link Click

function TrackLinkClickFromGridOrCarousel(pageName, action, linkValue) {
}


// This function to track pagination from Inline shopping bag or Inline saved item.
// pageName - "Inline Shopping Bag" or "Inline Saved Item" 
// pageNumber - Numbe rof page clicked
function TrackInlineCustomerSelectionPaginate(pageName, pageNumber) {
}

// Function to track View By drop down of wish list.
// value represents the option chosen from drop down.
function TrackWishListViewBy(value) {
}

// Function to do web tracking on links available in Full page wish list.

function OmnitureTrackFullSaveItemLinkClick(linkName) {
}

function TrackPrintEmailClick(argPageTitle, argAction, skuValue) {
    var pageName;
    var company = "Tiffany & Co. | ";
    if (locale == "en-us-ird") {
        company = "IRIDESSE Pearls | ";
    }
    pageName = company + argPageTitle + " | ACTION | " + argAction;
    //Set Omniture variables
    s.pageName = pageName;
    s.prop8 = argPageTitle + " -> " + argAction;
    //Submit Omniture variable 	
    s.t();
    GATrackAction(argPageTitle, argAction, skuValue);
}

function TrackActionAddToShoppingBag(argPageTitle, argItem, gridPosition, tileAttr) {
    if (Is_Omniture_Enabled == 'true') {
        omnitureTrackActionAddToShoppingBag(argPageTitle, argItem, gridPosition, tileAttr);
    }

}

function TrackActionMobileLoadMoreResults(argPageTitle, action) {
    if (Is_Omniture_Enabled == 'true') {
        omnitureTrackMobileLoadMoreResults(argPageTitle, action);
    }
}

function TrackMobileCarousel(value) {
}

function TrackExitLinkClick(linkObject, linkName) {
    if (Is_Omniture_Enabled == 'true') {
        OmnitureExitLinkTracking(linkObject, linkName);
    }
}

function TrackSearchTerm(searchTerm, count) {
    /* DTM Phse 2, Batch-2 internal search changes - tracking is performed on pageload and client side tracking is removed
    if (Is_Omniture_Enabled == 'true') {
        OmnitureTrackSearchTerm(searchTerm, count);
    }
    */
}

function TrackStoreSearchTerm(searchTerm) {
    if (Is_Omniture_Enabled == 'true') {
        omnitureTrackStoreSearchTerm(searchTerm);
    }

}

function TrackPrepopulatedSearchTerm(searchTerm) {
    if (Is_Omniture_Enabled == 'true') {
        omnitureTrackPrepopulatedSearchTerm(searchTerm);
    }
}
function TrackViewRemainingItems(pageName, linkName) {
}

function TrackVideo(videoName, action, value, totalTime) {
    omnitureTrackVideo(videoName, action, value, totalTime);
}

function TrackMasterCategoryShopLinksClick(masterCategory, linkName) {
    //Omniture
    if (Is_Omniture_Enabled == 'true') {
        if (!IsNullOrEmpty(masterCategory) && !IsNullOrEmpty(linkName)) {
            var menuItem = masterCategory + "," + linkName;
            OmnitureTrackNavigationalLinks(menuItem, 'mid-page');
        }        
    }
}

function TrackWeddingBandDetailsLink(pageName, action, value) {
}

function TrackSkinToneSeeItOn(pageName, action, value) {
}

function TrackCaratSizeSeeItOn(pageName, action, value) {
}

function TrackInlineShoppingBagViewItems(argPageTitle, argAction, argItems) {
    if (Is_Omniture_Enabled == 'true') {
        omnitureTrackInlineShoppingBagViewItems(argPageTitle, argAction, argItems);
    }

}

function TrackInlineViewSavedItems(argPageTitle, argAction) {
}

function TrackInlineRemoveShoppingBagItem(argPageTitle, argAction) {
    if (Is_Omniture_Enabled == 'true') {
        omnitureTrackInlineRemoveShoppingBagItem(argPageTitle, argAction);
    }

}
function TrackInlineRemoveShoppingBagItem(argPageTitle, argAction, argItem) {
    if (Is_Omniture_Enabled == 'true') {
        omnitureTrackInlineRemoveShoppingBagItem(argPageTitle, argAction, argItem);
    }

}

function TrackInlineRemoveSavedItem(argPageTitle, argAction, argItem) {

    if (Is_Omniture_Enabled == 'true') {
        omnitureTrackInlineRemoveSavedItem(argItem);
    }

}

function TrackInlineShoppingBagLinksClick(argPageTitle, argAction) {
}

function TrackInlineSavedItemsLinkClick(argPageTitle, argAction) {
}

function TrackSavedItemsViewBy(argPageTitle, argAction) {
}

function TrackSavedItemsViewByImageSize(argPageTitle, argAction) {
}
function TrackSKUInRecentlyViewedItemPageItems(ItemViewSource, skuDescription) {
}

function TrackCompleteSearch(pageName, searchTerm) {
}

function TrackScheduleVisitWithRings(pageName, action, value) {
}

function TrackActionAddToSavedItems(argPageTitle, argAction, skuValue, argItem, gridPosition, tileAttr) {
    if (Is_Omniture_Enabled == 'true') {
        OmnitureTrackActionAddToSavedItems(argItem, gridPosition, tileAttr);
    }

}

function TrackProductZoom(pageName, action, skuDescription, imgName) {
    if (Is_Omniture_Enabled == 'true') {
        if (!IsNullOrEmpty(action) && !IsNullOrEmpty(imgName)) {
            var interactionName = "zoom|" + action;
            OmnitureTrackImageInteraction(interactionName, imgName);
        }
    }
}

function TrackItemOnRollOver(level1, level2) {
}

function TrackExpandCollapseMarketingTiles(pageName, action, sectionName) {
}

function TrackItemPageShareType(linkName) {
}
function TrackPDPTabActivity(linkName, itemDesc) {
    if (Is_Omniture_Enabled == 'true') {
        OmnitureTrackPDPTabInteraction(linkName);
    }
}

function TrackDeviceInfo(category, data) {
    /* Empty */
}

function TrackRemoveSavedItem(argPageTitle, argAction, argItem) {
    if (Is_Omniture_Enabled == 'true') {
        OmnitureTrackRemoveSavedItem(argItem);
    }
}

function TrackRemoveSavedEngagementItem(argPageTitle, argAction) {
    if (Is_Omniture_Enabled == 'true') {
        OmnitureTrackRemoveSavedEngagementItem(argPageTitle, argAction);
    }
}
function TrackMapLink(link) {
    if (Is_Omniture_Enabled == 'true') {
        OmnitureTrackMapLink(link);
    }
}
function TrackHomePagePromo(promo) {
    if (Is_Omniture_Enabled == 'true') {
        OmnitureTrackHomePagePromo(promo);
    }
}
function TrackCreateAccount(relationshipStatus, signupDate) {
    if (Is_Omniture_Enabled == 'true') {
        OmnitureTrackCreateAccount(relationshipStatus, signupDate);
    }

}
function TrackSignOut() {
    if (Is_Omniture_Enabled == 'true') {
        OmnitureTrackSignOut();
    }
}

function TracAccountActivation() {
    // GA tracking done on the Passwordreset.aspx page
    if (Is_Omniture_Enabled == 'true') {
        OmnitureTrackAccountActivation();
    }
}
function TrackSignIn() {
    // GA tracking done on the signin.aspx page
    if (Is_Omniture_Enabled == 'true') {
        OmnitureTrackSignIn();
    }
}
function TrackEmailSignUp(isCreateAccount, signUpDate) {
    if (Is_Omniture_Enabled == 'true') {
        OmnitureTrackEmailSignUp();
    }
    if (isCreateAccount) {
        TrackCreateAccount('', signUpDate);
    }
}
function trackErrors(errors) {
    if (Is_Omniture_Enabled == 'true') {
        OmnitureTrackErrors(errors);
    }
}
function TrackVirtualPageViews(dataObj) {
    if (Is_Omniture_Enabled == 'true') {
        OmnitureTrackVirtualPageViews(dataObj);
    }
}
function TrackFileDownload(fileName) {
    if (Is_Omniture_Enabled == 'true') {
        OmnitureTrackFileDownload(fileName);
    }
}
function TrackSiteInteractions(name, type) {
    if (Is_Omniture_Enabled == 'true') {
        OmnitureTrackSiteInteractions(name, type);
    }
}

function TrackExitLinkSiteInteraction(name, type, exitURL) {
    if (Is_Omniture_Enabled == 'true') {
        OmnitureTrackExitLinkSiteInteraction(name, type, exitURL);
    }
}
function TrackBreadcrumbInteractions(name, type, isGoBackLink) {
    if (Is_Omniture_Enabled == 'true') {
        OmnitureTrackBreadcrumbInteractions(name, type, isGoBackLink);
    }
}

function TrackStoreLocInteractions(name, type, storeID, eventID) {
    if (Is_Omniture_Enabled == 'true') {
        OmnitureTrackStoreLocInteractions(name, type, storeID, eventID);
    }

}
// This function tracks data for header menus
function TrackNavigationalLinks(menu, location) {
    //Omniture
    if (Is_Omniture_Enabled == 'true') {
        if (!IsNullOrEmpty(menu) && !IsNullOrEmpty(location)) {
            OmnitureTrackNavigationalLinks(menu, location);
        }
    }
}

function TrackNavigationalExitLinkEvent(location, linkName, exitLinkText, isTelephoneNo) {
    if (Is_Omniture_Enabled == 'true') {
        OmnitureTrackNavigationalExitLinkEvent(location, linkName, exitLinkText, isTelephoneNo);
    }
}
function trackSearchFindItemInStore(keyword) {
    //Omniture
    if (Is_Omniture_Enabled == 'true') {
        if (!IsNullOrEmpty(keyword)) {
            omnitureTrackSearchFindItemInStore(keyword);
        }
    }
}
function trackSelectFindItemInStore(storeName) {
    //Omniture
    if (Is_Omniture_Enabled == 'true') {
        if (!IsNullOrEmpty(storeName)) {
            omnitureTrackSelectFindItemInStore(storeName);
        }
    }
}
function trackLoadMore() {
    //Omniture
    if (Is_Omniture_Enabled == 'true') {
        omnitureTrackLoadMore();
    }
}
function TrackHolidaySiteInteractions(name, type) {
    if (Is_Omniture_Enabled == 'true') {
        OmnitureTrackHolidaySiteInteractions(name, type);
    }
}

function trackBannerImpression(bannerType, bannerCode) {
    //Omniture
    if (Is_Omniture_Enabled == 'true') {
        if (!IsNullOrEmpty(bannerType)) {
            omnitureTrackBannerImpression(bannerType, bannerCode);
        }
    }
}
function trackGiftMessageStart() {
    //Omniture
    if (Is_Omniture_Enabled == 'true') {
        omnitureTrackGiftMessageStart();
    }
}
function trackModalPageView(dataObj) {
    if (Is_Omniture_Enabled == 'true') {
        omnitureTrackModalPageView(dataObj);
    }
}
function trackCartMerge(dataObj) {
    if (Is_Omniture_Enabled == 'true') {
        omnitureTrackCartMerge(dataObj);
    } 
}
function trackCarousel(trackId, pageId, direction) {
    if (Is_Omniture_Enabled == 'true') {
        omnitureTrackCarousel(trackId, pageId, direction);
    }
}
function trackBGSortMethod(dtmSortMethod, count) {
    if (Is_Omniture_Enabled == 'true') {
        omnitureTrackBGSortMethod(dtmSortMethod, count);
    }
}
function trackBYOSiteInteractions(name, type) {
    if (Is_Omniture_Enabled == 'true') {
        omnitureTrackBYOSiteInteractions(name, type);
    }
}
function trackBYOSaveAndPreview() {
    if (Is_Omniture_Enabled == 'true') {
        omnitureTrackBYOSaveAndPreview();
    }
}
function trackVirtualPageAndSiteInteractions(dataObj) {
    if (Is_Omniture_Enabled == 'true') {
        omnitureTrackVirtualPageAndSiteInteractions(dataObj);
    }
}



/* End of SiteTracking.js */
ï»¿// ** Begin functions brought over from old JavaScript.ascx
var agt = navigator.userAgent.toLowerCase();
var appVer = navigator.appVersion.toLowerCase();
var is_minor = parseFloat(appVer);
var is_major = parseInt(is_minor);

// If Mac platform, also use the Macintosh style sheet.
/*
if (navigator.platform.indexOf('Mac') != -1) {
	document.write('<link rel="stylesheet" href="/Shared/css/screen_mac.css?v=8">');
	document.write('<link rel="stylesheet" href="/Local/'+locale+'/css/local_mac.css?v=8">');
}
*/

if (isStmtInternal.toLowerCase() == "true") {
    document.write('<link rel="stylesheet" href="/Local/' + locale + '/css/internal.css?v=7.1">');
}

function isIEUnsupported() {
    var iePos = appVer.indexOf('msie');
    if (iePos != -1) {
        is_minor = parseFloat(appVer.substring(iePos + 5, appVer.indexOf(';', iePos)));
        is_major = parseInt(is_minor);
    }
    if ((iePos != -1) && is_major < 6) {
        if (isRetail.toLowerCase() == "true") { return false; }
        else { return true; }
    }
    else { return false; }
}

function isSafariUnsupported() {
    if ((agt.indexOf('safari') > 0) && agt.indexOf('mac') > 0) {
        is_minor = parseFloat(agt.substring(agt.indexOf('safari') + 7, agt.indexOf('safari') + 12));
        is_major = parseInt(is_minor);
        if (is_major < 412) { return true; }
        else { return false; }
    }
}

function isSafari3Plus() {
    if (agt.indexOf('safari') > 0) {
        is_minor = parseFloat(agt.substring(agt.indexOf('safari') + 7, agt.indexOf('safari') + 12));
        is_major = parseInt(is_minor);
        if (is_major >= 500) { return true; }
        else { return false; }
    }
    return false;
}

var browserName = navigator.appName;
var browserVer = parseInt(navigator.appVersion);
var isMac = (navigator.appVersion.indexOf("Mac") != -1);
//Do Object detection
if (document.getElementById) {
    if ((browserName == "Netscape" && browserVer < 5) || isIEUnsupported() || isSafariUnsupported() || (browserName == "Microsoft Internet Explorer" && isMac)) {
        document.location.href = "/Common/errors/upgrade.aspx";
    }
}
else { document.location.href = "/Common/errors/upgrade.aspx"; }


function shouldPriceBeVisible() {
    if ((locale.toLowerCase() == "intl" && isRetail.toLowerCase() == "false") || (locale.toLowerCase() == "zh-cn") || (locale.toLowerCase().indexOf("watch") > -1)) {
        return false;
    }
    return true;
}

function Redirect(url) {
    window.location = url;
}

// ND: Added so that tIFR could access user agent through ExternalInterface
function getUserAgent() {
    return navigator.userAgent.toLowerCase();
}

// ND: Added so that tIFR could access browser detection through ExternalInterface
function isBrowserIE() {
    var iePos = appVer.indexOf('msie');
    if (iePos != -1) {
        is_minor = parseFloat(appVer.substring(iePos + 5, appVer.indexOf(';', iePos)));
        is_major = parseInt(is_minor);
    }

    if ((iePos != -1) && is_major >= 4) {
        return true;
    }
    else {
        return false;
    }
}

function isIPhone() {
    if (navigator.userAgent.match(/iPhone/i) != null) {
        return true;
    }
    return false;
}

function isIPad() {
    if (navigator.userAgent.match(/iPad/i) != null) {
        return true;
    }
    return false;
}

function isIPod() {
    if (navigator.userAgent.match(/iPod/i) != null) {
        return true;
    }
    return false;
}

function isBlackBerry() {
    if (navigator.userAgent.match(/BlackBerry/i) != null) {
        return true;
    }
    return false;
}

function isKindle() {
    if (navigator.userAgent.match(/Kindle/i) != null) {
        return true;
    }
    else if (navigator.userAgent.match(/Silk-Accelerated/i) != null) {
        return true;
    }
    return false;
}

function isKindleFire() {
    if (navigator.userAgent.match(/Kindle Fire/i) != null) {
        return true;
    }
    else if (navigator.userAgent.match(/Silk-Accelerated/i) != null) {
        return true;
    }
    return false;
}

function isWindowsPhone() {
    if (navigator.userAgent.match(/Windows Phone/i) != null) {
        return true;
    }
    return false;
}

function isAndroid() {
    if (navigator.userAgent.match(/Android/i) != null) {
        return true;
    }
    return false;
}

function isAndroidMobile() {
    if (navigator.userAgent.match(/Android/i) != null && navigator.userAgent.match(/Mobile/i) != null) {
        return true;
    }
    return false;
}
function isAndroidTablet() {
    if (navigator.userAgent.match(/Android/i) != null && navigator.userAgent.match(/Mobile/i) == null) {
        return true;
    }
    return false;
}

function isMobile() {
    return isIPhone() || isIPad() || isIPod() || isAndroid();
}

function isSmallMobile() {
    return isIPhone() || isIPod() || isAndroidMobile();
}

function isTablet() {
    return isIPad() || isAndroidTablet();
}

function isMobileDomain() {
    var url = document.location.href;
    url = url.split("http://").join("").split("https://").join("");
    if (url.indexOf("m") == 0) {
        return true;
    }
    return false;
}

// ** End functions brought over from old JavaScript.ascx



/* Begin General Scripts */
//Get the true height of any given page
function getPageHeight() {
    return document.getElementById('container').offsetHeight;
}

function getPageWidth() {
    return document.getElementById('container').offsetWidth;
}

//Get Y Coordinate of an object
function findPosY(obj) {
    var curtop = 0;
    if (obj.offsetParent) {
        while (1) {
            curtop += obj.offsetTop;
            if (!obj.offsetParent) {
                break;
            }
            obj = obj.offsetParent;
        }
    } else if (obj.y) {
        curtop += obj.y;
    }
    return curtop;
}

function isIridesse() {
    if (typeof (locale) != "undefined" && locale != "") {
        if (locale.toLowerCase().indexOf("ird") > -1) {
            return true;
        }
    }
    return false;
}

/* Begin Navagation Script */
navHover = function () {
    var NavItem = document.getElementById("nav").getElementsByTagName("LI");
    for (var i = 0; i < NavItem.length; i++) {
        NavItem[i].onmouseover = function () {
            this.className += " navhover";
        };
        NavItem[i].onmouseout = function () {
            this.className = this.className.replace(new RegExp(" navhover\\b"), "");
        };
    }
};

var navDisabled = false;

function navOnOff() {
    changeSignOut();
    HandleEStoreSession();
    if (navDisabled) {
        document.write('<style>#nav LI:hover UL {LEFT: -999em;}</style>');
    }
    else {
        if (window.attachEvent) window.attachEvent("onload", navHover);
    }
}

/* Begin Search Script*/
var SearchDiv;
var timerOn = false;
var timecount = 800;
var isSearchOpen = false;
var advSearchIsOpen = false;
var advMenuItems = "";
var searchFieldHasFocus = false;
var isSearchCloseBlocked = false;
var SearchDivLink;

function stopTimer() {
    if (timerOn) {
        clearTimeout(timerID);
        timerID = null;
        timerOn = false;
    }
}
var isStoreSearch = false;
var isStoreSearchAvailable = false;
var searchMode = "";
function checkifSearchOpen(mode) {
    if (mode == "store") { isStoreSearch = true; }
    else { isStoreSearch = false }
    if (isSearchOpen && (searchMode == mode)) {
        closeSearch();
    }
    else if (isSearchOpen && (searchMode != mode)) {
        closeSearch();
        if (!navDisabled) {
            openSearch();
            searchMode = mode;
        }
    }
    else {
        if (!navDisabled) {
            openSearch();
            searchMode = mode;
        }
    }
    if (isStoreSearch) {
        s.prop3 = "Search Store";
        s.eVar8 = "Search Store";
        s.pageName = "Activity | Search Store Tab Click";
    }
    else {
        s.prop3 = "Search";
        s.eVar8 = "Search";
        s.pageName = "Activity | Search Tab Click";
    }
    void (s.t());

}

function openSearch() {
    SearchDiv = document.getElementById("search");
    SearchDiv.className += " searchOn";
    isSearchOpen = true;
    document.getElementById("ctlHeader_ctlSearch_searchError").innerHTML = "&nbsp;";
    document.getElementById("ctlHeader_ctlSearch_searchError").style.display = "none";
    if (locale == "en-US-Watch" || locale == "en-US-Stmt") {
        document.forms[0].ctlHeader_ctlSearch_searchInput.value = "";
    }
    else {
        if (isStoreSearch) { document.forms[0].ctlHeader_ctlSearch_searchInput.value = txtStoreSearchInstructions; document.getElementById("ctlHeader_ctlSearch_divStoreLinks").style.display = "block"; }
        else {
            document.forms[0].ctlHeader_ctlSearch_searchInput.value = txtSearchInstructions;
        }
    }
    if (isStoreSearch) { SearchDivLink = document.getElementById("navSearchStores"); }
    else {
        SearchDivLink = document.getElementById("navSearch");
    }
    SearchDivLink.className += " searchLinkOn";
}

function closeSearchTime() {
    if (isSearchOpen) {
        if (timerOn == false) {
            timerID = setTimeout("closeSearch()", timecount);
            timerOn = true;
        }
    }
}

function closeSearch() {
    if (isSearchCloseBlocked == false && searchFieldHasFocus == false) {
        SearchDiv = document.getElementById("search");
        if (SearchDiv != null) {
            SearchDiv.className = SearchDiv.className.replace(new RegExp("( )?searchOn\\b"), "");
            SearchDivLink = document.getElementById("navSearch");
            if (SearchDivLink != null) {
                SearchDivLink.className = SearchDivLink.className.replace(new RegExp("( )?searchLinkOn\\b"), "");
                if (isStoreSearchAvailable) {
                    document.getElementById("navSearchStores").className = SearchDivLink.className.replace(new RegExp("( )?searchLinkOn\\b"), "");
                    $('#ctlHeader_ctlSearch_searchInput').css('color', '#919191');
                    $('#ctlHeader_ctlSearch_searchInput').css('font-style', 'italic');
                    document.getElementById("ctlHeader_ctlSearch_divStoreLinks").style.display = "none";
                }
                isSearchOpen = false;
                if (advSearchIsOpen) {
                    closeAdvSearch();
                    advSearchIsOpen = false;
                }
            }
        }
    }
    else {
        stopTimer();
        timerID = setTimeout("closeSearch()", timecount);
        timerOn = true;
    }
}

function blockSearchClose() {
    isSearchCloseBlocked = true;
}

function unblockSearchClose() {
    isSearchCloseBlocked = false;
    // If timer is already on, restart it so that the close delay consistently starts from when the blocking stops
    if (timerOn == true) {
        stopTimer();
        timerID = setTimeout("closeSearch()", timecount);
        timerOn = true;
    }
}

function openAdvSearch() {
    updateSelects();
    advSearchIsOpen = true;
    var simpleSearchBtn = document.getElementById("searchButton");
    //	simpleSearchBtn.className +=" buttonHide";
    simpleSearchBtn.style.visibility = "hidden";
    var advSearchLink = document.getElementById("divAdvSearch");
    advSearchLink.className += " advSearchHide";
    var advSearchDrops = document.getElementById("advSearchDrops");
    advSearchDrops.className = advSearchDrops.className.replace(new RegExp("( )?advSearchDropsHide\\b"), "");
    var advSearchBtn = document.getElementById("seachBrdButton");
    advSearchBtn.className = advSearchDrops.className.replace(new RegExp("( )?seachBrdButtonHide\\b"), "");

    var svcLocator = ServiceLocator.getInstance();
    svcLocator.getService("advancedSearchMenuService").getSearchDropdownValues();

    s.pageName = "Activity | Search Advanced link Click";
    void (s.t());

    TrackEvent('Menus', 'Header', 'Advanced Search', '');
}

function closeAdvSearch() {
    document.getElementById("search").style.height = "";
    var simpleSearchBtn = document.getElementById("searchButton");
    //	simpleSearchBtn.className = simpleSearchBtn.className.replace(new RegExp("( )?buttonHide\\b"), "");
    simpleSearchBtn.style.visibility = "visible";
    var advSearchLink = document.getElementById("divAdvSearch");
    advSearchLink.className = advSearchLink.className.replace(new RegExp("( )?advSearchHide\\b"), "");
    var advSearchDrops = document.getElementById("advSearchDrops");
    advSearchDrops.className += " advSearchDropsHide";
    var advSearchBtn = document.getElementById("seachBrdButton");
    advSearchBtn.className += " seachBrdButtonHide";
}

function handleSearchDropdownChange(id) {
    updateSelects();
}

function initSearch() {

    if (!document.getElementById("ctlHeader_ctlSearch_searchInput")) {
        return;
    }
    // Set up services
    var svcLocator = ServiceLocator.getInstance();
    svcLocator.registerService("searchValidationService", new SearchValidationService());
    svcLocator.registerService("advancedSearchMenuService", new AdvancedSearchMenuService());
    svcLocator.registerService("errorLogService", new ErrorLogService());

    // Register a couple of convenience handles	
    var viewLocator = ViewLocator.getInstance();
    viewLocator.registerView("searchPanel", document.getElementById("search"));
    viewLocator.registerView("searchError", document.getElementById("ctlHeader_ctlSearch_searchError"));

    // Set up event handler
    var searchCheckHandler = new SearchPanelEventHandler();
    subscribe(searchCheckHandler);

    closeSearch();

    //viewLocator.getView("searchError").style.display = "none";

    var inputHandle;
    var defaultButton = null;

    var formHandle = document.forms[0];
    var inputs = formHandle.getElementsByTagName('input');

    // Look for the first <input> tag with type="image" or type="submit" that's not search related
    for (var i = 0; i < inputs.length; i++) {
        if ((inputs[i].type == "image" || inputs[i].type == "submit")
			&& inputs[i].id.toLowerCase() != "ctlheader_ctlsearch_btnsimplesearch"
			&& inputs[i].id.toLowerCase() != "ctlheader_ctlsearch_btnadvancedsearch") {
            defaultButton = inputs[i];
            break;
        }
    }

    if (typeof (ValidatorOnSubmit) == "undefined") {
        // Go through all input fields, add key handlers to detect enter key
        // Only do this though if the DOMValidation libraries are not being used. The
        // DOMValidation library inserts code as well which conflicts with this and is
        // intended to override form behaviour
        for (var j = 0; j < inputs.length; j++) {
            inputHandle = inputs[j];
            inputHandle.onkeydown = function (e) {
                e = e || window.event;
                if (e.keyCode == 13) {
                    if (defaultButton && typeof (defaultButton.click) != "undefined") {
                        defaultButton.click();
                        e.cancelBubble = true;
                        if (e.stopPropagation) e.stopPropagation();
                        return false;
                    }
                    else {
                        // If there was no input field selected of type image or submit, then just submit the form
                        document.forms[0].submit();
                        return true;
                    }
                }
            };
        }
    }

    // We don't want a key handler for the search input field - let the enter key propagate to the form onsubmit handler
    document.getElementById("ctlHeader_ctlSearch_searchInput").onkeydown = function (e) {
        e = e || window.event;
        if (e.keyCode == 13) {
            submitSearch();
            e.cancelBubble = true;
            if (e.stopPropagation) e.stopPropagation();
            return false;
        }
    };

    // Track field focus for the search input field. If the focus is on the search input field, 
    // indicate to the onsubmit handler it should not allow the submit to proceed
    document.getElementById("ctlHeader_ctlSearch_searchInput").onfocus = function (e) {
        searchFieldHasFocus = true;
        blockSearchClose();
    };

    document.getElementById("ctlHeader_ctlSearch_searchInput").onblur = function (e) {
        searchFieldHasFocus = false;
        unblockSearchClose();
    };

    // Handler for onsubmit - checks whether it should proceed or not based on whether focus is on the search input field or not
    var previousOnSubmit = document.forms[0].onsubmit;
    document.forms[0].onsubmit = function () {
        if (searchFieldHasFocus == true) {
            submitSearch();
            return false;
        }
        else if (typeof (Page_ValidationActive) != "undefined" && Page_ValidationActive == true && typeof (Page_IsValid) != "undefined") {
            return Page_IsValid;
        }
        else {
            return true;
        }
    };

    if (isAjaxEnabled() == false) {
        // Go into simple mode if Ajax not available
        var advancedButton = document.getElementById("divAdvSearch");
        //		advancedButton.className +=" advSearchHide";
        advancedButton.innerHTML = "";

        if (document.forms[0].cookielessNoResultsMessage) {
            if (document.forms[0].cookielessNoResultsMessage.value != "") {
                openSearch();
                viewLocator.getView("searchError").style.display = "block";
                viewLocator.getView("searchError").innerHTML = document.forms[0].cookielessNoResultsMessage.value;
                viewLocator.getView("searchError").className = "errorText";
                document.getElementById("ctlHeader_ctlSearch_searchInput").focus();
            }
        }

        if (document.forms[0].cookielessDidYouMeanMessage) {
            if (document.forms[0].cookielessDidYouMeanMessage.value != "") {
                var didYouMeanArray = document.forms[0].cookielessDidYouMeanMessage.value.split(";"); // Value is in the form of <keyword>;<queryString>
                if (didYouMeanArray.length >= 2) {
                    openSearch();

                    var query = window.location.search.split("?").join("");
                    var sessionId = "";
                    var sessionIdQSVal = URLFactory.extractQueryStringValue(query, "mysid2");

                    if (sessionIdQSVal != "") {
                        sessionId = "&mysid2=" + sessionIdQSVal;
                    }

                    var newURL = "/Shopping/CategoryBrowse.aspx?search=1&search_params=" + didYouMeanArray[1] + sessionId;
                    viewLocator.getView("searchError").style.display = "block";
                    viewLocator.getView("searchError").innerHTML = didYouMeanLiteral.split("{0}").join('<a href="' + newURL + '">' + didYouMeanArray[0] + '</a>');
                    viewLocator.getView("searchError").className = "";
                    document.getElementById("ctlHeader_ctlSearch_searchInput").focus();
                }
            }
        }
    }

    if (shouldPriceBeVisible() == false) {
        removeMenu("searchPriceRanges");
    }
}

function submitSearch() {
    var searchTerm = document.forms[0].ctlHeader_ctlSearch_searchInput.value;
    var formHandle = document.forms[0];
    var elementHandle;
    var searchCriteria = null;

    if (searchTerm == txtSearchInstructions) { document.forms[0].ctlHeader_ctlSearch_searchInput.value = ""; searchTerm = "" }

    var elementNames = new Object();
    elementNames["categories"] = "searchCategories";
    elementNames["collections"] = "searchCollections";
    elementNames["priceRanges"] = "searchPriceRanges";
    elementNames["materials"] = "searchMaterials";
    elementNames["gemstones"] = "searchGemstones";
    elementNames["preciousMetals"] = "searchPreciousMetals";
    elementNames["pearlTypes"] = "searchPearlTypes";
    elementNames["gender"] = "searchGender";
    elementNames["dial"] = "searchDial";
    elementNames["movementType"] = "searchMovementType";
    elementNames["braceletStrap"] = "searchBraceletStrap";


    document.getElementById("ctlHeader_ctlSearch_searchError").innerHTML = "&nbsp;";
    document.getElementById("ctlHeader_ctlSearch_searchError").style.display = "none";

    if (advSearchIsOpen == true) {
        searchCriteria = new Object();
        for (var name in elementNames) {
            elementHandle = formHandle.elements[elementNames[name]];
            if (elementHandle) {
                searchCriteria[name] = "";
                if (elementHandle.selectedIndex > 0) {
                    searchCriteria[name] = elementHandle.options[elementHandle.selectedIndex].value;
                }
            }
        }
    }
    if (isStoreSearch) {
        // Omniture reporting TO DO NEED TO CHANGE FOR STORE SEARCH
        s.eVar2 = "[Store Search] " + searchTerm;
        s.eVar9 = "Search Store";
        s.prop3 = "Search Store";
        s.prop4 = "Search Store";
        s.hier1 = "Store Search, Search Store";
        s.pageName = "Activity | Search Store";
        void (s.t());

        GATrackSearchTerm(searchTerm);

        if (searchTerm == txtStoreSearchInstructions || searchTerm == "") { window.location.href = "/Locations/Default.aspx" }
        else { window.location.href = "/Locations/Default.aspx?qs=t+" + escape(searchTerm); }
    }
    else {
        // Omniture reporting
        s.eVar2 = searchTerm;
        s.eVar9 = "Search";
        s.prop3 = "Search";
        s.prop4 = "Search";
        s.hier1 = "Search,Search";
        s.pageName = "Activity | Search";
        void (s.t());

        GATrackSearchTerm(searchTerm);

        if (isAjaxEnabled() == true) {
            if (typeof (ServiceLocator) != "undefined") {
                var svcLocator = ServiceLocator.getInstance();
                if (svcLocator.getService("searchValidationService") != null) {
                    svcLocator.getService("searchValidationService").isSearchEmpty(searchTerm, searchCriteria);
                }
            }
        }
        else {
            var query = window.location.search.split("?").join("");
            var sessionId = "";
            var sessionIdQSVal = URLFactory.extractQueryStringValue(query, "mysid2");
            var referrer = escape(window.location.href);

            if (sessionIdQSVal != "") {
                sessionId = "&mysid2=" + sessionIdQSVal;
            }

            window.location.href = "/Shopping/SearchRedirect.aspx?keywords=" + escape(searchTerm) + sessionId + "&urlReferer=" + referrer;
        }
    }
}
/*End Search Script*/

function pageNavCheck() {
    if (window.attachEvent) {
        window.attachEvent("onload", pagenavHover);
    }
    var PageNavUL = document.getElementById("pagenav").getElementsByTagName("UL");
    if (!isIridesse()) {
        for (var i = 0; i < PageNavUL.length; i++) {
            newHeight = getPageHeight() - findPosY(PageNavUL[i]);
            if (isIE6()) { newHeight = newHeight - 6; }
            newPadding = newHeight - PageNavUL[i].offsetHeight;
            if (newPadding < 0) { newPadding = 0; }
            PageNavUL[i].style.paddingBottom = newPadding + "px";
        }
    }

}
/* Begin Page Navigation Drop Down Script */
pagenavHover = function () {
    var PageNavItem = document.getElementById("pagenav").getElementsByTagName("LI");
    for (var i = 0; i < PageNavItem.length; i++) {
        PageNavItem[i].onmouseover = function () {
            this.className += " pagenavhover";
        };
        PageNavItem[i].onmouseout = function () {
            this.className = this.className.replace(new RegExp(" pagenavhover\\b"), "");
        };
    }
};

/*Begin Sort By*/
var sortByOpen = false;
var SortByItem;
var sorttimerOn = false;
var sorttimecount = 0;
function checkSortBy() {
    if (sortByOpen) {
        closeSortBy();
    }
    else {
        openSortyBy();
    }
}
function startSortByClose() {
    if (!isTablet()) {
        if (sortByOpen) {
            if (sorttimerOn == false) {
                sorttimerID = setTimeout("closeSortBy()", sorttimecount);
                sorttimerOn = true;
            }
        }
    }
}
function stopSortByClose() {
    if (!isTablet()) {
        if (sorttimerOn) {
            clearTimeout(sorttimerID);
            sorttimerID = null;
            sorttimerOn = false;
        }
    }
}
function openSortyBy() {
    SortByItem = document.getElementById("sortByItemsUL");
    SortByItem.style.display = "block";
    sortByOpen = true;

    if (!isTablet()) {
        /*The following keeps the Sort By link black until the Sub link list is closed.*/
        var SortByLink = document.getElementById("sortByUL").getElementsByTagName("LI");
        for (var i = 0; i < SortByLink.length; i++) {
            SortByLink[i].onmouseover = function () {
                this.className += " sortbyhover";
            };
            SortByLink[i].onclick = function () {
                this.className = this.className.replace(new RegExp("( )?sortbyhover\\b"), "");
            };
            SortByLink[i].onmouseout = function () {
                this.className = this.className.replace(new RegExp("( )?sortbyhover\\b"), "");
            };
        }
    }
    else {
        // Add an "open" class to main sort by button so that appearance can be changed appropriately.
        $("#sortByUL a.globalsortby").addClass("open");
    }
}
function closeSortBy() {
    if (sortByOpen) {
        SortByItem.style.display = "none";
        sortByOpen = false;
        $("#sortByUL a.globalsortby").removeClass("open");
    }
} /*End Sort By*/

/*Begin image swaps functions*/
function MM_preloadImages() { //v3.0
    var d = document; if (d.images) {
        if (!d.MM_p) d.MM_p = new Array();
        var i, j = d.MM_p.length, a = MM_preloadImages.arguments; for (i = 0; i < a.length; i++) {
            if (a[i].indexOf("#") != 0) { d.MM_p[j] = new Image; d.MM_p[j++].src = a[i]; }
        }
    }
}

function MM_swapImgRestore() { //v3.0
    var i, x, a = document.MM_sr; for (i = 0; a && i < a.length && (x = a[i]) && x.oSrc; i++) x.src = x.oSrc;
}

function MM_findObj(n, d) { //v4.01
    var p, i, x; if (!d) d = document; if ((p = n.indexOf("?")) > 0 && parent.frames.length) {
        d = parent.frames[n.substring(p + 1)].document; n = n.substring(0, p);
    }
    if (!(x = d[n]) && d.all) x = d.all[n]; for (i = 0; !x && i < d.forms.length; i++) x = d.forms[i][n];
    for (i = 0; !x && d.layers && i < d.layers.length; i++) x = MM_findObj(n, d.layers[i].document);
    if (!x && d.getElementById) x = d.getElementById(n); return x;
}

function MM_swapImage() { //v3.0
    var i, j = 0, x, a = MM_swapImage.arguments; document.MM_sr = new Array; for (i = 0; i < (a.length - 2) ; i += 3)
        if ((x = MM_findObj(a[i])) != null) { document.MM_sr[j++] = x; if (!x.oSrc) x.oSrc = x.src; x.src = a[i + 2]; }
}

function rollOver(source) {
    MM_swapImage(source.id, '', imgOver(document.getElementById(source.id).src), 1)
}
function imgOver(source) { // change Mouseover image source at run-time
    if (source.indexOf("_over") == -1) { // do not add if image is already selected
        return source.replace(".gif", "_over.gif");
    }
    else {
        return source;
    }
}

function setOn(source) {
    MM_swapImage(source.id, '', imgOn(document.getElementById(source.id).src), 1);
}
function imgOn(source) { // change Mouseover image source at run-time
    if (source.indexOf("_on") == -1) {
        // do not add if image is already selected
        return source.replace(/_over.gif/gi, "_on.gif");
    }
    else {
        return source;
    }
}


/*End image swaps functions*/

/*PDFs */
function MM_openBrWindow(theURL, winName, features) { //v2.0
    window.open(theURL, winName, features);
}

/*Begin Holiday Banner scripts*/
var bannerDiv;
var bannertimerOn = false;
var bannertimecount = 800;
var isBannerOpen = false;

function openBannerInfo() {
    if (bannertimerOn) {
        clearTimeout(bannertimerID);
        bannertimerID = null;
        bannertimerOn = false;
    }
    else {
        bannerDiv = document.getElementById("bannerPosition");
        bannerDiv.className += " bannerOpen";
        isBannerOpen = true;
    }
}
function stopBannerTime() {
    if (bannertimerOn) {
        clearTimeout(bannertimerID);
        bannertimerID = null;
        bannertimerOn = false;
    }
}
function closeBannerTime() {
    if (isBannerOpen) {
        if (bannertimerOn == false) {
            bannertimerID = setTimeout("closeBannerInfo()", bannertimecount);
            bannertimerOn = true;
        }
    }
}
function closeBannerInfo() {
    bannerDiv.className = bannerDiv.className.replace(new RegExp("( )?bannerOpen\\b"), "");
    isBannerOpen = false;
    bannertimerOn = false;
}
/*End Holiday Banner scripts*/

/* Begin Incontent Layer scripts */
var divPopupHolder;
var divPopupHolderHeight;
var divMaskHolder;
var divPopupHolderTop;
var blnPopupMask;

function ringSizeConversion(thisobj) {
    linkAboutRingSizes();
}

function createPopUp(pwidth, pheight, blnMask, obj, ptop, href, bColor, blnBorder, mColor, opacity) {
    closePopUp();

    divPopupHolderTop = ptop;
    blnPopupMask = blnMask;
    if (blnPopupMask) { ptop = ptop } else { ptop = ptop + getPageScrollTop(); }
    divPopupHolderHeight = pheight;
    if (blnPopupMask) { pBorderWidth = 1 } else if (isSmallMobile()) { pBorderWidth = 0 } else { pBorderWidth = 5 }
    if (typeof blnBorder == 'undefined') { } else { if (!blnBorder) { pBorderWidth = 0 } }

    if (typeof bColor == 'undefined') { if (blnPopupMask) { borderColor = "E2E0DB" } else { borderColor = "E0E0E0" } }
    else { borderColor = bColor }
    var destURL = href
    var isSafari = (navigator.userAgent.toLowerCase().indexOf("safari") != -1); true; false;
    //if (isSafari) {alert(destURL)}
    //if (destURL.length < 1 ) {destURL=href}
    //Kill existing pop up windows first
    //if (divPopupHolder) {closePopUp}
    txtPopUpContent = '<iframe id="iframeContent" name="iframeContent" src="' + destURL + '" style="border:0; width:' + pwidth + 'px; height:' + pheight + 'px" frameborder="0" scrolling="no"></iframe>'
    divPopupHolder = document.createElement("div");
    divPopupHolder.id = "divPopUp"
    divPopupHolder.className = "divPopUp"
    divPopupHolder.style.position = "absolute";
    divPopupHolder.style.width = pwidth + "px";
    divPopupHolder.style.marginLeft = Math.round((pwidth + (pBorderWidth * 2)) / 2) * -1 + "px";
    divPopupHolder.style.left = "50%";
    divPopupHolder.style.top = ptop + "px";
    divPopupHolder.style.borderWidth = pBorderWidth + "px";
    divPopupHolder.style.borderColor = borderColor;
    divPopupHolder.style.borderStyle = "solid";

    // IOS 6 doesn't appear to take the important directive, but earlier OSes require it.
    if (typeof isMobilePopupOverlay != "undefined" && isMobilePopupOverlay == true) {
        $("#container").hide();
        divPopupHolder.style.borderWidth = "0px";
        divPopupHolder.style.position = "static";
        divPopupHolder.style.position = "static !important";
        divPopupHolder.style.left = "0";
        divPopupHolder.style.left = "0 !important";
        divPopupHolder.style.top = "0";
        divPopupHolder.style.margin = "10px";
        divPopupHolder.style.margin = "10px !important";
        //$('meta[name=viewport]').attr('content', 'width = 320, user-scalable=yes');
    }

    document.body.insertBefore(divPopupHolder, document.body.firstChild);
    divPopupHolder.innerHTML = txtPopUpContent;

    if (typeof isMobilePopupOverlay != "undefined" && isMobilePopupOverlay == true) {
        window.scrollTo(0, 0);
        return;
    }

    //Create Footer Mask to cover contents below
    divMaskHeaderHolder = document.createElement("div");
    document.body.insertBefore(divMaskHeaderHolder, document.body.firstChild);
    divMaskHeaderHolder.id = "divMaskHeader"
    if (blnPopupMask) {
        divMaskHeaderHolder.className = "divHeaderMask"
        if (typeof mColor == 'undefined') { }
        else { divMaskHolder.style.backgroundColor = mColor; }
    }
    else { divMaskHeaderHolder.className = "divClearMask" }
    divMaskHeaderHolder.style.height = "84px"
    divMaskHeaderHolder.style.top = "0px"
    divMaskHeaderHolder.innerHTML = "&nbsp;";
    divMaskHeaderHolder.onclick = closePopUp;

    //Create Mask to cover contents below
    divMaskHolder = document.createElement("div");
    document.body.insertBefore(divMaskHolder, document.body.firstChild);
    divMaskHolder.id = "divMask"
    if (blnPopupMask) {
        divMaskHolder.className = "divMask";
        if (typeof mColor == 'undefined') { }
        else {
            divMaskHolder.style.backgroundColor = mColor;
        }
    }
    else { divMaskHolder.className = "divClearMask" }
    var pagebtmPad = 25;
    var pagetopPad = 0;
    var headerHeight = 84;
    if (isIridesse()) {
        pagebtmPad = -10;
        pagetopPad = 0;
        headerHeight = 48;
    }
    divMaskHolder.style.height = (getPageHeight() + pagebtmPad - headerHeight) + "px";
    divMaskHolder.style.top = (pagetopPad + headerHeight) + "px";
    divMaskHolder.innerHTML = "&nbsp;";
    divMaskHolder.onclick = closePopUp;

    //Create Footer Mask to cover contents below
    divMaskFooterHolder = document.createElement("div");
    document.body.insertBefore(divMaskFooterHolder, document.body.firstChild);
    divMaskFooterHolder.id = "divMaskFooter"
    if (blnPopupMask) {
        divMaskFooterHolder.className = "divFooterMask";
    }
    else { divMaskFooterHolder.className = "divClearMask" }
    divMaskFooterHolder.style.height = "80px"
    divMaskFooterHolder.style.top = getPageHeight() + pagebtmPad + "px";
    divMaskFooterHolder.innerHTML = "&nbsp;";
    divMaskFooterHolder.onclick = closePopUp;

    //IE 6 hack to make the mask cover over select elements
    if (isIE6()) {
        divMaskIframeHolder = document.createElement("iframe");
        divMaskIframeHolder.id = "divShimMask";
        divMaskIframeHolder.className = "divShimMask";
        //divMaskIframeHolder.src = "placeholder.gif";
        //divMaskIframeHolder.src = "";
        divMaskIframeHolder.src = "/shared/images/misc/clr.gif"
        divMaskIframeHolder.scrolling = "no";
        divMaskIframeHolder.frameBorder = "0";
        divMaskIframeHolder.style.width = "960px";
        divMaskIframeHolder.style.height = (getPageHeight() + pagebtmPad) + "px";
        document.body.insertBefore(divMaskIframeHolder, document.body.firstChild);
    }

    //if(!blnPopupMask) {window.onscroll = keepAlive;}
}

function isIE6() {
    var agt = navigator.userAgent.toLowerCase();
    var appVer = navigator.appVersion.toLowerCase();
    var is_minor = parseFloat(appVer);
    var is_major = parseInt(is_minor);
    var iePos = appVer.indexOf('msie');
    if (iePos != -1) {
        is_minor = parseFloat(appVer.substring(iePos + 5, appVer.indexOf(';', iePos)));
        is_major = parseInt(is_minor);
    }
    if ((iePos != -1) && is_major < 7) { return true }
    else { return false }
}

function closePopUp() {
    if (typeof isMobilePopupOverlay != "undefined" && isMobilePopupOverlay == true) {
        //$('meta[name=viewport]').attr('content', 'width = 320,user-scalable=no');
        $("#container").show();
    }
    if (typeof (divPopupHolder) != "undefined" && divPopupHolder != null && divPopupHolder.parentNode != null) {
        closePopUpFollowup();
        setTimeout("closePopUpHistoryFollowup()", 50);
    }
    else { closeEmailPopUp(); }
}

function closePopUpFollowup() {
    if (typeof (divPopupHolder) != "undefined" && divPopupHolder != null && divPopupHolder.parentNode != null) {
        divPopupHolder.innerHTML = "";
        document.body.removeChild(divPopupHolder);
        divPopupHolder = null;
        if (typeof (divMaskHeaderHolder) != "undefined") {
            divMaskHeaderHolder.innerHTML = "";
            document.body.removeChild(divMaskHeaderHolder);
            divMaskHeaderHolder = null;
        }
        if (typeof (divMaskHolder) != "undefined") {
            divMaskHolder.innerHTML = "";
            document.body.removeChild(divMaskHolder);
            divMaskHolder = null;
        }
        if (typeof (divMaskFooterHolder) != "undefined") {
            divMaskFooterHolder.innerHTML = "";
            document.body.removeChild(divMaskFooterHolder);
            divMaskFooterHolder = null;
        }
        if (typeof (divMaskIframeHolder) != "undefined") {
            if (isIE6()) { document.body.removeChild(divMaskIframeHolder); divMaskIframeHolder = null; }
        }
        window.onscroll = "";
    }
}

function closePopUpHistoryFollowup() {
    if (typeof (ProductModel) == "undefined") { return; }
    var model = ProductModel.getInstance();
    var stateSnapshot = model.getStateSnapshot();

    if (stateSnapshot.popup != "") {
        // Don't set the history if the popup property hasn't been set. Just means that a popup is closing that wasn't using
        // this history manager.
        model.setBrowseStatesNoSideEffects({ popup: "" });
        HistoryManager.getInstance().addHistoryItem(URLFactory.convertStateToHash(model.getStateSnapshot()));
    }
}

function closePopUpViaReg() {
    if (typeof isMobilePopupOverlay != "undefined" && isMobilePopupOverlay == true) {
        //$('meta[name=viewport]').attr('content', 'width = 320,user-scalable=no');
        $("#container").show();
    }
    if (typeof divPopupHolder != "undefined") {
        closePopUpFollowup();
    }
    else {
        // Its a pop up window and we close the window.
        window.close();
    }
}

function keepAlive() {
    newptop = divPopupHolderTop + getPageScrollTop();
    divPopupHolder.style.top = newptop + "px";
}

function createMiniPopUp(pwidth, pheight, ptop, pleft, href) {
    change('btnSendVideo', 'selectOn');

    divMiniPopupHolderTop = ptop;
    divMiniPopupHolderHeight = pheight;
    var destURL = href
    txtPopUpContent = '<iframe id="iframeMiniContent" name="iframeMiniContent" src="' + destURL + '" style="border:0; width:' + pwidth + 'px; height:' + pheight + 'px" frameborder="0" scrolling="no"></iframe>'
    divMiniPopupHolder = document.createElement("div");
    document.body.insertBefore(divMiniPopupHolder, document.body.firstChild);
    divMiniPopupHolder.id = "divMiniPopUp"
    divMiniPopupHolder.className = "divMiniPopUp"
    divMiniPopupHolder.style.position = "absolute";
    divMiniPopupHolder.style.width = pwidth + "px";
    divMiniPopupHolder.style.marginLeft = "0px"
    divMiniPopupHolder.style.left = pleft + "px";
    divMiniPopupHolder.style.top = ptop + "px";

    if (top == self) {
        divMiniPopupHolder.style.top = "137px";
        divMiniPopupHolder.style.left = "50%";
        divMiniPopupHolder.style.marginLeft = "-342px";
    }

    divMiniPopupHolder.innerHTML = txtPopUpContent;

    //Create Mask to cover contents below
    divMiniMaskHolder = document.createElement("div");
    document.body.insertBefore(divMiniMaskHolder, document.body.firstChild);
    divMiniMaskHolder.id = "divMiniMask"
    divMiniMaskHolder.className = "divClearMask";
    divMiniMaskHolder.style.height = (getPageHeight()) + "px";
    divMiniMaskHolder.style.top = "0px"
    divMiniMaskHolder.innerHTML = "&nbsp;";
    divMiniMaskHolder.onclick = closeMiniPopUp;

}



function closeMiniPopUp() {
    if (typeof (divMiniPopupHolder) != "undefined") {
        divMiniPopupHolder.innerHTML = "";
        document.body.removeChild(divMiniPopupHolder);
        divMiniPopupHolder = null;
        divMiniMaskHolder.innerHTML = "";
        document.body.removeChild(divMiniMaskHolder);
        divMiniMaskHolder = null;
        change('btnSendVideo', '');
    }


}


function getPageScrollTop() {
    var yScrolltop;
    //var yTestScrolltop;
    if (self.pageYOffset) {
        yScrolltop = self.pageYOffset;
    } else if (document.documentElement && document.documentElement.scrollTop) {	 // Explorer 6 Strict
        yScrolltop = document.documentElement.scrollTop;
    } else if (document.body) {// all other Explorers
        yScrolltop = document.body.scrollTop;
    }
    //yTestScrolltop = yScrolltop
    if (getPageHeight() - divPopupHolderHeight - yScrolltop - 25 < 0) { yScrolltop = yTestScrolltop }
    else { yTestScrolltop = yScrolltop }
    return yScrolltop;
}

/* Begin Incontent Layer scripts */

/*Begin View Overlay scripts*/
var ViewDiv;
var viewtimerOn = false;
var viewtimecount = 0;
var isViewOpen = false;

function stopViewTimer() {
    if (viewtimerOn) {
        clearTimeout(viewtimerID);
        viewtimerID = null;
        viewtimerOn = false;
    }
}

function openInfoPanel(id) {
    ViewDiv = document.getElementById(id);
    checkifViewOpen();
}
function checkifEngraveOpen() {
    ViewDiv = document.getElementById("engraveOpts");
    checkifViewOpen();
}
function checkifSpecsOpen() {
    ViewDiv = document.getElementById("specs");
    checkifViewOpen();
}

function checkifBOPSOpen() {
    ViewDiv = document.getElementById("bops");
    checkifViewOpen();
}

function checkifRelSizeOpen() {
    ViewDiv = document.getElementById("relSize");
    checkifViewOpen();
}
function checkifViewOpen() {
    if (isViewOpen) {
        closeView();
    }
    else {
        openView();
    }
}
function openView() {
    ViewDiv.className += " viewOn";
    isViewOpen = true;
}

function closeViewTime() {
    if (isViewOpen) {
        if (viewtimerOn == false) {
            viewtimerID = setTimeout("closeView()", viewtimecount);
            viewtimerOn = true;
        }
    }
}
function closeView() {
    ViewDiv.className = ViewDiv.className.replace(new RegExp("( )?viewOn\\b"), "");
    isViewOpen = false;
}

/*Begin Item Swatch Drop*/
function checkifItemSwatchOpen() {
    ViewDiv = document.getElementById("swatchDiv");
    checkifViewOpen2();

}
function checkifViewOpen2() {
    if (isViewOpen) {
        closeView2();
    }
    else {
        openView2();
    }
}
function openView2() {
    document.getElementById('swatchDiv').style.display = 'block';
    isViewOpen = true;
}
function closeView2() {

    document.getElementById('swatchDiv').style.display = 'none';
    isViewOpen = false;
}
/*End Item Swatch Drop*/

function checkForOverlay() {
    var queryOverlayInURL = window.location.search.split("?").join("");
    var overlayParam = URLFactory.extractQueryStringValue(queryOverlayInURL, "overlay");
    openMarketingPopUp(overlayParam);
}

//if (typeof (BrowserUtils) != "undefined") {
//    BrowserUtils.addOnLoadHandler(checkForOverlay);
//}
/*End View Overlay scripts*/
//var is_cookie = (document.cookie) ? "true" : "false";
function isAjaxEnabled() {
    if (document.forms[0]) {
        if (document.forms[0].isAjaxEnabled) {
            if (document.forms[0].isAjaxEnabled.value.toLowerCase() == "false") {
                return false;
            }
            //When in cookieless mode, force the nonajax version of the grid
            if (document.cookie.indexOf("hascookies1") < 0) {
                return false;
            }
        }
    }
    return true;
}

function areCookiesEnabled() {
    if (document.forms[0]) {
        if (document.forms[0].areCookiesEnabled) {
            if (document.forms[0].areCookiesEnabled.value.toLowerCase() == "false") {
                return false;
            }
        }
    }
    return true;
}

function show(showLayer) {
    var whichElShow = document.getElementById(showLayer);
    if (whichElShow != null && typeof (whichElShow) != "undefined") {
        whichElShow.style.display = "block";
    }
}

function hide(hideLayer) {
    var whichElHide = document.getElementById(hideLayer);
    if (whichElHide != null && typeof (whichElHide) != "undefined") {
        whichElHide.style.display = "none";
    }
}

function checkShowHide(showHideLayer) {
    var whichElHide = document.getElementById(showHideLayer);
    if (whichElHide.style.display == "none") { show(showHideLayer) }
    else { hide(showHideLayer); }
}

// Header functions to show and hide sign out button
function nameDefined(ckie, nme) {
    var splitValues
    var i
    for (i = 0; i < ckie.length; ++i) {
        splitValues = ckie[i].split("=")
        if (splitValues[0] == nme) return true
    }
    return false
}
function delBlanks(strng) {
    var result = "";
    var i;
    var chrn;
    for (i = 0; i < strng.length; ++i) {
        chrn = strng.charAt(i);
        if (chrn != " ") { result += chrn; }
    }
    return result;
}
function getCookieValue(ckie, nme) {
    var splitValues;
    var i;
    for (i = 0; i < ckie.length; ++i) {
        splitValues = ckie[i].split("=");
        if (splitValues[0] == nme) { return splitValues[1]; }
    }
    return "";
}
function testCookie(cname, cvalue) {  //Tests to see if the cookie 
    var cookie = document.cookie           //with the name and value 
    var chkdCookie = delBlanks(cookie)  //are on the client computer
    var nvpair = chkdCookie.split(";")
    if (nameDefined(nvpair, cname))       //See if the name is in any pair
    {
        tvalue = getCookieValue(nvpair, cname)  //Gets the value of the cookie
        if (tvalue == cvalue) return true
        else return false
    }
    else return false
}
function changeSignOut() {
    if (testCookie("last_activity", "yes") && testCookie("samebrowsersession", "1")) {
        change('divHeader', 'divHeaderSecure');
        setCookie();
    }
}
function confirmationChangeSignOut() {
    if (testCookie("last_activity", "yes") && testCookie("samebrowsersession", "1")) {
        change('divConfirm', 'divHeaderSecure');
    }
}
function setCookie() {
    var futdate = new Date()		//Get the current time and date
    var expdate = futdate.getTime()  //Get the milliseconds since Jan 1, 1970
    expdate += 30 * 60 * 1000  //expires in 30 minutes
    futdate.setTime(expdate)
    var newCookie = "last_activity=yes; path=/;"// domain=dev.tiffany.us;"	//Set the new cookie values up 
    newCookie += " expires=" + futdate.toGMTString()
    window.document.cookie = newCookie //Write the cookie
}

function setCookieValue(name, value) {
    var futdate = new Date()		//Get the current time and date
    var expdate = futdate.getTime()  //Get the milliseconds since Jan 1, 1970
    expdate += 364 * 24 * 60 * 60 * 1000  //expires in about one year
    futdate.setTime(expdate)
    var newCookie = name + "=" + value + "; path=/;"// domain=dev.tiffany.us;"	//Set the new cookie values up 
    newCookie += "expires=" + futdate.toGMTString()
    window.document.cookie = newCookie //Write the cookie
}

function change(id, newClass) {
    identity = document.getElementById(id);
    identity.className = newClass;
}

function openSubWindow(url, winWidth, winHeight) {
    closeSubWindow();
    if (parseInt(navigator.appVersion) >= 4) {
        var xPos = (screen.availWidth - winWidth) / 2;
        var yPos = (screen.availHeight - winHeight) / 2;
    } else {
        var xPos = 300;
        var yPos = 400;
    }
    attrib = "menubar=0,status=0,personalbar=0,titlebar=0,toolbar=0,location=0,top=" + yPos + ",left=" + xPos + ",width=" + winWidth + ",height=" + winHeight + ",resizable=0,scrollbars=1";
    subWin = window.open(url, 'subWin', attrib);
    subWin.focus();
}
function closeSubWindow() {
    if ((document.subWin) && (!subWin.closed)) {
        subWin.close();
    } else {
        document.subWin = new Object();
    }
}

//Imported existing function
function processLinks(url) {
    top.location.href = url;
}

function setStatus(linkHandle) {
    var newStatusString = "";

    if (linkHandle.firstChild.nodeValue != null && linkHandle.firstChild.nodeValue != "" && linkHandle.firstChild.nodeValue != 'undefined') {
        newStatusString = linkHandle.firstChild.nodeValue;
    }
    else if (linkHandle.getAttribute("alt") != null && linkHandle.getAttribute("alt") != "" && linkHandle.getAttribute("alt") != 'undefined') {
        newStatusString = linkHandle.getAttribute("alt");

    }
    else if (linkHandle.getAttribute("title") != null && linkHandle.getAttribute("title") != "" && linkHandle.getAttribute("title") != 'undefined') {
        newStatusString = linkHandle.getAttribute("title");
    }
    else if (linkHandle.firstChild.getAttribute("alt") != null && linkHandle.firstChild.getAttribute("alt") != "" && linkHandle.firstChild.getAttribute("alt") != 'undefined') {
        newStatusString = linkHandle.firstChild.getAttribute("alt");
    }
    else if (linkHandle.firstChild.getAttribute("title") != null && linkHandle.firstChild.getAttribute("title") != "" && linkHandle.firstChild.getAttribute("title") != 'undefined') {
        newStatusString = linkHandle.firstChild.getAttribute("title");
    }

    window.status = newStatusString;
    return true;
}

function clearStatus() {
    window.status = "";
    return true;
}

function msBetweenDates(date1, date2) {
    var timeDifference = 0;
    if (typeof (date1) != "undefined" && date1 != null && typeof (date2) != "undefined" && date2 != null) {
        timeDifference = date2.getTime() - date1.getTime();
    }
    return timeDifference;
}

// ------------------------------------------------
// Handle the problem where ActiveX controls in IE rewrite the page title when
// there is a hash as part of the URL. The onFocus event in the ActiveX control
// will handle most of it, but doesn't work until the user has actually clicked
// on the control at least once.
function pageTitle_verify() {
    var currentPageTitle = document.title;
    if (currentPageTitle != originalPageTitle) {
        document.title = originalPageTitle;
    }
}

//Common Module Functions
var siteName = "Tiffany & Co.";
function readCookie(name) {
    var nameEQ = name + "=";
    var ca = document.cookie.split(';');
    for (var i = 0; i < ca.length; i++) {
        var c = ca[i];
        while (c.charAt(0) == ' ') c = c.substring(1, c.length);
        if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length, c.length);
    }
    return null;
}

function eraseCookie(name, value) {
    var expires = "";
    document.cookie = name + "=" + value + expires + "; path=/";
}

function setCookieModule(mylink, qs, css, t) {
    var newCookie = "module_mode=yes;path=/;"// domain=dev.tiffany.us;"	//Set the new cookie values up 
    var newCookie2 = "module_url=" + mylink + "; path=/;"// domain=dev.tiffany.us;"	//Set the new cookie values up 
    var newCookie3 = "module_css=" + css + "; path=/;"// domain=dev.tiffany.us;"	//Set the new cookie values up 
    var newCookie4 = "module_qs=" + qs + "; path=/;"// domain=dev.tiffany.us;"	//Set the new cookie values up 
    var newCookie5 = "module_t=" + t + "; path=/;"// domain=dev.tiffany.us;"	//Set the new cookie values up 
    window.document.cookie = newCookie
    window.document.cookie = newCookie2
    window.document.cookie = newCookie3
    window.document.cookie = newCookie4
    window.document.cookie = newCookie5
}


function postToFaceBook(T, U, L, OMCID) {
    if (typeof postURL == 'undefined') { postURL = window.location.protocol + "//" + window.location.host; }
    U = postURL + U + "&omcid=" + OMCID;
    window.open('https://www.facebook.com/sharer.php?u=' + encodeURIComponent(U) + '&t=' + encodeURIComponent(T), 'sharer', 'toolbar=0,status=0,scrollbars=1,width=670,height=436');
    sendOmnitureClickEvent('Post to Facebook');
}
function postToTwitter(T, U, L, OMCID) {
    if (typeof postURL == 'undefined') { postURL = window.location.protocol + "//" + window.location.host; }
    U = postURL + U + "&omcid=" + OMCID;
    window.open('https://twitter.com/share?url=' + encodeURIComponent(U) + '&text=@TiffanyAndCo ' + encodeURIComponent(T), 'sharer', 'toolbar=0,status=0,width=650,height=436');
    sendOmnitureClickEvent('Post to Twitter');
}
function postToPinterest(T, U, L, OMCID) {
    if (typeof postURL == 'undefined') { postURL = window.location.protocol + "//" + window.location.host; }
    U = postURL + U + "&omcid=" + OMCID;

    //Fetch product image via inline LINK tag on page.
    var imageURL = $('link[rel=image_src]').attr('href');
    //hasSubDomain() inside shared.js - test URLs should not be sent to Pinterest.
    if (hasSubDomain(imageURL)) {
        var loc = imageURL.indexOf(".");

        //JIRA#42 - HTTPS Migration
        imageURL = 'https://' + imageURL.substring(loc + 1);
    }
    var directURL = 'https://pinterest.com/pin/create/button/?';
    directURL += 'url=' + encodeURIComponent(U);
    directURL += '&media=' + encodeURIComponent(imageURL);
    directURL += '&description=' + encodeURIComponent(T);
    //Height needs to be bigger. If user is not logged into Pinterest,
    //the login button is cut off in popup window.
    window.open(directURL, 'sharer', 'toolbar=0,status=0,width=626,height=550,resizable=1', false);
    //omnitureModuleTracking(L + " | Post to Pinterest | " + U)
    sendOmnitureClickEvent('Post to Pinterest');
}

function postToWeibo(T, U, L, OMCID) {
    if (typeof postURL == 'undefined') { postURL = window.location.protocol + "//" + window.location.host; }
    U = postURL + U + "&omcid=" + OMCID;

    //Fetch product image via inline LINK tag on page.
    var imageURL = $('link[rel=image_src]').attr('href');
    //hasSubDomain() inside shared.js - test URLs should not be sent to Pinterest.
    if (hasSubDomain(imageURL)) {
        var loc = imageURL.indexOf(".");

        //JIRA#42 - HTTPS Migration
        imageURL = 'https://' + imageURL.substring(loc + 1);
    }
    var directURL = 'https://service.weibo.com/share/share.php?';
    directURL += 'url=' + encodeURIComponent(U);
    directURL += '&title=' + encodeURIComponent(T + ' @TiffanyAndCoèèå°¼ ');
    directURL += '&pic=' + encodeURIComponent(imageURL);

    if (locale.toLowerCase() == 'zh-cn') {
        directURL += '&language=zh_cn';
    } else {
        directURL += '&language=zh_tw';
    }
    window.open(directURL, 'sharer', 'toolbar=0,status=0,width=626,height=436');
    //omnitureModuleTracking(L + " | Post to Twitter | " + U)
    sendOmnitureClickEvent('Post to Weibo');
}

function postToMySpace(U, SKU, L, OMCID) {
    if (typeof postURL == 'undefined') { postURL = window.location.protocol + "//" + window.location.host; }
    U = window.location.protocol + "//" + window.location.host + U + "&omcid=" + OMCID;
    window.open('/common/services/MySpaceInterface.aspx?sku=' + SKU + "&omcid=" + OMCID);
    omnitureModuleTracking(L + " | Post to MySpace | " + U)
}

function postToMySpaceDirect(T, U, C, L, OMCID) {
    U = window.location.protocol + "//" + window.location.host + U + "&omcid=" + OMCID;
    C = "<img src='" + window.location.protocol + "//" + window.location.host + C + "' />";
    window.open('https://www.myspace.com/Modules/PostTo/Pages/?t=' + encodeURIComponent(T) + '&u=' + encodeURIComponent(U) + '&c=' + encodeURIComponent(C), 'sharer', 'toolbar=0,status=0,width=626,height=436,resizable=1,location=1,scrollbars=1');
    //Log Omniture
    omnitureModuleTracking(L + " | Post to MySpace | " + U)
}

function linkOutToBrowse(L, backButton, U, BU, T, CID, CSS) {
    if (BU == "getCurrentLocation") { BU = location.href; }
    setCookieModule(BU, CID, CSS, T);
    omnitureModuleTracking(L + " | View Related Items | " + U);
    if (top == self) { window.location.href = U; }
    else { parent.window.location.href = U; }
}

function linkOutToItem(L, backButton, U, BU, T, CID, MID, CSS) {
    if (BU == "getCurrentLocation") { BU = location.href; }
    setCookieModule(BU, CID, CSS, T);
    setCookieValue('_UrlReferrer=', '/Shopping/CategoryBrowse.aspx?cid=' + CID + '&mcat=' + MID);
    omnitureModuleTracking(L + " | View Item Page | " + U)
    window.location.href = U;
}


function downloadToUser(U, L) {
    //Use U for URL, L for logging
    window.location.replace("/Common/Services/FileDownload.aspx?filePath=" + U)
    if (typeof L == 'undefined') { }
    else { omnitureDownloadTracking(U, L); }
}

function downloadToFlashUser(U, L) {
    //Use U for URL, L for logging
    var IE = (navigator.appName.toLowerCase().indexOf("microsoft") != -1) ? true : false;
    //Deal with IE/Flash Issue of downloading
    if (IE) {
        if (typeof (divDownloadFileHolder) != "undefined") {
            divDownloadFileHolder.innerHTML = "";
            document.body.removeChild(divDownloadFileHolder);
        }
        divDownloadFileHolder = document.createElement("div");
        document.body.insertBefore(divDownloadFileHolder, document.body.firstChild);
        divDownloadFileHolder.id = "divDownloadFileHolder"
        divDownloadFileHolder.style.position = "absolute";
        divDownloadFileHolder.style.left = "-2000px";
        divDownloadFileHolder.style.top = "0px";
        divDownloadFileHolder.innerHTML = '<iframe id="ifr" src="' + U + '" onload="IEFileDownload();";></iframe>';
    }
    else {
        window.location.replace("/Common/Services/FileDownload.aspx?filePath=" + U)
    }
    if (typeof L == 'undefined') { }
    else { omnitureDownloadTracking(U, L); }
}

function IEFileDownload() {
    setTimeout("ifr.document.execCommand('SaveAs',null,'')", 500);
}

function omnitureDownloadTracking(linkObject, downloadName) {
    var s = s_gi(s_account);
    downloadName = siteName + " | " + downloadName
    s.pageName = "Activity | File Download";
    s.tl(linkObject, 'd', downloadName);

    GATrackFileDownLoad(downloadName);
}
function OmnitureExitLinkTracking(linkObject, linkName) {
    var s = s_gi(s_account);
    linkName = siteName + " | " + linkName
    s.pageName = "Activity | Exit Link";
    s.tl(linkObject, 'e', linkName);

    //d=>download, e=>exit, o=>generic custom link.
    GATrackExitLink(linkName);
}

function omnitureModuleTracking(flashPageTitle) {
    flashPageTitle = "Tiffany & Co. | " + flashPageTitle
    s.pageName = flashPageTitle;
    s.t();
    GATrackModuleEvent(flashPageTitle);
}

function omnitureTrackAction(argPageTitle, argAction, skuValue) {
    var pageName;
    var company = "Tiffany & Co. | ";
    if (locale == "en-us-ird") {
        company = "IRIDESSE Pearls | ";
    }
    pageName = company + argPageTitle + " | ACTION | " + argAction;
    //Set Omniture variables
    s.pageName = pageName;
    s.prop8 = argPageTitle + " -> " + argAction;
    //Submit Omniture variable 	
    s.t();
    GATrackAction(argPageTitle, argAction, skuValue);
}
function omnitureTrackActionAdd(argPageTitle, argAction) {
    var cookieCnt = parseInt(readCookie("shoppingbagcnt"));
    if (!isNaN(cookieCnt) && cookieCnt > 0) {
        s.events = "scAdd";
    } else {
        s.events = "scOpen,scAdd";
    }
    omnitureTrackAction(argPageTitle, argAction)
}

function omnitureTrackDeviceInfo(category, data) {
    if (IsDefined(category) && IsDefined(data)) {
        s.prop11 = "Device Info | " + category + " | " + data;
        s.t();
    }
}

function trackOrientation() {
    if (typeof (window.orientation) != "undefined") {
        if (window.orientation == 0 || window.orientation == 180) {
            GATrackDeviceInfo("Browser", "Orientation - Portrait");
            omnitureTrackDeviceInfo("Browser", "Orientation - Portrait");
        }
        else {
            GATrackDeviceInfo("Browser", "Orientation - Landscape");
            omnitureTrackDeviceInfo("Browser", "Orientation - Landscape");
        }
    }
    else {
        if ($(window).width() <= $(window).height()) {
            GATrackDeviceInfo("Browser", "Orientation - Portrait");
            omnitureTrackDeviceInfo("Browser", "Orientation - Portrait");
        }
        else {
            GATrackDeviceInfo("Browser", "Orientation - Landscape");
            omnitureTrackDeviceInfo("Browser", "Orientation - Landscape");
        }
    }
}

function trackMobileDeviceInfo() {
    var agent = navigator.userAgent.toLowerCase();
    var name = "Unknown";
    var version = "";
    var start;
    var end;

    if (agent.indexOf("ipod") > -1) {
        name = "iPod";
        start = agent.indexOf("iphone os ") + 10;
        if (start > -1) {
            end = agent.indexOf(" ", start);
            version = agent.substring(start, end).split("_").join(".");
        }
    }
    else if (agent.indexOf("iphone") > -1) {
        name = "iPhone";
        start = agent.indexOf("iphone os ") + 10;
        if (start > -1) {
            end = agent.indexOf(" ", start);
            version = agent.substring(start, end).split("_").join(".");
        }
    }
    else if (agent.indexOf("ipad") > -1) {
        name = "iPad";
        start = agent.indexOf("cpu os ") + 7;
        if (start > -1) {
            end = agent.indexOf(" ", start);
            version = agent.substring(start, end).split("_").join(".");
        }
    }
    else if (agent.indexOf("kindle fire") > -1) {
        name = "Kindle Fire (Android)";
        start = agent.indexOf("android ") + 8;
        if (start > -1) {
            end = agent.indexOf(" ", start);
            version = agent.substring(start, end);
        }
    }
    else if (agent.indexOf("silk-accelerated") > -1) {
        name = "Kindle Fire (Silk Accelerated)";
        start = agent.indexOf("silk/") + 5;
        if (start > -1) {
            end = agent.indexOf(")", start);
            version = agent.substring(start, end);
        }
    }
    else if (agent.indexOf("kindle") > -1) {
        name = "Kindle Monochrome";
        start = agent.indexOf("kindle/") + 7;
        if (start > -1) {
            end = agent.indexOf(" ", start);
            version = agent.substring(start, end);
        }
    }
    else if (agent.indexOf("android") > -1) {
        name = "Android";
        start = agent.indexOf("android ") + 8;
        if (start > -1) {
            end = agent.indexOf(";", start);
            version = agent.substring(start, end);
        }
    }
    else if (agent.indexOf("blackberry") > -1) {
        name = "Blackberry";
        start = agent.indexOf("version/") + 8;
        if (start > -1) {
            end = agent.indexOf(" ", start);
            version = agent.substring(start, end);
        }
    }
    else if (agent.indexOf("windows phone") > -1) {
        name = "Windows Phone";
        start = agent.indexOf("phone os ") + 9;
        if (start > -1) {
            end = agent.indexOf(" ", start);
            version = agent.substring(start, end);
        }
    }
    GATrackDeviceInfo("Platform", name + " " + version);
    omnitureTrackDeviceInfo("Platform", name + " " + version);
}

if (isIPad() || isIPhone() || isIPod() || isAndroid() || isBlackBerry() || isKindle() || isWindowsPhone()) {
    // Use this for tracking device orientation. This should be only for mobile devices.
    if (typeof (window.addEventListener) != "undefined") {
        if (typeof (window.onorientationchange) != "undefined") {
            window.addEventListener('orientationchange', function (orientation) {
                trackOrientation();
            }, false);
        }
        else if (typeof (window.onresize) != "undefined") {
            window.addEventListener('onresize', function (orientation) {
                trackOrientation();
            }, false);
        }
    };

    // This is to report starting orientation
    BrowserUtils.addOnLoadHandler(function () {
        trackOrientation();
        trackMobileDeviceInfo();
    });
};

function createItemBackButton() {
    document.getElementById('divBackToModule').innerHTML = "<div class='backToLink' style='width:250px; padding-top:19px; white-space:nowrap; clear:both'><a href='" + moduleURL + "'>" + unescape(moduleT) + "</a></div>";

}

function createCategoryBrowseBackButton() {
    document.getElementById('divBackToModule').innerHTML = "<div class='backToLink' style='width:300px; padding-top:10px; padding-left:15px; white-space:nowrap; clear:both'><a href='" + moduleURL + "'>" + unescape(moduleT) + "</a></div><style>#divSearchAndBrowse h1.flashTitle {margin:13px 0px -12px 30px; }</style>";
}

function emailThisSKU(SKU, L) {
    linkEmailThisPage('EmailThisPage.aspx?sku=' + SKU)
    omnitureModuleTracking(L + " | Email This Item | " + SKU)
}
function hideFloatedTiles() {
    document.getElementById("divPromoArea").style.display = "none";
    if (document.getElementById("contentHolidayBanner_TxtCustom")) { document.getElementById("contentHolidayBanner_TxtCustom").style.display = "none"; }
    if (document.getElementById("contentHolidayBanner_TxtRht")) { document.getElementById("contentHolidayBanner_TxtRht").style.display = "none"; }
    if (document.getElementById("contentHolidayBanner_TxtLft")) { document.getElementById("contentHolidayBanner_TxtLft").style.display = "none"; }
    document.getElementById("containerBackToLink").style.display = "none";
}
function showFloatedTiles() {
    document.getElementById("divPromoArea").style.display = "block";
    if (document.getElementById("contentHolidayBanner_TxtCustom")) { document.getElementById("contentHolidayBanner_TxtCustom").style.display = "block"; }
    if (document.getElementById("contentHolidayBanner_TxtRht")) { document.getElementById("contentHolidayBanner_TxtRht").style.display = "block"; }
    if (document.getElementById("contentHolidayBanner_TxtLft")) { document.getElementById("contentHolidayBanner_TxtLft").style.display = "block"; }
    document.getElementById("containerBackToLink").style.display = "block";
}

function openReportWindow(url, width, height) {
    if (typeof (width) == "undefined") {
        width = 600;
    }
    if (typeof (height) == "undefined") {
        height = 780;
    }
    attrib = "width=" + width + ",height=" + height + ",menubar=no,personalbar=no,titlebar=no,toolbar=no,location=no,resizable=yes,scrollbars=yes";
    win = window.open(url, 'name', attrib);
}

function openCentralModalWindow(url, height, width) {



    if (screen) {
        y = (screen.availHeight - height) / 2;
        x = (screen.availWidth - width) / 2;
    }
    attrib = "dialogWidth:" + width + "px;dialogHeight:" + height + "px;dialogTop:" + y + "px;dialogLeft:" + x + "px;center:yes;status:no;resizable:off;scroll:no";
    window.showModalDialog(url, "", attrib);
}
function openOverlayPopup(href, pwidth, pheight, pbgcolor, pbrdrcolor, pbrdrwidth, blnPopupMask) {

    ptop = (getPageHeight() - pheight) / 2;
    pleft = (getPageWidth() - pwidth) / 2;


    var destURL = href
    txtPopUpContent = '<iframe id="iframeMiniContent" name="iframeMiniContent" src="' + destURL + '" style="border:0; height:' + pheight + 'px; width:' + pwidth + 'px;" frameborder="0" scrolling="no" allowtransparency="true"></iframe>'

    divOverlayPopupHolder = document.createElement("div");
    document.body.insertBefore(divOverlayPopupHolder, document.body.firstChild);
    divOverlayPopupHolder.id = "divMiniPopUp"
    divOverlayPopupHolder.className = "divMiniPopUp"
    divOverlayPopupHolder.style.position = "absolute";
    //divOverlayPopupHolder.style.height = pheight + "px";
    divOverlayPopupHolder.style.width = pwidth + "px";
    divOverlayPopupHolder.style.marginLeft = "0px"
    divOverlayPopupHolder.style.left = pleft + "px";
    divOverlayPopupHolder.style.top = ptop + "px";
    divOverlayPopupHolder.style.borderWidth = pbrdrwidth + "px";
    divOverlayPopupHolder.style.borderColor = "#" + pbrdrcolor;
    divOverlayPopupHolder.style.backgroundColor = "#" + pbgcolor;

    if (top == self) {
        divOverlayPopupHolder.style.top = ptop + "px";
        divOverlayPopupHolder.style.left = "50%";
        divOverlayPopupHolder.style.marginLeft = (pleft - 480) + "px";
        divOverlayPopupHolder.style.borderWidth = pbrdrwidth + "px";
        divOverlayPopupHolder.style.borderColor = "#" + pbrdrcolor;
        divOverlayPopupHolder.style.backgroundColor = "#" + pbgcolor;
    }

    divOverlayPopupHolder.innerHTML = txtPopUpContent;

    //Create Mask to cover contents below
    divOverlayPopupMaskHolder = document.createElement("div");
    document.body.insertBefore(divOverlayPopupMaskHolder, document.body.firstChild);
    divOverlayPopupMaskHolder.id = "divMiniMask"
    if (blnPopupMask) { divOverlayPopupMaskHolder.className = "divMask"; } else { divOverlayPopupMaskHolder.className = "divBlueMask"; }
    divOverlayPopupMaskHolder.style.height = ($(document).height()) + "px";
    divOverlayPopupMaskHolder.style.top = "0px"
    divOverlayPopupMaskHolder.innerHTML = "&nbsp;";
    divOverlayPopupMaskHolder.onclick = closeOverlayPopUp;

}

function closeOverlayPopUp() {
    if (typeof (divOverlayPopupHolder) != "undefined") {
        divOverlayPopupHolder.innerHTML = "";
        document.body.removeChild(divOverlayPopupHolder);
        divOverlayPopupMaskHolder.innerHTML = "";
        document.body.removeChild(divOverlayPopupMaskHolder);
    }
}

function resizeOverlayPopup(pheight, pwidth) {
    if (typeof (divOverlayPopupHolder) != "undefined") {

        divOverlayPopupHolder.style.height = pheight + "px";
        divOverlayPopupHolder.style.width = pwidth + "px";

        document.getElementById('iframeMiniContent').height = pheight + "px";
        document.getElementById('iframeMiniContent').width = pwidth + "px";

    }
}

//-------------------------------------------
// begin code for inline shopping 
//-------------------------------------------
function updateShoppingBagCount() {
    //ShoppingBagCnt
    var cookieCnt = parseInt(readCookie("shoppingbagcnt"));
    if (document.getElementById("spanShoppingBagCount")) {
        if (!isNaN(cookieCnt) && cookieCnt > 0) {
            document.getElementById("spanShoppingBagCount").innerHTML = "&nbsp;(" + cookieCnt + ")";
        } else {
            document.getElementById("spanShoppingBagCount").innerHTML = "";
        }
    }
}
function updateSavedCount() {
    //SavedItemsCnt
    var cookieCnt = parseInt(readCookie("saveditemscnt"));

    if (document.getElementById("spanSavedItemCount")) {
        if (!isNaN(cookieCnt) && cookieCnt > 0) {
            document.getElementById("spanSavedItemCount").innerHTML = "&nbsp;(" + cookieCnt + ")";
        } else {
            document.getElementById("spanSavedItemCount").innerHTML = "";
        }
    }
}

var divShoppingPopupHolder;
var divWishlistPopupHolder;
var isShoppingPopupOpen;
var isWishlistPopupOpen;
var closeShoppingLayerTimeoutId;
var closeWishlistLayerTimeoutId;
var openShoppingTimeout;
var openWishlistTimeout;

function showInlineShoppingBag() {
    var currLocSplit = document.location.href.split('?');
    if (currLocSplit[0].toUpperCase().indexOf("SHOPPINGBAG.ASPX") > -1) { return; }
    if (currLocSplit[0].toUpperCase().indexOf("WISHLIST.ASPX") > -1) { return; }
    if (locale == "en-US-Trade") { return; }
    if (locale == "ja-JP-Trade") { return; }

    //if there is a timer waiting to close the popup, stop the timer
    if (closeShoppingLayerTimeoutId) {
        cancelCloseShoppingPopUp();
    }
    //if it's not already open, set the timer to open it
    if (!isShoppingPopupOpen) {
        if (areCookiesEnabled()) {
            openShoppingTimeout = setTimeout('createShoppingPopUp("/Customer/InlineShoppingBag.aspx")', 500);
        } else {
            openShoppingTimeout = setTimeout('createShoppingPopUp("/Customer/InlineShoppingBag.aspx?' + currLocSplit[1] + '")', 500);
        }
    }
}

function showInlineSavedItems() {
    var currLocSplit = document.location.href.split('?');
    if (currLocSplit[0].toUpperCase().indexOf("WISHLIST.ASPX") > -1) { return; }
    if (currLocSplit[0].toUpperCase().indexOf("SHOPPINGBAG.ASPX") > -1) { return; }
    if (locale == "en-US-Trade") { return; }
    if (locale == "en-US-Stmt") { return; }
    if (locale == "ja-JP-Trade") { return; }
    if (locale == "en-US-PKB") { return; }
    if (closeWishlistLayerTimeoutId) {
        cancelCloseWishlistPopUp();
    }
    if (!isWishlistPopupOpen) {
        if (areCookiesEnabled()) {
            openWishlistTimeout = setTimeout('createWishlistPopUp("/Customer/WishList/InlineWishList.aspx")', 500);
        } else {
            openWishlistTimeout = setTimeout('createWishlistPopUp("/Customer/WishList/InlineWishList.aspx?' + currLocSplit[1] + '")', 500);
        }
    }
}

function hideInlineShoppingBag() {
    //if there is a timer to open it, stop the timer
    if (openShoppingTimeout) {
        clearInterval(openShoppingTimeout);
        openShoppingTimeout = null;
    }
    if (isShoppingPopupOpen) {
        delayedCloseShoppingPopUp();
    }
}

function hideInlineSavedItems() {
    if (openWishlistTimeout) {
        clearInterval(openWishlistTimeout);
        openWishlistTimeout = null;
    }
    if (isWishlistPopupOpen) {
        delayedCloseWishlistPopUp();
    }
}

function createShoppingPopUp(href) {
    var destURL = href;
    var pwidth = 310;
    var pheight = 300;
    var txtPopUpContent = "";

    txtPopUpContent = '<img id="imgLoadingBag" src="/Shared/Images/misc/loading.gif" alt="" style="position:absolute;left:141px;top:136px;"/><iframe id="iframeShoppingBag" name="iframeShoppingBag" src="' + destURL + '" style="border:0; width:' + pwidth + 'px; height:' + pheight + 'px" frameborder="0" scrolling="no"></iframe>'
    divShoppingPopupHolder = document.createElement("div");
    document.getElementById("divLogoBG").appendChild(divShoppingPopupHolder);
    divShoppingPopupHolder.id = "divPopUp";
    divShoppingPopupHolder.className = "divInline";
    divShoppingPopupHolder.innerHTML = txtPopUpContent;
    divShoppingPopupHolder.onmouseover = cancelCloseShoppingPopUp;
    divShoppingPopupHolder.onmouseout = delayedCloseShoppingPopUp;
    isShoppingPopupOpen = true;
}

function closeShoppingPopUp() {
    if (typeof (divShoppingPopupHolder) != "undefined" && document.getElementById("divPopUp")) {
        divShoppingPopupHolder.innerHTML = "";
        document.getElementById("divLogoBG").removeChild(divShoppingPopupHolder);
        divShoppingPopupHolder = null;
        window.onscroll = "";
        isShoppingPopupOpen = false;
    }
}

function delayedCloseShoppingPopUp() {
    closeShoppingLayerTimeoutId = setTimeout("closeShoppingPopUp();", 1500);
}

function cancelCloseShoppingPopUp() {
    clearTimeout(closeShoppingLayerTimeoutId);
    closeShoppingLayerTimeoutId = null;
}
function createWishlistPopUp(href) {
    var destURL = href;
    var inlineWLSBWidth = 310;
    var pheight = 300;
    var loadingLeftPos = inlineWLSBWidth - 169;
    var txtPopUpContent = "";

    txtPopUpContent = '<img id="imgLoadingSaved" src="/Shared/Images/misc/loading.gif" alt="" style="position:absolute;left:' + loadingLeftPos + 'px;top:136px;"/><iframe id="iframeWishlist" name="iframeWishlist" src="' + destURL + '" style="border:0; width:' + inlineWLSBWidth + 'px; height:' + pheight + 'px" frameborder="0" scrolling="no"></iframe>'
    divWishlistPopupHolder = document.createElement("div");
    document.getElementById("divLogoBG").appendChild(divWishlistPopupHolder);
    divWishlistPopupHolder.id = "divWishlistPopUp";
    divWishlistPopupHolder.className = "divInline";
    divWishlistPopupHolder.innerHTML = txtPopUpContent;
    divWishlistPopupHolder.onmouseover = cancelCloseWishlistPopUp;
    divWishlistPopupHolder.onmouseout = delayedCloseWishlistPopUp;
    isWishlistPopupOpen = true;
}

function closeWishlistPopUp() {
    if (typeof (divWishlistPopupHolder) != "undefined" && document.getElementById("divWishlistPopUp")) {
        divWishlistPopupHolder.innerHTML = "";
        document.getElementById("divLogoBG").removeChild(divWishlistPopupHolder);
        divWishlistPopupHolder = null;
        window.onscroll = "";
        isWishlistPopupOpen = false;
    }
}

function delayedCloseWishlistPopUp() {
    closeWishlistLayerTimeoutId = setTimeout("closeWishlistPopUp();", 1500);
}

function cancelCloseWishlistPopUp() {
    clearTimeout(closeWishlistLayerTimeoutId);
    closeWishlistLayerTimeoutId = null;
}

function HandleEStoreSession() {
    if (isEStore()) {

        //If browser Session cookie not yet created, clear the estore user session.
        if (!testCookieExists("estorebrowsersession")) {
            ClearEStoreAnonymousShoppingBag();

            //Now create the session cookie, so the new session is maintained for user to shop.
            CreateEStoreCookies(true, true);

        } else if (!testCookieExists("estoresessiontimeout")) { //If same browser session, but the user has timed out

            ClearEStoreAnonymousShoppingBag();

            //Now create the session timeout cookie, so the new session is maintained for user to shop.
            CreateEStoreCookies(false, true);

            //If it is the samebrowser session (i.e., user did not close browser, but there was 30 min idle time, 
            //redirect user to home page.                
            window.location.href = "/default.aspx";

        } else if (testCookieExists("estorebrowsersession") && testCookieExists("estoresessiontimeout")) {
            //Now update the session timeout cookie, so the new session is maintained for user to shop.
            CreateEStoreCookies(false, true);
        }

    }
}

function isEStore() {
    if (typeof (locale) != "undefined" && locale != "") {
        if (locale.toLowerCase().indexOf("estr") > -1) {
            return true;
        }
    }
    return false;
}

function ClearEStoreAnonymousShoppingBag() {
    //If the site is estore, clear the anonymous shoppingbag.
    if (isEStore()) {
        DeleteCookie("mysid2");
        DeleteCookie("custlastvisit");
        DeleteCookie("shoppingbagcnt");
        DeleteCookie("saveditemscnt");
    }
}

function DeleteCookie(name) {
    var futdate = new Date()		//Get the current time and date
    var expdate = futdate.getTime()  //Get the milliseconds since Jan 1, 1970
    expdate -= 10 * 1000  //set datetime back to 10 minutes 
    futdate.setTime(expdate)
    var newCookie = name + "=; path=/;"
    newCookie += "expires=" + futdate.toGMTString()
    window.document.cookie = newCookie //Write the cookie
}

function testCookieExists(cname) {  //Tests to see if the cookie 
    var cookie = document.cookie           //with the name and value 
    var chkdCookie = delBlanks(cookie)  //are on the client computer
    var nvpair = chkdCookie.split(";")
    if (nameDefined(nvpair, cname))       //See if the name is in any pair
    {
        return true
    }
    else {
        return false
    }
}

function CreateEStoreCookies(createbrowserCookie, createTimeoutCookie) {
    if (createTimeoutCookie) {
        //create cookie "estoresessiontimeout"
        var futdate = new Date()		//Get the current time and date
        var expdate = futdate.getTime();  //Get the milliseconds since Jan 1, 1970
        if (configExpTime == null || configExpTime == 0)
            configExpTime = 10;
        expdate += 60 * 1000 * configExpTime;  //configExpTime is defined in Javascript.ascx, it reads value from web.config
        futdate.setTime(expdate)
        var newCookie = "estoresessiontimeout=no; path=/;"
        newCookie += " expires=" + futdate.toGMTString()
        window.document.cookie = newCookie //Write the cookie
    }

    if (createbrowserCookie) {
        //create cookie "estorebrowsersession"
        var newCookie2 = "estorebrowsersession=yes; path=/;"
        window.document.cookie = newCookie2 //Write the cookie
    }
}
function linkToPolicy(policy) {

    // for service folder , the href will do.
    if (policyfolder == 'service') {
        return true;
    }
    else {
        // means its checkout folder. change overlay page. 
        switch (policy) {
            case "tou":
                parent.document.getElementById("iframeContent").src = "/Customer/Checkout/AboutTermsOfUse.aspx";
                break;
            case "tos":
                parent.document.getElementById("iframeContent").src = "/Customer/Checkout/AboutTermsOfSale.aspx";
                break;
            case "pp":
                parent.document.getElementById("iframeContent").src = "/Customer/Checkout/PrivacyPolicy.aspx";
                break;
        }
        return false;
    }

}
function externalWarning(url) {
    window.open("/Service/ExternalSiteWarning.aspx?redirect=" + url, "_blank");
}

function createBlueOverlay(pwidth, pheight, blnMask, obj, ptop, href, bColor, blnBorder, borderWidth, mColor, opacity) {
    divPopupHolderTop = ptop;
    blnPopupMask = blnMask;
    txtMaskStyle = opacity;
    if (blnPopupMask) { ptop = ptop } else { ptop = ptop + getPageScrollTop(); }
    divPopupHolderHeight = pheight;
    if (blnPopupMask) { pBorderWidth = 1 } else { pBorderWidth = 5 }
    if (typeof borderWidth != 'undefined') { pBorderWidth = borderWidth }
    if (typeof blnBorder == 'undefined') { } else { if (!blnBorder) { pBorderWidth = 0 } }
    if (typeof txtMaskStyle == 'undefined') { txtMaskStyle = "divBlueMask"; }

    if (typeof bColor == 'undefined') { if (blnPopupMask) { borderColor = "E2E0DB" } else { borderColor = "E0E0E0" } }
    else { borderColor = bColor }
    var destURL = href
    var isSafari = (navigator.userAgent.toLowerCase().indexOf("safari") != -1); true; false;
    txtPopUpContent = '<iframe id="iframeContent" name="iframeContent" src="' + destURL + '" style="border:0; width:' + pwidth + 'px; height:' + pheight + 'px" frameborder="0" scrolling="no"></iframe>'
    divPopupHolder = document.createElement("div");
    document.body.insertBefore(divPopupHolder, document.body.firstChild);
    divPopupHolder.id = "divPopUp";
    divPopupHolder.className = "divPopUp";
    divPopupHolder.style.position = "absolute";
    divPopupHolder.style.width = pwidth + "px";
    divPopupHolder.style.marginLeft = Math.round((pwidth + (pBorderWidth * 2)) / 2) * -1 + "px";
    divPopupHolder.style.left = "50%";
    divPopupHolder.style.top = ptop + "px";
    divPopupHolder.style.borderWidth = pBorderWidth + "px";
    divPopupHolder.style.borderColor = borderColor
    divPopupHolder.style.borderStyle = "solid"
    divPopupHolder.innerHTML = txtPopUpContent;

    //Create Mask to cover contents below
    divMaskHolder = document.createElement("div");
    document.body.insertBefore(divMaskHolder, document.body.firstChild);
    divMaskHolder.id = "divMask"
    if (blnPopupMask) {
        divMaskHolder.className = txtMaskStyle;
        if (typeof mColor == 'undefined') { }
        else {
            divMaskHolder.style.backgroundColor = mColor;
        }
    }
    else { divMaskHolder.className = "divClearMask" }
    var pagebtmPad = 25;
    var pagetopPad = 0;
    var headerHeight = 84;
    divMaskHolder.style.top = "0px"
    divMaskHolder.style.height = (getPageSize()) + "px";
    divMaskHolder.innerHTML = "&nbsp;";
    divMaskHolder.onclick = closeOverlay;

    //IE 6 hack to make the mask cover over select elements
    if (isIE6()) {
        divMaskIframeHolder = document.createElement("iframe");
        divMaskIframeHolder.id = "divShimMask";
        divMaskIframeHolder.className = "divShimMask";
        divMaskIframeHolder.src = "/shared/images/misc/clr.gif"
        divMaskIframeHolder.scrolling = "no";
        divMaskIframeHolder.frameBorder = "0";
        divMaskIframeHolder.style.width = "960px";
        divMaskIframeHolder.style.height = (getPageHeight() + pagebtmPad) + "px";
        document.body.insertBefore(divMaskIframeHolder, document.body.firstChild);
    }
}

function getPageSize() {
    var yScroll;
    if (window.innerHeight && window.scrollMaxY) {
        yScroll = window.innerHeight + window.scrollMaxY;
    } else if (document.body.scrollHeight > document.body.offsetHeight) {
        yScroll = document.body.scrollHeight;
    } else {
        yScroll = document.body.offsetHeight;
    }

    var windowHeight;

    if (self.innerHeight) {
        windowHeight = self.innerHeight;
    } else if (document.documentElement && document.documentElement.clientHeight) {
        windowHeight = document.documentElement.clientHeight;
    } else if (document.body) {
        windowHeight = document.body.clientHeight;
    }
    // small pages
    if (yScroll < windowHeight) {
        pageHeight = windowHeight;
    } else {
        pageHeight = yScroll;
    }
    return pageHeight;
}
function closeOverlay() {
    if (typeof (divPopupHolder) != "undefined") {
        closeOverlayFollowup();
        setTimeout("closeOverlayHistoryFollowup()", 50);
    }
}
function closeOverlayFollowup() {
    if (typeof (divPopupHolder) != "undefined") {
        divPopupHolder.innerHTML = "";
        document.body.removeChild(divPopupHolder);
        divPopupHolder = null;

        if (typeof (divMaskHolder) != "undefined") {
            divMaskHolder.innerHTML = "";
            document.body.removeChild(divMaskHolder);
            divMaskHolder = null;
        }
        if (typeof (divMaskIframeHolder) != "undefined") {
            if (isIE6()) { document.body.removeChild(divMaskIframeHolder); divMaskIframeHolder = null; }
        }
        window.onscroll = "";
    }
}

function closeOverlayHistoryFollowup() {
    var model = ProductModel.getInstance();
    var stateSnapshot = model.getStateSnapshot();
    if (stateSnapshot.popup != "") {
        model.setBrowseStatesNoSideEffects({ popup: "" });
        HistoryManager.getInstance().addHistoryItem(URLFactory.convertStateToHash(model.getStateSnapshot()));
    }
}

// replaces the image thumbnails for item groups created by a flash module with flash thumbnails on the wishlist page
function flashSavedItems() {
    if (moduleItemGroups) {
        var thumbnailSWF;
        var errorHTML = "no flash";
        var i;
        for (i = 0; i < moduleItemGroups.length; i++) {
            var item = moduleItemGroups[i];
            switch (item.module) {
                case 'CHM01':
                    thumbnailSWF = "/Shared/Modules/CHM01/saved_item.swf";
                    break;
            }
            var flashHolder = new FlashAPI(document.getElementById(item.itemImageDiv));
            flashHolder.setAttribute("src", thumbnailSWF);
            flashHolder.setAttribute("width", "140");
            flashHolder.setAttribute("height", "140");
            flashHolder.setAttribute("menu", "false");
            flashHolder.setAttribute("wmode", "opaque");
            flashHolder.setAttribute("flashVars", "initState=" + escape(item.flashModuleData) +
										     "&moduleCode=" + item.module +
										     "&link=" + escape("/shopping/ModuleBrowse.aspx?module=CHM01#f+%flashHistoryState%") +
										     "&servicePath=" + "/common/services/wpcservices.aspx");
            flashHolder.setAttribute("onfocus", "pageTitle_verify();");
            flashHolder.setAlternateHTML(errorHTML);
            flashHolder.setFlashVersion(9, 0, 0);
            flashHolder.generateFlash();
        }
    }
}

//
function getScreenYMid() {

    var viewportHeightOffset = 0;
    var viewportHeight = 0;

    if (typeof (window.pageYOffset) != 'undefined') {
        viewportHeightOffset = window.pageYOffset;
    }
    if (typeof (document.documentElement.scrollTop) != 'undefined' && viewportHeightOffset == 0) {
        viewportHeightOffset = document.documentElement.scrollTop;
    }
    if (typeof (document.getElementsByTagName('body')[0].scrollTop) != 'undefined' && viewportHeightOffset == 0) {
        viewportHeightOffset = document.getElementsByTagName('body')[0].scrollTop;
    }

    var viewportwidth;
    // For (mozilla/netscape/opera/IE7)
    if (typeof (window.innerWidth) != 'undefined') {
        viewportwidth = window.innerWidth;
        viewportHeight = window.innerHeight;
    }
        // IE6 in standards compliant mode
    else if (typeof (document.documentElement) != 'undefined'
                && typeof (document.documentElement.clientWidth) != 'undefined'
                && document.documentElement.clientWidth != 0) {
        viewportwidth = document.body.clientWidth;
        viewportHeight = document.body.clientHeight;
    }
    //IE7 does not correctly report offsetTop of container controls
    //hence an iteration is required to get the combined offsetTop
    var curTop = 0;
    var objSlHost = document.getElementById('silverlightControlHost');
    if (objSlHost.offsetParent) {
        do {
            curTop += objSlHost.offsetTop;
        }
        while (objSlHost = objSlHost.offsetParent)
    }

    var ypos = ((viewportHeightOffset + (viewportHeight / 2)) - curTop);
    return ypos;
}

function getScreenXMid() {

    var viewportWidthOffset = 0;

    if (typeof window.pageXOffset != 'undefined') {
        viewportWidthOffset = window.pageXOffset;
    }
    if (typeof document.documentElement.scrollLeft != 'undefined' && viewportWidthOffset == 0) {
        viewportWidthOffset = document.documentElement.scrollLeft;
    }
    if (typeof document.getElementsByTagName('body')[0].scrollLeft != 'undefined' && viewportWidthOffset == 0) {
        viewportWidthOffset = document.getElementsByTagName('body')[0].scrollLeft;
    }

    var viewportwidth = 0;
    // For (mozilla/netscape/opera/IE7)
    if (typeof (window.innerWidth) != 'undefined') {
        viewportwidth = window.innerWidth;
    }
        // IE6 in standards compliant mode
    else if (typeof (document.documentElement) != 'undefined'
                && typeof (document.documentElement.clientWidth) != 'undefined'
                && document.documentElement.clientWidth != 0) {
        viewportwidth = document.body.clientWidth;
    }
    var xpos = ((viewportWidthOffset + (viewportwidth / 2)) - ((viewportwidth - document.getElementById('silverlightControlHost').offsetWidth) / 2));
    return xpos;
}

function hasSubDomain(url) {
    // IF THERE, REMOVE WHITE SPACE FROM BOTH ENDS
    url = url.replace(new RegExp(/^\s+/), ""); // START
    url = url.replace(new RegExp(/\s+$/), ""); // END

    // IF FOUND, CONVERT BACK SLASHES TO FORWARD SLASHES
    url = url.replace(new RegExp(/\\/g), "/");

    // IF THERE, REMOVES 'http://', 'https://' or 'ftp://' FROM THE START
    url = url.replace(new RegExp(/^http\:\/\/|^https\:\/\/|^ftp\:\/\//i), "");

    // IF THERE, REMOVES 'www.' FROM THE START OF THE STRING
    url = url.replace(new RegExp(/^www\./i), "");

    // REMOVE COMPLETE STRING FROM FIRST FORWARD SLASH ON
    url = url.replace(new RegExp(/\/(.*)/), "");

    // REMOVES '.??.??' OR '.???.??' FROM END - e.g. '.CO.UK', '.COM.AU'
    if (url.match(new RegExp(/\.[a-z]{2,3}\.[a-z]{2}$/i))) {
        url = url.replace(new RegExp(/\.[a-z]{2,3}\.[a-z]{2}$/i), "");

        // REMOVES '.??' or '.???' or '.????' FROM END - e.g. '.US', '.COM', '.INFO'
    } else if (url.match(new RegExp(/\.[a-z]{2,4}$/i))) {
        url = url.replace(new RegExp(/\.[a-z]{2,4}$/i), "");
    }
    // CHECK TO SEE IF THERE IS A DOT '.' LEFT IN THE STRING
    var subDomain = (url.match(new RegExp(/\./g))) ? true : false;

    return (subDomain);
}

//----------------------------------------------------