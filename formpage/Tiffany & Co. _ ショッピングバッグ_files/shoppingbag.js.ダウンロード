var shipRadioButtonTemplate='<label><input type="radio" data-text="" onclick="SetShippingTypeID(this);" $Checked$ value="$ShippingOptionDetailID$" name="shippingTypes"><span></span> $DisplayName$<p> $DeliveryDateText$</p></label><br>'
var shipTypeLegend='<legend class="visually-hidden">Shipping Types</legend>';var query=window.location.search.split("?").join("");var action=URLFactory.extractQueryStringValue(query,"action");var isTaxEstimationInitiated=false;if(action=="showmergedmsg"&&IsMergeMessageShown==false){trackCartMerge("You already had items in your cart");setTimeout(function(){$(".merged-anchor").trigger("click");},1000);}if(isMobile()){$(".apply-custom-drop").removeClass("apply-custom-drop");}if(isSmallMobile()){var isMobilePopupOverlay=true;}function doEngraving(engravingURL){var sc="";if($("#literalContinueShoppingLink2").length>0){sc="&prevurl="+document.getElementById("literalContinueShoppingLink2").href;}var props={link:$(this),source:engravingURL+"&prevurl="+sc,type:"ajax",size:"large"
};openModalOverlay(props);}function createEngravingOverlay(pwidth,pheight,destURL){var engravingIframe='<iframe id="iframeContent" name="iframeContent" src="'+destURL+'" style="border:0; width: 100%; height: 100%" frameborder="0" scrolling="no"></iframe>';var engravingHolder='<div id="divPopUp" class="divPopUp" style="border: none; position: absolute; left: 0px; top: 0px;"><div class="divPopUpEngraving"><div id="close" style="display: block; position: absolute; right: 10px; top: 15px;"><a href="javascript:parent.closePopUp();" class="closeLink" style="display: block; position: relative; color: white;"><i class="icon-font" aria-hidden="true" style="font-size: 18px;">delete_large</i></a></div></div>'+engravingIframe+'</div>';$("body").append(engravingHolder);$(window).scrollTop(0);}function createContShopLink(){var bottomContinueLinkHolder=document.getElementById("literalContinueShoppingLink2");var continueLabel="";var continueLink="";var contDiv=null;if(bottomContinueLinkHolder!=null){contDiv=document.createElement("div");continueLabel=bottomContinueLinkHolder.innerHTML;continueLink=bottomContinueLinkHolder.href;contDiv.setAttribute("id","contShopping");contDiv.setAttribute("class","backToLink");var contLink="<a href='"+continueLink+"'>"+continueLabel+"</a>";contDiv.innerHTML=contLink;var marker=document.getElementById("divPageContent");contDiv.insertBefore(marker);}}function createProceedToPurchaseLink(){var genPageHandle=document.getElementById("divGenPage");if(genPageHandle!=null&&genPageHandle.className=="rhtBasketPanelOn"){genPageHandle.className="rhtBasketPanelOff";}}function wrapTopPurchaseLink(){var plink=document.getElementById("btnPurchaseTop");if(plink!=null){var hdr=plink.parentNode;var wrap=document.createElement("div");wrap.id="wrapPurchaseTop";hdr.insertBefore(wrap,plink);wrap.appendChild(plink);plink.style.visibility="visible";}}function TrimString(s){var m=s.match(/^\s*(\S+(\s+\S+)*)\s*$/);return(m==null)?"":m[1];}function ValidateValue(txtItem,str){if(TrimString(str).length==0){document.getElementsByName(txtItem).item(0).value='';}}function initAddConfirmationClose(){location.reload();}function applyNumberSpinner(){$(".applyNumberSpinner").each(function(){var numberSpinnerHTML='<div class="numberSpinner" rel="'+$(this).attr("id")+'"><span class="down"></span><span class="number">'+$(this).val()+'</span><span class="up"></span>';$(this).hide().after(numberSpinnerHTML);$(this).removeClass("applyNumberSpinner");});}function updateShoppingBagCount(){var cookieCnt=parseInt(readCookie("shoppingbagcnt"));if(document.getElementById("spanShoppingBagCount")){if(!isNaN(cookieCnt)&&cookieCnt>0){document.getElementById("spanShoppingBagCount").innerHTML=cookieCnt;}else{document.getElementById("spanShoppingBagCount").innerHTML="";}}if(document.getElementById("bagCount")){if(!isNaN(cookieCnt)&&cookieCnt>0){$("#bagCount").html(cookieCnt);}else{$("#bagCount").hide()
}}}function updateSavedCount(){var cookieCnt=parseInt(readCookie("saveditemscnt"));if(document.getElementById("spanSavedItemCount")){if(!isNaN(cookieCnt)&&cookieCnt>0){$("#spanSavedItemCount").show();document.getElementById("spanSavedItemCount").innerHTML=cookieCnt;}else{document.getElementById("spanSavedItemCount").innerHTML="";}}}function readCookie(name){var nameEQ=name+"=";var ca=document.cookie.split(';');for(var i=0;i<ca.length;i++){var c=ca[i];while(c.charAt(0)==' ')c=c.substring(1,c.length);if(c.indexOf(nameEQ)==0)return c.substring(nameEQ.length,c.length);}return null;}function showHideControls(data){var parent=$(".shopping-bag-container");var sbCount=data.d.Header.TotalBagCount;var sbCustomItemCount=data.d.Header.TotalBagCustomItemCount;var sbRolledUpCount=data.d.Header.TotalBagRolledUpItemCount;if(sbCount!=null&&sbCount>0){if(isSmallMobile()){if(sbRolledUpCount!=null&&sbRolledUpCount==1){$("#btnPurchaseTop").hide();}else{$("#btnPurchaseTop").show();}}else{$("#btnPurchaseTop").hide();}parent.children(".bag-right").find(".order-details").show();$("#btnPurchaseBot").show();if(sbCustomItemCount!=null&&sbCustomItemCount>5){$("#btnPurchaseBot").prop('disabled',true);$("#btnPurchaseTop").prop('disabled',true);$("#divErrorMessageIndicator").show();}else if(sbCustomItemCount==0){$(".byoIndividualBox").hide();}else{$("#btnPurchaseBot").prop('disabled',false);$("#btnPurchaseTop").prop('disabled',false);$("#divErrorMessageIndicator").hide();}$("#litShoppingBagCount").show();$(".divShoppingBagCount").html("("+sbCount+")");if(isSmallMobile()||locale.toLowerCase()=="en-us-estr"||locale.toLowerCase()=="ja-jp-estr"){$("#divemailprint").hide();}else{$("#divemailprint").show();}var radioHtml=renderRadioButtonGroup(data.d.ResponseObject.ShippingTypes);$("#shippingMethods").html(shipTypeLegend+radioHtml);parent.children(".bag-right").find(".order-subtotal span").text(data.d.ResponseObject.OrderSubTotal);parent.children(".bag-right").find(".complimentary-shipping span").text(data.d.ResponseObject.ShippingCost);parent.children(".bag-right").find(".complimentary-shipping-shippingOption").html(data.d.ResponseObject.ShippingMethod);if(data.d.ResponseObject.IsDisplayDeliveryDate==true){$('#selectedOptionDeliveryDate').show();$('#selectedOptionDeliveryDate').html(data.d.ResponseObject.DeliveryDateText);}else{$('#selectedOptionDeliveryDate').html("");$('#selectedOptionDeliveryDate').hide();}if(data.d.ResponseObject.IsSavedShippingTypeAvailable==false){$("#hdnSelectedShipTypeUnavailabilityFlag").val("1");ShowShipTypeUnavailityError();}$(".estimatedTax__tax-text").text(estimatedTaxText.replace("{0}",data.d.ResponseObject.ZipCode));$('#txtSBZipCodeForTax').val(data.d.ResponseObject.ZipCode);$("#hdnZipCodeForTax").val(data.d.ResponseObject.ZipCode);parent.children(".bag-right").find("#estimatedTaxAmt").text(data.d.ResponseObject.TaxAmount);parent.children(".bag-right").find("#divTotal span").text(data.d.ResponseObject.TotalPrice);$("#hdnTotalPriceWithoutTax").val(data.d.ResponseObject.TotalPriceWithoutTax);if(data.d.ResponseObject.IsDisplayNeedItSooner==false&&data.d.ResponseObject.IsDisplayShippingOptionEdit==false){$("#needItSoonerPlaceHolder").hide();}else if(data.d.ResponseObject.IsDisplayNeedItSooner==true||data.d.ResponseObject.IsDisplayShippingOptionEdit==true){$("#needItSoonerPlaceHolder").show();$('#needItSoonerPlaceHolder').html(data.d.ResponseObject.ShippingToggleText);}if(data.d.ResponseObject.IsComplimentaryShipping=='false'){$(".complimentary-shipping-note").hide();$(".banner-note").show();}}else{$('.offset').css("margin-top","20%");$(".byoIndividualBox").hide();$("#btnPurchaseTop").hide();$("#divErrorMessageIndicator").hide();$("#litShoppingBagCount").hide();$(".divShoppingBagCount").html("");$("#divemailprint").hide();parent.children(".bag-right").find(".order-details").hide();$("#literalContinueShoppingLink2").hide();if($("#hdnIsUserSignIn ").val()=="false"){$("#lblEmptyBasketSignIn").css("display","block");$("#divSignInLink").css("display","inline");}$("#divShopPopularLink").show();}}var viewportHeight;function fixOrderDetails(){var viewportScrollTop=$(window).scrollTop();var viewportScrollBottom=viewportScrollTop+$(window).height();var containerOffset=$(".bag-right").offset().top;var objBottom=viewportScrollTop+$(".bag-right-content").outerHeight();var bottomOffset=$(".bag-right").offset().top+$(".bag-right").outerHeight();if($(".bag-items-container").outerHeight()+18>$(".bag-right-content").outerHeight()){if(viewportScrollTop>=containerOffset){$(".bag-right-content").addClass("fixed");if(objBottom>=bottomOffset){$(".bag-right-content").addClass("bottomed");}else{$(".bag-right-content").removeClass("bottomed");}}else{$(".bag-right-content").removeClass("fixed").removeClass("bottomed");}}else{$(".bag-right-content").removeClass("fixed").removeClass("bottomed");}}$(window).load(function(){fixOrderDetails();});$(window).resize(function(){viewportHeight=$(window).height();fixOrderDetails();});$(window).scroll(function(){fixOrderDetails();});function showBusyIndicator(){$("#divBusy").css("display",'block');$("#divBusyImg").css("display",'block');}function hideBusyIndicator(){$("#divBusy").css("display",'none');$("#divBusyImg").css("display",'none');}function SetShippingTypeID(current){$("#hdnSingleSelectedShippingOptionDetailID").val(current.value);$("#selectShippingNotAvailableError").hide();var dataString='{"shippingDetailID" : "'+current.value+'"}';$.ajax({url:"/Customer/ShoppingBag.aspx/GetUpdatedBagSummaryForShippingTypeChange",type:"POST",data:dataString,dataType:"json",contentType:"application/json; charset=utf-8",success:function(data){RefreshOrderSummaryForShippingTypeChange(data);},error:function(jqXHR,status,error){hideBusyIndicator();}});}function RefreshOrderSummaryForShippingTypeChange(data){var parent=$(".shopping-bag-container");parent.children(".bag-right").find(".complimentary-shipping span").text(data.d.ResponseObject.ShippingCost);parent.children(".bag-right").find(".complimentary-shipping-shippingOption").html(data.d.ResponseObject.ShippingMethod);$(".estimatedTax__tax-text").text(estimatedTaxText.replace("{0}",data.d.ResponseObject.ZipCode));$('#txtSBZipCodeForTax').val(data.d.ResponseObject.ZipCode);$("#hdnZipCodeForTax").val(data.d.ResponseObject.ZipCode);parent.children(".bag-right").find("#estimatedTaxAmt").text(data.d.ResponseObject.TaxAmount);parent.children(".bag-right").find("#divTotal span").text(data.d.ResponseObject.TotalPrice);$("#hdnTotalPriceWithoutTax").val(data.d.ResponseObject.TotalPriceWithoutTax);if(data.d.ResponseObject.IsDisplayDeliveryDate==true){$('#selectedOptionDeliveryDate').html(data.d.ResponseObject.DeliveryDateText);$('#selectedOptionDeliveryDate').show();}else{$('#selectedOptionDeliveryDate').html("");$('#selectedOptionDeliveryDate').hide();}if(data.d.ResponseObject.IsSavedShippingTypeAvailable==false){$("#hdnSelectedShipTypeUnavailabilityFlag").val("1");ShowShipTypeUnavailityError();}if(data.d.ResponseObject.IsDisplayNeedItSooner==false&&data.d.ResponseObject.IsDisplayShippingOptionEdit==false){$("#needItSoonerPlaceHolder").hide();}else if(data.d.ResponseObject.IsDisplayNeedItSooner==true||data.d.ResponseObject.IsDisplayShippingOptionEdit==true){$('#needItSoonerPlaceHolder').html(data.d.ResponseObject.ShippingToggleText);$("#needItSoonerPlaceHolder").show();}$("#hdnShippingTypeExpandedState").val("0");ShowHideShippingTypeSection();if(data.d.ResponseObject.IsComplimentaryShipping=='false'){$(".complimentary-shipping-note").hide();$(".banner-note").show();}if(data.d.ResponseObject.IsComplimentaryShipping=='true'){$(".banner-note").hide();$(".complimentary-shipping-note").show();}}function RefreshOrderSummaryForTaxEstimation(data){var parent=$(".shopping-bag-container");$("#selectShippingNotAvailableError").hide();if(data.d.ResponseObject.IsTaxCalculated==true){$(".estimatedTax__tax-text").text(estimatedTaxText.replace("{0}",data.d.ResponseObject.ZipCode));$('#txtSBZipCodeForTax').val(data.d.ResponseObject.ZipCode);$("#hdnZipCodeForTax").val(data.d.ResponseObject.ZipCode);$("#shoppingBagTax").hide();parent.children(".bag-right").find("#estimatedTaxAmt").text(data.d.ResponseObject.TaxAmount);parent.children(".bag-right").find("#divTotal span").text(data.d.ResponseObject.TotalPrice);$("#hdnTotalPriceWithoutTax").val(data.d.ResponseObject.TotalPriceWithoutTax);$("#hdnTaxSectionFlag").val("1");ShowHideTaxSections();$("#shoppingBagTax").removeClass("zipCodeInvalidErrorMargin");$("#taxCalculationServiceError").hide();var radioHtml=renderRadioButtonGroup(data.d.ResponseObject.ShippingTypes);$("#shippingMethods").html(shipTypeLegend+radioHtml);parent.children(".bag-right").find(".complimentary-shipping span").text(data.d.ResponseObject.ShippingCost);parent.children(".bag-right").find(".complimentary-shipping-shippingOption").html(data.d.ResponseObject.ShippingMethod);if(data.d.ResponseObject.IsSavedShippingTypeAvailable==false){$("#hdnSelectedShipTypeUnavailabilityFlag").val("1");ShowShipTypeUnavailityError();}}else if(data.d.ResponseObject.IsTaxCalculated==false&&data.d.ResponseObject.IsInvalidPostCode==true){$("#zipCodeInvalidError").show();$("#shoppingBagTax").addClass("zipCodeInvalidErrorMargin");$("#taxCalculationServiceError").hide();var totalWithoutTax=$("#hdnTotalPriceWithoutTax").val();if(totalWithoutTax!=null&&totalWithoutTax!=undefined&&totalWithoutTax!=""){$("#totalPriceFigure").text(totalWithoutTax);}}else if(data.d.ResponseObject.IsTaxCalculated==false&&data.d.ResponseObject.IsInvalidPostCode==false&&data.d.ResponseObject.IsTaxCalculationConnectionError==false&&data.d.ResponseObject.IsAddrValidationConnectionError==false){$("#zipCodeInvalidError").hide();$("#shoppingBagTax").removeClass("zipCodeInvalidErrorMargin");$("#taxCalculationServiceError").hide();var totalWithoutTax=$("#hdnTotalPriceWithoutTax").val();if(totalWithoutTax!=null&&totalWithoutTax!=undefined&&totalWithoutTax!=""){$("#totalPriceFigure").text(totalWithoutTax);}}else if(data.d.ResponseObject.IsTaxCalculationConnectionError==true){$("#zipCodeInvalidError").hide();$("#shoppingBagTax").removeClass("zipCodeInvalidErrorMargin");$("#taxCalculationServiceError").show();var totalWithoutTax=$("#hdnTotalPriceWithoutTax").val();if(totalWithoutTax!=null&&totalWithoutTax!=undefined&&totalWithoutTax!=""){$("#totalPriceFigure").text(totalWithoutTax);}}else if(data.d.ResponseObject.IsAddrValidationConnectionError==true){$("#zipCodeInvalidError").hide();$("#taxCalculationServiceError").show();var totalWithoutTax=$("#hdnTotalPriceWithoutTax").val();if(totalWithoutTax!=null&&totalWithoutTax!=undefined&&totalWithoutTax!=""){$("#totalPriceFigure").text(totalWithoutTax);}}}function ShowHideShippingTypeSection(){var shipTypeSectionFlag=$("#hdnShippingTypeExpandedState").val();if(shipTypeSectionFlag=="1"){$("#shippingMethods").show();var query=window.location.search.split("?").join("");var needItSooner=URLFactory.extractQueryStringValue(query,"needItSooner");if(needItSooner==1){if(isMobile()){$("html, body").animate({scrollTop:$("#divOrderDetails").offset().top},"slow");}}}else{$("#shippingMethods").hide();}}function ShowShipTypeUnavailityError(){var selectedshipTypeUnavailabilityFlag=$("#hdnSelectedShipTypeUnavailabilityFlag").val();if(selectedshipTypeUnavailabilityFlag=="1"){$("#selectShippingNotAvailableError").show();$("#hdnSelectedShipTypeUnavailabilityFlag").val("0");}else{$("#selectShippingNotAvailableError").hide();}}function ShowHideTaxSections(){var taxSectionFlag=$("#hdnTaxSectionFlag").val();if(taxSectionFlag=="-1"){$("#taxCalculationServiceError").show();}else if(taxSectionFlag=="0"){$("#shoppingBagTax").show();$("#estimatedTax").hide();$("#ltEstimateLabel").show();$("#estimateInput").hide();$("#taxCalculationServiceError").hide();}else if(taxSectionFlag=="1"){var taxAmountString=$("#estimatedTaxAmt").text();if(taxAmountString==""||taxAmountString==null||taxAmountString==undefined){$("#hdnTaxSectionFlag").val("0");$("#hdnZipCodeForTax").val("");$('#txtSBZipCodeForTax').val("");ShowHideTaxSections();}else{$("#shoppingBagTax").hide();$("#estimatedTax").show();$("#taxCalculationServiceError").hide();$("#zipCodeInvalidError").hide();}}else if(taxSectionFlag=="2"){$("#shoppingBagTax").show();$("#estimatedTax").hide();$("#ltEstimateLabel").hide();$("#estimateInput").show();$("#taxCalculationServiceError").hide();}else{$("#shoppingBagTax").hide();$("#estimatedTax").hide();$("#taxCalculationServiceError").hide();}var lastEnteredZipCode=$("#hdnZipCodeForTax").val();$('#txtSBZipCodeForTax').val(lastEnteredZipCode);}function EstimateTax(){$("#selectShippingNotAvailableError").hide();var zipCodeEntered=$("#txtSBZipCodeForTax").val().split(" ").join("");var inputLength;if((sbsiteID=="1"||sbsiteID=="21")){inputLength=5;}else if(sbsiteID=="5"||sbsiteID=="85"){inputLength=7;}if(((sbsiteID=="1"||sbsiteID=="21")&&zipCodeEntered.length==5)||((sbsiteID=="5"||sbsiteID=="85")&&(zipCodeEntered.length==6||zipCodeEntered.length==7))){$("#taxCalculationServiceError").hide();$("#zipCodeInvalidError").hide();$("#shoppingBagTax").removeClass("zipCodeInvalidErrorMargin");var dataString='{"zipCode" : "'+zipCodeEntered+'"}';if(isTaxEstimationInitiated==false){isTaxEstimationInitiated=true;$.ajax({url:"/Customer/ShoppingBag.aspx/EstimateTaxByZipCode",type:"POST",data:dataString,dataType:"json",contentType:"application/json; charset=utf-8",success:function(data){isTaxEstimationInitiated=false;RefreshOrderSummaryForTaxEstimation(data);TrackSiteInteractions("estimate tax:["+zipCodeEntered+"]","checkout");},error:function(jqXHR,status,error){isTaxEstimationInitiated=false;hideBusyIndicator();}});}}else if(((sbsiteID=="1"||sbsiteID=="21")&&zipCodeEntered.length>5)||((sbsiteID=="5"||sbsiteID=="85")&&zipCodeEntered.length>7)){var zipCodeUnaltered=$("#txtSBZipCodeForTax").val();zipCodeUnaltered=zipCodeUnaltered.substring(0,inputLength);$("#txtSBZipCodeForTax").val(zipCodeUnaltered);}}function renderRadioButtonGroup(rowDataArray){if(rowDataArray!=null){var i,n;var rowHTML="";for(i=0,n=rowDataArray.length;i<n;i++){rowHTML+=renderRadio(rowDataArray[i]);}return rowHTML;}else{return"";}}function renderRadio(item){var rowTemplate=shipRadioButtonTemplate;var rowHTML="";rowTemplate=rowTemplate.split("$ShippingOptionDetailID$").join(item.ShippingOptionDetailId).replace("$DisplayName$",item.DisplayName).replace("$DeliveryDateText$",item.DeliveryDateText);if(item.IsSelected==true){rowTemplate=rowTemplate.replace("$Checked$","checked=\"checked\"");}else{rowTemplate=rowTemplate.replace("$Checked$","");}return rowTemplate;}$(document).ready(function(){var newItemAddCookie;var ntempcookie=CookieManager.getCookieValue("newitemadded");viewportHeight=$(window).height();if(typeof ntempcookie=="undefined"||ntempcookie==null||ntempcookie==""){newItemAddCookie=0;}else{newItemAddCookie=parseInt(ntempcookie);}if(newItemAddCookie==1){$('html, body').animate({scrollTop:$('.offset').offset().top-230},1500);}$(window).scroll(function(){if(newItemAddCookie==1){var bottom_of_object=$('.alert-success').offset().top+$('.alert-success').outerHeight();var bottom_of_window=$(window).scrollTop()+$(window).height();if(bottom_of_window>bottom_of_object){$(".alert-success").fadeIn('show');setTimeout(function(){$(".alert-success").fadeOut('show');},5000);newItemAddCookie=0;CookieManager.eraseCookie("newitemadded");}}});ShowHideTaxSections();ShowHideShippingTypeSection();ShowShipTypeUnavailityError();if(typeof(isComplimentaryShipping)!=="undefined"&&isComplimentaryShipping){$(".complimentary-shipping-note").show();}else{$(".banner-note").show();}if(isSmallMobile()){$('html, body').addClass('mobile');$(".banner-note").html($("#ctlHeaderM_ctlBanner_holiday_banner .inner").html());}else{$(".banner-note").html($("#ctlHeader_ctlBanner_holiday_banner .default").html());}var engravingAlphaMapping=['A','B','C','D','E','F','G','H','I','J','K','L','M','N','O','P','Q','R','S','T','U','V','W','X','Y','Z'];$("#btnPurchaseTop").click(function(){TrackNavigationalLinks("checkout","bag top");});$("#btnPurchaseBot").click(function(){TrackNavigationalLinks("checkout","bag bottom");trackShoppingBagDataOnCheckout();});$('.engravingWrapper').each(function(){var $initials=$(this).find('.initials');$initials.each(function(){var spans='';$(this).children('span').each(function(){var html=$('<div>').append($(this).clone()).remove().html();spans+=html;});$(this).empty();$(this).html(spans);});var $initial=$(this).find('.initials').children('span');$initial.each(function(i){$(this).children('img').remove();var initial=$(this).html();$(this).empty();$(this).html('<img src="/Shared/images/misc/engravingPeriod.gif" width="2" height="2">');var pos;pos="pos"+(i+1);$(this).attr('class',pos);$(this).attr('initial',initial);var yPosition,xPosition;yPosition=jQuery.inArray(initial,engravingAlphaMapping)*40;$(this).removeAttr('style');xPosition=$(this).css("background-position").split(" ")[0];if(initial==''){$(this).css("display","none");}else{$(this).css("background-position",xPosition+" -"+yPosition+"px").css("display","inline-block");}$(this).css('visibility','visible');});});$(".rhtPanelListItem .iconPlus a").click(function(){var isEngravingAvailable=$(this).parents(".rhtPanelListItem").find("input.engravable").val();var wlid=$(this).parents(".rhtPanelListItem").find("input.ids").val();if(isEngravingAvailable.toLowerCase()=="true"){createPopUp(550,680,true,this,20,'/Shopping/CustomizationOverlay.aspx?wlid='+wlid);return false;}});$("body").on("click",".bag-delete",function(){var container=$(this).parents(".bag-item-container");container.find(".remove-confirmation").show();return false;});$("body").on("click",".jq-remove-cancel",function(){var container=$(this).parents(".bag-item-container");container.find(".remove-confirmation").hide();return false;});$("body").on("click",".message-delete",function(){var container=$(this).parents(".bag-item");container.remove();return false;});$(window).load(function(){var itemValue=$('#lblAutomaticRemovedItemID').val();var dataString='{"shoppingBagRemovedItemValue" : "'+itemValue+'"}';$.ajax({url:"/Customer/ShoppingBag.aspx/RemoveAutomaticShoppingBagItem",type:"POST",data:dataString,dataType:"json",contentType:"application/json; charset=utf-8",success:function(data){$('#lblAutomaticRemovedItemID').val('');},error:function(jqXHR,status,error){}});});$("body").on("click",".removeItem",function(event){event.preventDefault();showBusyIndicator();var container=$(this).parents(".bag-item-container");var parentContainer=container.parents(".bag-item");var innerContainer=container.children(".bag-item-details");var itemUrl=container.children(".bag-item-image").find('a:first').attr('href');var itemName=parentContainer.children(".deleteForLaterHide").find('.item-name').html();var itemLink="<a href="+itemUrl+">"+itemName+"</a>";var itemKey=innerContainer.children(".lblKeyHide").val();var itemValue=innerContainer.children(".lblIDHide").val();var parent=container.parents(".shopping-bag-container");var selectItem=container.children(".bag-item-details").find(".inputDropGroupType").val();var quantity=container.children(".bag-item-details").find(".inputDropQuantity").val();var dataString='{"shoppingBagItemKey" : "'+itemKey+'","shoppingBagItemValue" : "'+itemValue+'","selectedItem" : "'+selectItem+'","quantity" : "'+quantity+'"}';$(".saveForLaterHide.saveForLaterShow").parents(".bag-item").remove();$(".deleteForLaterHide.deleteForLaterShow").parents(".bag-item").remove();$.ajax({url:"/Customer/ShoppingBag.aspx/RemoveShoppingBagItem",type:"POST",data:dataString,dataType:"json",contentType:"application/json; charset=utf-8",success:function(data){var numSBItems=data.d.Header.TotalBagCount;updateShoppingBagCount();showHideControls(data);fixOrderDetails();setTimeout(function(){container.addClass("complete");parentContainer.children(".deleteForLaterHide").find('.item-name').empty();parentContainer.children(".deleteForLaterHide").find('.item-name').html(itemLink);parentContainer.children(".deleteForLaterHide").addClass("deleteForLaterShow");hideBusyIndicator();},2000);if(typeof(data.d.ResponseObject.DataLayer)!=="undefined"&&!IsNullOrEmpty(data.d.ResponseObject.DataLayer)){var dataObject=JSON.parse(data.d.ResponseObject.DataLayer);trackData(dataObject);}if(!isMobileSite){$('#rr1').fadeOut();getProductRecsRefersh();}},error:function(jqXHR,status,error){hideBusyIndicator();}});});$("body").on("click",".removeCustomItem",function(event){event.preventDefault();showBusyIndicator();var container=$(this).parents(".bag-item-container");var parentContainer=container.parents(".bag-item");var innerContainer=container.children(".bag-item-details");var itemUrl=container.children(".bag-item-image").find('a:first').attr('href');var itemName=parentContainer.children(".deleteForLaterHide").find('.item-name').html();var itemLink="<a href="+itemUrl+">"+itemName+"</a>";var itemKey=innerContainer.children(".lblKeyHide").val();var itemValue=innerContainer.children(".lblIDHide").val();var parent=container.parents(".shopping-bag-container");var isSaveForLater=false;var dataString='{"shoppingBagCustomItemKey" : "'+itemKey+'","isSaveForLater" : "'+isSaveForLater+'"}';$(".saveForLaterHide.saveForLaterShow").parents(".bag-item").remove();$(".deleteForLaterHide.deleteForLaterShow").parents(".bag-item").remove();$.ajax({url:"/Customer/ShoppingBag.aspx/RemoveShoppingBagCustomItem",type:"POST",data:dataString,dataType:"json",contentType:"application/json; charset=utf-8",success:function(data){var numSBItems=data.d.Header.TotalBagCount;updateShoppingBagCount();showHideControls(data);fixOrderDetails();setTimeout(function(){container.addClass("complete");parentContainer.children(".deleteForLaterHide").find('.item-name').empty();parentContainer.children(".deleteForLaterHide").find('.item-name').html(itemLink);parentContainer.children(".deleteForLaterHide").addClass("deleteForLaterShow");hideBusyIndicator();},2000);},error:function(jqXHR,status,error){hideBusyIndicator();}});});$("body").on("click",".saveForLaterCustomItem, .jq-save-customItem-later",function(event){event.preventDefault();showBusyIndicator();var container=$(this).parents(".bag-item-container");var parentContainer=container.parents(".bag-item");var innerContainer=container.children(".bag-item-details");var itemUrl=container.children(".bag-item-image").find('a:first').attr('href');var itemName=parentContainer.children(".deleteForLaterHide").find('.item-name').html();var itemLink="<a href="+itemUrl+">"+itemName+"</a>";var itemKey=innerContainer.children(".lblKeyHide").val();var itemValue=innerContainer.children(".lblIDHide").val();var parent=container.parents(".shopping-bag-container");var dataString='{"shoppingBagCustomItemKey" : "'+itemKey+'"}';$(".saveForLaterHide.saveForLaterShow").parents(".bag-item").remove();$(".deleteForLaterHide.deleteForLaterShow").parents(".bag-item").remove();$(this).parents(".bag-item").find(".byoViewDetails").css("display","none");$.ajax({url:"/Customer/ShoppingBag.aspx/SaveForLaterSBCustomItem",type:"POST",data:dataString,dataType:"json",contentType:"application/json; charset=utf-8",success:function(data){var numSBItems=data.d.Header.TotalBagCount;var numSaveItems=data.d.Header.TotalCount;updateShoppingBagCount();updateSavedCount();showHideControls(data);container.children(".bag-item-image").find(".saveForLaterCustomItem").hide();container.children(".bag-item-image").find(".saved-remove").show();setTimeout(function(){container.addClass("complete");parentContainer.children(".saveForLaterHide").find('.item-name').empty();parentContainer.children(".saveForLaterHide").find('.item-name').html(itemLink);parentContainer.children(".saveForLaterHide").addClass("saveForLaterShow");hideBusyIndicator();},2000);if(typeof(data.d.ResponseObject.DataLayer)!=="undefined"&&!IsNullOrEmpty(data.d.ResponseObject.DataLayer)){var dataObject=JSON.parse(data.d.ResponseObject.DataLayer);trackData(dataObject);}},error:function(jqXHR,status,error){hideBusyIndicator();}});});$("body").on("click",".saveForLater, .jq-save-later",function(event){event.preventDefault();showBusyIndicator();var container=$(this).parents(".bag-item-container");var parentContainer=container.parents(".bag-item");var innerContainer=container.children(".bag-item-details");var itemUrl=container.children(".bag-item-image").find('a:first').attr('href');var itemName=parentContainer.children(".deleteForLaterHide").find('.item-name').html();var itemLink="<a href="+itemUrl+">"+itemName+"</a>";var itemKey=innerContainer.children(".lblKeyHide").val();var itemValue=innerContainer.children(".lblIDHide").val();var parent=container.parents(".shopping-bag-container");var selectItem=container.children(".bag-item-details").find(".inputDropGroupType").val();var quantity=container.children(".bag-item-details").find(".inputDropQuantity").val();var dataString='{"shoppingBagItemKey" : "'+itemKey+'","shoppingBagItemValue" : "'+itemValue+'","selectedItem" : "'+selectItem+'","quantity" : "'+quantity+'"}';$(".saveForLaterHide.saveForLaterShow").parents(".bag-item").remove();$(".deleteForLaterHide.deleteForLaterShow").parents(".bag-item").remove();$.ajax({url:"/Customer/ShoppingBag.aspx/SaveForLaterSBItem",type:"POST",data:dataString,dataType:"json",contentType:"application/json; charset=utf-8",success:function(data){var numSBItems=data.d.Header.TotalBagCount;var numSaveItems=data.d.Header.TotalCount;updateShoppingBagCount();updateSavedCount();showHideControls(data);container.children(".bag-item-image").find(".saveForLater").hide();container.children(".bag-item-image").find(".saved-remove").show();setTimeout(function(){container.addClass("complete");parentContainer.children(".saveForLaterHide").find('.item-name').empty();parentContainer.children(".saveForLaterHide").find('.item-name').html(itemLink);parentContainer.children(".saveForLaterHide").addClass("saveForLaterShow");hideBusyIndicator();},2000);if(typeof(data.d.ResponseObject.DataLayer)!=="undefined"&&!IsNullOrEmpty(data.d.ResponseObject.DataLayer)){var dataObject=JSON.parse(data.d.ResponseObject.DataLayer);trackData(dataObject);}if(!isMobileSite)getProductRecsRefersh();},error:function(jqXHR,status,error){hideBusyIndicator();}});});$("body").on("click",".jq-undo",function(){var container=$(this).siblings(".bag-item-container");var undo=$(this);if(undo.hasClass("undo-removed")){}else if(undo.hasClass("undo-saved")){}undo.addClass("animate");setTimeout(function(){undo.addClass("complete");undo.removeClass("undo-saved").removeClass("undo-removed");container.removeClass("complete");setTimeout(function(){container.removeClass("animate");},20);},300);return false;});$("body").on("vclick","#ltEstimateLabel, .estimatedTax__tax-edit",function(e){$("#hdnTaxSectionFlag").val("2");$("#shoppingBagTax").removeClass("dont-stack");ShowHideTaxSections();if(isMobileSite){$('html, body').animate({scrollTop:$("#estimateInput").offset().top-100
},500);}$("#txtSBZipCodeForTax").focus();e.stopPropagation();return false;});$("body").on("vclick",".needItSooner",function(){if(locale.toLowerCase()=="en-au"){var props={link:$(this),source:"/Service/FaqOverlay.aspx?faqCode=linkauneeditsooner&redesign=true",type:"ajax",size:"normal",closeWarning:false
};openModalOverlay(props);}else{$(".shippingOptions").toggle();}});var deleteTimer;$("#txtSBZipCodeForTax").blur(function(e){if($("#txtSBZipCodeForTax").val().length==0){$("#taxCalculationServiceError").hide();$("#zipCodeInvalidError").hide();$("#shoppingBagTax").removeClass("zipCodeInvalidErrorMargin");var totalWithoutTax=$("#hdnTotalPriceWithoutTax").val();if(totalWithoutTax!=null&&totalWithoutTax!=undefined&&totalWithoutTax!=""){$("#totalPriceFigure").text(totalWithoutTax);}deleteTimer=setTimeout(function(){$("#hdnTaxSectionFlag").val("0");$("#hdnZipCodeForTax").val("");ShowHideTaxSections();$("#shoppingBagTax").addClass("dont-stack");},5000);}else{EstimateTax();}});$("#txtSBZipCodeForTax").keyup(function(e){var zipCodeEntered=$("#txtSBZipCodeForTax").val().split(" ").join("");EstimateTax();if(zipCodeEntered.length==0){var totalWithoutTax=$("#hdnTotalPriceWithoutTax").val();if(totalWithoutTax!=null&&totalWithoutTax!=undefined&&totalWithoutTax!=""){$("#totalPriceFigure").text(totalWithoutTax);}deleteTimer=setTimeout(function(){$("#hdnTaxSectionFlag").val("0");$("#hdnZipCodeForTax").val("");ShowHideTaxSections();$("#shoppingBagTax").addClass("dont-stack");},5000);}else{if(deleteTimer){clearTimeout(deleteTimer);}}preventEnterSubmit(e);});$("#txtSBZipCodeForTax").keydown(function(event){$("#taxCalculationServiceError").hide();$("#zipCodeInvalidError").hide();$("#shoppingBagTax").removeClass("zipCodeInvalidErrorMargin");preventEnterSubmit(event);});$("#txtSBZipCodeForTax").keypress(function(event){$("#taxCalculationServiceError").hide();$("#zipCodeInvalidError").hide();$("#shoppingBagTax").removeClass("zipCodeInvalidErrorMargin");preventEnterSubmit(event);});$("#needItSoonerPlaceHolder").on("vclick",function(e){if($("#shippingMethods").is(':visible')){$("#hdnShippingTypeExpandedState").val("0");}else{$("#hdnShippingTypeExpandedState").val("1");TrackSiteInteractions("need it sooner","checkout");}});$("#ltEstimateLabel").on("vclick",function(e){if($("#shippingMethods").is(':visible')){$("#hdnShippingTypeExpandedState").val("0");ShowHideShippingTypeSection();}});$(".byoViewDetails a").click(function(e){$(this).find("i.down").toggleClass("byoDropDown");$(this).find("i.up").toggleClass("byoDropUp");$(this).next().toggle();e.preventDefault();});if($("#lblEmptyBasketErr").is(":visible")){$(".byoIndividualBox").hide();}$('.bag-item-image a[href*="build-your-own"]').each(function(){});$("body").on("click",".jq-sb-edit-engraving",function(e){e.preventDefault();var props={link:$(this),source:$(this).attr("href"),type:"ajax",size:"large"
};openModalOverlay(props);});$("body").on("mousedown",".jq-sb-select-motif",function(e){e.preventDefault();});$("body").on("click",".jq-sb-select-motif",function(e){e.preventDefault();var props={link:$(this),source:$(this).siblings(".overlay-url").val(),type:"ajax",size:"large"
};openModalOverlay(props);});$("body").on("mousedown click",".jq-sb-select-motif-single",function(e){e.preventDefault();});$('.bag-item').each(function(){var fragrancesNotice=$(this).find('.hdnItemFragrances').attr('value');if(typeof fragrancesNotice!=="undefined"&&fragrancesNotice=='True'){console.log('enable:'+fragrancesNotice);$(this).find('.ItemZipCodeAvailabilityNotice').show();}});});var count=0;function preventEnterSubmit(event){if(event.keyCode==13&&count==0){count=1;EstimateTax();event.preventDefault();event.stopPropagation()
return false;}if(count==1){count=0;}}