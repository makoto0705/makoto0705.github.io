var productTemplate='<img id="product_$sku$" src="$img$" alt="$alt$" data-sku="$sku$" data-description="$description$" data-price="$price$" data-crop="$crop$" data-crop-normal="$cropN$" data-state="$state$" data-isgroup="$isgroup$" data-isengravable="$isengravable$" data-hasMotif="$hasMotif$" data-ispurchasable="$ispurchasable$" />';var imageTemplate='$src$?$$presetId$$';var DEFAULT_IMAGE_CROP="0.2,0.2,0.6,0.6";var imageCroppedTemplate='$src$&layer=1&cropN=$crop$';var imageCroppedTemplateAbsolute='$src$&layer=1&crop=$crop$';var tooltipXHR=null;var model,inlineZoomViewer;var rrProdRecs;if($(window).width()<980&&locale.toLowerCase()=="en-us-pkb"){$("body").addClass("narrow");}function createProductString(rrProductArray){var productString='{"recommendedProducts":[';for(var i=0;i<rrProductArray.items.length;i++){var tempString='{"SKU": "$productID$", "TYPE": "$isEngagement$"},';tempString=tempString.replace("$productID$",rrProductArray.items[i].sku);tempString=tempString.replace("$isEngagement$","N");if(i==rrProductArray.items.length-1){tempString=tempString.slice(0,-1);}productString=productString+tempString;}productString=productString+']}';return productString;}function createProductRecommendationData(rrProdRecs){if(rrProdRecs!=undefined&&showProdRecommendation!="False"){for(var i=0;i<rrProdRecs.length;i++){var getProducts=createProductString(rrProdRecs[i]);getAvailability(getProducts,rrProdRecs[i]);}}}function getAvailability(productString,productObject){$.ajax({url:"/Shopping/Item.aspx/GetProductRecommendations",type:"POST",data:productString,dataType:"json",contentType:"application/json; charset=utf-8",success:function(data){createRRDiv(data.d,productObject);},error:function(jqXHR,status,error){}});}function createRRDiv(finalizedItemArray,productObject){var rrDiv;var $uplatePlacement="rr1";$("#"+$uplatePlacement+" .rrItemCarousel").removeClass("touch-carousel").addClass("apply-touch-carousel");var productPlacement=$("#"+$uplatePlacement+" .rrItemCarousel .container");var tempDiv="<div class='rrItem'><a class='miniPDP' href='$itemURL$' data-sku='$sku$' data-ispurchasabale='$isPurchasable$' data-itemURL='$itemURL$' data-rrAnalytics='$rrAnalytics$'><img src='$imageURL$'><div class='item-desc'>$itemDesc$</div><div class='item-price'>$itemPrice$</div></a><a id='$sku$' class='btnAddToBag avenir type-cta' data-isengravable='$isengravable$' data-hasMotif='$hasMotif$' data-selectedsku='$selectedsku$' data-group='$GroupType$' data-group-sku='$groupsku$' data-sku-list='$skuList$' data-ispurchasabale='$isPurchasable$' href='#' data-rrAnalytics='$rrAnalytics$'>"+txtAddtoBagLink+"</a></div>";var tempDivPurchase="<div class='rrItem'><a class='miniPDP' href='$itemURL$' data-sku='$sku$' data-ispurchasabale='$isPurchasable$' data-itemURL='$itemURL$' data-rrAnalytics='$rrAnalytics$'><img src='$imageURL$'><div class='item-desc'>$itemDesc$</div><div class='item-price'>$itemPrice$</div></a><a id='$sku$' class='btnAddToBag avenir type-cta' data-isengravable='$isengravable$' data-hasMotif='$hasMotif$' data-selectedsku='$selectedsku$' data-group='$GroupType$' data-group-sku='$groupsku$' data-sku-list='$skuList$' data-ispurchasabale='$isPurchasable$' href='#' data-rrAnalytics='$rrAnalytics$'>"+txtAddtoBagLink+"</a></div>";var newTempDiv="";var count=0;for(var i=0;i<finalizedItemArray.length;i++){if(finalizedItemArray[i]!=null){if(finalizedItemArray[i].isAvailable=="True"&&finalizedItemArray[i].isPurchasable=='True'){tempDiv=tempDivPurchase;if(count%3==0){newTempDiv=newTempDiv+"<div>"+tempDiv;}else if(count%3==2){newTempDiv=newTempDiv+tempDiv+"</div>";}else{newTempDiv=newTempDiv+tempDiv;}var tempSkuListArry;var SkuList=[];var SkuListFinal;if(finalizedItemArray[i].SKUList!=null){tempSkuListArry=finalizedItemArray[i].SKUList;for(var j=0;j<tempSkuListArry.length;j++){SkuList.push(tempSkuListArry[j].Sku);}}SkuListFinal=SkuList.toString();var strGroupSKUFinal;var tempGroupSKUArray;if(finalizedItemArray[i].Group!=null&&finalizedItemArray[i].GroupTypeID=='2'){strGroupSKUFinal=finalizedItemArray[i].Group.Sku;}else{strGroupSKUFinal='None';}var sty=finalizedItemArray[i].isGroup;var groupType=(finalizedItemArray[i].GroupTypeID!=null)?finalizedItemArray[i].GroupTypeID:"Individual";var price=(finalizedItemArray[i].ShowPrice!="false")?finalizedItemArray[i].Price:"";newTempDiv=newTempDiv.split("$itemURL$").join(finalizedItemArray[i].FriendlyUrl+"?trackpdp=sbpr");newTempDiv=newTempDiv.split("$sku$").join(finalizedItemArray[i].Sku);newTempDiv=newTempDiv.split("$isPurchasable$").join(finalizedItemArray[i].isPurchasable);newTempDiv=newTempDiv.split("$selectedsku$").join(finalizedItemArray[i].DefaultSku);newTempDiv=newTempDiv.split("$isengravable$").join(finalizedItemArray[i].IsServiceable);newTempDiv=newTempDiv.split("$hasMotif$").join(finalizedItemArray[i].IsMotifEnabled);newTempDiv=newTempDiv.split("$skuList$").join(SkuListFinal);newTempDiv=newTempDiv.split("$groupsku$").join(strGroupSKUFinal);newTempDiv=newTempDiv.replace("$imageURL$","//media.tiffany.com/is/image/Tiffany/EcomBrowseL/"+finalizedItemArray[i].ImgURL+".jpg");newTempDiv=newTempDiv.replace("$itemDesc$",finalizedItemArray[i].Name);newTempDiv=newTempDiv.replace("$itemPrice$",price);newTempDiv=newTempDiv.split("$rrAnalytics$").join(productObject.items[i].link_url);if(groupType=='Individual'){newTempDiv=newTempDiv.replace("$GroupType$",groupType);}else{newTempDiv=newTempDiv.replace("$GroupType$","Type"+groupType);}count++;}}}if(count%3==2){newTempDiv=newTempDiv+"<div class='rrItem'></div>";}else if(count%3==1)
newTempDiv=newTempDiv+"<div class='rrItem'></div><div class='rrItem'></div>";productPlacement.html(newTempDiv);initTouchCarousel();$("#"+$uplatePlacement+" #rrTitle").text(productObject.strategy_message);if(count!=0){$("#"+$uplatePlacement).fadeIn();}}function getProductRecsSkuList(rrApiUrl,rrDivID){$.ajax({url:rrApiUrl,type:"GET",dataType:"json",contentType:"application/json; charset=utf-8",success:function(jObject){var placementList=getformatedObject(jObject);createProductRecommendationData(placementList);},error:function(jqXHR,status,error){logErrorMessage(jqXHR,status,error);}});}function logErrorMessage(jqXHR,status,error){var dataString='{"errorMessage" : "'+error+'", "errorDetail" : "'+status+'", "priority" : 2, "errorTypeNumber" : 0, "applicatonName" : "Tco.Ui.Web" , "moduleName" : "RRProductRecommendation", "procName" : "RichRelevanceProductSearch"}';$.ajax({url:"/Default.aspx/AddToErrorLog",type:"POST",data:dataString,contentType:"application/json; charset=utf-8",success:function(){},error:function(jqXHR,status,error){}});}function getProductRecsRefersh(){$.ajax({url:"/Default.aspx/GetProductRecsSkuList",type:"POST",data:'{"sessionID" : "'+browserSessionID+'"}',dataType:"json",contentType:"application/json; charset=utf-8",success:function(data){getProductRecsSkuList(data.d,rrProdRecs_rrDivID);},error:function(jqXHR,status,error){}});}function getformatedObject(jObject){var PlacementList=[];var JSONProductRecs={};var JSONProductRecsItems=[];if(jObject!=null&&jObject["placements"]!=null){var jObjectPlacements=jObject["placements"];jObjectPlacements.forEach(function(objplacement){if(objplacement["recommendedProducts"]!=null){JSONProductRecs={};JSONProductRecs["placement_name"]=objplacement["placement"].toString();JSONProductRecs["strategy_message"]=objplacement["strategyMessage"].toString();JSONProductRecs["strategy_name"]="";var skuList=objplacement["recommendedProducts"];var JSONProductRecsItems=[];var jsonProductRecsItem={};skuList.forEach(function(sku){jsonProductRecsItem={};jsonProductRecsItem["image_url"]=sku["imageURL"].toString();jsonProductRecsItem["link_url"]=sku["clickTrackingURL"].toString();jsonProductRecsItem["price"]=sku["priceCents"].toString();jsonProductRecsItem["rating"]=sku["rating"].toString();jsonProductRecsItem["sales_price"]="";jsonProductRecsItem["sku"]=sku["id"].toString();JSONProductRecsItems.push(jsonProductRecsItem);})
JSONProductRecs.items=JSONProductRecsItems;PlacementList.push(JSONProductRecs);}});}return PlacementList;}$(document).ready(function(){$("body").on("click",".rrItem .miniPDP",function(e){e.preventDefault();e.stopPropagation();var relUrl=$(this).attr('href');var itemSku=$(this).attr('data-sku');var curbagCnt=parseInt(readCookie("shoppingbagcnt"));var itemRedirect=$(this).attr("data-itemURL");var rrItem=$(this).attr("data-rrAnalytics");if(curbagCnt>0){var baseUrl='/Shopping/DigiCatMiniPDP.aspx?shopTile=1&sku='+itemSku+'&reqType=sb&rel=sb&trackpdp=sbpr';showShopTileMiniPDP(baseUrl);$("#shop-tile-overlay .list").addClass("shopOverlayHidden");$("#shop-tile-overlay").addClass("hiddenList");initRollbar();$("#shop-tile-overlay").css("top",$(document).scrollTop()+(($(window).height()-$("#shop-tile-overlay").height())/2)+"px");$("#shop-tile-overlay").show();$("#shop-tile-overlay iframe").animate({"opacity":"1"
},500);$("#gray-overlay-shop-tile").show();}$.ajax({url:rrItem+"&callback=?",data:"",type:'POST',timeout:10000,dataType:"jsonp",success:function(data){if(curbagCnt==0){window.location=itemRedirect;}},error:function(e){if(curbagCnt==0){window.location=itemRedirect;}}});return false;});$("body").on("click",".rrItem .btnAddToBag",function(event){event.preventDefault();var itemRedirect=$(this).attr("data-itemURL");var rrItem=$(this).attr("data-rrAnalytics");var sku=$(this).attr('id');var isEngravingAvailable=$(this).attr("data-isengravable");var hasMotif=$(this).attr("data-hasMotif");var selectedSku=$(this).attr("data-selectedsku");var SkuList=$(this).attr('data-sku-list');var SkuGroup=$(this).attr('data-group-sku');var qty=1;var mcat="";var cid="";var itemKey="";var origin=0;var groupType=$(this).attr('data-group');var ajaxUrl,dataString;var StrSkuAndQuantity=[];StrSkuAndQuantity.push(SkuGroup+":"+"1");StrSkuAndQuantity.push(SkuList+":"+"1");selectedSku=(selectedSku=="")?sku:selectedSku;mcat=(mcat=="")?0:mcat;cid=(cid=="")?0:cid;itemKey=selectedSku+"_0_"+sku+" ";$.ajax({url:rrItem+"&callback=?",data:"",type:'POST',timeout:10000,dataType:"jsonp",success:function(data){if(isEngravingAvailable.toLowerCase()=="true"||hasMotif.toLowerCase()=="true"){if(groupType=="Type2"){var engravingURL="/Shopping/CustomizationOverlay.aspx?groupType="+groupType+"&sku="+sku+"&selectedSku="+selectedSku+"&Quantity="+StrSkuAndQuantity+"&rel=sb&source=pr";}else{var engravingURL="/Shopping/CustomizationOverlay.aspx?groupType="+groupType+"&sku="+sku+"&selectedSku="+selectedSku+"&Quantity=1&rel=sb&source=pr";}doEngraving(engravingURL);}else{showBusyIndicator();if(groupType=='Type2'){ajaxUrl='/Default.aspx/AddMultipleShoppingBagItems';dataString='{"strSku":"'+sku+'", "selectedSku":"'+selectedSku+'", "strSkuAndQuantity":"'+StrSkuAndQuantity.join(";")+'", "cid":'+cid+', "mcid":'+mcat+', "origin":'+origin+', "cat_id":"", "cat_item_id":"", "p_cat_id":"", "p_cat_item_id":""}';}else{ajaxUrl='/Default.aspx/AddShoppingBagItem';dataString='{"sku" : "'+sku+'","selectedSku" : "'+selectedSku+'","quantity" : "'+qty+'", "cid":'+cid+', "mcid":'+mcat+', "origin":'+origin+'}';}$.ajax({url:ajaxUrl,type:"POST",data:dataString,dataType:"json",contentType:"application/json; charset=utf-8",success:function(data){if(typeof(data.d.DataLayer)!=="undefined"&&!IsNullOrEmpty(data.d.DataLayer)){TrackActionAddToShoppingBag("sbpr",data.d.DataLayer);}if(data.d.SuccessFlag=="True"){CookieManager.setCookieValue('newitemadded',1);}window.location.href='/Customer/ShoppingBag.aspx?isMenu=1&hdr=1';},error:function(jqXHR,status,error){hideBusyIndicator();}});}},error:function(e){if(isEngravingAvailable.toLowerCase()=="true"||hasMotif.toLowerCase()=="true"){if(groupType=="Type2"){var engravingURL="/Shopping/CustomizationOverlay.aspx?groupType="+groupType+"&sku="+sku+"&selectedSku="+selectedSku+"&Quantity="+StrSkuAndQuantity+"&rel=sb&source=pr";}else{var engravingURL="/Shopping/CustomizationOverlay.aspx?groupType="+groupType+"&sku="+sku+"&selectedSku="+selectedSku+"&Quantity=1&rel=sb&source=pr";}doEngraving(engravingURL);}else{showBusyIndicator();if(groupType=='Type2'){ajaxUrl='/Default.aspx/AddMultipleShoppingBagItems';dataString='{"strSku":"'+sku+'", "selectedSku":"'+selectedSku+'", "strSkuAndQuantity":"'+StrSkuAndQuantity.join(";")+'", "cid":'+cid+', "mcid":'+mcat+', "origin":'+origin+', "cat_id":"", "cat_item_id":"", "p_cat_id":"", "p_cat_item_id":""}';}else{ajaxUrl='/Default.aspx/AddShoppingBagItem';dataString='{"sku" : "'+sku+'","selectedSku" : "'+selectedSku+'","quantity" : "'+qty+'", "cid":'+cid+', "mcid":'+mcat+', "origin":'+origin+'}';}$.ajax({url:ajaxUrl,type:"POST",data:dataString,dataType:"json",contentType:"application/json; charset=utf-8",success:function(data){if(typeof(data.d.DataLayer)!=="undefined"&&!IsNullOrEmpty(data.d.DataLayer)){TrackActionAddToShoppingBag("sbpr",data.d.DataLayer);}if(data.d.SuccessFlag=="True"){CookieManager.setCookieValue('newitemadded',1);}window.location.href='/Customer/ShoppingBag.aspx?isMenu=1&hdr=1';},error:function(jqXHR,status,error){hideBusyIndicator();}});}}});});if(!isMobileSite)getProductRecsSkuList(rrProdRecs_rrApiUrl,rrProdRecs_rrDivID);});