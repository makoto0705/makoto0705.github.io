function ViewLocator(){this.pInstance=null;this.pViews=new Array();}ViewLocator.getInstance=function(){if(!this.pInstance){this.pInstance=new ViewLocator();}return this.pInstance;};ViewLocator.prototype.registerView=function(viewName,viewHandle){this.pViews[viewName]=viewHandle;};ViewLocator.prototype.getView=function(viewName){if(this.pViews[viewName]){return this.pViews[viewName];}return null;};function ToolTipAdvanced(){this.pInstance=null;this.pHandle=null;this.pShowIntervalId=0;this.pHideIntervalId=0;this.pMaxWidth=300;this.pShowDelay=600;this.pHideDelay=0;this.pContents="";this.pId="";this.moveWithCursor=true;this.isVisible=false;this.lastX=-1;this.lastY=-1;}ToolTipAdvanced.getInstance=function(){if(!this.pInstance){this.pInstance=new ToolTipAdvanced();}return this.pInstance;};ToolTipAdvanced.prototype.init=function(elementId){this.pHandle=document.getElementById(elementId);this.isVisible=false;};ToolTipAdvanced.prototype.showToolTipNow=function(contents,x,y,alignment,id,isBig){this.pContents=contents;this.pId=id;clearTimeout(this.pShowIntervalId);clearTimeout(this.pHideIntervalId);this.lastX=x;this.lastY=y;this.pHandle.innerHTML=contents;repositionToolTipAdvanced(x,y,false);var baseStyle=(isBig)?"toolTipAdvancedBig":"toolTipAdvanced";if(typeof(alignment)!="undefined"&&alignment=="right"){this.pHandle.className=baseStyle+" toolTipRight";}else{this.pHandle.className=baseStyle;}delayedToolTipAdvancedShow();};ToolTipAdvanced.prototype.showToolTip=function(contents,x,y,alignment,id,isBig){this.pContents=contents;this.pId=id;clearTimeout(this.pShowIntervalId);clearTimeout(this.pHideIntervalId);this.lastX=x;this.lastY=y;this.pHandle.innerHTML=contents;repositionToolTipAdvanced(x,y,false);var baseStyle=(isBig)?"toolTipAdvancedBig":"toolTipAdvanced";if(typeof(alignment)!="undefined"&&alignment=="right"){this.pHandle.className=baseStyle+" toolTipRight";}else{this.pHandle.className=baseStyle;}this.pShowIntervalId=setTimeout("delayedToolTipAdvancedShow()",this.pShowDelay);};ToolTipAdvanced.prototype.showToolTipFollowup=function(){var contents=this.pContents;if(this.pHandle){this.pHandle.style.visibility="visible";this.isVisible=true;if(this.lastY<0){}else{repositionToolTipAdvanced(this.lastX,this.lastY);}}};ToolTipAdvanced.prototype.hideToolTip=function(){clearTimeout(this.pShowIntervalId);clearTimeout(this.pHideIntervalId);this.hideToolTipFollowup();};ToolTipAdvanced.prototype.hideToolTipNow=function(){clearTimeout(this.pShowIntervalId);clearTimeout(this.pHideIntervalId);this.hideToolTipFollowup();};ToolTipAdvanced.prototype.hideToolTipFollowup=function(){if(this.pHandle){this.pHandle.style.visibility="hidden";this.isVisible=false;}};ToolTipAdvanced.prototype.getToolTip=function(){if(this.pHandle){return this.pHandle;}return null;};ToolTipAdvanced.prototype.getContents=function(){return this.pContents;};ToolTipAdvanced.prototype.setMaxWidth=function(maxWidth){this.pMaxWidth=maxWidth;};ToolTipAdvanced.prototype.setMouseOutHandler=function(handler){var id=this.pId;var target=this.pHandle;if(typeof(handler)=="undefined"||handler==null){delete this.pHandle.onmouseout;}else{this.pHandle.onmouseout=function(e){if(!e)var e=window.event;if(target.nodeName!='DIV')return;var relatedTarget=(e.relatedTarget)?e.relatedTarget:e.toElement;while(relatedTarget!=target&&relatedTarget.nodeName!='BODY'){relatedTarget=relatedTarget.parentNode;}if(relatedTarget==target)return;handler();};}};ToolTipAdvanced.prototype.setVisible=function(isVisible){clearTimeout(this.pShowIntervalId);clearTimeout(this.pHideIntervalId);if(isVisible==true){this.pHandle.style.visibility="visible";this.isVisible=true;}else{this.pHandle.style.visibility="hidden";this.isVisible=false;}};function delayedMouseOutHandler(){}function repositionToolTipAdvanced(x,y,useOffset){var toolTipHandle=ToolTipAdvanced.getInstance().getToolTip();if(toolTipHandle!=null){var xOffsetRight=10;var xOffsetLeft=-11;var yOffsetTop=5;var yOffsetBottom=10;var xOffset=xOffsetRight;var yOffset=yOffsetBottom;var newX;var newY;if(useOffset==true){var width=BrowserUtils.getBrowserWidth();var height=BrowserUtils.getBrowserHeight();var toolTipWidth=toolTipHandle.offsetWidth;var toolTipHeight=toolTipHandle.offsetHeight;if(x>=width/2-8){xOffset=xOffsetLeft-toolTipWidth;}newX=x+xOffset;newY=y+yOffset;if(newX+toolTipWidth>=width-18){newX=width-toolTipWidth-18;}}else{newX=x;newY=y;}if(toolTipHandle){toolTipHandle.style.left=newX+"px";toolTipHandle.style.top=newY+"px";}}}function delayedToolTipAdvancedShow(){ToolTipAdvanced.getInstance().showToolTipFollowup();}function delayedToolTipAdvancedHide(){ToolTipAdvanced.getInstance().hideToolTipFollowup();}var imageCodeMap=new Array();imageCodeMap["1002item"]={template:"[sku]_m_[v].jpg",type:"smallImg"};imageCodeMap["1003item"]={template:"[sku]_m_over_[v].jpg",type:"smallOverImg"};imageCodeMap["1002group"]={template:"[sku]_m_[v].jpg",type:"smallImg"};imageCodeMap["1003group"]={template:"[sku]_m_over_[v].jpg",type:"smallOverImg"};imageCodeMap["1065item"]={template:"[sku]_l_[v].jpg",type:"largeImg"};imageCodeMap["1066item"]={template:"[sku]_l_over_[v].jpg",type:"largeOverImg"};imageCodeMap["1065group"]={template:"[sku]_l_[v].jpg",type:"largeImg"};imageCodeMap["1066group"]={template:"[sku]_l_over_[v].jpg",type:"largeOverImg"};function ProductFactory(){}ProductFactory.convertXMLToArray=function(xmlData){var currentNode;var tempObject;var returnArray=new Array();var itemType;var images;var imageName;var imageCode;var imageVersion;var imageType;var imagePath;var isGroup;var isPurchaseable;var isServiceable;try{for(var i=0;i<xmlData.childNodes.length;i++){currentNode=xmlData.childNodes[i];if(currentNode.nodeName.toLowerCase()=="item"){itemType="item";tempObject={id:XMLUtils.getNodeValue(currentNode,"sku"),name:XMLUtils.getNodeValue(currentNode,"name"),price:XMLUtils.getNodeValue(currentNode,"price"),wholesalePrice:"",qs:XMLUtils.getNodeValue(currentNode,"qs"),smallImg:"/local/"+locale+"/Images/txt/placeholder_m.gif",smallOverImg:"/local/"+locale+"/Images/txt/placeholder_m_over.gif",largeImg:"/local/"+locale+"/Images/txt/placeholder_l.gif",largeOverImg:"/local/"+locale+"/Images/txt/placeholder_l_over.gif"};isGroup=XMLUtils.getNodeValue(currentNode,"isGroup");tempObject.isGroup=(isGroup=="true");isPurchaseable=XMLUtils.getNodeValue(currentNode,"isPurchasable");tempObject.isPurchaseable=(isPurchaseable!="false");isServiceable=XMLUtils.getNodeValue(currentNode,"isServiceable");tempObject.isServiceable=(isServiceable!="false");if(XMLUtils.getNode(currentNode,"defaultSku")!=null){tempObject.defaultSku=XMLUtils.getNodeValue(currentNode,"defaultSku");}if(XMLUtils.getNode(currentNode,"wholesaleprice")!=null){tempObject.wholesalePrice=XMLUtils.getNodeValue(currentNode,"wholesaleprice");}if(tempObject.id.toUpperCase().indexOf("GRP")>-1){itemType="group";}if(tempObject.name==""&&XMLUtils.getNodeValue(currentNode,"pmaDesc")!=null&&XMLUtils.getNodeValue(currentNode,"pmaDesc")!=""){tempObject.name=XMLUtils.getNodeValue(currentNode,"pmaDesc");}if(tempObject.name==""&&XMLUtils.getNodeValue(currentNode,"mipsDesc")!=null&&XMLUtils.getNodeValue(currentNode,"mipsDesc")!=""){tempObject.name=XMLUtils.getNodeValue(currentNode,"mipsDesc");}if(tempObject.name==""&&XMLUtils.getNodeValue(currentNode,"posDesc")!=null&&XMLUtils.getNodeValue(currentNode,"posDesc")!=""){tempObject.name=XMLUtils.getNodeValue(currentNode,"posDesc");}images=currentNode.getElementsByTagName("img");imageName=XMLUtils.getNodeValue(currentNode,"imgUrl");tempObject.largeImg=URLFactory.scene7ImageURL(imageName,"$EcomMobileBrowseM$","","");tempObject.largeOverImg=tempObject.largeImg;tempObject.smallImg=tempObject.largeImg;tempObject.smallOverImg=tempObject.largeImg;returnArray.push(tempObject);}}}catch(err){Debug.error(err);}return returnArray;};ProductFactory.convertJSONToArray=function(JSONData){var currentNode;var tempObject;var returnArray=new Array();var itemType;var images;var imageCode;var imageVersion;var imageType;try{for(var i=0;i<JSONData.length;i++){currentNode=JSONData[i];tempObject={id:currentNode.id,name:currentNode.name,price:currentNode.price,qs:currentNode.qs};if(currentNode.defaultSku!=null){tempObject.defaultSku=currentNode.defaultSku;}if(currentNode.wholesaleprice!=null){tempObject.wholesalePrice=currentNode.wholesaleprice;}itemType="item";if(tempObject.id.toUpperCase().indexOf("GRP")>-1){itemType="group";}images=currentNode.imgs.split("#");for(var j=0;j<images.length;j++){imageArr=images[j].split(":");imageVersion=imageArr[0];imageCode=imageArr[1];imageType=ProductFactory.getImageType(itemType,imageCode);if(imageArr.length>2&&imageArr[2]!=null&&imageArr[2]!=""){tempObject[imageType]=imageArr[2];}else{tempObject[imageType]=ProductFactory.getImagePath(tempObject.id,tempObject.defaultSku,imageVersion,itemType,imageCode);}}returnArray.push(tempObject);}}catch(err){Debug.error(err);}return returnArray;};ProductFactory.getTotalNumProducts=function(xmlData){try{if(xmlData){return Number(xmlData.attributes.getNamedItem("numHits").value);}}catch(err){Debug.error(err);}return null;};ProductFactory.getImagePath=function(lSku,lDefaultSku,lVersion,lItemType,lCode){var returnPath="";var valid=true;var sku="";var version="";var itemType="";var code="";var IMAGE_ROOT_DIR="/shared/media/products/";try{if(lSku){sku=lSku;}if(lDefaultSku){sku=lDefaultSku;}if(typeof(lVersion)!="undefined"&&lVersion!=null&&lVersion!=""){version="_"+lVersion;}if(lItemType){itemType=lItemType;}if(lCode){code=lCode;}if(imageCodeMap[code+itemType]){if(sku!=""){returnPath=imageCodeMap[code+itemType].template;returnPath=IMAGE_ROOT_DIR+returnPath.split("[sku]").join(sku).split("_[v]").join(version);return returnPath;}}}catch(err){Debug.error(err);}return"";};ProductFactory.getImageType=function(itemType,code){if(imageCodeMap[code+itemType]){return imageCodeMap[code+itemType].type;}return"";};ProductFactory.getShowSortMenu=function(xmlData){try{if(xmlData){if(xmlData.attributes.getNamedItem("showSortBy")!=null){var showSort=xmlData.attributes.getNamedItem("showSortBy").value;if(showSort.toLowerCase()=="false"){return false;}}}return true;}catch(err){Debug.error(err);}return true;};function XMLUtils(){}XMLUtils.getNode=function(nodeHandle,nodeName){try{if(nodeHandle){for(var i=0;i<nodeHandle.childNodes.length;i++){if(nodeHandle.childNodes[i].nodeName.toLowerCase()==nodeName.toLowerCase()){return nodeHandle.childNodes[i];}}}}catch(err){Debug.error(err);}return null;};XMLUtils.getNodeValue=function(nodeHandle,nodeName){var node=this.getNode(nodeHandle,nodeName);if(node!=null){if(node.firstChild!=null){if(node.firstChild.textContent){return node.firstChild.textContent;}else if(node.firstChild.nodeValue){return node.firstChild.nodeValue;}else if(node.firstChild.text){return node.firstChild.text;}}}return"";};XMLUtils.getNodeAttribute=function(nodeHandle,nodeAttribute){if(nodeHandle!=null){if(nodeHandle.attributes){if(nodeHandle.attributes.getNamedItem(nodeAttribute)){return nodeHandle.attributes.getNamedItem(nodeAttribute).value;}}}return"";};function SearchFactory(){}SearchFactory.getIsEmptyFromXML=function(xmlData){var currentNode;var numHits=0;try{if(xmlData.attributes.getNamedItem("numHits")!=null&&typeof(xmlData.attributes.getNamedItem("numHits"))!="undefined"){numHits=Number(xmlData.attributes.getNamedItem("numHits").value);}if(numHits>0){return false;}}catch(err){Debug.error(err);}return true;};SearchFactory.getSearchParamsFromXML=function(xmlData){var searchParams="";try{if(this.getIsEmptyFromXML(xmlData)==false){searchParams=XMLUtils.getNodeValue(xmlData,"searchParams");}}catch(err){Debug.error(err);}return searchParams;};SearchFactory.getErrorMessageFromXML=function(xmlData){var errorMessage="";try{if(this.getIsEmptyFromXML(xmlData)==true){if(XMLUtils.getNode(xmlData,"errorString")!=null&&typeof(XMLUtils.getNode(xmlData,"errorString"))!="undefined"){errorMessage=XMLUtils.getNodeValue(xmlData,"errorString");}}}catch(err){Debug.error(err);}return errorMessage;};SearchFactory.getRedirectFromXML=function(xmlData){var redirectURL="";try{if(XMLUtils.getNode(xmlData,"redirectUrl")!=null&&typeof(XMLUtils.getNode(xmlData,"redirectUrl"))!="undefined"){redirectURL=XMLUtils.getNodeValue(xmlData,"redirectUrl");}}catch(err){Debug.error(err);}return redirectURL;};SearchFactory.getDidYouMeanFromXML=function(xmlData){var keyword="";var qs="";var didYouMeanNode;try{if(XMLUtils.getNode(xmlData,"didYouMean")!=null&&typeof(XMLUtils.getNode(xmlData,"didYouMean"))!="undefined"){qs=XMLUtils.getNodeValue(xmlData,"didYouMean");keyword=XMLUtils.getNodeAttribute(XMLUtils.getNode(xmlData,"didYouMean"),"keyword");}}catch(err){Debug.error(err);}return{keyword:keyword,qs:qs};};SearchFactory.getItemSkuFromXML=function(xmlData){var currentNode;var itemSku="";try{if(xmlData.attributes.getNamedItem("SKU")!=null&&typeof(xmlData.attributes.getNamedItem("SKU"))!="undefined"){itemSku=xmlData.attributes.getNamedItem("SKU").value;}return itemSku;}catch(err){Debug.error(err);}return"";};function CategoriesFactory(){}CategoriesFactory.convertXMLToObjects=function(xmlData){var currentNode;var currentMenuItem;var currentMenuItemObj;var tempObject;var returnArray=new Array();var tempMenu;var menusArray;try{menusArray=xmlData.getElementsByTagName("menu");for(var i=0;i<menusArray.length;i++){currentNode=menusArray[i];tempMenu=new CategoryMenuVO();tempMenu.name=currentNode.getAttribute("target");tempMenu.id=tempMenu.name.split(" ").join(" ");tempMenu.reset="";for(var j=0;j<currentNode.childNodes.length;j++){currentMenuItem=currentNode.childNodes[j];if(currentMenuItem.firstChild!=null){if(currentMenuItem.firstChild.textContent){tempObject={label:currentMenuItem.firstChild.textContent,value:currentMenuItem.getAttribute("value"),sub:currentMenuItem.getAttribute("sub"),selected:false};}else if(currentMenuItem.firstChild.nodeValue){tempObject={label:currentMenuItem.firstChild.nodeValue,value:currentMenuItem.getAttribute("value"),sub:currentMenuItem.getAttribute("sub"),selected:false};}else{tempObject={label:currentMenuItem.firstChild.text,value:currentMenuItem.getAttribute("value"),sub:currentMenuItem.getAttribute("sub"),selected:false};}if(currentMenuItem.getAttribute("sel")=="true"){tempObject.selected=true;tempObject.value=currentMenuItem.getAttribute("resetQS");tempMenu.reset=tempObject.value;}tempObject.id=tempObject.value;if(tempObject.label!=""&&typeof(tempObject.label)!="undefined"){tempMenu.items.push(tempObject);}}}returnArray.push(tempMenu);}}catch(err){Debug.error(err);}return returnArray;};CategoriesFactory.convertJSONToObjects=function(JSONData){var currentNode;var currentMenuItem;var currentMenuItemObj;var tempObject;var returnArray=new Array();var tempMenu;var menusArray;try{menusArray=JSONData;for(var i=0;i<menusArray.length;i++){if(typeof(menusArray[i])!="undefined"){currentNode=menusArray[i];tempMenu=new CategoryMenuVO();tempMenu.name=currentNode.target;for(var j=0;j<currentNode.items.length;j++){currentMenuItem=currentNode.items[j];tempObject={label:currentMenuItem.name,value:currentMenuItem.value,sub:null,selected:false};if(currentMenuItem.sel=="true"||currentMenuItem.sel==true){tempObject.selected=true;tempObject.value=currentMenuItem.resetQS;}if(tempObject.label!=""&&typeof(tempObject.label)!="undefined"){tempMenu.items.push(tempObject);}}returnArray.push(tempMenu);}}}catch(err){Debug.error(err);}return returnArray;};CategoriesFactory.getLayoutType=function(xmlData){if(xmlData.getAttribute("layout")){return xmlData.getAttribute("layout");}return"1";};function GetProductsAndCategoriesService(){}var getProductsAndCategoriesService_isIncremental=false;var getProductsAndCategoriesService_firstLoadComplete=false;GetProductsAndCategoriesService.prototype.getData=function(queryString){try{var searchString=window.location.search.split("?").join("");var cid=CATEGORY_ID;var sortCriteria=URLFactory.extractValue(queryString,"sortCriteria");var pageQueryString=window.location.search.split("?").join("");var search=false;var searchQSVal=URLFactory.extractQueryStringValue(pageQueryString,"search");if(searchQSVal==""){searchQSVal=window.location.pathname.split("/")[1];}var dtmRecordCount="";getProductsAndCategoriesService_isIncremental=false;if(typeof(arguments[1])!="undefined"){getProductsAndCategoriesService_isIncremental=arguments[1];}if(sortCriteria==""){if(cid!=""){queryString=URLFactory.updateHash(queryString,"sortCriteria","5");}else{queryString=URLFactory.updateHash(queryString,"sortCriteria","1");}}if(searchQSVal.toLowerCase()=="search"){search=true;}if(isAjaxEnabled()==true){var successFunction=this.onResult;var failFunction=this.onError;$.ajax({url:"/api/search/searchcategory",type:"POST",data:'{"SearchQueryString": "'+URLFactory.convertHashToServiceHash(queryString)+'", "IsSearchMode": '+search+', "SessionID":"'+browserSessionID+'", "UserID":"'+sessionUserid+'"}',dataType:"json",contentType:"application/json; charset=utf-8",success:function(data){if(data!=null){successFunction(data);if(data!=null&&data.RelevancySortOrder!=null){dtmSortMethod=data.RelevancySortOrder
}else{dtmSortMethod="";}dtmRecordCount=data.NumofRecords;}else{failFunction(data);}if(trackDtmPageView){trackBGSortMethod(dtmSortMethod,dtmRecordCount);trackDtmPageView=false;}if((typeof trackSortOption!=="undefined"&&trackSortOption==true)&&(typeof dtmSortOption!=="undefined"&&dtmSortOption!="")){TrackSortOptions("",dtmSortOption,dtmSortMethod);trackSortOption=false;}},error:function(jqXHR,status,error){if(trackDtmPageView){trackBGSortMethod(dtmSortMethod,dtmRecordCount);trackDtmPageView=false;}}});}}catch(err){Debug.error(err);}};GetProductsAndCategoriesService.prototype.onResult=function(result){try{var query=window.location.search.split("?").join("");var searchKeywordQS=decodeURIComponent(URLFactory.extractQueryStringValue(query,"searchkeyword"));if(searchKeywordQS==""){searchKeywordQS=decodeURIComponent(window.location.pathname.split("/")[2]);}getProductsAndCategoriesService_firstLoadComplete=true;if(result){if(result.RedirectURL!=null&&result.RedirectURL!=""&&(window.location.pathname+window.location.search!=result.RedirectURL)){window.location.href=result.RedirectURL;}else{var resultProductArray=result.Items;var resultCategoryArray=result.Menus;var resultMinPrice=result.MinPrice;var resultMaxPrice=result.MaxPrice;var numHits=(typeof(result.NumofRecords)=="undefined"||result.NumofRecords==null||result.NumofRecords=="0")?"0":result.NumofRecords;var layoutType=(typeof(result.Layout)=="undefined"||result.Layout==null)?"1":result.Layout;var didYouMean=(typeof(result.SearchAdjustments)=="undefined"||result.SearchAdjustments==null)?"":result.SearchAdjustments;var showSort=true;var n=resultProductArray.length;var contentTiles=(result.JSONFilterContentTiles==null)?null:(Number(result.JSONFilterContentTiles.NumofRecords)>0)?result.JSONFilterContentTiles:"";if(numHits==0){$("#filterBreadcrumbs").hide();$("#divSearchAndBrowse").hide();$("#filterLink").hide();$("#sortLink").hide();var searchKeywordQSHyphenReplaced=(typeof(searchKeywordQS)=="undefined"||searchKeywordQS==null)?"":searchKeywordQS.split("-").join(" ");$("#searchTerms").html(searchKeywordQSHyphenReplaced);if(isSearch==""){$("#noSearch h1").hide();}else{$("#noSearch h1").show();$(".search-message").hide();}$(".ru-RU #nosearch_tile2").hide().html("");$(".ru-RU #nosearch_tile3").css("margin-top","10px");$("#noSearch").show();}else{$("#filterBreadcrumbs").show();$("#divSearchAndBrowse").show();$("#filterLink").show();$("#sortLink").show();$("#noSearch").hide();}for(var i=0;i<n;i++){result.Items[i].id="product"+result.Items[i].Sku;result.Items[i].smallImg=URLFactory.scene7ImageURL(result.Items[i].ImgURL,"$EcomMobileBrowseM2$","","");result.Items[i].largeImg=URLFactory.scene7ImageURL(result.Items[i].ImgURL,"$EcomBrowseM$","","");result.Items[i].name=result.Items[i].Name;result.Items[i].price=(result.Items[i].Price==null||result.Items[i].Price=="0"||result.Items[i].Price=="-1")?"":result.Items[i].Price;}$("#sortList a:not(.jq-close-browse-modal)").each(function(){var tempURL=(result.CurrentStateURL)?result.CurrentStateURL.split("/"):window.location.pathname.split("/");var dataFilter=$(this).attr("data-filter");var tempText=getUrlUniqueIDFromSortValue(dataFilter);tempURL[tempURL.length-1]="sort-"+tempText;tempURL=tempURL.join("/");$(this).attr("href",tempURL);});var tempURL=(result.CurrentStateURL)?result.CurrentStateURL.split("/"):window.location.pathname.split("/");tempURL=[tempURL[0],tempURL[1],tempURL[2]];$(".jq-filter-reset").attr("href",tempURL.join("/"));if(isSearch=="0"&&result.SEOAttributes!=null){var isCanonicalDisabled=false;for(var i=0;i<result.Menus.length;i++){if(result.Menus[i].isCanonicalDisabled){isCanonicalDisabled=true;break;}}if(isCanonicalDisabled){$("link[rel='canonical']").remove();if($("meta[name='robots']").length==0){$("head").append("<meta name='robots' content='NOINDEX, NOFOLLOW'>");}}else{$("link[rel='canonical']").remove();$("head").append("<link rel='canonical' href='"+result.SEOAttributes.CanonicalURL+"'>");$("meta[name='robots']").remove();}$("#filters h1 span.catName").html(result.SEOAttributes.H1Tag);$("meta[name='description']").attr("content",result.SEOAttributes.MetaDescription)
$("meta[name='keywords']").attr("content",result.SEOAttributes.MetaKeywords)
document.title=result.SEOAttributes.PageTitle;}GetProductsAndCategoriesService_process(resultProductArray,resultCategoryArray,numHits,layoutType,didYouMean.AdjustedTerms,didYouMean.OriginalTerms,showSort,resultMinPrice,resultMaxPrice,result.FormattedLowPrice,result.FormattedHighPrice,contentTiles);}populateBreadcrumb(result.BreadCrumb);populateJsonLDScript(result.BreadCrumb);}else{var tempArray=new Array();var productsGrid=ViewLocator.getInstance().getView("productsGrid");productsGrid.setProducts(tempArray);var error=new Object();error.name="Service 'GetProductsAndCategoriesService' returned with no results";error.message=error.name;error.fileName="GetProductsAndCategoriesService.js";error.lineNumber="";Debug.error(error);}$("#productsGrid").removeClass("loading");buildFilters();getSavedItemsList();}catch(err){Debug.error(err);}};function getSavedItemsList(){$.ajax({url:"/Customer/InlineCustomerSelections.aspx/GetInlineSavedItems",type:"POST",data:'',dataType:"json",contentType:"application/json; charset=utf-8",success:function(data){if(data.d.ResponseObject){var items=data.d.ResponseObject.SavedItems;$.each(items,function(){var sku=this.GroupSku;if(!sku){sku=this.Sku;}var savedId=this.ID;$("#cellproduct"+sku).find(".saved-heart").addClass("filled").attr("data-saved-id",savedId);});}},error:function(jqXHR,status,error){}});}GetProductsAndCategoriesService.prototype.onError=function(result){var tempArray=new Array();var productsGrid=ViewLocator.getInstance().getView("productsGrid");productsGrid.setProducts(tempArray);if(tempArray.length==0){window.location="../default.aspx";}var error=new Object();error.name="Service 'GetProductsAndCategoriesService' returned with an error";error.message=result.get_message();error.fileName="GetProductsAndCategoriesService.js";error.lineNumber="";Debug.error(error);if(error.message.indexOf("Authentication")>=0){window.location="../Default.aspx";}};var QueryString=function(){var query_string={};var query=window.location.search.substring(1);var vars=query.split("&");for(var i=0;i<vars.length;i++){var pair=vars[i].split("=");if(typeof query_string[pair[0]]==="undefined"){query_string[pair[0]]=decodeURIComponent(pair[1]);}else if(typeof query_string[pair[0]]==="string"){var arr=[query_string[pair[0]],decodeURIComponent(pair[1])];query_string[pair[0]]=arr;}else{query_string[pair[0]].push(decodeURIComponent(pair[1]));}}return query_string;}();function GetProductsAndCategoriesService_process(resultProductArray,resultCategoryArray,numHits,layoutType,keyword,qs,showSort,minPrice,maxPrice,formattedLowPrice,formattedHighPrice,contentTiles){var model=ProductModel.getInstance();var stateSnapshot=model.getStateSnapshot();model.setNumProducts(numHits);model.setProducts(resultProductArray);model.custom.minPrice=minPrice;model.custom.maxPrice=maxPrice;model.custom.formattedLowPrice=formattedLowPrice;model.custom.formattedHighPrice=formattedHighPrice;if(layoutType=="1"){model.getProductGrid("viewAll").gridType="topLeftBottomRight";model.getProductGrid("viewPaged").gridType="topLeftBottomRight";}else{model.getProductGrid("viewAll").gridType="bottomLeftTopRight";model.getProductGrid("viewPaged").gridType="bottomLeftTopRight";}ViewLocator.getInstance().getView("productsGrid").setGridType(model.getCurrentProductGrid().gridType);if(ViewLocator.getInstance().getView("sortBy")!=null){if(showSort==false){ViewLocator.getInstance().getView("sortBy").style.display="none";}else{ViewLocator.getInstance().getView("sortBy").style.display="block";}}blockDropDownClicks=false;CategoriesModel.getInstance().addMenus(resultCategoryArray);if(typeof(keyword)!="undefined"&&keyword!=""&&keyword!=null&&typeof(qs)!="undefined"&&qs!=""&&qs!=null){$("span[rel='searchKeywords']").html(adjustedTerms.split("{0}").join(qs).split("{1}").join("<span id='newKeyword'>"+keyword+"</span>"));}else{var terms;if($("span[rel='searchKeywords']").html()==""){terms=window.location.pathname.split("/")[2].split("-").join(" ");$("span[rel='searchKeywords']").html(LABEL_RESULTS_FOR+" &quot;"+terms+"&quot;");}}var productsGrid=ViewLocator.getInstance().getView("productsGrid");if(contentTiles!=""){productsGrid.setTiles(contentTiles);}else{productsGrid.setTiles("");}if(getProductsAndCategoriesService_isIncremental==false){productsGrid.producTArrayDrawEnd=0;productsGrid.setProducts(resultProductArray);}else{productsGrid.producTArrayDrawEnd=0;productsGrid.appendToProducts(resultProductArray);}if(isMobileDomain()){var loadMoreButton=ViewLocator.getInstance().getView("loadMoreButton");if(loadMoreButton!=null){loadMoreButton.onclick=function(){handleLoadMore();};loadMoreButton.className="btn";}$("#loadMoreThumbnailsLoading").hide();if(typeof(generateFilterMenu)!="undefined"){generateFilterMenu();}}if(typeof initGridPosition!="undefined"&&initGridPosition!=null){if(initGridPosition!=""){$(document).scrollTop(initGridPosition);}initGridPosition=null;}if(loadMoreCount>0){for(var i=0;i<loadMoreCount;i++){productsGrid.appendToProducts();}}if(window.history.state!=null&&(productClicked!=""&&productClicked!=undefined)){$('html, body').animate({scrollTop:$("#cell"+productClicked).offset().top-50
},1000);productClicked="";}generateEvent("onProductsAndCategoriesLoaded");};function getUrlUniqueIDFromSortValue(dataFilter){var urlUniqueID="";switch(dataFilter){case"0":urlUniqueID="";break;case"1":urlUniqueID="high-to-low";break;case"2":urlUniqueID="low-to-high";break;case"3":urlUniqueID="new-to-tiffany";break;case"4":urlUniqueID="alphabetically";break;case"5":urlUniqueID="relevance";break;case"6":urlUniqueID="whats-old";break;case"7":urlUniqueID="alphabetically-backwards";break;case"8":urlUniqueID="reverse-category-order";break;case"9":urlUniqueID="related-items";break;case"10":urlUniqueID="reverse-related-items";break;case"11":urlUniqueID="relevance-search";break;}return urlUniqueID;}function ErrorLogService(){}var errorLogService_lastError;ErrorLogService.prototype.logError=function(errorData){if(errorLogService_isLoggingEnabled()==true){try{if(isAjaxEnabled()==true){errorLogService_lastError=errorData;PageMethods.set_path('/mobile/default.aspx');PageMethods.AddToErrorLog(errorData.errorMessage,errorData.errorDetail,errorData.priority,errorData.errorType,errorData.applicationName,errorData.moduleName,errorData.procName,this.onResult,this.onError);}else{errorLogService_logErrorNoAjax(errorData.errorMessage,errorData.errorDetail,errorData.priority,errorData.errorType,errorData.applicationName,errorData.moduleName,errorData.procName);}}catch(err){errorLogService_logErrorNoAjax(errorData.errorMessage,errorData.errorDetail,errorData.priority,errorData.errorType,errorData.applicationName,errorData.moduleName,errorData.procName);}}};ErrorLogService.prototype.onResult=function(result){};ErrorLogService.prototype.onError=function(result){var err=errorLogService_lastError;errorLogService_logErrorNoAjax(err.errorMessage,err.errorDetail,err.priority,err.errorType,err.applicationName,err.moduleName,err.procName);};function errorLogService_logErrorNoAjax(errorMessage,errorDetail,priority,errorType,applicationName,moduleName,procName){errorMessage="errMsg="+escape(errorMessage);priority="&priority="+escape(priority);errorType="&errorType="+escape(errorType);applicationName="&appName="+escape(applicationName);moduleName="&modName="+escape(moduleName);procName="&procName="+escape(procName);errorDetail="&errDtl="+escape(errorDetail);var imageShim=document.createElement("img");imageShim.setAttribute("src","/Common/Errors/AJAXErrorInterface.aspx?"+errorMessage+priority+errorType+applicationName+moduleName+procName+errorDetail);imageShim.style.display="none";document.body.appendChild(imageShim);};function errorLogService_isLoggingEnabled(){if(document.forms[0]){if(document.forms[0].LogClientSideErrors){if(document.forms[0].LogClientSideErrors.value.toLowerCase()=="true"){return true;}}}return false;}function ProductGridEventHandler(){}ProductGridEventHandler.prototype.onGridSwitched=function(gridName,gridProperties){var vwLocator=ViewLocator.getInstance();var prodGrid=vwLocator.getView("productsGrid");var pageSize=gridProperties.pageSize;var service=ServiceLocator.getInstance().getService("getProductsService");if(prodGrid){prodGrid.setGridType(gridProperties.gridType);}};ProductGridEventHandler.prototype.onProductSelected=function(productId,friendlyUrl,errorCode,itemPos,tileTracking){var model=ProductModel.getInstance();var product=model.getProduct(productId);var query=window.location.search.split("?").join("");var mcat=URLFactory.extractQueryStringValue(query,"mcat");if(mcat==null||mcat==""){mcat=MASTER_CATEGORY_ID;}var cid=URLFactory.extractQueryStringValue(query,"cid");if(cid==null||cid==""){cid=CATEGORY_ID;}var referrerURL="";var search="";var itemPostion="";var searchQSVal=URLFactory.extractQueryStringValue(query,"search");if(searchQSVal==""){searchQSVal=window.location.pathname.split("/")[1];}var sessionId="";var sessionIdQSVal=URLFactory.extractQueryStringValue(query,"mysid2");var partnerId="";var partnerIdQSVal=URLFactory.extractQueryStringValue(query,"partner");var assortmentId="";var assortmentIdQSVal=URLFactory.extractQueryStringValue(query,"assortmentid");var siteId="";var siteIdQSVal=URLFactory.extractQueryStringValue(query,"siteid");var productsGrid=ViewLocator.getInstance().getView("productsGrid");var gridPos="&gridpos="+productsGrid.productArray.length+"/"+$(document).scrollTop();var trackPDP="&trackpdp=bg";productId=productId.split("product").join("");if(areCookiesEnabled()==false){referrerURL="&_UrlReferrer="+escape(window.location.href);}else{setCookieValue("_UrlReferrer",escape(window.location.href));}if(searchQSVal=="search"||searchQSVal=="1"){search="&search=1";trackPDP="&trackpdp=search";}if(sessionIdQSVal!=""){sessionId="&mysid2="+sessionIdQSVal;}if(partnerIdQSVal!=""){partnerId="&partner="+partnerIdQSVal;}if(assortmentIdQSVal!=""){assortmentId="&assortmentid="+assortmentIdQSVal;}if(siteIdQSVal!=""){siteId="&siteid="+siteIdQSVal;}if(itemPos!=""){itemPostion="&trackgridpos="+itemPos;}var baseAction=friendlyUrl;if(isMobileDomain()==true){var newURL;if(friendlyUrl.indexOf("?")>0){baseAction=friendlyUrl+'&fromGrid=1'+gridPos;}else{baseAction=friendlyUrl+'?fromGrid=1'+gridPos;}if($("#categoryBrowse").length>0){baseAction+="&fromcid="+cid;}}if(errorCode){baseAction+="&errorCode="+errorCode;}if(product!=null&&typeof(product.ItemQS)!="undefined"&&product.ItemQS!=""){if(baseAction.indexOf("?")>0){document.forms[0].action=baseAction+search+sessionId+partnerId+assortmentId+siteId+trackPDP+itemPostion+tileTracking;}else{document.forms[0].action=baseAction+"?"+search+sessionId+partnerId+assortmentId+siteId+trackPDP+itemPostion+tileTracking;}document.forms[0].method="post";document.forms[0].submit();}else{document.forms[0].action=baseAction+search+sessionId+partnerId+assortmentId+siteId+trackPDP+itemPostion;document.forms[0].method="post";document.forms[0].submit();}var snapShot=window.history.state;snapShot.numPages=loadMoreCount;snapShot.productID=product.id;window.history.pushState(snapShot,"",window.location.pathname+"?trackbgfm=pdp");};var VIEW_ALL_THRESHOLD=48;function GridNavigationEventHandler(){}GridNavigationEventHandler.prototype.onNumResultsChanged=function(num,gridProperties){try{if(document.getElementById("numResultsLabel")!=null){document.getElementById("numResultsLabel").innerHTML="("+gridProperties.numResults+")";$('.num-results').html("("+gridProperties.numResults+")");}}catch(err){Debug.error(err);}};GridNavigationEventHandler.prototype.onProductsAndCategoriesLoaded=function(){enableFilterMenu();};function Debug(){}Debug.error=function(err){var pageURL=window.location.href;var filterError=Debug.filterError(pageURL,err.message,err.fileName,err.lineNumber);if(filterError==false){if(document.forms[0]){if(document.forms[0].showJSErrors){if(document.forms[0].showJSErrors.value.toLowerCase()=="true"){alert("Intercepted error\nname: "+err.name+"\nmessage: "+err.message+"\nfile: "+err.fileName+"\nline: "+err.lineNumber+"\n\nNote that this a message from the debugging framework. These debug messages will be disabled in production and will instead be silently logged to the server.");}}}if(typeof(ErrorVO)!="undefined"&&typeof(ServiceLocator)!="undefined"&&typeof(ErrorLogService)!="undefined"){if(ServiceLocator.getInstance().getService("errorLogService")==null){ServiceLocator.getInstance().registerService("errorLogService",new ErrorLogService());}var errDetails=new ErrorVO();errDetails.errorMessage=err.name;errDetails.errorDetail="\nreferrer URL: "+pageURL+"\nfileName: "+err.fileName+"\nlineNumber: "+err.lineNumber+"\ndetail:\n"+err.message;if(ServiceLocator.getInstance().getService("errorLogService")){ServiceLocator.getInstance().getService("errorLogService").logError(errDetails);}}}};Debug.windowTrace=function(message){if(document.getElementById("debug")==null){var debugDiv=document.createElement("div");debugDiv.setAttribute("id","debug");document.body.appendChild(debugDiv);}document.getElementById("debug").innerHTML+=message+"<br \>";};Debug.getCurrentTime=function(){var tempDate=new Date();return tempDate.getTime();};Debug.filterError=function(pageURL,message,URL,line){try{var lowerPageURL=pageURL.toLowerCase();var lowerMessage=message.toLowerCase();var lowerURL="";if(typeof(URL)!="undefined"&&URL!=null){lowerURL=URL.toLowerCase();}if(lowerMessage.indexOf("mainflash")>=0){return true;}if(lowerMessage.indexOf("syntax error")>=0&&line==1&&lowerPageURL.indexOf("/item.aspx")){return true;}if(lowerMessage.indexOf("sendclick is not a function")>=0){return true;}if(lowerMessage.indexOf("error loading script")>=0){return true;}return false;}catch(err){return false;}};if(typeof(ErrorVO)=="undefined"){function ErrorVO(errorMessage,errorDetail,priority,errorType,applicationName,moduleName,procName){this.errorMessage="-";this.errorDetail="-";this.priority="1";this.errorType="25";this.applicationName="-";this.moduleName="-";this.procName="-";if(errorMessage){this.errorMessage=errorMessage;}if(errorDetail){this.errorDetail=errorDetail;}if(priority){this.priority=priority;}if(errorType){this.errorType=errorType;}if(applicationName){this.applicationName=applicationName;}if(moduleName){this.moduleName=moduleName;}if(procName){this.procName=procName;}}}function CategoriesModel(){this.pInstance=null;this.categoryMenus=new Object();this.removedMenus=new Object();this.filterArray=[];this.pCachedFilters=[];this.filteredProductArray=[];this.appliedFilterIdArray=[];}CategoriesModel.getInstance=function(){if(!this.pInstance){this.pInstance=new CategoriesModel();}return this.pInstance;};CategoriesModel.prototype.addMenus=function(menusArray){if(menusArray){this.reset();for(var i=0;i<menusArray.length;i++){this.addMenu(menusArray[i]);}generateEvent("onReloadCategoryMenus",this.categoryMenus);}};CategoriesModel.prototype.addMenu=function(menuObject){if(menuObject){if(typeof(menuObject.DimensionGroup)!="undefined"){this.categoryMenus[menuObject.DimensionGroup]=menuObject;}else{this.categoryMenus[menuObject.name]=menuObject;}}};CategoriesModel.prototype.getMenu=function(menuName){if(menuName){if(this.categoryMenus[menuName]){return this.categoryMenus[menuName];}}return null;};CategoriesModel.prototype.getRelatedMenuName=function(menuName,selectedItem){if(menuName){if(selectedItem!=""&&selectedItem!=null){var menu=this.getMenu(menuName);if(menu){for(var i=0;i<menu.items.length;i++){if(menu.items[i].value==selectedItem){if(menu.items[i].sub){return menu.items[i].sub;}break;}}}}}return"";};CategoriesModel.prototype.reset=function(){this.categoryMenus=new Object();};CategoriesModel.prototype.removeMenu=function(menuName){if(menuName){this.removedMenus[menuName]=true;}};CategoriesModel.prototype.isMenuRemoved=function(menuName){if(this.removedMenus[menuName]==true){return true;}return false;};CategoriesModel.prototype.addFilters=function(filterIdArray){var filterIdString=","+this.appliedFilterIdArray.join(",")+",";var n=filterIdArray.length;for(var i=0;i<n;i++){if(filterIdString.indexOf(","+filterIdArray[i]+",")==-1){this.appliedFilterIdArray.push(filterIdArray[i]);filterIdString=","+this.appliedFilterIdArray.join(",")+",";}}this.updateFilteredList();generateEvent("onFiltersChanged",this.appliedFilterIdArray);};CategoriesModel.prototype.removeFilters=function(filterIdArray){var n=filterIdArray.length;var i,j;var filterToRemove;for(i=0;i<n;i++){filterToRemove=filterIdArray[i];for(j=0;j<this.appliedFilterIdArray.length;j++){if(this.appliedFilterIdArray[j]==filterToRemove){this.appliedFilterIdArray.splice(j,1);break;}}}this.updateFilteredList();generateEvent("onFiltersChanged",this.appliedFilterIdArray);};CategoriesModel.prototype.removeAllFilters=function(){this.filteredProductArray=this.productArray;this.appliedFilterIdArray=[];this.updateFilteredList();generateEvent("onFiltersChanged",this.appliedFilterIdArray);};CategoriesModel.prototype.updateFilteredList=function(){};CategoriesModel.prototype.getFilter=function(filterId){return this.pCachedFilters[filterId];};loadedMouseOverImages=new Object();loadedMouseOutImages=new Object();lastMouseoverId="";lastClickId="";lastOverlayId="";productToolTipInstance="";function ProductGridMobile(containerElement){this.containerElement=containerElement;this.productArray=[];this.useLabels=false;this.labelClassName="";this.overLabelClassName="";this.clickToOpenTooltip=false;this.tableCellSpacing=10;this.tableCellPadding=0;this.producTArrayDrawEnd=0;this.contentTiles="";this.pImageSize=140;this.pLabelWidth=140;this.pTableId="table"+String(Math.random()).split(".").join("");if(typeof(ToolTip)!="undefined"){productToolTipInstance=ToolTip.getInstance();}this.clickToOpenTooltip=true;}ProductGridMobile.prototype.setProducts=function(productArray){if(productArray){if(productArray.length>0){this.productArray=productArray;}else{this.productArray=[{id:"",name:"",price:0,qs:""}];}}else{this.productArray=[{id:"",name:"",price:0,qs:""}];}this.drawGrid();};ProductGridMobile.prototype.resetProducts=function(){this.productArray=[];this.drawGrid();};ProductGridMobile.prototype.appendToProducts=function(productArray){this.drawGrid();};ProductGridMobile.prototype.appendDrawGrid=function(productArray,indexOffset){var itemElement;var productDetails;var startN=this.productArray.length;var n=productArray.length;var tableHnd=document.getElementById(this.pTableId);var numColumns=2;var numBlanks=0;var numProductMT=$("#tempMarketingTiles .productMT").length;var productCount=0;if($("#"+this.pTableId).width()=="402"){numColumns=3;}if(tableHnd!=null){if(numProductMT>n/5){numProductMT=Math.floor(n/5);}for(var i=productCount;i<n;i++){if(numProductMT>0&&n>4){productDetails=this.getProduct(i+numProductMT+(startN-n));productCount=numProductMT+i;}else{productDetails=this.getProduct(i+(startN-n));productCount++;}productDetails.itemPostion=i+1+(startN-n);itemElement=this.drawGridItem(productDetails,i-numProductMT+(startN-n));tableHnd.appendChild(itemElement);if(i==3){break;}}if(productCount<n){for(var i=0;i<numProductMT;i++){productDetails=this.getProduct(productCount+(startN-n));if(i>n||productDetails.id==""){break;}productDetails.itemPostion=productCount+1+(startN-n);productDetails.isProductTile=true;itemElement=this.drawGridItem(productDetails);tableHnd.appendChild(itemElement);productCount++;var endOfProductArray=false;if((i!=numProductMT-1||i==0)&&productCount<n){for(var j=0;j<4;j++){productDetails=this.getProduct(productCount+(startN-36));productDetails.itemPostion=productCount+1+(startN-36);itemElement=this.drawGridItem(productDetails,productCount-(i-numProductMT)+(startN-36));tableHnd.appendChild(itemElement);productCount++;if(productCount>=n){break;}}}$($("#tempMarketingTiles .productMT")[0]).remove();if(productCount>=n){break;}}}if(productCount<n){var numMarketingTiles=$("#tempMarketingTiles").children("div").length;for(var i=0;i<numMarketingTiles;i++){itemElement=moveMarketingTiles();tableHnd.appendChild(itemElement);for(var j=0;j<6;j++){productDetails=this.getProduct(productCount+(startN-n));productDetails.itemPostion=productCount+1+(startN-n);itemElement=this.drawGridItem(productDetails,productCount-numProductMT+(startN-n));tableHnd.appendChild(itemElement);productCount++;if(productCount>=n){break;}}if(productCount>=n){break;}}var count=0;for(var i=productCount;i<n;i++){productDetails=this.getProduct(i+(startN-n));if(count==0){productDetails.isProductTile=true;}count=(count==6)?0:count+1;productDetails.itemPostion=i+(startN-n)+1;itemElement=this.drawGridItem(productDetails,i-numProductMT+(startN-n));tableHnd.appendChild(itemElement);if(i==n-1){if(count%2==0&&count!=0){itemElement=this.drawGridItem();tableHnd.appendChild(itemElement);}}}}initTouchCarousel();}};ProductGridMobile.prototype.setToolTip=function(toolTipInstance){productToolTipInstance=toolTipInstance;};ProductGridMobile.prototype.setGridType=function(gridType){};ProductGridMobile.prototype.setTiles=function(contentTiles){this.contentTiles=contentTiles;};ProductGridMobile.prototype.drawGrid=function(){if(this.producTArrayDrawEnd==0){this.containerElement.innerHTML="";$("#tempMarketingTiles").remove();$("<div id='tempMarketingTiles'></div>").appendTo("body");if(this.contentTiles==null){$("#tempMarketingTiles").html($("#cachedMarketingTiles").children().html());}else if(this.contentTiles!=""){for(var i=0;i<Number(this.contentTiles.NumofRecords);i++){$("#tempMarketingTiles").append(this.contentTiles.MarketingTiles[i].MediaContent);}}}var tableHnd;var itemElement;var id;var n=(this.productArray.length>35+this.producTArrayDrawEnd)?35+this.producTArrayDrawEnd:this.productArray.length;var productDetails;var numBlanks=0;tableHnd=document.createElement("ul");tableHnd.id=this.pTableId;tableHnd.className="grid";var numProductMT=$("#tempMarketingTiles .productMT").length;var numTotalTiles=$("#tempMarketingTiles").children().length;var productCount=this.producTArrayDrawEnd;if(numProductMT>(n-productCount)/5){numProductMT=Math.floor((n-productCount)/5);}if(n>=35+this.producTArrayDrawEnd){n=(numTotalTiles-numProductMT>5)?n-5:n-(numTotalTiles-numProductMT);}for(var i=productCount;i<n;i++){if(numProductMT>0&&n>4){productDetails=this.getProduct(i+numProductMT);productCount=numProductMT+i;}else{productDetails=this.getProduct(i);productCount++;}productDetails.itemPostion=i+1;itemElement=this.drawGridItem(productDetails,i-numProductMT);tableHnd.appendChild(itemElement);if(i%2==0&&i==n-1){itemElement=this.drawGridItem();tableHnd.appendChild(itemElement);}if(i==this.producTArrayDrawEnd+3){break;}}if(productCount<n){for(var i=0;i<numProductMT;i++){productDetails=this.getProduct(i);if(i>n||productDetails.id==""){break;}productDetails.itemPostion=productCount+1;productDetails.isProductTile=true;itemElement=this.drawGridItem(productDetails);tableHnd.appendChild(itemElement);var endOfProductArray=false;productCount++;if((i!=numProductMT-1||i==0)&&productCount<n){for(var j=0;j<4;j++){productDetails=this.getProduct(productCount);productDetails.itemPostion=productCount+1;itemElement=this.drawGridItem(productDetails,productCount-(i-numProductMT));tableHnd.appendChild(itemElement);productCount++;if(productCount>=n){break;}}}$($("#tempMarketingTiles .productMT")[0]).remove();if(productCount>=n){break;}}}if(productCount<n){var numMarketingTiles=$("#tempMarketingTiles").children().length;for(var i=0;i<numMarketingTiles;i++){itemElement=moveMarketingTiles();tableHnd.appendChild(itemElement);for(var j=0;j<6;j++){productDetails=this.getProduct(productCount);productDetails.itemPostion=productCount+1;itemElement=this.drawGridItem(productDetails,productCount-numProductMT);tableHnd.appendChild(itemElement);productCount++;if(productCount>=n){if(j%2==0){itemElement=this.drawGridItem();tableHnd.appendChild(itemElement);}break;}}if(productCount>=n){break;}}var count=0;for(var i=productCount;i<n;i++){productDetails=this.getProduct(i);productDetails.itemPostion=i+1;if(count==0){productDetails.isProductTile=true;}count=(count==6)?0:count+1;itemElement=this.drawGridItem(productDetails,i-numProductMT);tableHnd.appendChild(itemElement);if(i==n-1){if(count%2==0&&count!=0){itemElement=this.drawGridItem();tableHnd.appendChild(itemElement);}}}}this.containerElement.appendChild(tableHnd);this.producTArrayDrawEnd=n;var loadMoreButton=ViewLocator.getInstance().getView("loadMoreButton");if(this.productArray.length<=this.producTArrayDrawEnd){loadMoreButton.style.display="none";}else{loadMoreButton.style.display="block";}$("#loadMoreThumbnailsLoading").hide();lazyLoad();initTouchCarousel();};function moveMarketingTiles(){var itemElement=document.createElement("li");itemElement.className="marketingTile tileResponsive";itemElement.innerHTML=$($("#tempMarketingTiles div")[0]).html();$($("#tempMarketingTiles div")[0]).remove();return itemElement;}ProductGridMobile.prototype.drawGridItem=function(productDetails,whichSide){var itemElement=document.createElement("li");var id="";var imageSize=this.pImageSize;var clickToOpenTooltip=this.clickToOpenTooltip;var tableCellSpacing=this.tableCellSpacing;if(typeof(productDetails)!="undefined"&&productDetails!=null){id=productDetails.id;}if(id==""){itemElement.className="resultsThumbnailSmall imageNotHere";if(whichSide%2==0){itemElement.className=itemElement.className+" leftSide";}itemElement.innerHTML='<a href="javascript:;" class="grid-item"><span></span></a>';}else if(typeof(id)=="undefined"){itemElement.className="resultsThumbnailSmall";itemElement.innerHTML='<a href="product-detail.html" class="grid-item"><span></span></a>';}else{itemElement.className="resultsThumbnailSmall";if(whichSide%2==0){itemElement.className=itemElement.className+" leftSide";}if(productDetails.isProductTile){itemElement.className=itemElement.className+" productTile";}itemElement.id="cell"+id;itemElement.setAttribute("data-default-sku",productDetails.DefaultSku);itemElement.setAttribute("data-sku",productDetails.Sku);itemElement.onfocus=function(){this.blur();};var itemTracking="";var itemRRUrl="";if(productDetails.RRClickTrackingURL!=null){itemRRUrl=productDetails.RRClickTrackingURL;}else{itemRRUrl="none";}if(productDetails.IsNewProduct&&CATEGORY_ID!=622067){itemTracking=itemTracking+"&tracktile=new";}if(productDetails.isProductTile){if(itemTracking!=""){itemTracking=itemTracking+"|highlight";}else{itemTracking=itemTracking+"&tracktile=highlight";}}var optionsText=(productDetails.IsMotifEnabled)?'<div class="type-eb3-i">'+customOptions+'</div>':(productDetails.IsServiceable.toLowerCase()=="true")?'<div class="type-eb3-i">'+engraveOptions+'</div>':"";if(this.useLabels==true){itemElement.innerHTML='<a data-tileTracking="'+itemTracking+'" data-itemPos='+productDetails.itemPostion+' href="javascript:;" class="grid-item">'+'<span>'+getProductImages(productDetails)+'</span>'+'</a><h2><a href="javascript:;">'+productDetails.name+'</a></h2>';}else{var htmlString='';htmlString+='<a data-tileTracking="'+itemTracking+'" data-itemPos='+productDetails.itemPostion+' href="'+productDetails.FriendlyUrl+'" class="grid-item" data-rrurl="'+itemRRUrl+'">';htmlString+=getProductImages(productDetails);if(productDetails.IsNewProduct&&CATEGORY_ID!=622067){htmlString+='<span class="new-product">'+newText+'</span>';}htmlString+='</a>';htmlString+='<div class="info-height">';htmlString+='<a href="#" class="saved-heart jq-update-saved"><span class="heart-empty"><i class="icon-font">like</i></span><span class="heart-filled"><i class="icon-font">like_solid</i></span></a>';htmlString+='<a data-tileTracking="'+itemTracking+'" data-itemPos='+productDetails.itemPostion+' href="'+productDetails.FriendlyUrl+'" class="grid-item" data-rrurl="'+itemRRUrl+'">';if(productDetails.Title2){htmlString+='<span class="title-small">'+productDetails.Title+'</span>';htmlString+='<br>'+productDetails.Title2;}else{htmlString+=productDetails.Title;}htmlString+='</a>';htmlString+=productDetails.price;htmlString+=optionsText;htmlString+='</div>';itemElement.innerHTML=htmlString;}}return itemElement;};function getProductImages(productDetails){var imageHTML="";var itemImage=(typeof productDetails=='undefined')?"":(productDetails.isProductTile)?productDetails.largeImg:productDetails.smallImg;var imageSize=(typeof productDetails=='undefined')?"":(productDetails.isProductTile)?"EcomBrowseM":"EcomMobileBrowseM2";var altText=(typeof productDetails=='undefined')?"":productDetails.Name;var id=productDetails.id;if(productDetails.IsMotifEnabled){var images=3;if(productDetails.GroupMemberImageUrls.length<3){images=productDetails.GroupMemberImageUrls.length;}imageHTML+='<div class="image-rotator image-rotator--'+images+'">';$.each(productDetails.GroupMemberImageUrls,function(j){imageHTML+='<img data-src="'+URLFactory.scene7ImageURL(this,'$'+imageSize+'$')+'" id="img'+id+'_'+j+' alt="" >';if(j==2){return false;}});}else{imageHTML='<img data-src="'+itemImage+'" id="img'+id+'" alt="'+altText+'" />';}return imageHTML;}ProductGridMobile.prototype.getProductId=function(index){var id="";if(index<this.productArray.length){return this.productArray[index].id;}return id;};ProductGridMobile.prototype.getProduct=function(index){if(index<this.productArray.length){return this.productArray[index];}return null;};ProductGridMobile.prototype.getLabelWidth=function(){return this.pLabelWidth;};ProductGridMobile.prototype.setLabelWidth=function(size){this.pLabelWidth=size;};ProductGridMobile.prototype.checkWidth=function(){var itemElement;var productDetails;var tableHnd=document.getElementById(this.pTableId);var numLI=0;var numColumns=2;var numBlanks=0;if($("#"+this.pTableId).width()=="402"){numColumns=3;}if(tableHnd!=null){numLI=tableHnd.childNodes.length;for(var i=numLI-1;i>=0;i--){itemElement=tableHnd.childNodes[i];if(itemElement.className.indexOf("imageNotHere")>-1){tableHnd.removeChild(itemElement);}else{break;}}numBlanks=numColumns-1-((tableHnd.childNodes.length-1)%numColumns);for(i=0;i<numBlanks;i++){itemElement=this.drawGridItem();tableHnd.appendChild(itemElement);}}};function overImageLoaded(id){loadedMouseOverImages[id]=true;var ids="";for(var item in loadedMouseOverImages){ids+=item+":";}}function productClick(id,friendlyUrl,name,price,image,isGroup,isPurchaseable,isBig,size,clickToOpen,tableCellSpacing,itemPos){if((clickToOpen==true&&lastClickId==id)||clickToOpen==false){generateEvent("onProductSelected",id,friendlyUrl,"",itemPos);}else{var currentLink=$("#img"+id).parents('a');var currentLi=currentLink.parents('li');var $nextLi=currentLink.parents('li').next();var $prevLi=currentLink.parents('li').prev();var markup='<div id="overlay'+id+'" class="overlay"><div class="wrapper"><a id="overlayCloseLink'+id+'" href="javascript:;" class="close"></a><p>'+name+'<br/><span class="price">'+price+'</span></p><a id="overlayViewMoreLink'+id+'" href="javascript:;" class="viewMoreLink">'+LABEL_VIEW_MORE_OVERLAY+'</a></div></div>';var gridWidth=$('.grid').width();closeGridOverlay(true);lastOverlayId="overlay"+id;if(gridWidth<445){if(currentLink.parents('li').is('.grid li:nth-child(even)')){$(markup).addClass("leftHand").appendTo($prevLi);}else if(currentLink.parents('li').is('.grid li:nth-child(odd)')&&currentLink.parents('li').is('.grid li:last-child')){$('<li></li>').appendTo('.grid').show(0,$(markup).removeClass("leftHand").appendTo(currentLink));}else{$(markup).removeClass("leftHand").appendTo($nextLi);}}else{if(currentLink.parents('li').is('.grid li:nth-child(3n)')){$(markup).addClass("leftHand").appendTo($prevLi);}else if(currentLink.parents('li').is('.grid li:not(.grid li:nth-child(3n))')&&currentLink.parents('li').is('.grid li:last-child')){$('<li></li>').appendTo('.grid').show(0,$(markup).removeClass("leftHand").appendTo(currentLink));}else{$(markup).removeClass("leftHand").appendTo($nextLi);}}lastClickId=id;}setupOverlay(id,friendlyUrl,itemPos);return false;}function setupOverlay(id,friendlyUrl,itemPos){if(document.getElementById("overlay"+id)!=null){document.getElementById("overlay"+id).onclick=function(e){if(!e)var e=window.event;e.cancelBubble=true;if(e.stopPropagation)e.stopPropagation();generateEvent('onProductSelected',id,friendlyUrl,"",itemPos);};document.getElementById("overlayCloseLink"+id).onclick=function(e){if(!e)var e=window.event;e.cancelBubble=true;if(e.stopPropagation)e.stopPropagation();closeGridOverlay(true);};document.getElementById("overlayViewMoreLink"+id).onclick=function(e){if(!e)var e=window.event;e.cancelBubble=true;if(e.stopPropagation)e.stopPropagation();generateEvent('onProductSelected',id,friendlyUrl,"",itemPos);};}}function closeGridOverlay(cancelEvent){var previousOverlay=document.getElementById(lastOverlayId);if(previousOverlay!=null){previousOverlay.parentNode.removeChild(previousOverlay);}lastClickId="";if(typeof(cancelEvent)!="undefined"&&cancelEvent==true){return false;}}function revealProduct(id){loadedMouseOutImages[id]=true;setTimeout(function(){massFadeInstance.addTarget("img"+id);massFadeInstance.addTarget("label"+id);},10);if(id==lastMouseoverId&&productToolTipInstance!=""){productToolTipInstance.hideToolTip();}}function findPosX(obj){var curleft=0;if(obj.offsetParent){while(1){curleft+=obj.offsetLeft;if(!obj.offsetParent){break;}obj=obj.offsetParent;}}else if(obj.x){curleft+=obj.x;}if(document.all){curleft+=10;}return curleft;}function findPosY(obj){var curtop=0;if(obj.offsetParent){while(1){curtop+=obj.offsetTop;if(!obj.offsetParent){break;}obj=obj.offsetParent;}}else if(obj.y){curtop+=obj.y;}return curtop;}var visible=false;var dtmSortOption="";var trackSortOption=false;var BREADCRUMB_CURRENT_FILTERS;$(document).ready(function(){var queryDetect=false;if(document.querySelectorAll){queryDetect=true;}if(queryDetect==true){$('#filterLink').click(function(){if($(this).hasClass("disabled")==false){if($('#filterList').is(":visible")){hideFilters();}else{$("#filterList").show();$("#filterList .browse-modal-inner .browse-modal-content a:first").focus();}}$("body").on("keydown","#filterList .browse-modal-inner",function(e){if(e.keyCode==27){$(".jq-close-browse-modal").click();}else{trapTabKey($(this),e);}});$("#sortList").hide();return false;});$('#sortLink').click(function(){$("#sortList").toggle();$("#sortList .browse-modal-inner .browse-modal-content a:first").focus();$("#filterList").hide();$("body").on("keydown","#sortList .browse-modal-inner",function(e){if(e.keyCode==27){$(".jq-close-browse-modal").click();}else{trapTabKey($(this),e);}});return false;});}});function buildFilters(){var filterMenuHTML=buildFilterMenu();var open=$(".filterLink.clicked").attr("rel");var listCount=0;visible=true;$('#filterList .browse-modal-content').empty();$(filterMenuHTML).appendTo('#filterList .browse-modal-content');var currencySymbol="$";switch(locale.toLowerCase()){case"en-ca":case"fr-ca":currencySymbol="CDN$";break;case"es-mx":currencySymbol="MX$";break;case"pt-br":currencySymbol="R$";break;case"ja-jp":case"ja-jp-estr":case"ja-jp-trade":currencySymbol="&yen;";break;case"en-au":currencySymbol="AU$";break;case"en-gb":currencySymbol="&pound;";break;case"ko-kr":currencySymbol="₩";break;case"ru-ru":currencySymbol="₽";break;case"zh-cn":currencySymbol="人民币";break;case"de-at":case"en-be":case"fr-fr":case"de-de":case"en-ie":case"it-it":case"en-nl":case"es-es":currencySymbol="&euro;";break;}$(".price-symbol").html(currencySymbol);setTimeout(function(){var paddingLeft=hiddenWidth($(".price-symbol"))+6;$(".price-symbol + input").css("padding-left",paddingLeft);},20);if(open){$('a[rel="'+open+'"]').trigger("click");}if(document.getElementById("filterBreadcrumbs")==null){$('<div id="filterBreadcrumbs"></div>').insertAfter('#titleBorder');}$(".filter-loader").hide();}$('body').on('click','.filterLink',function(){var windowHeight=$(window).height();var titleHeight=$('#titleBar').height();var navHeight=$("header").height();var listWidth="-"+$(this).parent().outerWidth()+"px";var maxHeight=$(this).next('dl').height();var listHeight=((windowHeight-navHeight-titleHeight)<maxHeight)?(windowHeight-navHeight-titleHeight):maxHeight;var n;if($(this).hasClass("clicked")){$(this).next('dl').hide();$(this).removeClass('clicked');}else{$('#filterList dl').hide();$('.filterLink').removeClass('clicked');$(this).next('dl').show();$(this).addClass('clicked');}return false;});$("body").on("click",".jq-filter-apply",function(){$(this).parents(".browse-modal-container").hide();return false;});var query=window.location.search.split("?").join("");var sortStart=ProductModel.getInstance().getStateSnapshot().sortCriteria;var isSearch=URLFactory.extractQueryStringValue(query,"search");if(isSearch==""){isSearch=window.location.pathname.split("/")[1]=="search"?"1":"0";}if(isSearch=="1"){$("#sortList a[data-filter='5']").attr("data-filter","11");if(sortStart==9999){sortStart=11;}}else{if(sortStart==9999){sortStart=5;}}$('#sortList a[data-filter="'+sortStart+'"]').addClass("active");if(locale.toLowerCase()=="zh-hant"||(locale.toLowerCase()=="intl"&&isRetailMode.toLowerCase()=="false")){$('html > head').append($('<style>.price { display:none !important; }</style>'));}$('body').on('click','#sortList .browse-modal-content a',function(){if(!$(this).hasClass("active")){$("#sortList a").removeClass("active");$(this).addClass("active");var filter=$(this).attr("data-filter");var state=ProductModel.getInstance().getStateSnapshot();state.sortCriteria=filter;var hash=URLFactory.convertStateToHash(state);ProductModel.getInstance().setStateSnapshot(state);window.history.pushState(state,"",$(this).attr("href"));$("#sortList").hide();$("html, body").animate({scrollTop:0},"slow");dtmSortOption=$(this).text();trackSortOption=true;}return false;});$('body').on('click','#filterList dl li a',function(){if($(this).parent().hasClass("disabled")){return false;}handleFilterOptionClick($(this));return false;});$('body').on('blur','#lowRangeEntry, #highRangeEntry',function(e){lowRange=$("#lowRangeEntry").val();highRange=$("#highRangeEntry").val();if(highRange==PRICE_RANGE_NO_LIMIT_LABEL){highRange="";}if(highRange!=""&&lowRange!=""){var model=CategoriesModel.getInstance();state=ProductModel.getInstance().getStateSnapshot();if(!isNaN(parseInt(lowRange))&&!isNaN(parseInt(highRange))&&parseInt(lowRange)>parseInt(highRange)){state.lowRange=highRange;state.highRange=lowRange;thisText=formatCurrency(highRange)+" - "+formatCurrency(lowRange);}else{state.lowRange=lowRange;state.highRange=highRange;thisText=formatCurrency(lowRange)+" - "+formatCurrency(highRange);}var refinements='';var i=0;$.each(model.categoryMenus,function(){if(this.DimensionGroup!="Price"){$.each(this.MenuItems,function(){if(this.isRefinementSelected==true){if(i>0){refinements+="+";}refinements+=this.ID;i++;}});}});state.refinement=refinements;id=URLFactory.convertStateToHash(state);$(".filter-loader").show();handleSetFilter(id,"",true);if(isSearch=="1"){var OmniPageName="Generic Search (Endeca)";var OmniCatName=null;}else{var OmniPageName="Category Browse (Endeca)";}var currencySymbol=$(".price-symbol:first").html();var range=currencySymbol+lowRange+" - "+currencySymbol+highRange;var updateFilters={action:"add",categoryName:OmniCatName,filterName:range,filterType:"Price",pageName:OmniPageName
};TrackEndecaDimensions(updateFilters);}});function handleFilterOptionClick(handle){$(".filter-loader").show();var isPriceRange=false;var state;var model=ProductModel.getInstance();if(handle[0].id=="searchPriceRangeButton"){handle=$("#category_PriceRange .filterLink");isPriceRange=true;}if(handle.parent().hasClass('disabled')){}else if(handle.parent().hasClass('active')){handle.parent().removeClass('active');var originalValue=handle.parent().attr('rel');var thisText=handle.text();var id=handle.parent().attr("id").split("category_").join("");var category=handle.parents(".primaryLi").attr("id").split("category_").join("");var resetId=id;removeBreadCrumb(thisText,category);if($('#filterList .active').length==0){$('#filterList li:last-child').css({'border-bottom':0});}handleSetFilter(resetId,handle.attr("href"));}else{var thisText=handle.text();var id=handle.parent('li').attr("id").split("filter_").join("");if(isPriceRange==true){lowRange=$("#lowRangeEntry").val();highRange=$("#highRangeEntry").val();if(lowRange=="0"){lowRange="";}if(highRange==PRICE_RANGE_NO_LIMIT_LABEL){highRange="";}state=ProductModel.getInstance().getStateSnapshot();if(!isNaN(parseInt(lowRange))&&!isNaN(parseInt(highRange))&&parseInt(lowRange)>parseInt(highRange)){state.lowRange=highRange;state.highRange=lowRange;thisText=formatCurrency(highRange)+" - "+formatCurrency(lowRange);}else{state.lowRange=lowRange;state.highRange=highRange;thisText=formatCurrency(lowRange)+" - "+formatCurrency(highRange);}id=URLFactory.convertStateToHash(state);}var category=handle.parents(".primaryLi").attr("id").split("category_").join("");handle.parent().addClass('active');addBreadcrumbs(thisText,category);handleSetFilter(id,handle.attr("href"));}$("html, body").animate({scrollTop:0},"slow");}$('body').on('click','#btnReset, .jq-filter-reset',function(){var keyword;$('#filterList a').removeClass('active');$('#filterList li:last-child').css({'border-bottom':0});var OmniPageName="Category Browse (Endeca)";var updateFilters={"pageName":OmniPageName,"filterType":"","filterName":"","categoryName":keyword,"action":"resetAll"
};hideFilters();handleResetAll(updateFilters);window.history.pushState(ProductModel.getInstance().pBrowseState,"",$(this).attr("href"));$(".visualFilterBtn").removeClass("addVFBtnActive");if($(".vf").length>0){$(".vf").find(".selected").removeClass("selected");$(".vf").find(".catName span:not('.noQuestion1')").each(function(){$(this).html("");});$(".vf").find(".catName br").each(function(){$(this).hide();});$(".vf span.catName").html($("#headerText #title").html());$("#titleBar .filterVFShow").html($("#headerText #title").html());$(".reloadStart").hide();$(".vf div.touch-carousel #touchCarousel-0-tab-0").click();}return false;});$('body').on('click','#filterList dt',function(){$('#filterList dl').hide();var filterHeight=$('#primary').height();$('.filterLink').removeClass('clicked');return false;});$('body').on('click','#btnErrorViewFilters',function(){var thisHref=$(this).attr('href');window.location=thisHref;return true;});function hideFilters(){$('#filterList dl').hide();}function addBreadcrumbs(crumb,category){var OmniPageName="Category Browse (Endeca)";if($("#filterBreadcrumbs span").text().indexOf('"')>=0){if($("#filterBreadcrumbs span").text().indexOf(",")>=0){var OmniCatName=$("#filterBreadcrumbs span").text().replace(/"/g,"").split(",")[0];}else{var OmniCatName=$("#filterBreadcrumbs span").text().replace(/"/g,"");}}else{var OmniCatName=$("#headerText #title").text();}var updateFilters={"pageName":OmniPageName,"filterType":category,"filterName":crumb,"categoryName":OmniCatName,"action":"add"
};trackFilters(updateFilters,false);}function removeBreadCrumb(crumb,category){var OmniPageName="Category Browse (Endeca)";if($("#filterBreadcrumbs span").text().indexOf('"')>=0){if($("#filterBreadcrumbs span").text().indexOf(",")>=0){var OmniCatName=$("#filterBreadcrumbs span").text().replace(/"/g,"").split(",")[0];}else{var OmniCatName=$("#filterBreadcrumbs span").text().replace(/"/g,"");}}else{var OmniCatName=$("#headerText #title").text();}var updateFilters={"pageName":OmniPageName,"filterType":category,"filterName":crumb,"categoryName":OmniCatName,"action":"remove"
};trackFilters(updateFilters,false);}function fixBreadCrumb(){var firstBreadcrumb=$('#filterBreadcrumbs span').eq(0);firstBreadcrumb.text(firstBreadcrumb.text().split(", ").join(""));}function refreshGrid(link){$('#grid').load(link+' #grid li');}function populateBreadcrumb(data){if(locale.toLowerCase()!="en-us-estr"&&locale.toLowerCase()!="ja-jp-estr"&&locale.toLowerCase()!="en-us-stmt"&&locale.toLowerCase()!="en-us-pkb"&&isPreviewVersion.toLowerCase()=="false"){if(typeof(data)!="undefined"&&data!=null){var itemBuffer="";var itemCount=data.length-1;for(var i=0;i<data.length;i++){if(i!=itemCount){itemBuffer+="<li><a href='"+data[i].CanonicalURL+"'>"+data[i].Name+"</a></li>";}else{itemBuffer+="<li>"+data[i].Name+"</li>";}}BREADCRUMB_CURRENT_FILTERS=data;$("#breadCrumb ul").html(itemBuffer);setTimeout(function(){$('#breadCrumb').show();},500);}}}function populateJsonLDScript(data){if(locale.toLowerCase()!="en-us-estr"&&locale.toLowerCase()!="ja-jp-estr"&&locale.toLowerCase()!="en-us-stmt"&&locale.toLowerCase()!="en-us-pkb"&&isPreviewVersion.toLowerCase()=="false"){if(typeof(data)!="undefined"&&data!=null){var finalSchemaObj=[];var tempSchemaItems=[];for(var i=0;i<data.length;i++){var tempSchemaData={};tempSchemaData["@type"]="ListItem";tempSchemaData["position"]=data[i].DisplayOrder;tempSchemaData["item"]={"@id":data[i].CanonicalURL,"name":data[i].Name
};tempSchemaItems.push(tempSchemaData);}for(var i=0;i<tempSchemaItems.length;++i){finalSchemaObj.push(tempSchemaItems[i]);}var scriptSchema=document.createElement('script');scriptSchema.type='application/ld+json';scriptSchema.text=JSON.stringify({"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[finalSchemaObj]
});if($('head script[type="application/ld+json"]').length>0){$('head script[type="application/ld+json"]').remove();$("head").append(scriptSchema);}else{$("head").append(scriptSchema);}}}}var model;var svcLocator;var vwLocator;var GRID_DIRECTION="topLeftBottomRight";var hideAddressStartTime;var hash=window.location.hash.split("#").join("");var initGridPosition;var loadMoreCount=0;var productClicked=0;function handleLoadMore(){try{var productsGrid=ViewLocator.getInstance().getView("productsGrid");var loadMoreButton=vwLocator.getView("loadMoreButton");loadMoreCount=loadMoreCount+1;var snapShot=ProductModel.getInstance().getStateSnapshot();snapShot.numPages=loadMoreCount;window.history.pushState(snapShot,"",window.location.href);closeGridOverlay(false);productsGrid.appendToProducts();TrackActionMobileLoadMoreResults('Category Browse','Load more results');}catch(err){Debug.error(err);}}function handleCloseFilterMenu(e){closeFilterMenu();}function handleOpenFilterMenu(e){openFilterMenu();}function handleFilterMenuReset(menuName){var gridHandle=vwLocator.getView("productsGrid");if(gridHandle!=null){disableFilterMenu();document.getElementById("productsGrid").innerHTML='<div style="height:150px;"></div>';$("#productsGrid").addClass("loading");vwLocator.getView("loadMoreButton").style.display="none";model.setBrowseStates({refinement:""});}hilightFilterMenuItem(-1);closeFilterMenu();enableHilightFilterResetButton(false);window.location.hash="";}function init(){if(window.history.state!=null){if(window.history.state.numPages!=""){loadMoreCount=window.history.state.numPages;}if(window.history.state.productID!=""||window.history.state.productID!=null){productClicked=window.history.state.productID;}}$('#filterButtons').scrollToFixed({marginTop:$('header').outerHeight()+$("#titleBar").outerHeight(),zIndex:2
});$($(".fixed-spacer")[0]).css("height",$("#filterButtons").outerHeight());if(typeof(isHideSavedItem)!="undefined"&&isHideSavedItem=="True"){$("body").addClass("hide-saved-hearts");}$("#titleBar").wrapInner("<div>");try{mobileUISetup();svcLocator=ServiceLocator.getInstance();svcLocator.registerService("getDataService",new GetProductsAndCategoriesService());var prodGrid;prodGrid=new ProductGridMobile(document.getElementById("productsGrid"));prodGrid.setToolTip(ToolTipAdvanced.getInstance());ToolTipAdvanced.getInstance().init("toolTipHolder");ToolTipAdvanced.getInstance().moveWithCursor=false;blockDropDownClicks=true;vwLocator=ViewLocator.getInstance();vwLocator.registerView("productsGridHolder",document.getElementById("divArrowsAndGrid"));vwLocator.registerView("productsGrid",prodGrid);vwLocator.getView("productsGridHolder").style.visibility="visible";var viewAllProductsGrid=new ProductGridVO();viewAllProductsGrid.gridType=GRID_DIRECTION;viewAllProductsGrid.gridName="viewAll";viewAllProductsGrid.numRows=-1;viewAllProductsGrid.pageSize=VIEW_ALL_THRESHOLD;var viewPagedProductsGrid=new ProductGridVO();viewPagedProductsGrid.gridType=GRID_DIRECTION;viewPagedProductsGrid.gridName="viewPaged";viewPagedProductsGrid.numRows=3;viewPagedProductsGrid.pageSize=10000;prodGrid.setGridType(viewPagedProductsGrid.gridType);document.getElementById("productsGrid").innerHTML='<div style="height:150px;"></div>';var productGridHandler=new ProductGridEventHandler();subscribe(productGridHandler);var gridNavigationHandler=new GridNavigationEventHandler();subscribe(gridNavigationHandler);var hash=window.location.hash;var query=window.location.search.split("?").join("");var cidParam=CATEGORY_ID;var searchParams;if(FRIENDLY_SEARCH_PARAM!=""){searchParams=FRIENDLY_SEARCH_PARAM;}else{searchParams=URLFactory.extractQueryStringValue(query,"search_params");}var searchKeyword=URLFactory.extractQueryStringValue(query,"searchkeyword");if(searchKeyword==""){searchKeyword=window.location.pathname.split("/")[2].split("-").join(" ");}var isSearch=(window.location.pathname.split("/")[1].toLowerCase()=="search")?"1":"0";var gridPos=decodeURIComponent(URLFactory.extractQueryStringValue(query,"gridpos"));var stateSnapshot;model=ProductModel.getInstance();model.addProductGrid(viewPagedProductsGrid);model.addProductGrid(viewAllProductsGrid);if(hash!=""&&isAjaxEnabled()==true){model.setStateSnapshot(URLFactory.convertHashToState(hash));stateSnapshot=model.getStateSnapshot();}else if(searchParams!=""){stateSnapshot=URLFactory.convertHashToState(searchParams);if(cidParam!=""){stateSnapshot.category=cidParam;}if(gridPos!=""){stateSnapshot.hasInitPosition=true;stateSnapshot.pageSize=gridPos.split("/")[0];initGridPosition=gridPos.split("/")[1];}if(searchKeyword!=""&&isSearch=="1"){stateSnapshot.searchTerms=searchKeyword;}model.setStateSnapshot(stateSnapshot);}else if(searchKeyword!=""&&isSearch=="1"){stateSnapshot=model.getStateSnapshot();stateSnapshot.searchTerms=searchKeyword;model.setStateSnapshot(stateSnapshot);}else{stateSnapshot=model.getStateSnapshot();if(cidParam!=""){stateSnapshot.category=cidParam;}if(gridPos!=""){stateSnapshot.hasInitPosition=true;stateSnapshot.pageSize=gridPos.split("/")[0];initGridPosition=gridPos.split("/")[1];}stateSnapshot.refinement="";model.setStateSnapshot(stateSnapshot);}window.history.replaceState(stateSnapshot,"",window.location);if(document.forms[0].elements["_UrlReferrer"]){document.forms[0].elements["_UrlReferrer"].value=window.location.href;}ToolTipAdvanced.getInstance().init("toolTipHolder");if(isAjaxEnabled()==false){svcLocator.getService("getDataService").getJSONData();if(model.getBrowseStates().pageSize>36){model.setCurrentProductGridName("viewAll");}}if(isSearch=="1"){$(".search-message").addClass("is-search");$("#filterBreadcrumbs").after($(".search-message"));$(".search-message").show();$($(".fixed-spacer")[0]).css("height",$("#titleBar").outerHeight());}else{var prevScroll=$(window).scrollTop();setInterval(function(){prevScroll=$(window).scrollTop();},100);$(window).scroll(function(){var scroll=$(window).scrollTop();if(scroll<prevScroll-50){if($('.vf').length==0){if(scroll<prevScroll-50){$(".search-message").show();$("#filterButtons").css("top",parseInt($("#titleBar").css("top"))+$("#titleBar").outerHeight());$($(".fixed-spacer")[0]).css("height",$("#titleBar").outerHeight());}else if(scroll>prevScroll+50){$(".search-message").hide();$("#filterButtons").css("top",parseInt($("#titleBar").css("top"))+$("#titleBar").outerHeight());$($(".fixed-spacer")[0]).css("height",$("#titleBar").outerHeight());}}}$("#filterButtons").css("top",parseInt($("#titleBar").css("top"))+$("#titleBar").outerHeight());$($(".fixed-spacer")[0]).css("height",$("#titleBar").outerHeight());});if($(".question1Text").parents(".filterVFShow").length>0){console.log("Current Pos"+$(window).scrollTop());$(".startOver-mobile").addClass("show");}}$("body").on("click",".grid-item",function(e){var id;var attr=$(this).parent().attr("id");if(typeof attr!==typeof undefined&&attr!==false){id=$(this).parent().attr("id").replace("cell","");}else{id=$(this).closest("li").attr("id").replace("cell","");}var friendlyUrl=$(this).attr("href");var itemPos=$(this).attr("data-itempos");var tileTracking=$(this).attr("data-tileTracking");var itemRRUrls=$(this).attr("data-rrurl");CookieManager.setCookieValue("userCurrentFilters",encodeURIComponent(JSON.stringify(BREADCRUMB_CURRENT_FILTERS)));generateEvent('onProductSelected',id,friendlyUrl,"",itemPos,tileTracking);if(typeof itemRRUrls!=='undefined'&&itemRRUrls!='none'){e.preventDefault();$.ajax({url:itemRRUrls,data:"",type:'POST',timeout:10000,dataType:"jsonp",success:function(data){},error:function(e){}});}return false;});$("body").on("click",".jq-update-saved",function(){var link=$(this);var container=link.parents("li");var imageSrc=container.find(".grid-item img").attr("src");var defaultSku=container.attr("data-default-sku");var savedId=link.attr("data-saved-id");var sku=container.attr("data-sku");var trackingSku=sku+":"+defaultSku;var gridPosition=container.index()+1;var tileTracking=container.find(".grid-item").attr("data-tileTracking");var cid=0;var mcid=0;if(link.hasClass("filled")){var removeKey="listItemKey";var isSavedRingsToken=',"isSavedRings" : false';$.ajax({url:"/Customer/InlineCustomerSelections.aspx/RemoveSavedItem",type:"POST",data:'{"'+removeKey+'":"'+savedId+'"'+isSavedRingsToken+'}',dataType:"json",contentType:"application/json; charset=utf-8",success:function(data){var count=data.d.Header.TotalCount+data.d.Header.TotalRingCount+data.d.Header.TotaldahReceivedCount+data.d.Header.TotaldahSentCount+data.d.Header.TotalSavedBYOCount;CookieManager.setCookieValue("saveditemscnt",count);$("#spanSavedItemCount, .added-toast .saved-count").html(count);if(count==0){$("#spanSavedItemCount").hide().parent().removeClass("active");}link.removeClass("filled");TrackRemoveSavedItem("Category Browse","Delete Item",data.d.ResponseObject.DataLayer);},error:function(jqXHR,status,error){}});}else{var data='{"sku":"'+sku+'", "selectedSku":"'+defaultSku+'", "cid":'+cid+', "mcid":'+mcid+', "qty":"1"}';$.ajax({url:'/Default.aspx/AddSavedItemFromBG',type:'POST',cache:false,data:data,dataType:"json",contentType:"application/json; charset=utf-8",success:function(data){var count=data.d.BagCount;CookieManager.setCookieValue("saveditemscnt",count);$("#spanSavedItemCount, .added-toast .saved-count").html(count);$("#spanSavedItemCount").show().parent().addClass("active");link.addClass("filled");getSavedItemsList();if(count==1){$("#firstSavedToast").removeClass("hidden");setTimeout(function(){$("#firstSavedToast").addClass("hidden");},5000);}if(tileTracking!=''){tileTracking=tileTracking.substr(tileTracking.indexOf("=")+1)
}TrackActionAddToSavedItems("Category Browse","Save Item",trackingSku,data.d.DataLayer,gridPosition,tileTracking);},error:function(jqXHR,textStatus,errorThrown){}});}return false;});}catch(err){Debug.error(err);}}function openFilterMenu(){$('#filterList').css("display","block");closeGridOverlay(false);}function closeFilterMenu(){$('#filterList').css("display","none");}function buildFilterMenu(){var model=ProductModel.getInstance();var categoriesData=CategoriesModel.getInstance();var state=model.getStateSnapshot();var category;var categoryItem;var menuHTML='<ul id="primary" style="left: 0px; ">';var n,i,j,h;var menuSelected=false;var showPrice=true;var priceRangeSelected=false;var minPrice=model.custom.minPrice;var maxPrice=model.custom.maxPrice;var formattedMinPrice=formatCurrency(minPrice);var formattedMaxPrice=formatCurrency(maxPrice);var formattedLowPrice=model.custom.formattedLowPrice;var formattedHighPrice=model.custom.formattedHighPrice;var minRangeModel=state.lowRange;var maxRangeModel=state.highRange;var priceRangeLabel="";var priceResetQS="";var listHtml1='';var listHtml2='';var lowPrice='';var highPrice='';if(locale.toLowerCase()=="zh-hant"||(locale.toLowerCase()=="intl"&&isRetailMode.toLowerCase()=="false")){showPrice=false;}var menusObj=categoriesData.categoryMenus;var menusArray=$.map(menusObj,function(value,index){return[value];});menusArray.sort(function(a,b){return(a.DisplayOrder>b.DisplayOrder)?1:((b.DisplayOrder>a.DisplayOrder)?-1:0);});$.each(menusArray,function(){var selectedFiltersHtml='';category=this;category.label=category.DimensionGroup;if(filterLabels[category.DimensionGroup]){category.label=filterLabels[category.DimensionGroup];}n=category.MenuItems.length;h=Math.ceil(n/2);if(category.DimensionGroup=="Price"&&showPrice==true){if(minRangeModel==""||minRangeModel=="0"||minRangeModel==0){minRangeModel=Math.round(Number(minPrice));}else{priceRangeSelected=true;}if(maxRangeModel==""||maxRangeModel=="0"||maxRangeModel==0){maxRangeModel=Number(maxPrice);}else{priceRangeSelected=true;}if(priceRangeSelected==false){if(category.MinSelectedPrice){lowPrice=category.MinSelectedPrice;highPrice=category.MaxSelectedPrice;}else{lowPrice='';highPrice='';}}}if(category.MenuItems.length==1&&category.MenuItems[0].resetQS!=""&&category.MenuItems[0].resetQS!=null){category.MenuItems[0].refinementQS=category.MenuItems[0].resetQS;menuHTML+='<li class="primaryLi" id="category_'+category.DimensionGroup+'"><a href="#" rel="'+category.DimensionGroup+'" class="avenir type-cta filterLink active"><label>'+category.MenuItems[0].Name+'</label><span class="show-for-closed"><i class="icon-font" aria-label="expand">plus</i></span><span class="show-for-open"><i class="icon-font" aria-label="collaspe">minus</i></span>';menuSelected=true;}else{if(category.DimensionGroup!="Price"||(category.DimensionGroup=="Price"&&showPrice==true)){menuHTML+='<li class="primaryLi" id="category_'+category.DimensionGroup+'"><a href="#" rel="'+category.DimensionGroup+'" class="avenir type-cta filterLink"><label>'+category.label+'</label><span class="show-for-closed"><i class="icon-font" aria-label="expand">plus</i></span><span class="show-for-open"><i class="icon-font" aria-label="collaspe">minus</i></span>';}}var c=0;if(category.DimensionGroup=="Price"&&showPrice==true&&priceRangeSelected==true){priceRangeLabel=formattedLowPrice+" - "+formattedHighPrice;state.lowRange="";state.highRange="";priceResetQS=URLFactory.convertStateToHash(state);selectedFiltersHtml+='<span>';selectedFiltersHtml+=priceRangeLabel+' ('+model.getCurrentProductGrid().numResults+')';if(model.getCurrentProductGrid().numResults==0){selectedFiltersHtml+='</span><span class="filter-error">'+nomatchText;}c++;}category.MenuItems.sort(function(a,b){return(a.refinementDisplayOrder>b.refinementDisplayOrder)?1:((b.refinementDisplayOrder>a.refinementDisplayOrder)?-1:0);});var zeroResults=true;var sc=0;for(i=0;i<n;i++){categoryItem=category.MenuItems[i];if(categoryItem.isRefinementSelected==true){if(c==0){selectedFiltersHtml+='<span>';}else{selectedFiltersHtml+=' ; ';}selectedFiltersHtml+=categoryItem.Name+' ('+categoryItem.refinementItemCount+')';if(categoryItem.refinementItemCount!=0){zeroResults=false;}c++;sc++;}}if(sc==0){zeroResults=false;}if(zeroResults){selectedFiltersHtml+='</span><span class="filter-error">'+nomatchText;}if(c>0){selectedFiltersHtml+='</span>';}menuHTML+=selectedFiltersHtml;if(category.DimensionGroup!="Price"||(category.DimensionGroup=="Price"&&showPrice==true)){menuHTML+='</a><dl class="filterOptionContainer" style="display: none; "><dd id="filterListContainer'+category.DimensionGroup+'">';listHtml1='<ul class="">';if(n>=2){listHtml2='<ul class="">';}for(i=0;i<n;i++){categoryItem=category.MenuItems[i];var cssClass="";if(categoryItem.isRefinementSelected==true){cssClass="active";categoryItem.refinementQS=categoryItem.resetQS;}if(categoryItem.refinementItemCount==0){cssClass+=' disabled';}var friendlyUrl=(categoryItem.isRefinementSelected)?categoryItem.resetFriendlyUrl:categoryItem.refinementFriendlyUrl;var catName=categoryItem.Name;if(locale.toLowerCase()=="zh-cn"&&(category.DimensionGroup=="Price"&&showPrice==true)||locale.toLowerCase()=="ru-ru"&&(category.DimensionGroup=="Price"&&showPrice==true)){catName=categoryItem.Name.split(" - ").join(" - <br>");}var noFollow=(categoryItem.isSEOIndexFollow!="null"&&categoryItem.isSEOIndexFollow)?"nofollow noindex":"";if(i>(h-1)){listHtml2+='<li id="filter_'+categoryItem.refinementQS+'" class="'+cssClass+'"><a href="'+friendlyUrl+'" class="avenir type-cta-alt" rel="'+noFollow+'"'+'>'+catName+'</a></li>';}else{listHtml1+='<li id="filter_'+categoryItem.refinementQS+'" class="'+cssClass+'"><a href="'+friendlyUrl+'" class="avenir type-cta-alt" rel="'+noFollow+'"'+'>'+catName+'</a></li>';}}listHtml1+='</ul>';menuHTML+=listHtml1;if(n>=2){listHtml2+='</ul>';menuHTML+=listHtml2;}menuHTML+='</dd>';if(category.DimensionGroup=="Price"&&showPrice==true){if(model.getCurrentProductGrid().numResults>1){menuHTML+='   <div id="price-field"><div class="price-input-wrapper"><span class="price-symbol"></span>';if(priceRangeSelected==false){menuHTML+='<input type="number" name="lowRangeEntry" id="lowRangeEntry" value="'+lowPrice+'" pattern="[0-9]*" maxlength="13">';}else{menuHTML+='<input type="number" name="lowRangeEntry" id="lowRangeEntry" value="'+minRangeModel+'" pattern="[0-9]*" maxlength="13">';}menuHTML+='</div><label for="highRangeEntry">to</label><div class="price-input-wrapper"><span class="price-symbol"></span>';if(priceRangeSelected==false){menuHTML+='<input type="number" name="highRangeEntry" id="highRangeEntry" value="'+highPrice+'" pattern="[0-9]*" maxlength="13">';}else{menuHTML+='<input type="number" name="highRangeEntry" id="highRangeEntry" value="'+maxRangeModel+'" pattern="[0-9]*" maxlength="13">';}menuHTML+='</div></div>';}}menuHTML+='</dl></li>';}});menuHTML+='</ul>';return menuHTML;}function enableFilterMenu(){$('#filterLink').removeClass('disabled');}function disableFilterMenu(){}function hilightFilterMenuItem(selectedIndex){var menuHnd;var menuItems;var n;menuHnd=document.getElementById("sub");if(menuHnd!=null){menuItems=menuHnd.childNodes;n=menuItems.length;for(var i=0;i<n;i++){if(menuItems[i].className!=""){menuItems[i].className="";}}if(selectedIndex>=0&&selectedIndex<n){menuItems[selectedIndex+1].className="selected";}}}function handleSetFilter(filterId,stateURL,isPriceRange){loadMoreCount=0;var browseStates=new Object();var category=URLFactory.extractValue(filterId,"category");var refinement=URLFactory.extractValue(filterId,"refinement");var lowRange=URLFactory.extractValue(filterId,"lowRange");var highRange=URLFactory.extractValue(filterId,"highRange");browseStates["category"]=category;browseStates["refinement"]=refinement;browseStates["lowRange"]=lowRange;browseStates["highRange"]=highRange;model.setBrowseStates(browseStates);CategoriesModel.getInstance().addFilters([filterId]);if(isPriceRange){var stateURL=window.location.pathname.split("/");var newStateURL=[];for(var i=0;i<stateURL.length;i++){if(stateURL[i].indexOf("price")<0){newStateURL.push(stateURL[i]);}}var newPrice="price-"+lowRange+"-"+highRange;if(newStateURL[newStateURL.length-1].indexOf("sort")>=0){var sortFilter=newStateURL.pop();newStateURL.push(newPrice);newStateURL.push(sortFilter);}else{newStateURL.push(newPrice);}stateURL=newStateURL.join("/");}var urlUniqueID="";switch($("#sortList a.active").attr("data-filter")){case"0":urlUniqueID="";break;case"1":urlUniqueID="high-to-low";break;case"2":urlUniqueID="low-to-high";break;case"3":urlUniqueID="new-to-tiffany";break;case"4":urlUniqueID="alphabetically";break;case"5":urlUniqueID="relevance";break;case"6":urlUniqueID="whats-old";break;case"7":urlUniqueID="alphabetically-backwards";break;case"8":urlUniqueID="reverse-category-order";break;case"9":urlUniqueID="related-items";break;case"10":urlUniqueID="reverse-related-items";break;case"11":urlUniqueID="relevance-search";break;}stateURL+="/sort-"+urlUniqueID;window.history.pushState(model.pBrowseState,"",stateURL);}var lastWindowWidth=$(window).width();var lastWindowHeight=$(window).height();function setOrientation(){if(lastWindowWidth!=$(window).width()||lastWindowHeight!=$(window).height()){closeGridOverlay(false);var prodGrid=ViewLocator.getInstance().getView("productsGrid");if(prodGrid!=null){prodGrid.checkWidth();}}lastWindowWidth=$(window).width();lastWindowHeight=$(window).height();}if(typeof(window.addEventListener)!="undefined"){window.addEventListener('load',setOrientation,false);window.addEventListener('orientationchange',setOrientation,false);window.addEventListener('resize',setOrientation,false);}function handleResetAll(updateFilters){disableFilterMenu();model.setBrowseStates({refinement:"",lowRange:"",highRange:""});window.location.hash="";trackFilters(updateFilters,false);}function mobileUISetup(){var loadMoreContainer=document.createElement("div");loadMoreContainer.id="loadMoreThumbnailsDiv";loadMoreContainer.className="avenir type-cta";var loadMoreButton=document.createElement("a");loadMoreButton.id="loadMoreThumbnails";loadMoreButton.className="btn";loadMoreButton.onclick=function(){handleLoadMore()};loadMoreContainer.appendChild(loadMoreButton);var loadMoreButtonLoading=document.createElement("div");loadMoreButtonLoading.id="loadMoreThumbnailsLoading";loadMoreButtonLoading.className="loading";loadMoreButtonLoading.style.height="20px";loadMoreButtonLoading.style.display="none";loadMoreContainer.appendChild(loadMoreButtonLoading);var loadMoreButtonText=document.createTextNode(LABEL_VIEW_MORE);loadMoreButton.appendChild(loadMoreButtonText);document.getElementById("divSearchAndBrowse").appendChild(loadMoreContainer);var pageTitleElement=document.getElementsByTagName("h1")[0];var pageTitleHTML=pageTitleElement.innerHTML;pageTitleHTML=pageTitleHTML.split(LABEL_BROWSE_TITLE_PREFIX).join("");pageTitleElement.innerHTML=pageTitleHTML+'<span id="numResultsLabel"></span>';document.getElementById("titleBar").style.visibility="visible";ViewLocator.getInstance().registerView("loadMoreButton",document.getElementById("loadMoreThumbnails"));hideAddressStartTime=new Date();}function hideAddressBar(){if(typeof(getProductsAndCategoriesService_firstLoadComplete)!="undefined"&&getProductsAndCategoriesService_firstLoadComplete==false){if((new Date()).getTime()-hideAddressStartTime.getTime()>4000){window.scrollTo(0,1);}else{setTimeout(hideAddressBar,500);}}else{window.scrollTo(0,1);}}function getPageSize(){var yScroll;if(window.innerHeight&&window.scrollMaxY){yScroll=window.innerHeight+window.scrollMaxY;}else if(document.body.scrollHeight>document.body.offsetHeight){yScroll=document.body.scrollHeight;}else{yScroll=document.body.offsetHeight;}var windowHeight;if(self.innerHeight){windowHeight=self.innerHeight;}else if(document.documentElement&&document.documentElement.clientHeight){windowHeight=document.documentElement.clientHeight;}else if(document.body){windowHeight=document.body.clientHeight;}if(yScroll<windowHeight){pageHeight=windowHeight;}else{pageHeight=yScroll;}return pageHeight;}function setCookieValue(name,value){var futdate=new Date();var expdate=futdate.getTime();expdate+=364*24*60*60*1000;futdate.setTime(expdate);var newCookie=name+"="+value+"; path=/;";newCookie+="expires="+futdate.toGMTString();window.document.cookie=newCookie;}function areCookiesEnabled(){if(document.forms[0]){if(document.forms[0].areCookiesEnabled){if(document.forms[0].areCookiesEnabled.value.toLowerCase()=="false"){return false;}}}return true;}function trackFilters(breadcrumbs,getMorePressed){var productsGrid=ViewLocator.getInstance().getView("productsGrid");var pageSize=model.getBrowseStates().pageSize;var currentPage=Math.ceil(productsGrid.productArray.length/pageSize);var trackMetric="";if(breadcrumbs==""){trackMetric="Load More";}else{trackMetric="Load More, "+breadcrumbs;}if(getMorePressed==true){trackMetric+=": "+(currentPage+1);}trackMetric=trackMetric.split(", ").join(",").split(" ,").join(",").split(",").join(", ");TrackEndecaDimensions(breadcrumbs);}var trackDtmPageView;var dtmSortMethod="";$(document).ready(function(){init();$(window).bind('popstate',function(e){if(window.history.state!=null){model.setStateSnapshot(window.history.state);}if($(".vf").is(":visible")){var filters=window.location.pathname.split("/");var vfFilters=[];$(".vf .container").find('a').each(function(){vfFilters.push($(this).attr("href"));$(this).removeClass("selected");});for(var i=0;i<filters.length;i++){for(var j=0;j<vfFilters.length;j++){if(filters[i]==vfFilters[j].split("/")[3]){$("a[href='"+vfFilters[j]+"']").addClass("selected");}}}$.each($(".vf__question").next(),function(index){var answer=$(this).children(".selected").attr("data-response");if(answer==undefined){$(".catName .question"+(index+1)+"Text").html("");$(".question"+(index+1)+"Text").html("");$(".question"+(index)+"Textbr").hide();if(index==0){$(".noQuestion1").show();}}else{if(index==0){$(".noQuestion1").hide();}$(".question"+(index+1)+"Text").show();$(".question"+(index+1)+"Text").html(answer);$(".question"+(index)+"Textbr").show();}$(".vf .catName").html($(".questionText").html());$("#filters .filterVFShow").html($(".questionText").html());$(".reloadStart").css("display","block");$(".startOver-mobile").addClass("show");});$("#filterButtons").css("top",parseInt($("#titleBar").css("top"))+$("#titleBar").outerHeight());$($(".fixed-spacer")[0]).css("height",$("#titleBar").outerHeight());}if($(".visualFilter").is(":visible")){var filters=window.location.pathname.split("/");var vfFilters=[];$(".visualFilter").find('a').each(function(){vfFilters.push($(this).attr("href"));$(this).removeClass("addVFBtnActive");});for(var i=0;i<filters.length;i++){for(var j=0;j<vfFilters.length;j++){if(filters[i]==vfFilters[j].split("/")[3]){$("a[href='"+vfFilters[j]+"']").addClass("addVFBtnActive");}}}}});if($(".filtersVF").is(":visible")){if($(".question1Text").parents(".filterVFShow").length>0){console.log("Current Pos"+$(window).scrollTop());$(".startOver-mobile").addClass("show");}}trackDtmPageView=true;if($(".visualFilter").is(":visible")){var filters=window.location.pathname.split("/");var vfFilters=[];$(".visualFilter").find('a').each(function(){vfFilters.push($(this).attr("href"));});for(var i=0;i<filters.length;i++){for(var j=0;j<vfFilters.length;j++){if(filters[i]==vfFilters[j].split("/")[3]){$("a[href='"+vfFilters[j]+"']").addClass("addVFBtnActive");}}}}$("body").on("click",".visualFilterBtn",function(e){e.preventDefault();var catUrl=$(this).attr("href");var trackFilters=[];if(!$(this).hasClass("addVFBtnActive")){$(this).addClass("addVFBtnActive");$(".visualFilterBtn").not(this).each(function(){if($(this).hasClass("addVFBtnActive")){var updateFilters={"pageName":"","filterType":"visual","filterName":$(this).text(),"categoryName":"","action":"remove"
};trackFilters.push(updateFilters);}$(this).removeClass("addVFBtnActive");});var updateFilters={"pageName":"","filterType":"visual","filterName":$(this).text(),"categoryName":"","action":"add"
};trackFilters.push(updateFilters);}else{$(this).removeClass("addVFBtnActive");var selected=$(this).attr("href").split("/");selected.pop()
catUrl=selected.join("/");var updateFilters={"pageName":"","filterType":"visual","filterName":$(this).text(),"categoryName":"","action":"remove"
};trackFilters.push(updateFilters);}var service=ServiceLocator.getInstance().getService("getDataService");$.ajax({url:"/api/search/searchcategory",type:"POST",data:'{"SearchQueryString": "'+catUrl+'", "IsSearchMode": false, "SessionID": "'+browserSessionID+'", "UserID": "'+sessionUserid+'", "IsFriendlySearchUrl": true}',dataType:"json",contentType:"application/json; charset=utf-8",success:function(data){if(data!=null){if(service!=null){service.onResult(data);var filterSnap=URLFactory.convertHashToState(data.StateHash);ProductModel.getInstance().setStateSnapshot(filterSnap,false);window.history.pushState(filterSnap,"",data.CurrentStateURL);for(var i=0;i<trackFilters.length;i++){TrackEndecaDimensions(trackFilters[i]);}}}else{if(service!=null){service.onError(data);}}},error:function(jqXHR,status,error){}});});$("body").on("click",".reloadStart",function(e){e.preventDefault();$(".reloadStart").hide();$('.startOver-mobile').removeClass("show");TrackSiteInteractions("start over","gift finder");$(".vf__question").next().find(".selected").removeClass("selected");var resetCat=$(".vf2__carousel .container").attr("data-masterCat")+"/sort-relevance";var tab="#"+$(this).parents(".vf2__title").siblings("div.touch-carousel").attr("id")+"-tab-0";$(tab).click();var service=ServiceLocator.getInstance().getService("getDataService");$.ajax({url:"/api/search/searchcategory",type:"POST",data:'{"SearchQueryString": "'+resetCat+'", "IsSearchMode": false, "SessionID": "'+browserSessionID+'", "UserID": "'+sessionUserid+'", "IsFriendlySearchUrl": true}',dataType:"json",contentType:"application/json; charset=utf-8",success:function(data){if(data!=null){if(service!=null){service.onResult(data);var filterSnap=URLFactory.convertHashToState(data.StateHash);ProductModel.getInstance().setStateSnapshot(filterSnap,false);window.history.pushState(filterSnap,"",data.CurrentStateURL);$(".vf span.catName").html($("#headerText #title").html());$("#titleBar .filterVFShow").html("");}}else{if(service!=null){service.onError(data);}}},error:function(data){}});});$("body").on("click",".startOver-mobile a",function(e){e.preventDefault();var prevScroll=$(window).scrollTop();$(".reloadStart").trigger("click");$("#filterButtons").css("top",parseInt($("#titleBar").css("top"))+$("#titleBar").outerHeight());$($(".fixed-spacer")[0]).css("height",$("#titleBar").outerHeight());$('html, body').animate({scrollTop:$("#headerTile").offset().top-150
},1000);});if($(".vf").is(":visible")){$(".vf span.catName").html($("#headerText #title").html());$("#titleBar").html("<div><div id='headerText'>"+$('#title')[0].outerHTML+$('#numResultsLabel')[0].outerHTML+"</div>"+$('.filtersVF')[0].outerHTML+"</div>");$("#titleBar").hide();$(window).scroll(function(e){e.preventDefault();$("#titleBar").show();$("#titleBar").css("min-height","0");$("#titleBar #headerText").hide();$("#titleBar #numResultsLabel").hide();if($(".search-message").is(":visible")){$($(".fixed-spacer")[1]).show();}else{$($(".fixed-spacer")[1]).hide();}if($("#filterButtons").hasClass("scroll-to-fixed-fixed")){$("#titleBar .filtersVF").css("display","block");if($(".filterVFShow").is(":empty")){$(".filterVFShow").html($(".catName").html());}}else{$("#titleBar .filtersVF").hide();}});var filters=window.location.pathname.split("/");var vfFilters=[];$(".vf .container").find('a').each(function(){vfFilters.push($(this).attr("href"));});for(var i=0;i<filters.length;i++){for(var j=0;j<vfFilters.length;j++){if(filters[i]==vfFilters[j].split("/")[3]){$("a[href='"+vfFilters[j]+"']").addClass("selected");}}}$.each($(".vf__question").next(),function(index){var answer=$(this).children(".selected").attr("data-response");if(answer==undefined){if(index==0){$(".noQuestion1").show();}}else{if(index==0){$(".noQuestion1").hide();}$(".question"+(index+1)+"Text").show();$(".question"+(index+1)+"Text").html(answer);$(".question"+(index)+"Textbr").show();$(".vf .catName").html($(".questionText").html());$("#titleBar .filterVFShow").html($(".questionText").html());$(".reloadStart").css("display","block");$(".startOver-mobile").addClass("show");}});}$("body").on("click",".vf_link a",function(e){e.preventDefault();var trackFilters=[];$(".reloadStart").css("display","block");$(".startOver-mobile").addClass("show");if(!$(this).hasClass("selected")){if($(this).siblings(".selected").length>0){var updateFilters={"pageName":"","filterType":"gift finder","filterName":$(this).siblings(".selected").text(),"categoryName":"","action":"remove"
};trackFilters.push(updateFilters);}$(this).siblings().removeClass("selected");$(this).addClass("selected");var updateFilters={"pageName":"","filterType":"gift finder","filterName":$(this).text(),"categoryName":"","action":"add"
};trackFilters.push(updateFilters);}else{$(this).removeClass("selected");var updateFilters={"pageName":"","filterType":"gift finder","filterName":$(this).text(),"categoryName":"","action":"remove"
};trackFilters.push(updateFilters);}var getSelected=$(this).closest("div.container").find(".selected");var mastCat=$(this).closest("div.container").attr("data-masterCat");var endURL=mastCat;for(var i=0;i<getSelected.length;i++){var answerUrl=$(getSelected[i]).attr("href").split("/");answerUrl=answerUrl[answerUrl.length-1];endURL=endURL+"/"+answerUrl;}if(getSelected.length===0){endURL=$(".vf2__carousel .container").attr("data-masterCat")+"/sort-relevance";$(".vf span.catName").html($("#headerText #title").html());$(".reloadStart").hide();$(".startOver-mobile").removeClass("show");$("#titleBar .filterVFShow").html("");}else{$.each($(".vf__question").next(),function(index){var answer=$(this).children(".selected").attr("data-response");if(answer==undefined){$(".catName .question"+(index+1)+"Text").html("");$(".question"+(index+1)+"Text").html("");$(".question"+(index)+"Textbr").hide();if(index==0){$(".noQuestion1").show();}}else{if(index==0){$(".noQuestion1").hide();}$(".question"+(index+1)+"Text").show();$(".question"+(index+1)+"Text").html(answer);$(".question"+(index)+"Textbr").show();}});$(".vf .catName").html($(".questionText").html());$("#titleBar .filterVFShow").html($(".questionText").html());}var service=ServiceLocator.getInstance().getService("getDataService");$.ajax({url:"/api/search/searchcategory",type:"POST",data:'{"SearchQueryString": "'+endURL+'", "IsSearchMode": false, "SessionID": "'+browserSessionID+'", "UserID": "'+sessionUserid+'", "IsFriendlySearchUrl": true}',dataType:"json",contentType:"application/json; charset=utf-8",success:function(data){if(data!=null){if(service!=null){service.onResult(data);var filterSnap=URLFactory.convertHashToState(data.StateHash);window.history.pushState(filterSnap,"",data.CurrentStateURL);ProductModel.getInstance().setStateSnapshot(filterSnap,false);for(var i=0;i<trackFilters.length;i++){TrackEndecaDimensions(trackFilters[i]);}}}else{if(service!=null){service.onError(data);}}},error:function(jqXHR,status,error){}});visualFilterQnAAutoAdvance($(this));});$("body").on("click",".vf .catName span b",function(e){console.log($(this).parents(".vf2__title").next().attr("id"));var index=Math.floor($(this).parent().index()/2);var tab="#"+$(this).parents(".vf2__title").siblings("div.touch-carousel").attr("id")+"-tab-"+index;$(tab).click();});$("body").on("click",".breadcrumb li a",function(e){e.preventDefault();TrackBreadcrumbInteractions('categorybrowse','breadcrumb','');window.location=$(this).attr("href");return false;});var checkFiterCookie=CookieManager.getCookieValue('userCurrentFilters');if(typeof(checkFiterCookie)!="undefined"&&checkFiterCookie!=""&&checkFiterCookie!=null){CookieManager.eraseCookie("userCurrentFilters");}});function visualFilterQnAAutoAdvance(answer){if($(answer).hasClass("selected")){$(".touchcarousel-next").click();}}function formatCurrency(price,ignoreCents){if(typeof(price)=="number"){price=String(price);}else{price=String(convertCurrencyToNumber(price));}var currencyTemplate="${0}";var priceArray=price.split("");var formattedPrice="";var specialSites=["it-it","fr-fr","de-de","es-es","de-at","pr-br","ru-ru"];if(specialSites.indexOf(locale.toLowerCase())>-1){for(var i=priceArray.length;i>0;i--){if(priceArray[i]=="."){priceArray[i]=",";}}}for(var i=priceArray.length-3;i>0;i-=3){if(specialSites.indexOf(locale.toLowerCase())>-1){priceArray.splice(i,0,".");}else{priceArray.splice(i,0,",");}}switch(locale.toLowerCase()){case"en-ca":case"fr-ca":currencyTemplate="CDN${0}";break;case"es-mx":currencyTemplate="MX${0}";break;case"pt-br":currencyTemplate="R${0}";break;case"ja-jp":currencyTemplate="&yen;{0}";break;case"en-au":currencyTemplate="AU${0}";break;case"en-gb":currencyTemplate="&pound;{0}";break;case"de-at":case"en-be":case"fr-fr":case"de-de":case"en-ie":case"it-it":case"en-nl":case"es-es":currencyTemplate="&euro; {0}";break;}if(!ignoreCents){if(specialSites.indexOf(locale.toLowerCase())>-1){if(priceArray.indexOf(",")==-1){priceArray.push(",");priceArray.push("0");priceArray.push("0");}}else{if(priceArray.indexOf(".")==-1){priceArray.push(".");priceArray.push("0");priceArray.push("0");}}}formattedPrice=currencyTemplate.split("{0}").join(priceArray.join(""));return formattedPrice;}function convertCurrencyToNumber(price){if(typeof(price)=="string"){var specialSites=["it-it","fr-fr","de-de","es-es","de-at","pr-br","ru-ru"];if(specialSites.indexOf(locale.toLowerCase())>-1){price=price.replace(/[^\d,]/g,"");price=price.replace(/[,]/g,".");}else{price=price.replace(/[^\d.]/g,"");}return Number(price);}else{return price;}}function hiddenWidth(obj){var clone=obj.clone();clone.css("visibility","hidden");$('body').append(clone);var width=clone.outerWidth();clone.remove();return width;}