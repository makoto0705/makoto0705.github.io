var productTemplate='<img id="product_$sku$" src="$img$" alt="$alt$" data-sku="$sku$" data-description="$description$" data-price="$price$" data-crop="$crop$" data-crop-normal="$cropN$" data-state="$state$" data-isgroup="$isgroup$" data-isengravable="$isengravable$" data-ispurchasable="$ispurchasable$" />';var imageTemplate='$src$?$$presetId$$';var DEFAULT_IMAGE_CROP="0.2,0.2,0.6,0.6";var imageCroppedTemplate='$src$&layer=1&cropN=$crop$';var imageCroppedTemplateAbsolute='$src$&layer=1&crop=$crop$';var tooltipXHR=null;var model,inlineZoomViewer;var rrProdRecs;var spinsetisShowing=false;var activeBreadcrumb;if($(window).width()<980&&locale.toLowerCase()=="en-us-pkb"){$("body").addClass("narrow");}function createProductString(rrProductArray){var productString='{"recommendedProducts":[';for(var i=0;i<rrProductArray.items.length;i++){var tempString='{"SKU": "$productID$", "TYPE": "$isEngagement$"},';tempString=tempString.replace("$productID$",rrProductArray.items[i].sku);tempString=tempString.replace("$isEngagement$","N");if(i==rrProductArray.items.length-1){tempString=tempString.slice(0,-1);}productString=productString+tempString;}productString=productString+']}';return productString;}var SAVED_ID;var items=[];function getSavedItems(){var url="/Customer/InlineCustomerSelections.aspx/GetInlineSavedItems";if(locale.toLowerCase()=="en-us-trade"||locale.toLowerCase()=="ja-jp-trade"){url="/Trade/Customer/SavedItems.aspx/GetSavedItems";}$.ajax({url:url,type:"POST",data:'',dataType:"json",contentType:"application/json; charset=utf-8",success:function(data){if(data.d.ResponseObject){if(locale.toLowerCase()=="en-us-trade"||locale.toLowerCase()=="ja-jp-trade"){if(data.d.ResponseObject.EndecaGroups){$.each(data.d.ResponseObject.EndecaGroups,function(){$.each(this.Items,function(){items.push(this);});});}if(data.d.ResponseObject.OtherGroup){$.each(data.d.ResponseObject.OtherGroup.SubGroups,function(){$.each(this.Items,function(){items.push(this);});});}}else{items=data.d.ResponseObject.SavedItems;}var i=0;$.each(items,function(){var group=this.GroupSku;var selectedSku=this.SelectedSku;var pageSelectedSku=SELECTED_SKU;if(pageSelectedSku==""||pageSelectedSku!=selectedSku){pageSelectedSku=SELECTED_SKU_INVENTORY;}if(!group){group=this.Sku;}if(!selectedSku){selectedSku=this.Sku;}if(locale.toLowerCase()=="en-us-pkb"){var priceMarketID=((PKB_PRICMARKETID!="")?PKB_PRICMARKETID:0);var countryID=this.CountryID;if(group==SKU&&selectedSku==pageSelectedSku&&countryID==priceMarketID){SAVED_ID=this.ID;$("#ancSaveForLater").hide();$("#ancSaveRemove").show();i++;}}else{if(group==SKU&&selectedSku==pageSelectedSku){SAVED_ID=this.ID;$("#ancSaveForLater").hide();$("#ancSaveRemove").show();i++;}}});if(i==0){$("#ancSaveForLater").show();$("#ancSaveRemove").hide();}}else{$("#ancSaveForLater").show();$("#ancSaveRemove").hide();}},error:function(jqXHR,status,error){}});}function getAvailability(productString,productObject){$.ajax({url:"/Shopping/Item.aspx/GetProductRecommendations",type:"POST",data:productString,dataType:"json",contentType:"application/json; charset=utf-8",success:function(data){createRRDiv(data.d,productObject);},error:function(jqXHR,status,error){}});}function createRRDiv(finalizedItemArray,productObject){var rrDiv;var maxItemPerPage=3;if(productObject.placement_name.split(".")[1]=="rr3"||productObject.placement_name.split(".")[1]=="rr4"){maxItemPerPage=4;}$("#"+productObject.placement_name.split(".")[1]+" .rrItemCarousel").removeClass("touch-carousel").addClass("apply-touch-carousel");var productPlacement=$("#"+productObject.placement_name.split(".")[1]+" .rrItemCarousel .container");var tempDiv="<div class='rrItem'><a href='$itemURL$' data-itemURL='$itemURL$' data-rrAnalytics='$rrAnalytics$'><img src='$imageURL$'><div>$itemDesc$</div><div>$itemPrice$</div></a></div>";var newTempDiv="";var count=0;for(var i=0;i<finalizedItemArray.length;i++){if(finalizedItemArray[i]!=null){if(finalizedItemArray[i].isAvailable=="True"){if(count%maxItemPerPage==0){newTempDiv=newTempDiv+"<div>"+tempDiv;}else if(count%maxItemPerPage==maxItemPerPage-1){newTempDiv=newTempDiv+tempDiv+"</div>";}else{newTempDiv=newTempDiv+tempDiv;}var price=(finalizedItemArray[i].ShowPrice!="false")?finalizedItemArray[i].Price:"";newTempDiv=newTempDiv.split("$itemURL$").join(finalizedItemArray[i].FriendlyUrl+"?trackpdp=pr");newTempDiv=newTempDiv.replace("$imageURL$","//media.tiffany.com/is/image/Tiffany/EcomBrowseL/"+finalizedItemArray[i].ImgURL+".jpg");newTempDiv=newTempDiv.replace("$itemDesc$",finalizedItemArray[i].Name);newTempDiv=newTempDiv.replace("$itemPrice$",price);newTempDiv=newTempDiv.replace("$rrAnalytics$",productObject.items[i].link_url);count++;}}}for(var i=0;i<maxItemPerPage-((count-1)%maxItemPerPage)-1;i++){newTempDiv=newTempDiv+"<div class='rrItem'></div>";}productPlacement.html(newTempDiv);initTouchCarousel();$("#"+productObject.placement_name.split(".")[1]+" #rrTitle").text(productObject.strategy_message);if(count!=0){$("#"+productObject.placement_name.split(".")[1]).show();}if((productObject.placement_name.split(".")[1]=="rr2"||productObject.placement_name.split(".")[1]=="rr4")&&count>0){var topTile=2.15;if(productObject.placement_name.split(".")[1]=="rr4"){topTile=2;}if(!$("#tile4").length){$("#"+productObject.placement_name.split(".")[1]).attr("id","tile4");$("#tile1").after($("#tile4"));var productRecomendation={"Height":topTile,"Id":"tile4","Left":0,"SectionTitle":null,"Top":3,"Width":5
};$.each(ItemPageMarketingTilesJSON.tiles,function(){if(this.Width!=5){this.Top=this.Top+topTile;}});}else{$("#"+productObject.placement_name.split(".")[1]).attr("id","tile5");$("#tile4").after($("#tile5"));var productRecomendation={"Height":topTile,"Id":"tile5","Left":0,"SectionTitle":null,"Top":3,"Width":5
};$.each(ItemPageMarketingTilesJSON.tiles,function(){if(this.Width!=5||this.Id=="tile4"){this.Top=this.Top+topTile;}});}ItemPageMarketingTilesJSON.tiles.push(productRecomendation);layoutItemPageTiles();}}function preloadImages(containerId){var images=new Array();var imgcount=0;$("#"+containerId+" div > img").each(function(){if(!$(this).parent().parent().hasClass("text-container")){var src=$(this).attr("src");if(src!=""){src=$(this).attr("data-rollover-image");if(typeof(src)!="undefined"&&src!=null&&src!=""){images[imgcount]=new Image();images[imgcount].src=src;imgcount++;}}}});}function resizeOverlay(){}function updateLinkPosition(){if($(".item-desc").length&&$(".service-info div").length){$(".service-info > div").css('margin-top',0);var offsetTop=$(".item-desc").offset().top;var height=$(".item-desc").outerHeight();var linkOffset=$(".service-info > div").offset().top;if((offsetTop+height)>linkOffset){var marginTop=(offsetTop+height)-linkOffset;$(".service-info > div").css('margin-top',marginTop);}}}function createProductHTML(productData,size){var crop="";var sharpen="";var imageId=Math.round(Math.random()*1000000);if(typeof(productData.Crop)!="undefined"&&productData.Crop!=null&&productData.Crop!=""){crop=productData.Crop;}else{crop=templateStrings.defaultScene7Crop;}if(typeof(productData.Sharpen)!="undefined"&&productData.Sharpen!=null&&productData.Sharpen!=""){sharpen=productData.Sharpen;}var productHTML=templateStrings.productTemplate.split("$sku$").join(productData.Sku);if(typeof(size)=="undefined"||size==null||size==""||size.toLowerCase()=="small"){productHTML=productHTML.split("$img$").join(URLFactory.scene7ImageURL(productData.ImgURL,"$EcomBrowseM$",sharpen,""));productHTML=productHTML.split("$tooltipImage$").join(URLFactory.scene7ImageURL(productData.ImgURL,"$EcomBrowseM$",sharpen,crop));}else{productHTML=productHTML.split("$img$").join(URLFactory.scene7ImageURL(productData.ImgURL,"$EcomBrowseL$",sharpen,""));productHTML=productHTML.split("$tooltipImage$").join(URLFactory.scene7ImageURL(productData.ImgURL,"$EcomBrowseL$",sharpen,crop));}productHTML=productHTML.split("$alt$").join(productData.Name).split("$imageId$").join(imageId);return productHTML;}function populateProductGridSimiliarItems(containerId,products){var count=0;var maincontainer=$("#"+containerId+" .container");var currentGridContainer=$('<div class="grid-container browse-grid"></div>');var currentCol="";var htmlstring='';var n=products.Items.length;for(var i=0;i<n;i++){if(i>0&&i%10==0){htmlstring+='</div>';}if(i%10==0){htmlstring+='<div class="grid-container browse-grid">';}if(i%5==0){htmlstring+='<div class="col1 no-margin">';}else{htmlstring+='<div class="col1">';}htmlstring+=createProductHTML(products.Items[i]);htmlstring+='</div>';count++;}if((n==0||n%10)>0){for(var i=0;i<(10-(products.Items.length%10));i++){if(count%5==0){htmlstring+='<div class="col1 no-margin">';}else{htmlstring+='<div class="col1">';}htmlstring+='<div class="empty"></div></div>';count++;}}if(!endsWith(htmlstring,"</div></div>")){if(endsWith(htmlstring,"</div>")){htmlstring+="</div>";}else{htmlstring+="</div></div>";}}maincontainer.html(htmlstring);$("#"+containerId+" .grid-container:first img, #"+containerId+" .grid-container:nth-child(2) img, #"+containerId+" .grid-container:nth-child(3) img").each(function(){$(this).attr("src",$(this).attr("data-src"));});preloadImages(containerId);initTouchpager("#"+containerId);$(".empty").each(function(){$(this).height($(this).width());});var imgcount;var images=$("#"+containerId+" img").length;$("#"+containerId+" .current img").load(function(){imgcount++;if(imgcount=images){resizeTouchPager("#"+containerId);}});}function populateProductGrid(containerId,products){var count=0;var maincontainer=$("#"+containerId+" .container");var currentGridContainer=$('<div class="grid-container browse-grid"></div>');var currentCol="";var htmlstring='';var n=products.Items.length;for(var i=0;i<n;i++){if(i>0&&i%5==0){htmlstring+='</div>';}if(i%5==0){htmlstring+='<div class="grid-container browse-grid"><div class="col1 no-margin">';}else{htmlstring+='<div class="col1">';}htmlstring+=createProductHTML(products.Items[i]);htmlstring+='</div>';count++;}if((n==0||n%5)>0){for(var i=0;i<(5-(products.Items.length%5));i++){if(count%5==0){htmlstring+='<div class="col1 no-margin">';}else{htmlstring+='<div class="col1">';}htmlstring+='<div class="empty"></div></div>';count++;}}if(!endsWith(htmlstring,"</div></div>")){if(endsWith(htmlstring,"</div>")){htmlstring+="</div>";}else{htmlstring+="</div></div>";}}maincontainer.html(htmlstring);$("#"+containerId+" .grid-container:first img, #"+containerId+" .grid-container:nth-child(2) img, #"+containerId+" .grid-container:nth-child(3) img").each(function(){$(this).attr("src",$(this).attr("data-src")+"&trackpdp=rv");});preloadImages(containerId);initTouchpager("#"+containerId);$(".empty").each(function(){$(this).height($(this).width());});var imgcount;var images=$("#"+containerId+" img").length;$("#"+containerId+" .current img").load(function(){imgcount++;if(imgcount=images){resizeTouchPager("#"+containerId);}});if(n==0)$("#"+containerId).parent().hide();}function endsWith(str,suffix){return str.indexOf(suffix,str.length-suffix.length)!==-1;}function getRecentlyViewedItems(){model=StateModel.getInstance();$(".item-extras .loader").show();$.ajax({url:"/shopping/item.aspx/GetAllRecentlyViewedItems",type:"POST",data:'',dataType:"json",contentType:"application/json; charset=utf-8",success:function(data){if(data.d.ResponseObject!=null){for(i=0,n=data.d.ResponseObject.Items.length;i<n;i++){model.pCachedProducts.lookup[data.d.ResponseObject.Items[i].Sku]=data.d.ResponseObject.Items[i];}$(".item-extras .loader").hide();populateProductGrid("extras-recent",data.d.ResponseObject);getSavedItemsList();}},error:function(jqXHR,status,error){if(locale.toLowerCase()=="en-us-trade"||locale.toLowerCase()=="ja-jp-trade"){handleGTradeSessionTimeout(jqXHR);}}});}function clearAllItems(){$.ajax({url:"/shopping/item.aspx/ClearAllRecentlyViewedItems",type:"POST",data:'',dataType:"json",contentType:"application/json; charset=utf-8",success:function(data){if($("body").hasClass("en-US-Stmt")){$("#recentlyViews").hide();$(".extras-recently-viewed-link").hide();}else{$("#recentlyViews").fadeOut();}$("#idItemExtrasDiv .clearAllItems").hide();$("#idItemExtrasDiv .backSlashDivider").hide();},error:function(jqXHR,status,error){}});}function getAdditionalItems(){model=StateModel.getInstance();var i,n;var query=window.location.search.split("?").join("");var cidParam=URLFactory.extractQueryStringValue(query,"cid");var searchParams=URLFactory.extractQueryStringValue(query,"search_params");var dataString='{"searchQueryString" : "'+searchParams+'","isSearchMode" : '+(URLFactory.extractQueryStringValue(query,"search")==1?true:false);var url="/shopping/item.aspx/GetItemsXmlBySearchQS?"+query;if(typeof locale!="undefined"&&locale=="en-US-PKB"){url="/shopping/item.aspx/GetItemsXmlBySearchQSPMId";dataString+=', "priceMarketID": '+((PKB_PRICMARKETID!="")?PKB_PRICMARKETID:0);}dataString+='}';$(".item-extras .loader").show();$("#extras-additional .container").css("left","0%");$.ajax({url:url,type:"POST",data:dataString,dataType:"json",contentType:"application/json; charset=utf-8",success:function(data){if(data.d.ResponseObject!=null){if(data.d.ResponseObject.Items.length==0&&typeof isStatementExternalMode!="undefined"&&isStatementExternalMode=="True"){$("#maincontent > .item-extras").hide();}else{for(i=0,n=data.d.ResponseObject.Items.length;i<n;i++){model.pCachedProducts.lookup[data.d.ResponseObject.Items[i].Sku]=data.d.ResponseObject.Items[i];}$(".item-extras .loader").hide();if(!$("body").is('[class*="EStr"]')){$("#extras-additional").show();}populateProductGridSimiliarItems("extras-additional",data.d.ResponseObject);}}},error:function(jqXHR,status,error){if(locale.toLowerCase()=="en-us-trade"||locale.toLowerCase()=="ja-jp-trade"){handleGTradeSessionTimeout(jqXHR);}}});}function getSimilarItems(){var model=StateModel.getInstance();var tempSku=SKU;if(GROUP_TYPE.toLowerCase()!="individual"&&SELECTED_SKU!=""&&SELECTED_SKU!=null){tempSku=SELECTED_SKU;}$(".item-extras .loader").show();$.ajax({url:"/shopping/item.aspx/GetSimilarItemsJSON",type:"POST",data:'{"sku" : "'+tempSku+'","currentPage" : "1","recsPerPage":100, "priceMarketID": '+((PKB_PRICMARKETID!="")?PKB_PRICMARKETID:0)+' }',dataType:"json",contentType:"application/json; charset=utf-8",success:function(data){if(data.d.ResponseObject!=null){for(i=0,n=data.d.ResponseObject.Items.length;i<n;i++){model.pCachedProducts.lookup[data.d.ResponseObject.Items[i].Sku]=data.d.ResponseObject.Items[i];}$(".item-extras .loader").hide();$("#similarItems").show();populateProductGridSimiliarItems("extras-similar",data.d.ResponseObject);}},error:function(jqXHR,status,error){if(locale.toLowerCase()=="en-us-trade"||locale.toLowerCase()=="ja-jp-trade"){handleGTradeSessionTimeout(jqXHR);}}});}function renderImageViewerControl(type,imageName,imageUrl,altText){var controlHTML="";var tmpToExtractImageID;var imageId;var splitBaseURL=templateStrings.baseScene7ImageURL.split("/");var baseImageDirectory=splitBaseURL[splitBaseURL.length-2];var baseViewerURL='/Shopping/ZoomViewer.html?v=7&asset='+baseImageDirectory+'/$imageName$&baseServerUrl='+templateStrings.baseScene7Server+'/is/image&baseImageUrl='+templateStrings.baseScene7ImageURL;var baseImageURL='';if(imageName.indexOf("-")==-1){imageId=imageName;}else{tmpToExtractImageID=imageName.split("-");imageId=tmpToExtractImageID[tmpToExtractImageID.length-1];}var viewerURL=baseViewerURL.split("$imageName$").join(imageId);switch(type.toLowerCase()){case"seeiton":controlHTML='<div id="control_'+imageName+'" data-rendered="false" class="disabled-image"><img alt="'+altText+'" src="'+URLFactory.scene7ImageURL(imageName,"$EcomItemXL$","&op_usm=0.0,50,0,0&fmt=jpeg&qlt=50","")+'" style="max-height:inherit;height:100%;" /></div>';break;case"image":controlHTML='<div id="control_'+imageName+'" data-rendered="false"><iframe id="viewer-large" src="'+viewerURL+'" alt="'+altText+'" frameborder="0"  scrolling="no" width="100%" height="100%" ></iframe></div>';break;case"video":controlHTML='<div id="control_'+imageName+'" data-rendered="false" class="video-holder"></div>';break;case"module":controlHTML='<div id="control_'+imageName+'" data-rendered="false"><img id="overlay-large" alt="" src="" /></div>';break;}return controlHTML;}function renderImageViewer(imageData){var videos=[];var seeItOn=[];var products=[];var i,n;var currentImage;var viewMoreLinks=[];var thumbnailHTML="";var controlHTML="";var imagePaths=[];var viewerHTML="";var thumb360="";var seeItOnSharpenValue="0.0,50,0,0";if(typeof(imageData)=="undefined"||typeof(imageData.Images)=="undefined"||imageData.Images.length==0){var noImg="<img src="+URLFactory.scene7ImageURL("noimage","$EcomItemL2$","","")+">";$("#s7viewerInlineZoom").addClass("no-image").append(noImg);return;};for(i=0,n=imageData.Images.length;i<n;i++){currentImage=imageData.Images[i];switch(currentImage.Type.toLowerCase()){case"skustraighton":case"skualternateview":products.push(currentImage);break;case"skuseeitonview":seeItOn.push(currentImage);break;case"video":case"videoposterframe":case"videothumbnailposterframe":videos.push(currentImage);break;}}if(n>0){if(products.length>0){viewMoreLinks.push('<a class="item-more l6" href="#">'+templateStrings.moreViewsLabel+'</a>');for(i=0,n=products.length;i<n;i++){if(i==0){altText=LABEL_SHARE_SHORTDESC;}else{altText=LABEL_SHARE_SHORTDESC+"_alternative-view-"+i;}thumbnailHTML+='<img src="'+URLFactory.scene7ImageURL(products[i].BaseImg,"$EcomItemS$",products[i].ThumbnailPresetSharpenValue,"")+'" alt="'+altText+'" data-src="'+URLFactory.scene7ImageURL(products[i].BaseImg,"$EcomItemL2$",products[i].LargePresetSharpenValue,"")+'" data-src-full="'+URLFactory.scene7ImageURL(products[i].BaseImg,"$EcomItemXL$",products[i].FullScreenPresetSharpenValue,"")+'" data-module-src="'+products[i].ModuleUrl+'" data-base-img="'+products[i].BaseImg+'" data-type="image" data-image-type="moreViews" />';imagePaths.push(URLFactory.scene7ImageURL(products[i].BaseImg,"$EcomItemS$",products[i].ThumbnailPresetSharpenValue,""));imagePaths.push(URLFactory.scene7ImageURL(products[i].BaseImg,"$EcomItemL2$",products[i].LargePresetSharpenValue,""));imagePaths.push(URLFactory.scene7ImageURL(products[i].BaseImg,"$EcomItemXL$",products[i].FullScreenPresetSharpenValue,""));controlHTML+=renderImageViewerControl("image",products[i].BaseImg,URLFactory.scene7ImageURL(products[i].BaseImg,"$EcomItemXL$","",""),altText);if(thumb360==""){thumb360='<img style="opacity: 0.5; filter: alpha(opacity=50);" src="'+URLFactory.scene7ImageURL(products[i].BaseImg,"$EcomItemS$",products[i].ThumbnailPresetSharpenValue,"")+'" alt="'+altText+'">';}}$("#more-large").attr("src",URLFactory.scene7ImageURL(products[0].BaseImg,"$EcomItemL2$","","")).attr("alt",products[0].AltText);}if(seeItOn.length>0){viewMoreLinks.push('<a class="item-on l6" href="#">'+templateStrings.seeItOnLabel+'</a>');for(i=0,n=seeItOn.length;i<n;i++){if(i==0){altText=LABEL_SHARE_SHORTDESC+"_model-shot-"+(i+1);}else{altText=LABEL_SHARE_SHORTDESC+"_model-shot-"+(i+1);}thumbnailHTML+='<img src="'+URLFactory.scene7ImageURL(seeItOn[i].BaseImg,"$EcomItemS$",seeItOn[i].ThumbnailPresetSharpenValue,"")+'$" alt="'+altText+'" data-src="'+URLFactory.scene7ImageURL(seeItOn[i].BaseImg,"$EcomItemL2$",seeItOnSharpenValue,"")+'" data-src-full="'+URLFactory.scene7ImageURL(seeItOn[i].BaseImg,"$EcomItemXL$",seeItOnSharpenValue,"")+'" data-module-src="'+seeItOn[i].ModuleUrl+'" data-base-img="'+seeItOn[i].BaseImg+'" data-type="image" data-image-type="seeItOn" />';imagePaths.push(URLFactory.scene7ImageURL(seeItOn[i].BaseImg,"$EcomItemS$",seeItOn[i].ThumbnailPresetSharpenValue,""));imagePaths.push(URLFactory.scene7ImageURL(seeItOn[i].BaseImg,"$EcomItemL2$",seeItOnSharpenValue,""));imagePaths.push(URLFactory.scene7ImageURL(seeItOn[i].BaseImg,"$EcomItemXL$",seeItOnSharpenValue,""));controlHTML+=renderImageViewerControl("seeiton",seeItOn[i].BaseImg,URLFactory.scene7ImageURL(seeItOn[i].BaseImg,"$EcomItemXL$","",""),altText);if(thumb360==""){thumb360='<img style="opacity: 0.5; filter: alpha(opacity=50);" src="'+URLFactory.scene7ImageURL(products[i].BaseImg,"$EcomItemS$",products[i].ThumbnailPresetSharpenValue,"")+'" alt="'+altText+'">';}}}if(videos.length>0){viewMoreLinks.push('<a class="item-video l6" href="#">'+templateStrings.videoLabel+'</a>');for(i=0,n=videos.length;i<n;i++){thumbnailHTML+='<img src="'+URLFactory.scene7ImageURL(videos[i].ThumbnailUrl,"$EcomItemS$",videos[i].ThumbnailPresetSharpenValue,"")+'" alt="" data-src="'+URLFactory.scene7ImageURL(videos[i].BaseImg,"$EcomItemL2$",videos[i].LargePresetSharpenValue,"")+'" data-src-full="'+URLFactory.scene7ImageURL(videos[i].BaseImg,"$EcomItemXL$",videos[i].FullScreenPresetSharpenValue,"")+'" data-module-src="'+videos[i].ModuleUrl+'" data-base-img="'+videos[i].BaseImg+'" data-type="video" />';imagePaths.push(URLFactory.scene7ImageURL(videos[i].ThumbnailUrl,"$EcomItemS$",videos[i].ThumbnailPresetSharpenValue,""));imagePaths.push(URLFactory.scene7ImageURL(videos[i].BaseImg,"$EcomItemL2$",videos[i].LargePresetSharpenValue,""));imagePaths.push(URLFactory.scene7ImageURL(videos[i].BaseImg,"$EcomItemXL$",videos[i].FullScreenPresetSharpenValue,""));controlHTML+=renderImageViewerControl("video",videos[i].BaseImg,URLFactory.scene7ImageURL(videos[i].BaseImg,"$EcomItemXL$","",""),"");}}$(".thumbs div").html(thumbnailHTML);$(".image-overlay .large-image").prepend(controlHTML);BrowserUtils.preloadImages(imagePaths);if(imageData.Images.length<1){$(".thumbs").html("").hide();$("#more-views-links").html("");}else if(imageData.Images.length==1&&!IS_SPINSET_AVAILABLE){$(".thumbs").html("").hide();$("#more-views-links").html("");}}else{$(".thumbs").html("").hide();$("#more-views-links").html("");}var hash=window.location.hash.split("#").join("");if(hash==""){hash=URLFactory.convertStateToHash(StateModel.getInstance().getStateSnapshot());}setStateFromHistory(URLFactory.extractValue(hash,"flash"));HistoryManager.getInstance().overrideBaseState(hash);if(IS_SPINSET_AVAILABLE){$(".more-images .thumbs div").append('<div class="jq-spinset-thumb spinset-thumb" style="position: relative;">'+thumb360+'<i style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);" class="icon-font" aria-hidden="true">360_circle</i></div>');var label360alt=LABEL_SHARE_SHORTDESC+"__360-product-view";$(".spinset-thumb i").attr("alt",label360alt);}}function setImageViewerState(stateObj,suppressHistory){var model=StateModel.getInstance();var srcLarge="";var srcModule="";var $selectedThumb;var thumbIndex;var previousThumbIndex;var $selectedDiv;var srcAltText="";suppressHistory=(typeof(suppressHistory)=="undefined")?false:suppressHistory;if(typeof(stateObj.selectedImage)!="undefined"&&stateObj.selectedImage!=null){previousThumbIndex=$(".more-images .thumbs img.active").index()+1;thumbIndex=stateObj.selectedImage;if(thumbIndex==null){thumbIndex=previousThumbIndex;}$selectedThumb=$(".more-images .thumbs img").eq(thumbIndex-1);if($selectedThumb.length==0){$selectedThumb=$(".more-images .thumbs img").eq(0);thumbIndex=stateObj.selectedImage=1;}if(thumbIndex!=previousThumbIndex||previousThumbIndex==0){if(stateObj.selectedImage<=0){stateObj.selectedImage=1;}$selectedThumb=$(".more-images .thumbs img:nth-child("+thumbIndex+")");srcLarge=$selectedThumb.attr("data-src");srcModule=$selectedThumb.attr("data-module-src");srcAltText=$selectedThumb.attr("alt");$(".thumbs img").removeClass("active");$(".image-overlay .thumbs img:nth-child("+thumbIndex+")").addClass("active");$(".more-images .thumbs img:nth-child("+thumbIndex+")").addClass("active");if(previousThumbIndex>0){$(".image-overlay .large-image div:nth-child("+previousThumbIndex+")").fadeOut(250,function(){$selectedDiv=$(".image-overlay .large-image div:nth-child("+thumbIndex+")");$selectedDiv.fadeIn(250);if($selectedDiv.attr("data-rendered")=="false"){$selectedDiv.html($selectedDiv.html());$selectedDiv.attr("data-rendered","true");}});$("#more-large").removeClass("visible");}else{$(".image-overlay .large-image div:nth-child("+thumbIndex+")").fadeIn(250);}$(".s7staticimage img").attr("alt",srcAltText);setTimeout(function(){$("#more-large").attr("src",srcLarge).attr("alt",srcAltText);},250);$("#overlay-module").html("");}else{$(".image-overlay .thumbs img").removeClass("active");$(".image-overlay .thumbs img:nth-child("+thumbIndex+")").addClass("active");$(".image-overlay .large-image div:nth-child("+thumbIndex+")").fadeIn(250);}}if(typeof(stateObj.showFullScreen)!="undefined"&&stateObj.showFullScreen!=null){if(stateObj.showFullScreen==true){if($(".image-overlay").css("display")=="none"){resizeOverlay();$(".image-overlay .large-image div").hide();selectedDiv=$(".image-overlay .large-image div:nth-child("+stateObj.selectedImage+")");selectedDiv.show();selectedDiv.html(selectedDiv.html());if(!$("body").hasClass("ie-7")){$(".image-overlay").fadeIn(250);if($("body").hasClass("ie-8")){$("#gray-overlay").show();}else{$("#gray-overlay").fadeIn(250);}}$("#overlay-large").stop();if(suppressHistory==false){setImageViewerHistory();}}}else{if($(".image-overlay").css("display")!="none"){$(".image-overlay").hide();$("#gray-overlay").hide();if(suppressHistory==false){setImageViewerHistory();}}$("#overlay-module").html("");}}$selectedThumb=$(".image-overlay .thumbs img.active");if($(".image-overlay").css("display")=="block"&&$selectedThumb.attr("data-type")=="video"){handleShowVideo("control_"+$selectedThumb.attr("data-base-img"),$selectedThumb.attr("data-module-src"));}else if($(".video-holder video").length>0){$(".video-holder .video").children().filter("video").each(function(){this.pause();delete(this);$(this).remove();});$(".video-holder video").empty();}}function setImageViewerHistory(){var fullScreen=false;var selectedIndex="1";var hash=window.location.hash.split("#").join("");if(hash==""){hash=URLFactory.convertStateToHash(StateModel.getInstance().getStateSnapshot());}selectedIndex=$(".more-images .thumbs .active").index()+1;if($(".image-overlay").css("display")!="none"){fullScreen=true;}hash=URLFactory.updateHash(hash,"flash",fullScreen+"+"+selectedIndex);window.location.hash=hash;HistoryManager.getInstance().addHistoryItem(hash);}function setStateFromHistory(stateHash){var splitState=stateHash.split("+");var selectedImage=1;var showFullScreen=false;var previousThumbIndex=$(".more-images .thumbs img.active").index()+1;if(stateHash==""){if(previousThumbIndex==0){selectedImage=1;}else{selectedImage=previousThumbIndex;}}if(splitState!=null&&splitState.length==2){if((splitState[0].toLowerCase()=="true"||splitState[0].toLowerCase()=="false")&&isNaN(Number(splitState[1]))==false){selectedImage=Number(splitState[1]);showFullScreen=(splitState[0].toLowerCase()=="true")?true:false;}}setImageViewerState({selectedImage:selectedImage,showFullScreen:showFullScreen},true);}$(window).load(function(){var lineoffset=$(".item-extras").offset().top;$(".image-overlay").css("height",lineoffset);positionDiscoverLink();});$(window).scroll(function(){positionDiscoverLink();});$(window).resize(function(){resizeOverlay();layoutItemPageTiles();if($(".item-extras").length>1){var lineoffset=$(".item-extras").offset().top;$(".image-overlay").css("height",lineoffset);}positionDiscoverLink();});function layoutItemPageTiles(){calculateGrid();var maxHeight=0;if(typeof ItemPageMarketingTilesJSON!="undefined"){$.each(ItemPageMarketingTilesJSON.tiles,function(){$('#'+this.Id).css('width',gridSize(this.Width,gridUnit,gridGutter)+'px');var tileHeight=($('#'+this.Id).attr('data-height'))?$('#'+this.Id).attr('data-height'):this.Height;$('#'+this.Id).css('height',gridSize(tileHeight,gridUnit,gridGutter)+'px');$('#'+this.Id).css('top',gridPos(this.Top,gridUnit,gridGutter)+'px');$('#'+this.Id).css('left',gridPos(this.Left,gridUnit,gridGutter)+'px');$('#'+this.Id).addClass('col'+this.Width);if(this.Top+tileHeight>maxHeight){maxHeight=this.Top+tileHeight;}});}$('.flexible-height').css('height',(maxHeight*(gridUnit+gridGutter))+'px');centerTileText();$('.flexible-height').fadeIn();}function handlePKBSearch(){var searchText=$.trim($("#pkbSkuSearch").val(),'');$("#pkbSearchError").html("");if(compassConnectionSource!=null){sendSearchToCompass(searchText);}else if(searchText.length==8&&searchText.match(/^\d+$/)){$.ajax({url:"/Shopping/Item.aspx/GetSKUSearchResult",type:"POST",data:'{"sku":"'+searchText+'"}',contentType:"application/json; charset=utf-8",success:function(data){var response=data.d.ResponseObject;var successStatus=response.Found;var sku=response.Sku;var errorMessage=response.ErrorMessage;var oldURL;var query;if(successStatus!=null&&successStatus.toLowerCase()=="false"){if(errorMessage!=""&&errorMessage!=null){$("#pkbSearchError").html(errorMessage);}}else if(successStatus!=null&&successStatus.toLowerCase()=="true"){$("#pkbSearchError").html("");if(sku!=""&&sku!=null){var queryString="";var TotalNumOfProduct;var resultSKU="";var hashtemplate=readCookie("pkbitmpgSearchHash");if(hashtemplate!=null&&hashtemplate!=""){queryString=hashtemplate.split("$").join(searchText);}else{queryString="t+"+searchText;}$.ajax({url:"/Shopping/PKBSearch.aspx/GetProductsJSONBySearchQS",type:"POST",data:'{"searchQueryString":"'+queryString+'", "keyword":"'+searchText+'"}',contentType:"application/json; charset=utf-8",success:function(data){if(data){TotalNumOfProduct=(data.d.NumofRecords==null)?0:data.d.NumofRecords;var endecaErrorMessage=data.d.ErrorMessage;if(TotalNumOfProduct>1){document.location.href="/Shopping/PKBSearch.aspx#"+queryString;}else if(TotalNumOfProduct==0){if(endecaErrorMessage!=""&&endecaErrorMessage!=null){$("#pkbSearchError").html(endecaErrorMessage);}}else{$("#pkbSearchError").html("");if(TotalNumOfProduct=="1"){resultSKU=data.d.Items[0].Sku;}oldURL=document.location.href;query=oldURL.split("?")[1].split("#")[0];if(searchText!=""){if(resultSKU.toLowerCase().indexOf("grp")==0&&resultSKU.split(" ").join("").length==8){if(resultSKU!=""&&resultSKU!="undefined"){query=URLFactory.updateQuery(query,"sku",resultSKU);var selectedSKU=URLFactory.extractQueryStringValue(query,"selectedsku");query=URLFactory.updateQuery(query,"selectedsku",searchText);}}else{query=URLFactory.updateQuery(query,"sku",searchText);}}document.location.href="/Shopping/Item.aspx?"+query;}}}});}}}});}else if(searchText.length>0&&searchText!=''){var hashtemplate=readCookie("pkbitmpgSearchHash");if(hashtemplate!=null&&hashtemplate!=""){queryString=hashtemplate.split("$").join(searchText);}else{queryString="t+"+searchText;}window.location="/Shopping/PKBSearch.aspx#"+queryString;}}function itemPageAddToSaved(){var primarySku=SKU;var selectedSku=SELECTED_SKU;var query=window.location.search.split("?").join("");var mcat=MASTER_CATEGORY_ID;var cid=CATEGORY_ID;var productData=StateModel.getInstance().getProduct(primarySku);var url="";var data="";var qty=1;var qtyArray=[];var message="This item has been added to your wish list.";var links="";var priceMarket="1";var skuQtyArray=$("#skuGroups input").map(function(){return $(this).val();}).get();var skuQuantityArr=[];var trackingSku;if(SKU_ARRAY==null||SKU_ARRAY.length==1){if(selectedSku==""){trackingSku=primarySku;}else{trackingSku=primarySku+":"+selectedSku;}if(skuQtyArray.length==1){qty=skuQtyArray[0];}if(locale.toLowerCase()=="en-us-pkb"){url='/Default.aspx/AddPKBSavedItem';data='{"sku":"'+primarySku+'", "selectedSku":"'+selectedSku+'", "cid":'+cid+', "mcid":'+mcat+', "qty":"'+qty+'", "priceMarketID":"'+PKB_PRICMARKETID+'"}';}else{url='/Default.aspx/AddSavedItem';data='{"sku":"'+primarySku+'", "selectedSku":"'+selectedSku+'", "cid":'+cid+', "mcid":'+mcat+', "qty":"'+qty+'"}';}}else if(SKU_ARRAY.length>1){trackingSku=primarySku+":"+selectedSku;url='/Default.aspx/AddMultipleSavedItems';data='{"sku":"'+primarySku+'", "selectedSku":"'+selectedSku+'", "strSkuList":"'+SKU_ARRAY.join(":")+'", "cid":'+cid+', "mcid":'+mcat+', "qtyList":"'+skuQtyArray.join(":")+'"}';}if(true){$.ajax({url:url,type:'POST',cache:false,data:data,dataType:"json",contentType:"application/json; charset=utf-8",success:function(data){if(typeof(data.d.SuccessFlag)=="undefined"||data.d.SuccessFlag==false||data.d.SuccessFlag=="False"){var errorMsg=null;try{eval("errorMsg = "+data.d.SKUStatus[0].StatusMessage+";");}catch(err){}try{eval("errorMsg = "+data.d.SKUStatus[1].StatusMessage+";");}catch(err){}if(!errorMsg){errorMsg=data.d.SKUStatus[0].StatusMessage;}$("#ajaxError").html(errorMsg);}else{$("#ajaxError").html("");CookieManager.setCookieValue("saveditemscnt",data.d.BagCount);newlyAddedItemsArr=[];for(var i=0;i<data.d.SKUStatus.length;i++){var bagId=data.d.SKUStatus[i].ItemID;newlyAddedItemsArr[i]=bagId;}$("#saved-content").removeClass("sb rings").addClass("saved");InlineShoppingBagManager.getInstance().updateSavedItemsLabel();InlineShoppingBagManager.getInstance().updateInlineCustomerSelections(data.d.SKUStatus,data.d.Image);var query=window.location.search.split("?").join("");var itemGridPosition;if(query!=""||typeof query!="undefined"){itemGridPosition=URLFactory.extractQueryStringValue(query,"trackgridpos");}else{itemGridPosition="";}getSavedItems();TrackActionAddToSavedItems("Item Page","Add to SavedItems",trackingSku,data.d.DataLayer,itemGridPosition);}},error:function(jqXHR,textStatus,errorThrown){if(locale.toLowerCase()=="en-us-trade"||locale.toLowerCase()=="ja-jp-trade"){handleGTradeSessionTimeout(jqXHR);}}});}centerGridText();}function validateAddWithServicing(linkEngravingParams){var sku='';var selectedSku='';var groupType='';var parentGroupSku='';var quantity="1";var categoryId=0;var masterCategoryId=0;var paperCatalogueId=0;var paperCatalogueItemId=0;var origin=1;var url;var n;var paramsArray=linkEngravingParams.split("&");var tempParam;for(var i=0,n=paramsArray.length;i<n;i++){tempParam=paramsArray[i].split("=");if(tempParam.length>1){switch(tempParam[0].toLowerCase()){case"grouptype":groupType=tempParam[1];break;case"cid":categoryId=Number(tempParam[1]);break;case"mcid":masterCategoryId=Number(tempParam[1]);break;case"origin":origin=Number(tempParam[1]);break;case"sku":sku=tempParam[1];break;case"selectedsku":selectedSku=tempParam[1];break;case"quantity":quantity=tempParam[1].split(",").join(";");break;}}}if(groupType.toLowerCase()=="type2"){parentGroupSku=sku;url="/Shopping/Item.aspx/ValidateShoppingBagMultipleItemsWithServicing";data='{"strSku":"'+sku+'", "selectedSku":"'+selectedSku+'", "strSkuAndQuantity":"'+quantity+'", "cid":'+categoryId+', "mcid":'+masterCategoryId+', "origin":'+origin+', "cat_id":"", "cat_item_id":"", "p_cat_id":"", "p_cat_item_id":""}';for(var skuCnt=0;skuCnt<SKU_ARRAY.length;skuCnt++){var currView=document.getElementById("errMsg"+skuCnt);if(currView){currView.innerHtml="";currView.parentNode.removeChild(currView);}}}else{url="/Shopping/Item.aspx/ValidateShoppingBagItemWithServicing";data='{"sku":"'+sku+'", "selectedSku":"'+selectedSku+'", "quantity":"'+quantity+'", "cid":'+categoryId+', "mcid":'+masterCategoryId+', "origin":'+origin+', "cat_id":"", "cat_item_id":"", "p_cat_id":"", "p_cat_item_id":""}';}var errorDiv=document.getElementById("ajaxError");if(errorDiv){errorDiv.innerHTML="";}var nonAjaxErrorDiv=document.getElementById("divError");if(nonAjaxErrorDiv){nonAjaxErrorDiv.innerHTML="";nonAjaxErrorDiv.style.display="none";}$.ajax({url:url,type:"POST",contentType:"application/json; charset=utf-8",data:data,success:function(data){var resultObj={};resultObj.skuArray=new Array();var skuNodeArray=data.d.SKUStatus;for(var snCnt=0;snCnt<skuNodeArray.length;snCnt++){var currSkuNode=skuNodeArray[snCnt];var currSkuObj={};currSkuObj.id=currSkuNode.ItemID;currSkuObj.sku=currSkuNode.SKU;currSkuObj.status=currSkuNode.StatusMessage;resultObj.skuArray.push(currSkuObj);}resultObj.resStatus=skuNodeArray[0].StatusMessage;if(data.d.SuccessFlag.toLowerCase()=="true"){var query=window.location.search.split("?").join("");var itemPos;var itemTrackTileInfo;if(query!=""||typeof query!="undefined"){itemPos=URLFactory.extractQueryStringValue(query,"trackgridpos");}else{itemPos="";}if(query!=""||typeof query!="undefined"){itemTrackTileInfo=URLFactory.extractQueryStringValue(query,"tracktile");}else{itemTrackTileInfo="";}var props={link:$(this),source:'/Shopping/CustomizationOverlay.aspx?'+linkEngravingParams+"&isPDP=1&source=pdp&trackgridpos="+itemPos+"&tracktile="+itemTrackTileInfo,type:"ajax",size:"large"
};openModalOverlay(props);}else if(data.d.StatusMessage=="ERROR_HTTP_500"){window.location="/common/errors/500.aspx";}else{handleAddFault(resultObj.skuArray);}},error:function(jqXHR,status,error){window.location="/common/errors/500.aspx";}});}function handleAddFault(argResult){var msg;if(typeof(argResult)=="string"){msg=argResult;}else{for(var skuCnt=0;skuCnt<argResult.length;skuCnt++){var currSku=argResult[skuCnt];msg="";var currMsg=null;try{eval("currMsg = "+currSku.status+";");}catch(err){}if(currMsg){msg+=currMsg;}else{msg+=currSku.status;}currSku.errorString=msg;}}var errorDiv=document.getElementById("ajaxError");if(errorDiv){errorDiv.innerHtml="";var nonAjaxErrorDiv=document.getElementById("divError");if(nonAjaxErrorDiv){nonAjaxErrorDiv.innerHTML="";nonAjaxErrorDiv.style.display="none";}if(typeof(argResult)!="String"&&argResult.length>1){for(var skuACnt=0;skuACnt<SKU_ARRAY.length;skuACnt++){var currASku=SKU_ARRAY[skuACnt];var skuMsg;for(var innerCnt=0;innerCnt<argResult.length;innerCnt++){if(currASku==argResult[innerCnt].id||currASku==argResult[innerCnt].sku){skuMsg=argResult[innerCnt].errorString;break;}}var currView=document.getElementById("errMsg"+skuACnt);if(skuMsg!="PENDING"){if(!currView){var currView=document.createElement("div");currView.id="errMsg"+skuACnt;currView.className="error-text";var prevSibling=document.getElementById("ctlSkuGroupType2_rptItemList_ctl0"+skuACnt+"_divGrpData");if(!prevSibling){if(locale.toLowerCase()=="en-us-trade"||locale.toLowerCase()=="ja-jp-trade"){prevSibling=document.getElementById("ctlSkuGroupType2_rptItemList_ctl0"+skuACnt+"_txtQuantity").parentNode.parentNode;}else{prevSibling=document.getElementById("ctlSkuGroupType2_rptItemList_ctl0"+skuACnt+"_ddlQuantity").parentNode.parentNode;}}var msgParent=prevSibling.parentNode;msgParent.insertBefore(currView,prevSibling.nextSibling);}currView.innerHTML=skuMsg;}else{if(currView){currView.innerHTML="";currView.parentNode.removeChild(currView);}}}}else{errorDiv.innerHTML=msg;}}var addMessageDiv=document.getElementById("addMessage");if(addMessageDiv){addMessageDiv.innerHTML="";addMessageDiv.style.display="none";}}function itemPageAddToCart(){var primarySku=SKU;var selectedSku=SELECTED_SKU;var query=window.location.search.split("?").join("");var mcat=MASTER_CATEGORY_ID;var cid=CATEGORY_ID;var productData=StateModel.getInstance().getProduct(primarySku);var url="";var data="";var qty=0;var message="This item has been added to your shopping bag.";var links="";var skuQtyArray;if(locale.toLowerCase()=="en-us-trade"||locale.toLowerCase()=="ja-jp-trade"){skuQtyArray=$("#skuGroups input[type='tel']").map(function(){return $(this).val();}).get();}else{skuQtyArray=$("#skuGroups select.quantityDropdown").map(function(){return $(this).val();}).get();}var skuQuantityArr=[];var origin=(typeof ORDER_ORIGINATION!=undefined)?ORDER_ORIGINATION:1;clearTimeout(this.addToBagTimeout);this.addToBagTimeout=null;if(skuQtyArray.length==1){url='/Default.aspx/AddShoppingBagItem';data='{"sku":"'+primarySku+'", "quantity":"'+skuQtyArray[0]+'", "selectedSku":"'+selectedSku+'", "strSkuAndQuantity":"'+primarySku+':'+skuQtyArray[0]+'", "cid":'+cid+', "mcid":'+mcat+', "origin":'+origin+', "cat_id":"", "cat_item_id":"", "p_cat_id":"", "p_cat_item_id":""}';}else if(skuQtyArray.length>1){url='/Default.aspx/AddMultipleShoppingBagItems';for(var i=0;i<SKU_ARRAY.length;i++){skuQuantityArr.push(SKU_ARRAY[i]+":"+skuQtyArray[i]);}data='{"strSku":"'+primarySku+'", "selectedSku":"'+selectedSku+'", "strSkuAndQuantity":"'+skuQuantityArr.join(";")+'", "cid":'+cid+', "mcid":'+mcat+', "origin":'+origin+', "cat_id":"", "cat_item_id":"", "p_cat_id":"", "p_cat_item_id":""}';}if(skuQtyArray.length>0){$.ajax({url:url,type:'POST',cache:false,data:data,dataType:"json",contentType:"application/json; charset=utf-8",success:function(data){if(typeof(data.d.SuccessFlag)=="undefined"||data.d.SuccessFlag==null||data.d.SuccessFlag==false||data.d.SuccessFlag=="False"){var errorMsg="Error";try{eval("errorMsg = "+data.d.SKUStatus[0].StatusMessage+";");}catch(err){}try{eval("errorMsg = "+data.d.SKUStatus[1].StatusMessage+";");}catch(err){}$("#ajaxError").html(errorMsg);}else{$("#ajaxError").html("");CookieManager.setCookieValue("shoppingbagcnt",data.d.BagCount);$("#btnPurchase").hide();$("#btnGoToSB").show();newlyAddedItemsArr=[];for(var i=0;i<data.d.SKUStatus.length;i++){var bagId=data.d.SKUStatus[i].ItemID;newlyAddedItemsArr[i]=bagId;}$("#saved-content").removeClass("saved rings").addClass("sb");InlineShoppingBagManager.getInstance().updateShoppingBagLabel();InlineShoppingBagManager.getInstance().updateInlineCustomerSelections(data.d.SKUStatus,data.d.Image);var argItem=";"+$("#itemTitleAndText h1").text().replace(/<[^<>]+>|##|[\t\r\n]/g," ").replace(/[,:'"-]|^[ \t\r\n]+|[ \t\r\n]+$/g,"").replace(/\s{2,}/g," ").replace("™","(TM)").replace("®","(R)")+"-";if(GROUP_TYPE=="Individual"){argItem+=SKU;}else if(GROUP_TYPE=="Type2"){argItem+=SELECTED_SKU+":"+SKU_ARRAY[0];}else{argItem+=SELECTED_SKU;}var query=window.location.search.split("?").join("");var itemGridPosition;var itemTileAttribute;if(query!=""||typeof query!="undefined"){itemGridPosition=URLFactory.extractQueryStringValue(query,"trackgridpos");}else{itemGridPosition="";}if(query!=""||typeof query!="undefined"){itemTileAttribute=URLFactory.extractQueryStringValue(query,"tracktile");}else{itemTileAttribute="";}TrackActionAddToShoppingBag("Item Page",data.d.DataLayer,itemGridPosition,itemTileAttribute);}},error:function(jqXHR,textStatus,errorThrown){if(locale.toLowerCase()=="en-us-trade"||locale.toLowerCase()=="ja-jp-trade"){handleGTradeSessionTimeout(jqXHR);}}});}centerGridText();}function handleGTradeSessionTimeout(jqXHR){try{if(jqXHR!=null&&jqXHR.responseText!=null){if(jqXHR.responseText.indexOf("Authentication")>=0){window.location=window.location;}}}catch(err){}}function handleShowVideo(containerId,videoId){if(videoId!=""){$("#"+containerId).width(800);$("#"+containerId).height(450);Scene7Video.embedInit(containerId,videoId,800,450,"Item "+SKU,null,true);}}function createProductRecommendationData(rrProdRecs){if(rrProdRecs!=undefined&&showProdRecommendation!="False"){var isShown=[];for(var i=0;i<rrProdRecs.length;i++){var whatPlacement=rrProdRecs[i].placement_name.split(".rr")[1];var whatPlacementInt=parseInt(rrProdRecs[i].placement_name.split(".rr")[1]);if(!checkRRPlacements(isShown,whatPlacementInt)){var getProducts=createProductString(rrProdRecs[i]);getAvailability(getProducts,rrProdRecs[i]);isShown.push(whatPlacementInt);}}}}function checkRRPlacements(isShown,whatPlacementInt){for(var i=0;i<isShown.length;i++){if(whatPlacementInt%2==0&&isShown[i]%2==0){return true;}else if(whatPlacementInt%2==1&&isShown[i]%2==1){return true;}}return false;}$(document).ready(function(){if($(".storeWrapper").length>0){$(".saveItem").addClass("storeSelected");}$("btn-dropdown__blue").parent().addClass("fixedHeight");if(window.history.length==1&&$(".backlink").attr("href").indexOf("history.back")!=-1){var pathTObg=document.referrer.split("?")[0].split("/");pathTObg=["",pathTObg[3],pathTObg[4]]
$(".backlink").attr("href",pathTObg.join("/")+"?trackbgfm=pdp");}$("body").on("click",".backlink",function(e){e.preventDefault();var isGoBackLink=true;TrackBreadcrumbInteractions('item','breadcrumb',isGoBackLink);window.location=$(this).attr("href");return false;});getSavedItems();StateModel.getInstance().custom.imageViewerData=[];if(typeof(imageData)!="undefined"){renderImageViewer(imageData);}$("body").on("click",".btn-dropdown:not(.btn-dropdown.btn-dropdown__open), .btn-dropdown > a",function(e){e.preventDefault();var buttonDropdown=($(this).parent().hasClass("btn-dropdown"))?$(this).parent():$(this);if(!buttonDropdown.hasClass("btn-dropdown__open")){buttonDropdown.addClass("btn-dropdown__open");TrackSiteInteractions("pdp","customize product");}else{buttonDropdown.removeClass("btn-dropdown__open");}return false;});$("body").on("click",function(){if($(".btn-dropdown.btn-dropdown__open").length>0){$(".btn-dropdown.btn-dropdown__open").removeClass("btn-dropdown__open");}});$("body").on("click",".collapse",function(e){$(this).siblings(".grid-container").slideUp(250);$(this).html('<img src="/shared/images/icons/bottom-arrow.jpg" />');$(this).removeClass("collapse").addClass("expand");return false;});$("body").on("click",".expand",function(e){var selected=$(".item-extras a.selected").attr("rel");$(this).siblings("#"+selected).slideDown(250);$(this).html('<img src="/shared/images/icons/top-arrow.jpg" />');$(this).removeClass("expand").addClass("collapse");return false;});$("body").on("click",".item-extras h4 a",function(e){var tab=$(this).attr("rel");$(".item-extras h4 a").removeClass("selected");$(this).closest("h4").siblings("div").hide();$(this).addClass("selected");$(".expand").html('<img src="/shared/images/icons/top-arrow.jpg" />');$(".expand").removeClass("expand").addClass("collapse");if(tab=="extras-story"){$("#"+tab).show();}$(".empty").each(function(){$(this).height($(this).width());});if($(this).attr("rel")=="extras-recent"){getRecentlyViewedItems();if(typeof(TrackPDPTabActivity)!='undefined'){TrackPDPTabActivity('Recently Viewed Items',LABEL_SHARE_SHORTDESC);}}else if($(this).attr("rel")=="extras-additional"){getAdditionalItems();if(typeof(TrackPDPTabActivity)!='undefined'){TrackPDPTabActivity('Additional Items',LABEL_SHARE_SHORTDESC);}}else if($(this).attr("rel")=="extras-similar"){getSimilarItems();if(typeof(TrackPDPTabActivity)!='undefined'){TrackPDPTabActivity('Similar Items',LABEL_SHARE_SHORTDESC);}}else if($(this).attr("rel")=="extras-story"){if(typeof(TrackPDPTabActivity)!='undefined'){TrackPDPTabActivity('The Story of This Collection',LABEL_SHARE_SHORTDESC);}}return false;});$("body").on("click","#story-scroll",function(e){$('html, body').animate({scrollTop:$("#idItemExtrasDiv").offset().top},'fast');TrackPDPTabActivity($(this).text().replace(/\s+$/,'').replace(/^\s+/,"").toLowerCase(),LABEL_SHARE_SHORTDESC);return false;});$("body").on("click","#similar-scroll",function(e){$('html, body').animate({scrollTop:$("#similarItems").offset().top},'fast');return false;});$("body").on("mouseenter","#image-holder",function(e){if(isHandheld()){setImageViewerState({showFullScreen:true},true);}return false;});$("body").on("mouseenter","a.item-more",function(){if(isHandheld()){$(".image-overlay").fadeIn(250);if($("body").hasClass("ie-7")||$("body").hasClass("ie-8")){$("#gray-overlay").show();}else{$("#gray-overlay").fadeIn(250);}resizeOverlay();}$(".thumbs img:nth-child(1)").trigger("mouseenter");return false;});$("body").on("mouseenter","a.item-on",function(){if(isHandheld()){$(".image-overlay").fadeIn(250);if($("body").hasClass("ie-7")||$("body").hasClass("ie-8")){$("#gray-overlay").show();}else{$("#gray-overlay").fadeIn(250);}resizeOverlay();}$(".thumbs img:nth-child(3)").trigger("mouseenter");return false;});$("body").on("mouseenter","a.item-video",function(){if(isHandheld()){$(".image-overlay").fadeIn(250);if($("body").hasClass("ie-7")||$("body").hasClass("ie-8")){$("#gray-overlay").show();}else{$("#gray-overlay").fadeIn(250);}resizeOverlay();}$(".thumbs img:nth-child(4)").trigger("mouseenter");TrackItemDisplayOption("Shopping/Item","Video",LABEL_SHARE_SHORTDESC,$(this).attr("data-base-img")+".jpg");return false;});$("body").on("click","#s7viewerInlineZoom_container",function(){if($(this).closest(".thumbs").length>0){var thumbIndex=$(".more-images .thumbs img").index(this)+1;}else{var thumbIndex=$(".more-images .thumbs img.active").index()+1;}setImageViewerState({selectedImage:thumbIndex,showFullScreen:true},true);if($(".more-images .thumbs img.active").length&&$(".more-images .thumbs img.active").attr("data-image-type")){var data_type=($(".more-images .thumbs img.active").attr("data-image-type").toLowerCase()=="moreviews")?"Product":$(".more-images .thumbs img.active").attr("data-image-type");}else{var data_type="Product";}var imageTrack=($(".more-images .thumbs img.active").length>0)?$(".more-images .thumbs img.active").attr("data-base-img")+".jpg":$(this).parent().attr("data-src").split("?")[0].split("/EcomItemL2/")[1];TrackItemDisplayOption("Shopping/Item",data_type,LABEL_SHARE_SHORTDESC,imageTrack);});$("body").on("click",".image-overlay .close",function(){setImageViewerState({selectedImage:null,showFullScreen:false},true);return false;});$("body").on("mouseleave",".more-images",function(){return false;});$("body").on("click","#gray-overlay",function(){setImageViewerState({selectedImage:null,showFullScreen:false},true);return false;});var animating;$("body").on("click",".paging a",function(){var page=parseInt($(".current-page").text());var totalpages=parseInt($(".total-pages").text());var container=$(this).parent().siblings(".grid-container.active");if($(this).hasClass("page-left")){page--;var nextcontainer=container.prev();}else if($(this).hasClass("page-right")){page++;var nextcontainer=container.next();}if(animating){return false;}else{animating=true;}if(page==1){$(".page-left").hide();$(".page-right:hidden").show();}else if(page==totalpages){$(".page-right").hide();$(".page-left:hidden").show();}else{$(".page-left:hidden, .page-right:hidden").show();}$(".current-page").text(page);$("#extras-additional").height($("#extras-additional").height());container.removeClass("active").fadeOut(250,function(){nextcontainer.addClass("active").fadeIn(250,function(){$("#extras-additional").height("auto");animating=false;});$(".empty").each(function(){$(this).height($(this).width());});});return false;});centerGridText();$("body").on("mouseenter",".browse-grid > div > img, .browse-grid .subrow > img",function(e){var parent=this;if(timer){clearTimeout(timer);timer=null;}timer=setTimeout(function(){if(!$(parent).parent().parent().hasClass("text-container")){displayTooltipData($(parent));}clearTimeout(timer);timer=null;},300);});$("body").on("click","#grid-popup .close",function(e){$("#grid-popup").hide();return false;});$("body").on("click",".engraving-info .close",function(e){$(".engraving-info").hide();return false;});$("body").on("mouseleave","#grid-popup",function(e){var theselect=$("#grid-popup select");var thebtn=$("#grid-popup a.btn");if(e.target!=theselect[0]&&e.target.parentElement!=theselect[0]&&e.target!=thebtn[0]){$(this).fadeOut(300);}});$("body").on("click","a.engraving-available",function(){if(typeof(sendOmnitureClickEvent)!='undefined');sendOmnitureClickEvent('Engraving Available');$(".engraving-info").toggle();return false;});$("body").on("mouseleave",".engraving-info",function(){$(this).hide();});$("body").on("click","a.openStores",function(){$(".pickup-info").toggle();return false;});$("body").on("mouseleave",".pickup-info",function(){$(this).hide();});$("body").on("vclick",".pickup-info a.close",function(e){$(".pickup-info").hide();e.preventDefault();});$("body").on("click","a.specifications-available",function(){$(".specifications-info").toggle();return false;});$("body").on("mouseleave",".specifications-info",function(){$(this).hide();});layoutItemPageTiles();$("#btnPurchase").click(function(e){if(CookieManager.areCookiesEnabled()==true){itemPageAddToCart();e.preventDefault();}});$("#ancSaveForLater").click(function(e){if(CookieManager.areCookiesEnabled()==true){itemPageAddToSaved();e.preventDefault();}});$("#ancSaveRemove").click(function(e){if(CookieManager.areCookiesEnabled()==true){var removeKey="listItemKey";var isSavedRingsToken=',"isSavedRings" : false';var url="/Customer/InlineCustomerSelections.aspx/RemoveSavedItem";var dataString='{"'+removeKey+'":"'+SAVED_ID+'"'+isSavedRingsToken+'}';if(locale.toLowerCase()=="en-us-trade"||locale.toLowerCase()=="ja-jp-trade"){url="/Trade/Customer/SavedItems.aspx/RemoveSavedItems";dataString='{"itemsToBeRemoved":[{"ID":'+SAVED_ID+'}]}';}$.ajax({url:url,type:"POST",data:dataString,dataType:"json",contentType:"application/json; charset=utf-8",success:function(data){if(locale.toLowerCase()=="en-us-trade"||locale.toLowerCase()=="ja-jp-trade"){var count=0;if(data.d.ResponseObject.EndecaGroups){$.each(data.d.ResponseObject.EndecaGroups,function(){count+=this.Items.length;});}if(data.d.ResponseObject.OtherGroup){$.each(data.d.ResponseObject.OtherGroup.SubGroups,function(){count+=this.Items.length;});}}else{var count=data.d.Header.TotalCount+data.d.Header.TotalRingCount+data.d.Header.TotaldahReceivedCount+data.d.Header.TotaldahSentCount+data.d.Header.TotalSavedBYOCount;}CookieManager.setCookieValue("saveditemscnt",count);var savedItemsText="";if(locale.toLowerCase()=="en-us-pkb"){$("#spanSavedItemCount").html("("+count+")");}else{$("#spanSavedItemCount").html(count);}if(count==0){$("#spanSavedItemCount").hide().parent().removeClass("active");}else{$("#spanSavedItemCount").show();}$("#ancSaveForLater").show();$("#ancSaveRemove").hide();TrackRemoveSavedItem("PDP","Delete Item",data.d.ResponseObject.DataLayer);},error:function(jqXHR,status,error){}});e.preventDefault();}});var hash=window.location.hash;var query=window.location.search.split("?").join("");var compass=URLFactory.extractQueryStringValue(query,"compass");var searchParams=URLFactory.extractQueryStringValue(query,"search_params");var model=StateModel.getInstance();if(hash!=""){model.setStateSnapshot(URLFactory.convertHashToState(hash));}else if(searchParams!=""){model.setStateSnapshot(URLFactory.convertHashToState(searchParams));}else{var stateSnapshot=model.getStateSnapshot();if(typeof cidParam!="undefined"&&cidParam!=""){stateSnapshot.category=cidParam;}model.setStateSnapshot(stateSnapshot);}if(compass.toLowerCase()=="true"){$("body").addClass("embedded");}$(HistoryManager.getInstance()).bind("historyChanged",function(e,data){setStateFromHistory(data.state.flash);});$("body").on("click","a.clearAllItems",function(e){clearAllItems();e.preventDefault();return false;});$("a.clearAllItems").fadeIn(250);if(($("body").hasClass("en-US-Stmt")||$("body").hasClass("en-US-PKB"))&&$(".extras-recently-viewed-link a").hasClass("selected")){$("a.clearAllItems").show();}$(".item-container .more-images div img").load(function(){$(this).addClass("visible");});$("#s7viewerInlineZoom").hide();function setupInlineZoom(assetToGrab,thumbIndex){if($("#s7viewerInlineZoom").attr("data-src")!=""){if((assetToGrab==""||assetToGrab===undefined)){if(spinsetisShowing){inlineZoomViewer.dispose();}spinsetisShowing=false;assetToGrab=$("#s7viewerInlineZoom").attr("data-src").split("/")[7].split("-");inlineZoomViewer=new s7viewers.FlyoutViewer({"containerId":"s7viewerInlineZoom","params":{"asset":templateStrings.Scene7Profile+"/"+assetToGrab[assetToGrab.length-1].split(".")[0]+"?$EcomItemL2$","config":"Scene7SharedAssets/Universal_HTML5_Zoom_Inline","contenturl":templateStrings.baseScene7Server+"/skins/","serverurl":templateStrings.baseScene7Server+"/is/image/","FlyoutZoomView.imagereload":"1,breakpoint,1308;1250","FlyoutZoomView.zoomfactor":"1,-1,1",'tip':'0,0,0',"stageSize":"1408,1408"},"sdkBasePath":"/Shared/Scripts/ecom/sdk/"});inlineZoomViewer.setHandlers({"initComplete":function(){$("#s7viewerInlineZoom_container").css("width","100%").css("height",$("#s7viewerInlineZoom_container").css("width"));$(".s7staticimage img").attr("alt",LABEL_SHARE_SHORTDESC);}});if(!inlineZoomViewer.initCalled)inlineZoomViewer=inlineZoomViewer.init();}else{if(spinsetisShowing){var containerWidth=$("#s7viewerSpinSet_container_inner").width();containerWidth+="px";inlineZoomViewer.dispose();spinsetisShowing=false;inlineZoomViewer=new s7viewers.FlyoutViewer({"containerId":"s7viewerInlineZoom","params":{"asset":templateStrings.Scene7Profile+"/"+assetToGrab[assetToGrab.length-1].split(".")[0]+"?$EcomItemL2$","config":"Scene7SharedAssets/Universal_HTML5_Zoom_Inline","contenturl":templateStrings.baseScene7Server+"/skins/","serverurl":templateStrings.baseScene7Server+"/is/image/","tip":"0,0,0","FlyoutZoomView.imagereload":"1,breakpoint,1308;1250","FlyoutZoomView.zoomfactor":"1,-1,1","stageSize":"1408,1408"},"sdkBasePath":"/Shared/Scripts/ecom/sdk/"});inlineZoomViewer.setHandlers({"initComplete":function(){$("#s7viewerInlineZoom_container").css("width",containerWidth).css("height",containerWidth);$(".s7staticimage img").attr("alt",LABEL_SHARE_SHORTDESC);}});if(!inlineZoomViewer.initCalled)inlineZoomViewer=inlineZoomViewer.init();}else{setImageViewerState({selectedImage:thumbIndex,showFullScreen:false},true);inlineZoomViewer.containerHeight=$("#s7viewerInlineZoom_container").css("width");inlineZoomViewer.setAsset(templateStrings.Scene7Profile+"/"+assetToGrab[assetToGrab.length-1].split(".")[0]+"?$EcomItemL2$");}}}}function setupSpinView(){if(!spinsetisShowing){inlineZoomViewer.dispose();if($("#s7viewerInlineZoom").attr("data-src")!=""){inlineZoomViewer=new s7viewers.SpinViewer({"containerId":"s7viewerSpinSet","params":{"asset":templateStrings.Scene7Profile+"/"+SPINSET_IMAGE,"serverurl":templateStrings.baseScene7Server+"/is/image/","contenturl":templateStrings.baseScene7Server+"/skins/","SpinView.singleclick":"none","SpinView.doubleclick":"none","iconeffect":"0",'style':'https://media.tiffany.com/s7viewers/html5/SpinViewer_light.css',},"handlers":{"initComplete":function(){setTimeout(function(){var label360alt=LABEL_SHARE_SHORTDESC+"__360-product-view";$(".spinset-thumb i").attr("alt",label360alt);$("#s7viewerSpinSet_spinView canvas").attr("alt",label360alt);$("#s7viewerSpinSet_spinView").append('<div id="InfoMessage_s7classic_BD" class="s7tip" data-description="Scene7ComponentHolder" data-component="undefined" data-namespace="s7classic" style="position: absolute;color:black;left:0px;top:0px;width:100%;height:100%;background-color:white;opacity:0.7;"><div style="top:30%;position:relative;text-align:center;font-size:20px;"><i class="icon-font" id="spin_text" aria-hidden="true" style="font-size:60px;display:block;text-align:center;padding-bottom:15px;">360_hand</i>'+jsTranslations.txtSpin+'</div></div>');$("body").on("mousedown touchstart click","#InfoMessage_s7classic_BD",function(e){$("#InfoMessage_s7classic_BD.s7tip").hide();e.stopImmediatePropagation();});},100);},},'sdkBasePath':'/Shared/Scripts/ecom/sdk/'
}).init();}spinsetisShowing=true;TrackItemDisplayOption("","360 view","",SPINSET_IMAGE);}}setupInlineZoom();$("#s7viewerInlineZoom").fadeIn(250);$("body").on("click",".jq-spinset-thumb",function(e){e.preventDefault();$(".more-images .thumbs img").removeClass("active");$(this).addClass("active");setupSpinView();});$("body").on("click",".more-images .thumbs img",function(e){e.preventDefault();$(".more-images .thumbs img, .spinset-thumb").removeClass("active");$(this).addClass("active");var thumbIndex=$(".more-images .thumbs img").index(this)+1;var assetToGrab=$(this).attr("data-src").split("/")[7].split("-");setupInlineZoom(assetToGrab,thumbIndex);if($(".more-images .thumbs img.active").length&&$(".more-images .thumbs img.active").attr("data-image-type")){var data_type=($(this).attr("data-image-type").toLowerCase()=="moreviews")?"Product":$(this).attr("data-image-type");}TrackItemDisplayOption("Shopping/Item",data_type,LABEL_SHARE_SHORTDESC,$(this).attr("data-base-img")+".jpg");return false;});$("body").on("click",".image-overlay .thumbs img",function(){var assetToGrab=$(this).attr("data-src").split("/")[7].split("-");var thumbIndex=$(".image-overlay .thumbs img").index(this)+1;inlineZoomViewer.setAsset(templateStrings.Scene7Profile+"/"+assetToGrab[assetToGrab.length-1].split(".")[0]+"?$EcomItemL2$");setImageViewerState({selectedImage:thumbIndex,showFullScreen:null},true);$(".image-overlay .thumbs img").removeClass("active");$(".image-overlay .thumbs img:nth-child("+thumbIndex+")").addClass("active");$(".more-images .thumbs img").removeClass("active");$(".more-images .thumbs img:nth-child("+thumbIndex+")").addClass("active");var data_type=($(".more-images .thumbs img.active").attr("data-image-type").toLowerCase()=="moreviews")?"Product":$(".more-images .thumbs img.active").attr("data-image-type");TrackItemDisplayOption("Shopping/Item",data_type,LABEL_SHARE_SHORTDESC,$(this).attr("data-base-img")+".jpg");return false;});$("body").on("click",".rrItem a",function(e){e.preventDefault();var itemRedirect=$(this).attr("data-itemURL");var rrItem=$(this).attr("data-rrAnalytics");$.ajax({url:rrItem+"&callback=?",data:"",type:'POST',timeout:10000,dataType:"jsonp",success:function(data){window.location=itemRedirect;},error:function(e){window.location=itemRedirect;}});});if($('#dvFindInStore').length==0){$("#itemPage #itemInformation > div#mediaLinks").addClass("noFIIS");}populatePDPBreadcrumb();populatePDPSchemaData();$("body").on("click",".breadcrumb li a",function(e){e.preventDefault();TrackBreadcrumbInteractions('item','breadcrumb','');window.location=$(this).attr("href");return false;});});function populatePDPBreadcrumb(){var query=window.location.search.split("?").join("");var fromGrid=URLFactory.extractQueryStringValue(query,"fromGrid");var trackgridpos=URLFactory.extractQueryStringValue(query,"trackgridpos");if(typeof(fromGrid)!="undefined"&fromGrid=="1"){if(typeof(trackgridpos)!="undefined"&&trackgridpos=="undefined"){$('#breadCrumbPDPBackEnd').show();activeBreadcrumb=$('#breadCrumbPDPBackEnd');}else{var checkFiterCookie=CookieManager.getCookieValue('userCurrentFilters');if(typeof(checkFiterCookie)!="undefined"&&checkFiterCookie!=""&&checkFiterCookie!=null){var getCurrentFilters=JSON.parse(decodeURIComponent(window.CookieManager.getCookieValue('userCurrentFilters')));var itemName=$('#itemInformation #itemHeader .eyebrow').text().trim()+" "+$('#itemInformation #itemHeader h1.t1').text().trim();if(typeof(getCurrentFilters)!="undefined"&&getCurrentFilters!=null){var itemBuffer="";for(var i=0;i<getCurrentFilters.length;i++){itemBuffer+="<li><a href='"+getCurrentFilters[i].CanonicalURL+"' class='type-cta avenir'>"+getCurrentFilters[i].Name+"</a></li>";}itemBuffer+="<li>"+itemName+"</li>";$("#breadCrumb ul").html(itemBuffer);$('#breadCrumb').show();activeBreadcrumb=$('#breadCrumb');}}else{$('#breadCrumbPDPBackEnd').show();activeBreadcrumb=$('#breadCrumbPDPBackEnd');}}}else{$('#breadCrumbPDPBackEnd').show();activeBreadcrumb=$('#breadCrumbPDPBackEnd');}}function populatePDPSchemaData(){var breadcrumbArray=[];if(typeof activeBreadcrumb!="undefined"){$(activeBreadcrumb).find("li a").each(function(index,value){var buffer={};buffer.Name=$(this).text();buffer.CanonicalURL=$(this).attr('href');buffer.DisplayOrder=index+1;breadcrumbArray.push(buffer);});var lastBuffer={};lastBuffer.Name=$(activeBreadcrumb).find("li:last-child").text();lastBuffer.CanonicalURL=window.location.href.split("?")[0];lastBuffer.DisplayOrder=breadcrumbArray.length+1;breadcrumbArray.push(lastBuffer);populateJsonLDScript(breadcrumbArray);}}function populateJsonLDScript(data){if(typeof(data)!="undefined"&&data!=null){var finalSchemaObj=[];var tempSchemaItems=[];for(var i=0;i<data.length;i++){var tempSchemaData={};tempSchemaData["@type"]="ListItem";tempSchemaData["position"]=data[i].DisplayOrder;tempSchemaData["item"]={"@id":data[i].CanonicalURL,"name":data[i].Name
};tempSchemaItems.push(tempSchemaData);}for(var i=0;i<tempSchemaItems.length;++i){finalSchemaObj.push(tempSchemaItems[i]);}var scriptSchema=document.createElement('script');scriptSchema.type='application/ld+json';scriptSchema.text=JSON.stringify({"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[finalSchemaObj]
});$("head").append(scriptSchema);}}var savedItems=[];function getSavedItemsList(){var url="/Customer/InlineCustomerSelections.aspx/GetInlineSavedItems";if(locale.toLowerCase()=="en-us-trade"||locale.toLowerCase()=="ja-jp-trade"){url="/Trade/Customer/SavedItems.aspx/GetSavedItems";}$.ajax({url:url,type:"POST",data:'',dataType:"json",contentType:"application/json; charset=utf-8",success:function(data){if(data.d.ResponseObject){if(locale.toLowerCase()=="en-us-trade"||locale.toLowerCase()=="ja-jp-trade"){if(data.d.ResponseObject.EndecaGroups){$.each(data.d.ResponseObject.EndecaGroups,function(){$.each(this.Items,function(){savedItems.push(this);});});}if(data.d.ResponseObject.OtherGroup){$.each(data.d.ResponseObject.OtherGroup.SubGroups,function(){$.each(this.Items,function(){savedItems.push(this);});});}}else{savedItems=data.d.ResponseObject.SavedItems;}addHearts(savedItems);}else{$(".unheart").remove();}},error:function(jqXHR,status,error){}});}function addHearts(items){$(".unheart").remove();$.each(items,function(){var sku=this.GroupSku;if(!sku){sku=this.Sku;}var savedId=this.ID;$("img[data-sku='"+sku+"']").parent().append('<span class="unheart" data-saved-id="'+savedId+'"><i class="icon-font">like_solid</i></>');});}var compassConnectionId=null;var compassConnectionSource=null;var compassOriginatingServer=null;window.addEventListener("message",function(event){var command="";var message="";if(typeof(templateStrings.baseCompassServer)!="undefined"&&templateStrings.baseCompassServer.split(',').indexOf(event.origin)>=0){if(event.data.split(":").length==2){command=event.data.split(":")[0];message=event.data.split(":")[1];}else{command=event.data;}switch(command.toLowerCase()){case"initialize":compassConnectionId=message;compassConnectionSource=event.source;compassOriginatingServer=event.origin;break;case"addskutoorder":addSkuToCompassOrder(SKU,(SKU_ARRAY!=null&&SKU_ARRAY.length>0)?SKU_ARRAY[0]:"",SELECTED_SKU,PKB_PRICMARKETID);}}},false);function sendSkuToCompass(sku,state){if(compassConnectionSource!=null){if(typeof(state)!="undefined"&&state!=null&&state!=""){state=":"+state;}compassConnectionSource.postMessage("connection:"+compassConnectionId+";type:triggerSKU;data:"+sku+state,compassOriginatingServer);}}function addSkuToCompassOrder(sku,defaultSku,selectedSku,priceMarket){if(compassConnectionSource!=null&&typeof(sku)!="undefined"&&sku!=null&&sku!=""){selectedSku=(typeof(selectedSku)!="undefined"&&selectedSku!=null)?selectedSku:defaultSku;priceMarket=(typeof(priceMarket)!="undefined"&&priceMarket!=null)?priceMarket:"";compassConnectionSource.postMessage("connection:"+compassConnectionId+";type:triggerAddSKU;data:"+sku+"-"+selectedSku+"-"+priceMarket,compassOriginatingServer);}}function sendSearchToCompass(searchTerm){if(compassConnectionSource!=null){compassConnectionSource.postMessage("connection:"+compassConnectionId+";type:triggerSKUSearch;data:"+encodeURIComponent(searchTerm),compassOriginatingServer);}}function readCookie(name){var nameEQ=name+"=";var ca=document.cookie.split(';');for(var i=0;i<ca.length;i++){var c=ca[i];while(c.charAt(0)==' ')c=c.substring(1,c.length);if(c.indexOf(nameEQ)==0)return c.substring(nameEQ.length,c.length);}return null;}function positionDiscoverLink(){var viewportScrollTop=$(window).scrollTop();var viewportScrollBottom=viewportScrollTop+$(window).height();var infoBottom=$(".item-info-container").offset().top+$(".item-info-container").outerHeight();var linkHeight=$("#divServiceInfo").outerHeight();var lineOffset=$("#idItemExtrasDiv").offset().top;if(lineOffset<viewportScrollBottom){$("#divServiceInfo").removeClass("fixed");$("#divServiceInfo").addClass("absolute");}else{if(viewportScrollBottom<infoBottom+linkHeight){$("#divServiceInfo").removeClass("absolute");$("#divServiceInfo").removeClass("fixed");}else{$("#divServiceInfo").removeClass("absolute");$("#divServiceInfo").addClass("fixed");}}}function SaveDAHReceivedItem(sku,selectedSku,cid,mcat,dahid){var trackingSku;if(selectedSku==""){trackingSku=sku;}else{trackingSku=sku+":"+selectedSku;}$.ajax({type:"POST",url:"/shopping/item.aspx/AddSavedDAHItem",data:'{"sku":"'+sku+'", "selectedSku":"'+selectedSku+'", "cid":'+cid+', "mcid":'+mcat+', "qty":"1", "dahId":"'+dahid+'"}',contentType:"application/json; charset=utf-8",dataType:"json",success:function(data){if(data.d!=null){$("#saveHints").hide();$("#dAHSuccess").show();CookieManager.setCookieValue("saveditemscnt",data.d.BagCount);InlineShoppingBagManager.getInstance().updateSavedItemsLabel();TrackActionAddToSavedItems("Item Page","Add to DAHSavedItems",trackingSku,data.d.DataLayer,null);}},error:function(jqXHR,status,error){$("#dAHFailure").show();}});}function UpdateSavedItemsCount(){parent.InlineShoppingBagManager.getInstance().updateSavedItemsLabel();}function appendQueryString(key,value,isFirst){if(isFirst==true){return key+"="+value;}else{return"&"+key+"="+value;}}function initAddConfirmationClose(){setTimeout(function(){$("#addConfirmation").fadeOut("200");},2000);}function getLinkEngravingParams(mySku){var linkEngraving="";if(mySku){var productData=StateModel.getInstance().getProduct(mySku);var tooltipGroupDataLookup=StateModel.getInstance().custom.tooltipGroupDataLookup;var groupData=(typeof(tooltipGroupDataLookup[mySku])!="undefined")?tooltipGroupDataLookup[mySku].d:null;var groupType="Individual";var groupSelectValue="";if($("#grid-popup").css("display")!="none"&&typeof($("#grid-popup select").val())!="undefined"){groupSelectValue=$("#grid-popup select").val();}if(groupData!=null&&groupData.GroupTypeID!=null){groupType="Type"+groupData.GroupTypeID;}CATEGORY_ID=(CATEGORY_ID=="")?0:CATEGORY_ID;MASTER_CATEGORY_ID=(MASTER_CATEGORY_ID=="")?0:MASTER_CATEGORY_ID;linkEngraving=URLFactory.appendQueryString("groupType",groupType,true);linkEngraving=linkEngraving+URLFactory.appendQueryString("cid",CATEGORY_ID,false);linkEngraving=linkEngraving+URLFactory.appendQueryString("mcid",MASTER_CATEGORY_ID,false);linkEngraving=linkEngraving+URLFactory.appendQueryString("origin",ORDER_ORIGINATION,false);linkEngraving=linkEngraving+URLFactory.appendQueryString("sku",mySku,false);if(groupSelectValue!=""){linkEngraving=linkEngraving+URLFactory.appendQueryString("selectedsku",groupSelectValue,false);}else if(typeof productData.SelectedSku!="undefined"&&productData.SelectedSku!=null){linkEngraving=linkEngraving+URLFactory.appendQueryString("selectedsku",productData.SelectedSku,false);}else if(typeof productData.DefaultSku!="undefined"&&productData.DefaultSku!=null){linkEngraving=linkEngraving+URLFactory.appendQueryString("selectedsku",productData.DefaultSku,false);}if(groupType=="Type2"){var quantity="";if(groupData.SKUList!=null){for(var i=0;i<groupData.SKUList.length;i++){if(i!=0){quantity+=",";}quantity+=groupData.SKUList[i].Sku+":1";}}if(groupData.Group!=null){if(groupData.SKUList!=null&&groupData.SKUList.length>0){quantity+=",";}quantity+=groupData.Group.Sku+":1";}linkEngraving=linkEngraving+URLFactory.appendQueryString("Quantity",quantity,false);linkEngraving=linkEngraving+URLFactory.appendQueryString("defaultsku",groupData.DefaultSku,false);}else{linkEngraving=linkEngraving+URLFactory.appendQueryString("Quantity",1,false);}linkEngraving=linkEngraving+appendQueryString("source","pdp",false);}else{var quantity="";linkEngraving=appendQueryString("groupType",GROUP_TYPE,true);linkEngraving=linkEngraving+appendQueryString("cid",CATEGORY_ID,false);linkEngraving=linkEngraving+appendQueryString("mcid",MASTER_CATEGORY_ID,false);linkEngraving=linkEngraving+appendQueryString("origin",ORDER_ORIGINATION,false);if(GROUP_TYPE=="Individual"){if(locale.toLowerCase()=="en-us-trade"||locale.toLowerCase()=="ja-jp-trade"){quantity=document.getElementById("ctlSkuIndividual_txtQuantity").value;}else{if(typeof($("#ctlSkuIndividual_ddlQuantity").val())!=="undefined"){quantity=$("#ctlSkuIndividual_ddlQuantity").val();}else{quantity="1";}}linkEngraving=linkEngraving+appendQueryString("sku",SKU,false);linkEngraving=linkEngraving+appendQueryString("Quantity",quantity,false);}else if(GROUP_TYPE=="Type1"){if(locale.toLowerCase()=="en-us-trade"||locale.toLowerCase()=="ja-jp-trade"){quantity=document.getElementById("ctlSkuGroupType1_txtQuantity").value;}else{if(typeof($("#ctlSkuGroupType1_ddlQuantity").val())!=="undefined"){quantity=$("#ctlSkuGroupType1_ddlQuantity").val();}else{quantity="1";}}linkEngraving=linkEngraving+appendQueryString("sku",SKU,false);linkEngraving=linkEngraving+appendQueryString("selectedSku",SELECTED_SKU,false);linkEngraving=linkEngraving+appendQueryString("Quantity",quantity,false);}else if(GROUP_TYPE=="Type2"){for(var i=0;i<SKU_ARRAY.length;i++){if(i!=0){quantity+=",";}quantity+=SKU_ARRAY[i]+":";if(locale.toLowerCase()=="en-us-trade"||locale.toLowerCase()=="ja-jp-trade"){quantity+=document.getElementById("ctlSkuGroupType2_rptItemList_ctl0"+i+"_txtQuantity").value;}else{if(typeof($("#ctlSkuGroupType2_rptItemList_ctl0"+i+"_ddlQuantity").val())!=="undefined"){quantity+=$("#ctlSkuGroupType2_rptItemList_ctl0"+i+"_ddlQuantity").val();}else{quantity="1";}}}linkEngraving=linkEngraving+appendQueryString("sku",SKU,false);linkEngraving=linkEngraving+appendQueryString("selectedSku",SELECTED_SKU,false);linkEngraving=linkEngraving+appendQueryString("Quantity",quantity,false);linkEngraving=linkEngraving+URLFactory.appendQueryString("defaultsku",SKU_ARRAY[0],false);}else if(GROUP_TYPE=="Type7"){if(locale.toLowerCase()=="en-us-trade"||locale.toLowerCase()=="ja-jp-trade"){quantity=document.getElementById("ctlSkuGroupType7_txtQuantity").value;}else{if(typeof($("#ctlSkuGroupType7_ddlQuantity").val())!=="undefined"){quantity=$("#ctlSkuGroupType7_ddlQuantity").val();}else{quantity="1";}}linkEngraving=linkEngraving+appendQueryString("sku",SKU,false);linkEngraving=linkEngraving+appendQueryString("selectedSku",SELECTED_SKU,false);linkEngraving=linkEngraving+appendQueryString("Quantity",quantity,false);}linkEngraving=linkEngraving+appendQueryString("source","pdp",false);}return linkEngraving;}function TrackRecentlyViewedItems(){var skuDesc="";var extraItems="";if($('.item-extras .selected').length>0){extraItems=$('.item-extras .selected').text().trim();};if($(".t8").length>0){skuDesc=$(".t8").html();}if(typeof(TrackSKUInRecentlyViewedItemPageItems)!='undefined'){TrackSKUInRecentlyViewedItemPageItems(extraItems,skuDesc);}}function hideReceiveHints(){$("#receiveHints").hide();}function getPageHeight(){return(document.getElementById('container').offsetHeight-25);}function hideErrorMessage(){$('divError').html("");return true;}function SetUniqueRadioButton(nameregex,current,checkedSku,mipsDescription,posDescription,HasAlternateImages){re=new RegExp(nameregex);for(i=0;i<document.forms[0].elements.length;i++){elm=document.forms[0].elements[i];if(elm.type=='radio'){if(re.test(elm.name)){SELECTED_SKU_INVENTORY=checkedSku;elm.checked=false;}}}if(typeof(ProductLookup)!="undefined"&&ProductLookup!=null){ProductLookup.getInstance().config.sku=SELECTED_SKU_INVENTORY;ProductLookup.getInstance().reloadActiveTab();}if(typeof(mipsDescription)!="undefined"&&mipsDescription!=null&&mipsDescription!=""){$("#pkbMIPSDescription").html(mipsDescription);}if(typeof(posDescription)!="undefined"&&posDescription!=null&&posDescription!=""){$("#pkbPOSDescription").html(posDescription);}if(HasAlternateImages=="True"){var hv=$('#selectedSKU').val();$("#divAlterNateImg").show();var a_href=$('div#divAlterNateImg a').attr('href');if(hv==null||hv==""||hv=='undefined'){var reg=new RegExp("\\{0\\}","gm");a_href=a_href.replace(reg,SELECTED_SKU_INVENTORY);}else{a_href=a_href.replace(hv,SELECTED_SKU_INVENTORY);}$('#selectedSKU').val(SELECTED_SKU_INVENTORY);$('div#divAlterNateImg a').attr('href',a_href);}else{$("#divAlterNateImg").hide();}current.checked=true;}$(document).ready(function(){$("#pkbSkuSearch").keydown(function(e){if(e.keyCode==13){handlePKBSearch();}});if($("#grid-popup .image a").length>0){$("#grid-popup .image a").attr("onclick","TrackRecentlyViewedItems();");}if($("#grid-popup .info .item-links .details").length>0){$("#grid-popup .info .item-links .details").attr("onclick","TrackRecentlyViewedItems();");}var elm=$(".pickupMessage");var content=elm.text().trim();if(content.length){elm.css("padding-bottom","20px");}$("#ctlExtraItemDetailsInventory_ancSkuPrice").click(function(){$("html").addClass("hasIframeOverride");});var wristDiv="<a href='/Service/FaqOverlay.aspx?faq_id=2349&redesign=true' class='jq-open-modal' aria-label='Measure Wrists'><i aria-hidden='true' class='icon-font measureWrists'>question</i></a>";if($(".linkItemMeasureWrist").length>0){if($('div[id*="_divGrpData"] span.measureWrists').length>0){$('div[id*="_divGrpData"] span.measureWrists').replaceWith(wristDiv);}else if($('#ctlSkuGroupType1_divQuantity span.measureWrists').length>0){$("#ctlSkuGroupType1_divQuantity .measureWrists").replaceWith(wristDiv);}else{$(".measureWrists").replaceWith(wristDiv);}}$("body").on("click",".measureWrists",function(){TrackVirtualPageViews('measuring your wrist');});$("#ctlExtraItemDetailsInventory_spanSKUDisplay a").click(function(e){e.preventDefault();OverlayManager.getInstance().open("ctlExtraItemDetailsInventory_ancSkuPrice",{url:$(this).attr("href"),size:"full",iframe:true,position:"",bgstyle:""},true);});$("#infoDrawers div").each(function(){$(this).children("span").click(function(){var thisDrawer=$(this).next();thisDrawer.toggle();var wasOpen=$(this).find(".minus").is(":visible");$("#infoDrawers div span i.minus").hide();$("#infoDrawers div span i.plus").show();if(!wasOpen){$(this).find(".minus").toggle();$(this).find(".plus").toggle();}$("#infoDrawers > div > div").not(thisDrawer).hide();var drawerName=$(this).clone().children().remove(".plus, .minus").end().text().trim();if(!wasOpen){TrackPDPTabActivity(drawerName,LABEL_SHARE_SHORTDESC);}});});$.get("/Service/FaqOverlay.aspx?faqcode=linkpersonalizethisitem&redesign=true",function(data){$("#drawerPersonalize div").text($.trim($(data)[$(data).length-1].innerText));});$.get("/Service/FaqOverlay.aspx?faqCode=linkcounterfeitwarning&showBnr=false&redesign=true",function(data){$("#drawerCounterfeit div").text($.trim($(data)[$(data).length-1].innerText));});$("#contentLinkListHdr").remove();$("#locationName").text($("#a1").text().replace(" store.",""));getRecentlyViewedItems();if($("body").hasClass("en-US-PKB")){getSimilarItems();}$("body").on("click","#linkReturnPolicy",function(){setTimeout(function(){$('.rollbar.faqOverlay').trigger('rollbar',[440,0]);},2000);});$("body").on("click","#drawerShare a",function(){if(!$(this).hasClass("email")){switch($(this).attr("class")){case"facebook":postToFaceBook('',LABEL_URL,'Item Page','SMPF1&utm_campaign=Social_Media_Shared_Link&utm_medium=social_media&utm_source=Facebook_Share&utm_content=&utm_term=');break;case"twitter":postToTwitter(LABEL_SHARE_SHORTDESC,LABEL_URL,'Item Page','SMPF2&utm_campaign=Social_Media_Shared_Link&utm_medium=social_media&utm_source=Twitter_Share&utm_content=&utm_term=');break;case"pinterest":postToPinterest(LABEL_SHARE_SHORTDESC,LABEL_URL,'Item Page','SMPF2&utm_campaign=Social_Media_Shared_Link&utm_medium=social_media&utm_source=Pinterest_Share&utm_content=&utm_term=',$('#s7viewerInlineZoom').attr('data-src'));break;case"tumblr":postToTumblr(LABEL_SHARE_SHORTDESC,LABEL_URL,'image','SMPF2&utm_campaign=Social_Media_Shared_Link&utm_medium=social_media&utm_source=Tumbler_Share&utm_content=&utm_term=','',$('#s7viewerInlineZoom').attr('data-src'));break;case"google":postToGoogle(LABEL_URL,'SMPF2&utm_campaign=Social_Media_Shared_Link&utm_medium=social_media&utm_source=Google_Share&utm_content=&utm_term=');break;case"weibo":postToWeibo(LABEL_SHARE_SHORTDESC,LABEL_URL,'Item Page','SMPF2&utm_campaign=Social_Media_Shared_Link&utm_medium=social_media&utm_source=Weibo_Share&utm_content=&utm_term=');break;}TrackItemPageShareType($(this).attr("class"));}});$("#lnkEyeBrowLink").click(function(e){e.preventDefault();TrackSiteInteractions("eyebrow link|"+$(this).text().toLowerCase(),'pdp');window.location=$(this).attr("href");});$(".linkItemMeasureWrist").click(function(e){TrackVirtualPageViews($(this).text().replace(/\s+$/,'').replace(/^\s+/,"").toLowerCase());});$("#linkcustomerservicehours").click(function(e){TrackVirtualPageViews($(this).text().replace(/\s+$/,'').replace(/^\s+/,"").toLowerCase());});$(".linkAboutRingSives").click(function(e){TrackVirtualPageViews("ring size conversion");});$("#drawerDescription a.linkAboutRingSives").click(function(e){TrackVirtualPageViews($("#drawerDescription a.linkAboutRingSives").text().replace(/\s+$/,'').replace(/^\s+/,"").toLowerCase());});$("#linkRingSizeConversion").click(function(e){TrackVirtualPageViews("ring size conversion");});$("#lnkRingSizeGuide").click(function(e){TrackFileDownload("print ring size guide");});$("#linkAboutEngraving").click(function(e){TrackVirtualPageViews($("#linkAboutEngraving").text().replace(/\s+$/,'').replace(/^\s+/,"").toLowerCase());});$("#lnkRingSizer").click(function(e){TrackFileDownload("print ring size guide");});$("#findStoreLink, #seeMoreStoreLink").click(function(e){TrackSiteInteractions("find in store","pdp");});$(".faqFiiSConfirmAvailability").click(function(e){TrackVirtualPageViews("Confirm Availability");});$(".faqFiiSCurrentlyAvailable").click(function(e){TrackVirtualPageViews("Currently Available In-Store");});$("body").on("click","#ancAddtoEngraving, #ancEngraveCharm, #ancCustomizeCharm",function(e){e.preventDefault();TrackSiteInteractions("pdp","customize this item");var query=window.location.search.split("?").join("");var itemPos;var itemTrackTileInfo;if(query!=""||typeof query!="undefined"){itemPos=URLFactory.extractQueryStringValue(query,"trackgridpos");}else{itemPos="";}if(query!=""||typeof query!="undefined"){itemTrackTileInfo=URLFactory.extractQueryStringValue(query,"tracktile");}else{itemTrackTileInfo="";}if(isInformational=="True"){var props={link:$(this),source:'/Shopping/CustomizationOverlay.aspx?'+getLinkEngravingParams()+"&isPDP=1&source=pdp&trackgridpos="+itemPos+"&tracktile="+itemTrackTileInfo,type:"ajax",size:"large"
};openModalOverlay(props);}else{validateAddWithServicing(getLinkEngravingParams());}});$("#ancBuildYourDesign").click(function(e){trackBYOSiteInteractions('launch from banner','charm builder');window.location=$(this).attr("href");e.preventDefault();e.stopPropagation();});$("#divBuildYourOwn").click(function(e){e.preventDefault();$(this).find("a").click();});});