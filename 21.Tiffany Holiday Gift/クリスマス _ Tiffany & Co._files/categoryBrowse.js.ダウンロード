HistoryManager.getInstance().disableHistory();var tooltipXHR=null;var amountOfMarketingTile=0;var collectionLineBreak0Clicked=false;var catAllArray={};var isCatAllArrayCreated=false;var selectedDesigners=false;var selectedFilter=false;var BREADCRUMB_CURRENT_FILTERS;var minInputPrice;var maxInputPrice;$(document).ready(function(){var model=StateModel.getInstance();var i,n;var hash=window.location.hash;var query=window.location.search.split("?").join("");var cidParam=CATEGORY_ID;var searchParams;var trackDtmPageView=true;var dtmSortMethod="";var dtmSortOption="";var trackSortOption=false;if(FRIENDLY_SEARCH_PARAM!=""){searchParams=FRIENDLY_SEARCH_PARAM;}else{searchParams=URLFactory.extractQueryStringValue(query,"search_params");}var isSearch=false;if(URLFactory.extractQueryStringValue(query,"search")!=''){isSearch=URLFactory.extractQueryStringValue(query,"search");}else{isSearch=(/search/i).test(self.location.pathname);}var stateSnapshot=model.getStateSnapshot();var searchKeywordQS=decodeURIComponent(URLFactory.extractQueryStringValue(query,"searchkeyword"));if(searchKeywordQS===''){var urlPath=$(location).attr('pathname').split('/');if(urlPath[1]=='search'){searchKeywordQS=decodeURIComponent(urlPath[2].split("-").join(" "));if((locale.toLowerCase()=="en-us-trade"||locale.toLowerCase()=="ja-jp-trade"||locale.toLowerCase()=="en-us-estr"||locale.toLowerCase()=="ja-jp-estr"||locale.toLowerCase()=="en-us-stmt")&&searchKeywordQS==='items'){searchKeywordQS=''
}}}var categoryName=model.isSearchMode===true?"Search Results":$("#filters h1").text().split("(")[0];model.custom.gridHTMLBlocks=[];model.custom.gridLayoutBlocks=[];model.custom.gridSizeBlocks=[];model.custom.lastBlockShown=-1;model.custom.engageLazyLoad=false;model.custom.isSearchEngine=true;model.custom.AdjustedTerms="";model.custom.OriginalTerms="";model.custom.recentItemsLoaded=false;model.custom.initialNumBlocks=6;model.custom.lazyLoadBlockIncrement=8;model.custom.searchErrorMessage="";model.isSearchMode=(isSearch=="1")?true:false;model.productServiceURL="/api/search/searchcategory";model.productServiceType="POST";if(typeof(layoutData)!="undefined"&&layoutData!=null&&typeof(layoutData.tiles)!="undefined"&&layoutData.tiles!=null){marketingLayoutData.tiles=layoutData.tiles;}layoutData.tiles=[];if(hash!=""){stateSnapshot=URLFactory.convertHashToState(hash);}else if(searchParams!=""){stateSnapshot=URLFactory.convertHashToState(searchParams);if(cidParam!=""){stateSnapshot.category=cidParam;}}else{stateSnapshot=model.getStateSnapshot();if(cidParam!=""){stateSnapshot.category=cidParam;}}stateSnapshot.pageSize="10000";if(stateSnapshot.sortCriteria=="1"&&(model.custom.isSearchEngine==false||locale.toLowerCase()=="zh-cn"||locale.toLowerCase()=="zh-hant"||(locale.toLowerCase()=="intl"&&isRetail.toLowerCase()=="false"))){stateSnapshot.sortCriteria=StateModel.SORT_CRITERIA_DEFAULT;}if(model.isSearchMode==true){$("#sort a[data-filter='5']").attr("data-filter","11");$("#ctlHeader_ctlBanner_holiday_banner").hide();$("#search-fields").show();$("#browse-fields").hide();$("#results").addClass("search");if(searchKeywordQS!=""){stateSnapshot.searchTerms=searchKeywordQS;}if(stateSnapshot.searchTerms!=""){$("#search-fields").append("&ldquo;",stateSnapshot.searchTerms.split("-").join(" ").split("and^").join("&amp;").split("~").join("-"),"&rdquo;");}else if(searchKeywordQS!=""){$("#search-fields").append("&ldquo;",searchKeywordQS.split("-").join(" ").split("and^").join("&amp;").split("~").join("-"),"&rdquo;");}if(stateSnapshot.sortCriteria==null||stateSnapshot.sortCriteria==9999||stateSnapshot.sortCriteria=="9999"||stateSnapshot.sortCriteria==""){stateSnapshot.sortCriteria=11;}}else{$("#search-fields").hide();$("#browse-fields").show();}$("#sortLabel #sort-filter").html($("#sort a[data-filter='"+stateSnapshot.sortCriteria+"']").text());$(".error-holder").hide();model.pCachedProducts.lookup={};$(model).bind("getProductsComplete",function(e,data){selectedFilter=false;var tempState;var hideDesigners=false;clearBrowseGrid();if(locale.toLowerCase()!="en-us-estr"&&locale.toLowerCase()!="ja-jp-estr"&&locale.toLowerCase()!="en-us-stmt"&&locale.toLowerCase()!="en-us-pkb"&&isRetail.toLowerCase()=="false"&&isgTrade.toLowerCase()=="false"&&isPreviewVersion.toLowerCase()=="false"){populateBreadcrumb(data.results.BreadCrumb);populateJsonLDScript(data.results.BreadCrumb);if(typeof(data.results.BreadCrumb)!="undefined"&&data.results.BreadCrumb!=null){BREADCRUMB_CURRENT_FILTERS=data.results.BreadCrumb;}}$("#grid-popup").hide();layoutData.tiles=[];model.custom.gridHTMLBlocks=[];model.custom.gridLayoutBlocks=[];model.custom.gridSizeBlocks=[];model.custom.lastBlockShown=-1;model.custom.engageLazyLoad=false;model.custom.isSearchEngine=(typeof(data.results)!="undefined"&&typeof(data.results.SearchEngine)!="undefined"&&data.results.SearchEngine!=null&&data.results.SearchEngine=="0")?false:true;model.custom.AdjustedTerms="";model.custom.OriginalTerms="";model.custom.searchErrorMessage=(typeof(data.results.ErrorMessage)=="undefined"||data.results.ErrorMessage==null)?"":data.results.ErrorMessage;model.custom.AdjustedTerms=(data.results.SearchAdjustments==null||data.results.SearchAdjustments.AdjustedTerms==null)?"":data.results.SearchAdjustments.AdjustedTerms;model.custom.OriginalTerms=(data.results.SearchAdjustments==null||data.results.SearchAdjustments.OriginalTerms==null)?"":data.results.SearchAdjustments.OriginalTerms;$(window).unbind("scroll.browse");$("#viewRemainingButton").hide();if(data.results!=null){if(locale.toLowerCase()!="en-us-pkb"){Is_Omniture_Enabled='true';}if(data.results.RedirectURL!=null&&data.results.RedirectURL!=""&&(window.location.pathname+window.location.search!=data.results.RedirectURL)){window.location=data.results.RedirectURL;}else{$("#frmCategoryBrowsePage #filters").css("visibility","visible");var dtmRecordsCount="";if(data.results!=null){dtmRecordsCount=data.results.NumofRecords;}if(data.results!=null&&data.results.RelevancySortOrder!=null){dtmSortMethod=data.results.RelevancySortOrder
}else{dtmSortMethod="";}if(trackDtmPageView){trackBGSortMethod(dtmSortMethod,dtmRecordsCount);trackDtmPageView=false;}if(trackSortOption==true&&dtmSortOption!=""){TrackSortOptions("",dtmSortOption,dtmSortMethod);}this.pCategoryMenus=data.results.Menus;var contentTiles=false;if(data.results.JSONFilterContentTiles!=null&&Number(data.results.JSONFilterContentTiles.NumofRecords)>0){this.pCachedMarketingTiles.list=data.results.JSONFilterContentTiles.MarketingTiles;var newTilesHTML="";contentTiles=true;for(var i=0;i<Number(data.results.JSONFilterContentTiles.NumofRecords);i++){newTilesHTML+=data.results.JSONFilterContentTiles.MarketingTiles[i].MediaContent;}if($("#newContentTiles").length==0){$("body").append("<div id='newContentTiles'>"+newTilesHTML+"</div>");}else{$("#newContentTiles").html(newTilesHTML);}$("#newContentTiles > div").each(function(i){$(this).attr("id",$(this).attr("id")+"_template");});}else if(data.results.JSONFilterContentTiles==null){this.pCachedMarketingTiles.list=marketingLayoutData.tiles;}else{this.pCachedMarketingTiles.list="";}for(i=0,n=this.pCachedMarketingTiles.list.length;i<n;i++){this.pCachedMarketingTiles.lookup[this.pCachedMarketingTiles.list[i].Id]=this.pCachedMarketingTiles.list[i];}this.pCachedProducts.list=data.results.Items;for(i=0,n=data.results.Items.length;i<n;i++){this.pCachedProducts.lookup[data.results.Items[i].Sku]=data.results.Items[i];}this.layoutType=data.results.Layout;this.numProducts=data.results.NumofRecords;if(!isSearch&&data.results.SEOAttributes!=null){var isCanonicalDisabled=false;for(var i=0;i<data.results.Menus.length;i++){if(data.results.Menus[i].isCanonicalDisabled){isCanonicalDisabled=true;break;}}if(isCanonicalDisabled){$("link[rel='canonical']").remove();if($("meta[name='robots']").length==0){$("head").append("<meta name='robots' content='NOINDEX, NOFOLLOW'>");}}else{$("link[rel='canonical']").remove();$("head").append("<link rel='canonical' href='"+data.results.SEOAttributes.CanonicalURL+"'>");$("meta[name='robots']").remove();}$("#browse-fields h1 span.catName").html(data.results.SEOAttributes.H1Tag);$("meta[name='description']").attr("content",data.results.SEOAttributes.MetaDescription)
$("meta[name='keywords']").attr("content",data.results.SEOAttributes.MetaKeywords)
document.title=data.results.SEOAttributes.PageTitle;$("link[rel='alternate']").attr("href",data.results.SEOAttributes.AlternateURL)
}$("div.num-results, span.num-results").html("("+this.numProducts+")");$(".filtersVF .num-results").html("("+this.numProducts+")");if(model.isSearchMode==true){renderBrowseGrid(this.pCachedProducts.list,null);loadRelatedStories(this.pCachedProducts.list);}else{renderBrowseGrid(this.pCachedProducts.list,this.pCachedMarketingTiles.list);}var open=$(".filters-menu a.active").attr("data-filter-group");var c=0;var menusHtml='';var menuItemsHtml='';var menuCategoryItemsHtml='';var designerSubMenu='';var breadcrumbsHtml='';var showPrice=true;var priceRangeSelected=false;var state=model.getStateSnapshot();var formattedLowPrice=data.results.FormattedLowPrice;var formattedHighPrice=data.results.FormattedHighPrice;var minPrice=data.results.MinPrice;var maxPrice=data.results.MaxPrice;minInputPrice=data.results.MinPrice;maxInputPrice=data.results.MaxPrice;var minRangeModel=state.lowRange;var maxRangeModel=state.highRange;if(locale.toLowerCase()=="zh-hant"||(locale.toLowerCase()=="intl"&&isRetail.toLowerCase()=="false")){showPrice=false;}if(data.results.NumofRecords==1){$(".zero-results").hide();}else if(data.results.NumofRecords==0){$(".zero-results").show();}else{$(".zero-results").hide();}var currencySymbol="$";switch(locale.toLowerCase()){case"en-ca":case"fr-ca":currencySymbol="CDN$";break;case"es-mx":currencySymbol="MX$";break;case"pt-br":currencySymbol="R$";break;case"ja-jp":case"ja-jp-estr":case"ja-jp-trade":currencySymbol="&yen;";break;case"en-au":currencySymbol="AU$";break;case"en-gb":currencySymbol="&pound;";break;case"de-at":case"en-be":case"fr-fr":case"de-de":case"en-ie":case"it-it":case"en-nl":case"es-es":currencySymbol="&euro;";break;case"ko-kr":currencySymbol="₩";break;case"ru-ru":currencySymbol="₽";break;case"zh-cn":currencySymbol="人民币";break;}$(".price-symbol").html(currencySymbol);setTimeout(function(){var paddingLeft=hiddenWidth($(".price-symbol"))+6;$(".price-symbol + input").css("padding-left",paddingLeft);},20);var designerCollectionData="";if(typeof(data.results.Menus)!="undefined"&&data.results.Menus!=null&&data.results.Menus.length>0){data.results.Menus.sort(function(a,b){return(a.DisplayOrder>b.DisplayOrder)?1:((b.DisplayOrder>a.DisplayOrder)?-1:0);});var checkForDesigners=false;var checkForCategories=false;for(var i=0;i<data.results.Menus.length;i++){if(data.results.Menus[i].DimensionGroup=="DesignersCollections"){checkForDesigners=true;break;}}for(var i=0;i<data.results.Menus.length;i++){if(data.results.Menus[i].DimensionGroup=="Categories"){checkForCategories=true;break;}}$.each(data.results.Menus,function(){var filterGroup=this.DimensionGroup;if(this.DimensionGroup=="Price"&&showPrice==true){if(minRangeModel==""||minRangeModel=="0"||minRangeModel==0){minRangeModel=Math.round(Number(minPrice));}else{priceRangeSelected=true;}if(maxRangeModel==""||maxRangeModel=="0"||maxRangeModel==0){maxRangeModel=Number(maxPrice);}else{priceRangeSelected=true;}if(priceRangeSelected==true){var priceRangeLabel=formattedLowPrice+" - "+formattedHighPrice;var tempLowRange=state.lowRange;var tempHighRange=state.highRange;state.lowRange="";state.highRange="";priceResetQS=URLFactory.convertStateToHash(state);state.lowRange=tempLowRange;state.highRange=tempHighRange;$(".lowRangeEntry").val(minRangeModel);$(".highRangeEntry").val(maxRangeModel);var resetURL=window.location.pathname.split("/");var newResetURL=[];for(var i=0;i<resetURL.length;i++){if(resetURL[i].indexOf("price")<0){newResetURL.push(resetURL[i]);}}breadcrumbsHtml+='<a href="'+newResetURL.join("/")+'" data-hash="'+priceResetQS+'">'+priceRangeLabel+' &times;</a>';$(".zero-results").hide();if(data.results.NumofRecords==0){$(".filter-price-range").addClass("errors");}else{$(".filter-price-range").removeClass("errors");}c++;}else{if(this.MinSelectedPrice){$(".lowRangeEntry").val(this.MinSelectedPrice);$(".highRangeEntry").val(this.MaxSelectedPrice);}else{$(".lowRangeEntry").val('');$(".highRangeEntry").val('');}$(".filter-price-range").removeClass("errors");if(data.results.NumofRecords==0){$(".zero-results").show();}else{$(".zero-results").hide();}}}if(filterLabels[this.DimensionGroup]){var label=filterLabels[this.DimensionGroup];}else{var label=this.DimensionGroup;}if((this.DimensionGroup!="Price"||(this.DimensionGroup=="Price"&&showPrice==true))||(this.isTypes&&!checkForCategories)){if(this.DimensionGroup=="GemstoneColor"){return true;}if(!this.isCollection||(this.isCollection&&!checkForDesigners)){if(this.DimensionGroup=="DesignersCollections"){var collectionsSubGrounpShown=false;var locationOfSubGroup=-1;for(var i=0;i<data.results.Menus.length;i++){if(data.results.Menus[i].DimensionGroup.indexOf("DesignersCollectionsSub")>-1){collectionsSubGrounpShown=true;designerCollectionData=this;break;}}if(collectionsSubGrounpShown&&this.MenuItems.length<=1){label=filterLabels["Collections"];}}menusHtml+='<div class="flex-item"><a href="javascript:;" class="avenir type-cta " data-filter-group="'+this.DimensionGroup+'">'+label+' <span class="show-for-closed"><i class="icon-font">directional_down</i></span></a></div>';}this.MenuItems.sort(function(a,b){return(a.refinementDisplayOrder>b.refinementDisplayOrder)?1:((b.refinementDisplayOrder>a.refinementDisplayOrder)?-1:0);});var i=0;var designerMainMenu='';var designLocation=0;if(this.DimensionGroup!="Categories"){if(this.DimensionGroup=="DesignersCollections"){menuItemsHtml+='<div class="designers-menu" data-filter-group="'+this.DimensionGroup+'" style="display: none;">';designerMainMenu+='<div class="flex-block flex-shrink designers-menu__collections" data-linebreaks='+designLocation+' style="width:100%"><div class="flex-item new-menu-items">';}else if(this.DimensionGroup=="DesignersCollectionsSub"&&checkForDesigners){designerSubMenu+='<div class="flex-block flex-shrink designers-menu__collections-sub" data-linebreaks-sub='+designLocation+' style="width:100%"><div class="flex-item new-menu-items">';}else{menuItemsHtml+='<div class="flex-block flex-shrink" data-filter-group="'+this.DimensionGroup+'" style="display: none;">';menuItemsHtml+='<div class="flex-item new-menu-items">';}}else{menuItemsHtml+='<div class="flex-block flex-shrink categories-menu" data-filter-group="'+this.DimensionGroup+'" style="display: none;">';}var parentGroup=this.DimensionGroup;$.each(this.MenuItems,function(){var friendlyURL=this.refinementFriendlyUrl;var hash=this.refinementQS;if(this.resetQS){hash=this.resetQS;friendlyURL=this.resetFriendlyUrl;}var noFollow=(this.isSEOIndexFollow!="null"&&this.isSEOIndexFollow)?"nofollow noindex":"";var cssClass='';if(this.isRefinementSelected==true){cssClass+='active';breadcrumbsHtml+='<a href="'+friendlyURL+'" data-hash="'+hash+'" data-filter-type="'+filterGroup+'" rel="'+noFollow+'">'+this.Name+' &times;</a>';c++;}if(this.refinementItemCount==0){cssClass+=' disabled';}if(this.refinementItemCount==0&&this.ID==0){hideDesigners=true;}if(parentGroup=="DesignersCollections"){if(this.lineBreakGroupID==designLocation){if(i>0&&i%8==0){designerMainMenu+='</div><div class="flex-item new-menu-items">';}designerMainMenu+='<a href="'+friendlyURL+'" data-hash="'+hash+'" class="avenir type-cta-alt '+cssClass+'" rel="'+noFollow+'"><span class="checkbox"><i class="icon-font">checkmark</i></span>'+this.Name+' ('+this.refinementItemCount+')</a>';i++;}else{designLocation=this.lineBreakGroupID;designerMainMenu+='</div></div><div class="flex-block flex-shrink designers-menu__collections" data-linebreaks='+designLocation+' style="width:100%"><div class="flex-item new-menu-items">';designerMainMenu+='<a href="'+friendlyURL+'" data-hash="'+hash+'" class="avenir type-cta-alt '+cssClass+'" rel="'+noFollow+'"><span class="checkbox"><i class="icon-font">checkmark</i></span>'+this.Name+' ('+this.refinementItemCount+')</a>';i=1;}}else if(parentGroup=="DesignersCollectionsSub"&&checkForDesigners){if(i>0&&i%8==0){designerSubMenu+='</div><div class="flex-item new-menu-items">';}designerSubMenu+='<a href="'+friendlyURL+'" data-hash="'+hash+'" class="avenir type-cta-alt '+cssClass+'" rel="'+noFollow+'"><span class="checkbox"><i class="icon-font">checkmark</i></span>'+this.Name+' ('+this.refinementItemCount+')</a>';i++;}else if(parentGroup!="Categories"){if(i>0&&i%8==0){menuItemsHtml+='</div><div class="flex-item new-menu-items">';}menuItemsHtml+='<a href="'+friendlyURL+'" data-hash="'+hash+'" class="avenir type-cta-alt '+cssClass+'" rel="'+noFollow+'"><span class="checkbox"><i class="icon-font">checkmark</i></span>'+this.Name+' ('+this.refinementItemCount+')</a>';i++;}else{if(!isCatAllArrayCreated){if(this.isRefinementSelected){catAllArray[this.ID]=true;}else{catAllArray[this.ID]=false;}}var isActive=false;if(cssClass=="active"){var countOfActive=0;for(var j=0;j<data.results.Menus.length;j++){if(data.results.Menus[j].ParentCategoryID==this.ID){for(var k=0;k<data.results.Menus[j].MenuItems.length;k++){if(data.results.Menus[j].MenuItems[k].isRefinementSelected==true){countOfActive++;}}break;}}if(countOfActive==0){isActive=true;}}if(!isActive){cssClass="";}menuItemsHtml+='<div class="flex-item"><a data-filter-count="'+this.refinementItemCount+'" data-filter-id="'+this.ID+'" href="'+this.refinementFriendlyUrl+'" data-hash="'+this.refinementQS+'" data-reset-hash="'+this.resetQS+'" data-reset-url="'+this.resetFriendlyUrl+'"  data-isActive="'+cssClass+'" rel="'+noFollow+'">'+this.Name+' <span class="show-for-closed"><i class="icon-font">directional_down</i></span></a></div>';}});if(designerMainMenu!=""){designerMainMenu+='</div>';}menuItemsHtml+=designerMainMenu;menuItemsHtml+='</div>';menuItemsHtml+='</div>';}else if(this.isTypes){$.each(this.MenuItems,function(){var friendlyURL=this.refinementFriendlyUrl;var hash=this.refinementQS;if(this.resetQS){hash=this.resetQS;friendlyURL=this.resetFriendlyUrl;}var noFollow=(this.isSEOIndexFollow!="null"&&this.isSEOIndexFollow)?"nofollow noindex":"";if(this.isRefinementSelected==true){breadcrumbsHtml+='<a href="'+friendlyURL+'" data-hash="'+hash+'" data-filter-type="'+filterGroup+'" rel="'+noFollow+'">'+this.Name+' &times;</a>';c++;}});}});$("#sort a").each(function(){var tempURL=data.results.CurrentStateURL.split("/");var dataFilter=$(this).attr("data-filter");var tempText=getUrlUniqueIDFromSortValue(dataFilter);tempURL[tempURL.length-1]="sort-"+tempText;tempURL=tempURL.join("/");$(this).attr("href",tempURL);});var sortOption=stateSnapshot.sortCriteria;if(isSearch&&stateSnapshot.sortCriteria=="5"){sortOption="11";}$('.jq-toggle-sort[rel="sort"] span.data-filter').text($("#sort a[data-filter='"+sortOption+"']").text());var selectedSort=$('#sort a[data-filter="'+snapshot.sortCriteria+'"]');$("#sort a").removeClass("active");selectedSort.addClass("active");$(".jq-toggle-sort span.data-filter").text(selectedSort.text());var tempURL=data.results.CurrentStateURL.split("/");tempURL=[tempURL[0],tempURL[1],tempURL[2]];$(".jq-clear-all").attr("href",tempURL.join("/"));isCatAllArrayCreated=true;}if(c==0){$(".jq-clear-all").hide();}else{$(".jq-clear-all").show();}$(".filters-menu").html(menusHtml);$(".filters-menu-items").html(menuItemsHtml);$(".designers-menu").append(designerSubMenu);$(".new-browse-filters-menus-categories").html(menuCategoryItemsHtml);$(".filter-breadcrumbs").html(breadcrumbsHtml);if($(".categories-menu__sub-menu").length>0){$(".filters-menu-items a[data-filter-id='"+$(".categories-menu__sub-menu").attr("data-filter-id")+"']").click();}$(".filters-menu-items > div").each(function(){var $parent=$('.filters-menu a[data-filter-group="'+$(this).attr("data-filter-group")+'"]');if($(this).attr("data-filter-group")!="Price"){$(this).css("padding-left",$parent[0].offsetLeft);}else if($(this).attr("data-filter-group")=="Price"&&$parent.hasClass("active")){var $child=$(this);var hasInputs=($child.find(".filter-price-range").length>0)?true:false;if(!hasInputs){if($(this)[0].offsetLeft>$("#wrapper").width()/2){$child.prepend($(".filter-price-range").clone());$(".filter-price-range").show().addClass("flex-item");$child.css("padding-left",$parent[0].offsetLeft-$(".filter-price-range").outerWidth());}else{$child.css("padding-left",$(this)[0].offsetLeft);$child.append($(".filter-price-range").clone());$(".filter-price-range").show().addClass("flex-item");}}}});var hideCollectionMenu=false;if(collectionLineBreak0Clicked&&designerSubMenu!=""&&(designerCollectionData!=""&&designerCollectionData.MenuItems.length>1)){$(".designers-menu .designers-menu__collections:last").hide();collectionLineBreak0Clicked=false;selectedDesigners=true;}else if(designerCollectionData!=""&&designerCollectionData.MenuItems.length<=1){$(".designers-menu .designers-menu__collections-sub").show();hideCollectionMenu=true;}else{$(".designers-menu .designers-menu__collections-sub").hide();hideCollectionMenu=true;}if(!hideCollectionMenu&&$(".new-browse-filters__top-level a[data-filter-group='DesignersCollections']").hasClass("active")){$(".new-browse-filters__designer-options").css("padding-left",$(".new-browse-filters__top-level a[data-filter-group='DesignersCollections']")[0].offsetLeft);$(".new-browse-filters__designer-options").show();$(".new-browse-filters__designer-options").find("a.active").removeClass("active");if(selectedDesigners){$(".new-browse-filters__designer-options").find("a[data-linebreaks='0']").addClass("active");selectedDesigners=false;}else{$(".new-browse-filters__designer-options").find("a[data-linebreaks='1']").addClass("active");}}else{$(".new-browse-filters__designer-options").hide();}if(hideDesigners){$('.filters-menu a[data-filter-group="DesignersCollections"]').remove();$('.filters-menu-items div[data-filter-group="DesignersCollections"]').remove();}if(open){$('.filters-menu a[data-filter-group="'+open+'"]').trigger("click");}initRollbar();$('.filter-loader').hide();var images=new Array();var imgcount=0;$(".browse-grid > div > img, #engagement-grid img").each(function(){if(!$(this).parent().parent().hasClass("text-container")){var src=$(this).attr("src");images[imgcount]=new Image();images[imgcount].src=src;imgcount++;src=$(this).attr("data-rollover-image");if(typeof(src)!="undefined"&&src!=null&&src!=""){images[imgcount]=new Image();images[imgcount].src=src;imgcount++;}}});}renderExceptions();}else{renderExceptions(templateStrings.searchServiceErrorLabel,"","");}if(model.custom.recentItemsLoaded==false){getRecentlyViewedItems();model.custom.recentItemsLoaded=true;}if($("#hideSoldIRs").length>0){if(model.getStateSnapshot().soldIR=="0"){$("#hideSoldIRs").prop("checked",true);}else{$("#hideSoldIRs").prop("checked",false);}}if($("body").hasClass("ios")!=true&&$("body").hasClass("android")!=true){$("#viewRemainingButton").hide();model.custom.engageLazyLoad=true;TrackViewRemainingItems("Category Browse - "+categoryName,"View Remaining Desktop Button -> Seen "+(model.custom.lastBlockShown)+" of "+model.custom.gridLayoutBlocks.length+" blocks");}setPagePosition(model.getStateSnapshot().pagePosition);lazyLoad();});$(model).bind("getProductsError",function(e,data){StateModel.getInstance().custom.isSearchEngine=false;renderExceptions(templateStrings.searchServiceErrorLabel,"","",true);});$(model).bind("setStateSnapshotRequested",function(e,data){for(i=0,n=data.updatedProperties.length;i<n;i++){$(this).trigger(data.updatedProperties[i]+"UpdateRequested",{value:data.state[data.updatedProperties[i]]});}});$(model).bind("setStateSnapshotComplete",function(e,data){for(i=0,n=data.updatedProperties.length;i<n;i++){$(this).trigger(data.updatedProperties[i]+"Completed",{value:data.state[data.updatedProperties[i]]});}getSavedItemsList();});$("body").on("click",".browse-grid > div > img, .browse-grid .subrow > img",function(e){if(hoverOnEvent!="click"){$(this).trigger(hoverOnEvent);}});$("body").on(hoverOnEvent,".browse-grid > div > a > img, .browse-grid .subrow > a > img",function(e){var img=$(this);if(hoverOnEvent!="click"){if(timer){clearTimeout(timer);timer=null;}timer=setTimeout(function(){if(img.parents(".text-container").length==0){$("#flydown").fadeOut(300);$("#nav .flydowns a").removeClass("selected");$("#saved").fadeOut(300);$("a.searchstores, .bag a").removeClass("selected");$("#filters a").removeClass("selected");$("#grid-popup").hide();displayTooltipData(img);}clearTimeout(timer);timer=null;},500);}else{if(img.parents(".text-container").length==0){$("#flydown").fadeOut(300);$("#nav .flydowns a").removeClass("selected");$("#saved").fadeOut(300);$("a.searchstores, .bag a").removeClass("selected");$("#filters a").removeClass("selected");$("#grid-popup").hide();displayTooltipData(img);}}});$("body").on("click","#grid-popup .close",function(e){$("#grid-popup").hide();return false;});$("body").on(hoverOffEvent,"#grid-popup",function(e){if($(e.relatedTarget).attr("class")!=$("#grid-popup").attr("class")&&e.relatedTarget!=null&&!$(e.relatedTarget).parents("#grid-popup").length){var theselect=$("#grid-popup select");var thebtn=$("#grid-popup a.btn");if(e.target!=theselect[0]&&e.target.parentElement!=theselect[0]&&e.target!=thebtn[0]){$(this).fadeOut(300);}}});$("body").on("click",".jq-clear-all",function(e){$('.filter-loader').show();var model=StateModel.getInstance();var snapshot=model.getStateSnapshot();snapshot.lowRange="";snapshot.highRange="";snapshot.refinement="";model.setStateSnapshot(snapshot);var updateFilters={action:"resetAll",categoryName:"",filterName:"",filterType:"",pageName:"Category Browse (Endeca)"
};TrackEndecaDimensions(updateFilters);window.history.pushState(snapshot,"",$(this).attr("href"));$(".visualFilterBtn").removeClass("addVFBtnActive");if($(".vf").length>0){$(".vf").find(".selected").removeClass("selected");$(".vf").find(".catName span:not('.noQuestion1')").each(function(){$(this).html("");});$(".vf").find(".catName br").each(function(){$(this).hide();});$(".vf span.catName").html($("#browse-fields span.catName").html());$("#filters .filterVFShow").html("");}return false;});$("body").on("click",".new-browse-filters__designer-options a",function(e){var linebreaks=parseInt($(this).attr("data-linebreaks"));$(this).parent().parent().find(".active").removeClass("active");$(this).addClass("active");if(linebreaks==0){$(".designers-menu .designers-menu__collections:last").hide();$(".designers-menu .designers-menu__collections-sub:last").show();}else{$(".designers-menu .designers-menu__collections-sub:last").hide();$(".designers-menu .designers-menu__collections:last").show();}return false;});$("body").on("click",".jq-toggle-filters, .jq-toggle-sort",function(e){if(!$(this).hasClass("active")){var offset=$(this).offset().left-50-$("#wrapper").offset().left;var maxWidth=$("#wrapper").width();$(this).addClass("active");$("#flydown").fadeOut(300);$("#nav .flydowns a").removeClass("selected");$("#saved").fadeOut(300);$("a.search, a.searchstores, .bag a").removeClass("selected");$("#grid-popup").hide();var option=$(this).attr("rel");$("#filters a").removeClass("selected");$(this).addClass("selected");$(".new-browse-filters__designer-options").hide();if(option==="sort"){if($("#categoryFlyout").is(":visible")&&$("#categoryFlyout #sort").is(":visible")){$(".filters-menu a").attr("aria-expanded","false");$(".jq-toggle-sort").attr("aria-expanded","false");$(".categoryFlyout__closeFilters").removeClass("filtersOpen").removeClass("sortOpen");}else{$(".filters-menu a").attr("aria-expanded","false");$(".jq-toggle-filters").removeClass("filters-open");$(".jq-toggle-sort").attr("aria-expanded","true");$(".categoryFlyout__closeFilters").removeClass("filtersOpen")
$(".categoryFlyout__closeFilters").addClass("sortOpen");}$(".filters-menu-items > div").hide();$(".new-browse-filters__categories > div").hide();$("#sort").css("display","flex");$(".filters-menu a").removeClass("active");$(".categories-menu a").removeClass("active");$(".jq-toggle-sort").attr("aria-expanded","true");offset-=150;}else{if($("#categoryFlyout").is(":visible")&&$(".filters-menu").is(":visible")){$(".jq-toggle-filters").removeClass("filters-open");$(".categoryFlyout__closeFilters").removeClass("filtersOpen").removeClass("sortOpen");$(".filters-menu a").attr("aria-expanded","false");$(".jq-toggle-sort").attr("aria-expanded","false");$("#categoryFlyout").slideUp(300);}else{$(".jq-toggle-filters").addClass("filters-open");$(".filters-menu a").attr("aria-expanded","true");$(".jq-toggle-sort").attr("aria-expanded","false");$(".categoryFlyout__closeFilters").removeClass("sortOpen")
$(".categoryFlyout__closeFilters").addClass("filtersOpen");$("#categoryFlyout").slideDown(300);}$("#sort").hide();$(".filters-menu, .filters-menu-items").show();}}else{$("#sort").hide();$(this).removeClass("active");}return false;});var snapshot=model.getStateSnapshot();if(!snapshot.sortCriteria||snapshot.sortCriteria==9999){snapshot.sortCriteria="5";}var selectedSort=$('#sort a[data-filter="'+snapshot.sortCriteria+'"]');selectedSort.addClass("active");$(".jq-toggle-sort span.data-filter").text(selectedSort.text());$("body").on("click "+hoverOnEvent,".filters-menu a",function(e){if($(this).attr("id")=="searchPriceRangeButton"){return false;}if($(this).hasClass("active")){$(this).removeClass("active");$(this).parent().removeClass("active");$('.filters-menu-items > div').hide();$("#filters").removeClass("open");$('.filter-loader').hide();$(".new-browse-filters__designer-options").hide();$(".floating_filters").removeClass("isOpen");$(".categories-menu__sub-menu").remove();$(".categories-menu .open").removeClass("open");$(".categories-menu > div.active").removeClass("active");return false;}$(".itemPopUp").remove();$("#filters").addClass("open");$(".floating_filters").addClass("isOpen");$(".filters-menu .active").removeClass("active");if($(this).attr("data-filter-group")!="Categories"){$('.categories-menu__sub-menu').remove();}$(this).addClass("active");$(this).parent().addClass("active");var filterGroup=$(this).attr("data-filter-group");$(this).attr("aria-expanded","true");$('.filters-menu-items > div').hide();$('#sort').hide();$('.jq-toggle-sort').removeClass("active");$('.filters-menu-items > div[data-filter-group="'+filterGroup+'"]').show();if(filterGroup=="Price"){var $child=$('.new-browse-filters-menus div[data-filter-group="'+filterGroup+'"]');var hasInputs=($child.find(".filter-price-range").length>0)?true:false;if(!hasInputs){if($(this)[0].offsetLeft>$("#wrapper").width()/2){$child.prepend($(".filter-price-range").clone());$(".filter-price-range").show().addClass("flex-item");$child.css("padding-left",$(this)[0].offsetLeft-$(".filter-price-range").outerWidth());}else{$child.css("padding-left",$(this)[0].offsetLeft);$child.append($(".filter-price-range").clone());$(".filter-price-range").show().addClass("flex-item");}}}if($(".designers-menu .designers-menu__collections-sub").length>0&&$(this).attr("data-filter-group")=="DesignersCollections"&&$(this).text().split(" directional_down")[0]==filterLabels["DesignersCollections"]){$(".new-browse-filters__designer-options").css("padding-left",$(".new-browse-filters__top-level a[data-filter-group='DesignersCollections']")[0].offsetLeft);$(".new-browse-filters__designer-options").show();if(selectedDesigners){$(".new-browse-filters__designer-options").find("a.active").removeClass("active");$(".new-browse-filters__designer-options").find("a[data-linebreaks='0']").addClass("active");selectedDesigners=false;}else if(!$(".new-browse-filters__designer-options").find("a[data-linebreaks='0']").hasClass("active")){$(".new-browse-filters__designer-options").find("a[data-linebreaks='1']").addClass("active");}}else{$(".new-browse-filters__designer-options").hide();}return false;});$("body").on("click "+hoverOnEvent,".filters-menu-items a, .new-browse-filters__categories a, #sort a, .filter-breadcrumbs a",function(e){var $menu=$(this);if(e.type=="click"){if($menu.closest(".designers-menu__collections").attr("data-linebreaks")==0){collectionLineBreak0Clicked=true;}if($menu.hasClass("disabled")){return false;}if($menu.attr("id")=="searchPriceRangeButton"){return;}if($menu.closest(".categories-menu").length>0){if(!$menu.hasClass("open")){$menu.closest(".categories-menu").find(".active").removeClass("active");$menu.addClass("open");$menu.parent().addClass("active");$('.filter-loader').show();$.ajax({url:"/api/search/searchcategory",type:"POST",data:'{"SearchQueryString": "'+$menu.attr("data-hash")+'", "IsSearchMode": false, "SessionID": "'+browserSessionID+'", "UserID": "'+sessionUserid+'"}',dataType:"json",contentType:"application/json; charset=utf-8",success:function(data){appendTypeMenu(data,$menu);},error:function(data){}});}else{$menu.removeClass("open");$menu.parent().removeClass("active");$('.categories-menu__sub-menu').remove();}return false;}else if(!selectedFilter){selectedFilter=true;var action;var filterName;var filterType;if($menu.parents(".filter-breadcrumbs").length){action="remove";filterName=$menu.text().split("×")[0].trim();filterType=$menu.attr("data-filter-type");}else{filterName=$menu.text().split("checkmark")[1].split(" (")[0];if($menu.closest(".categories-menu__sub-menu").length==1){filterType=$(".categories-menu").attr("data-filter-group");}else if($menu.parent().parent().attr("data-filter-group")!=undefined){filterType=$menu.parent().parent().attr("data-filter-group");}else{filterType=$menu.closest(".designers-menu").attr("data-filter-group");}if($menu.hasClass("active")){action="remove";}else{action="add";}}if($menu.hasClass("spacer")==false){$('.filter-loader').show();var snapshot;if($(window).scrollTop()>$("#header").outerHeight()+40){$('body,html').animate({scrollTop:$("#header").outerHeight()+40},500);}var hashValue=$menu.attr("data-hash");var friendlyValue=$menu.attr("href");if($menu.closest(".categories-menu__sub-menu").length>0){if($menu.hasClass("cat_all")&&!$menu.hasClass("active")){$menu.closest(".categories-menu__sub-menu").find("a").removeClass("active");catAllArray[$menu.closest(".categories-menu__sub-menu").attr("data-filter-id")]=true;}else if($menu.hasClass("cat_all")&&$menu.hasClass("active")){catAllArray[$menu.closest(".categories-menu__sub-menu").attr("data-filter-id")]=false;}else{$menu.closest(".categories-menu__sub-menu").find("a.cat_all").removeClass("active");catAllArray[$menu.closest(".categories-menu__sub-menu").attr("data-filter-id")]=false;}}var sortValue=$menu.attr("data-filter");if($menu.closest(".flex-block").attr("id")=="sort"){snapshot=model.getStateSnapshot();snapshot.sortCriteria=sortValue;snapshot.pagePosition="";model.setStateSnapshot(snapshot);$(".jq-toggle-sort span.data-filter").text($menu.text());$menu.addClass("active").siblings().removeClass("active");}else{snapshot=URLFactory.convertHashToState(hashValue);$menu.addClass("active");if($("#hideSoldIRs").prop('checked')==true){snapshot.soldIR="0";}else{snapshot.soldIR="";}model.setStateSnapshot(snapshot);}if($menu.closest(".flex-block").attr("id")!="sort"){friendlyValue+="/sort-"+getUrlUniqueIDFromSortValue($("#sort a.active").attr("data-filter"));}window.history.pushState(snapshot,"",friendlyValue);$("#grid-popup").hide();if(isSearch){var OmniPageName="Generic Search (Endeca)";var OmniCatName=null;}else{var OmniPageName="Category Browse (Endeca)";var OmniCatName=$.trim($("h1").text().split(" (")[0]);}if($menu.parents("#sort").length>0){trackSortOption=true;dtmSortOption=$menu.text();}else{var updateFilters={"pageName":OmniPageName,"filterType":filterType,"filterName":filterName,"categoryName":OmniCatName,"action":action
};TrackEndecaDimensions(updateFilters);trackSortOption=false;dtmSortOption="";}resetCategoryText();}return false;}else{return false;}}else{if($menu.closest(".categories-menu").length>0){if(!$menu.hasClass("open")){$menu.parent().siblings().children().removeClass("open");$menu.parent().siblings().removeClass("active");$('.categories-menu__sub-menu').remove();$menu.closest(".categories-menu").find(".active").removeClass("active");$menu.addClass("open");$menu.parent().addClass("active");$('.filter-loader').show();$.ajax({url:"/api/search/searchcategory",type:"POST",data:'{"SearchQueryString": "'+$menu.attr("data-hash")+'", "IsSearchMode": false, "SessionID": "'+browserSessionID+'", "UserID": "'+sessionUserid+'"}',dataType:"json",contentType:"application/json; charset=utf-8",success:function(data){appendTypeMenu(data,$menu);},error:function(data){}});}}}});$("body").on("click",".tileShopNow, .imgTitle",function(){$($(this).siblings(".itemDiv"))[0].click()
});$(window).bind('popstate',function(e){if(window.history.state!=null){model.setStateSnapshot(window.history.state);}if($(".vf").is(":visible")){var filters=window.location.pathname.split("/");var vfFilters=[];$(".vf .container").find('a').each(function(){vfFilters.push($(this).attr("href"));$(this).removeClass("selected");});for(var i=0;i<filters.length;i++){for(var j=0;j<vfFilters.length;j++){if(filters[i]==vfFilters[j].split("/")[3]){$("a[href='"+vfFilters[j]+"']").addClass("selected");}}}$.each($(".vf__question").next(),function(index){var answer=$(this).children(".selected").attr("data-response");if(answer==undefined){$(".catName .question"+(index+1)+"Text").html("");$(".question"+(index+1)+"Text").html("");$(".question"+(index)+"Textbr").hide();if(index==0){$(".noQuestion1").show();}}else{if(index==0){$(".noQuestion1").hide();}$(".question"+(index+1)+"Text").show();$(".question"+(index+1)+"Text").html(answer);$(".question"+(index)+"Textbr").show();}$(".vf .catName").html($(".questionText").html());$("#filters .filterVFShow").html($(".questionText").html());$(".reloadStart").css("display","block");});}if($(".visualFilter").is(":visible")){var filters=window.location.pathname.split("/");var vfFilters=[];$(".visualFilter").find('a').each(function(){vfFilters.push($(this).attr("href"));$(this).removeClass("addVFBtnActive");});for(var i=0;i<filters.length;i++){for(var j=0;j<vfFilters.length;j++){if(filters[i]==vfFilters[j].split("/")[3]){$("a[href='"+vfFilters[j]+"']").addClass("addVFBtnActive");}}}}});$("body").on("click","#hideSoldIRs",function(e){var model=StateModel.getInstance();var snapshot;var soldIR="";if($(this).prop('checked')==true){soldIR="0";}snapshot=model.getStateSnapshot();snapshot.soldIR=soldIR;model.setStateSnapshot(snapshot);});$("body").on("click","#filters > div .close",function(){$("#filters > div").hide();$("#filters a").removeClass("selected");return false;});$("body").on("mouseleave","#filters",function(e){if(!isHandheld()&&!$("#lowRangeEntry").is(":focus")&&!$("#highRangeEntry").is(":focus")){$(".filters-menu .active").removeClass("active");$(".categories-menu .open").removeClass("open");$(".categories-menu .active").removeClass("active");$("#categoryFlyout").slideUp(300);$(".jq-toggle-filters").removeClass("filters-open");$(".filters-menu a").attr("aria-expanded","false");$('.filters-menu-items > div').hide();$('.categories-menu__sub-menu').remove();$(".jq-toggle-sort").attr("aria-expanded","false");$(".jq-toggle-sort").removeClass("sort-open");$(".categoryFlyout__closeFilters").removeClass("filtersOpen").removeClass("sortOpen");$(".new-browse-filters__designer-options").hide();$("#filters").removeClass("open");$(".floating_filters").removeClass("isOpen");$('.filter-loader').hide();$("#sort").hide();$(".jq-toggle-sort").removeClass("active").removeClass("selected");}});$("body").on("click",".categoryFlyout__closeFilters a",function(e){if(!isHandheld()&&!$("#lowRangeEntry").is(":focus")&&!$("#highRangeEntry").is(":focus")){$(".filters-menu .active").removeClass("active");$(".categories-menu .open").removeClass("open");$(".categories-menu .active").removeClass("active");$("#categoryFlyout").slideUp(300);$(".jq-toggle-filters").removeClass("filters-open");$(".filters-menu a").attr("aria-expanded","false");$(".jq-toggle-sort").attr("aria-expanded","false");$(".jq-toggle-sort").removeClass("sort-open");$(".categoryFlyout__closeFilters").removeClass("filtersOpen").removeClass("sortOpen");$(".new-browse-filters__designer-options").hide();$("#filters").removeClass("open");$(".floating_filters").removeClass("isOpen");$('.filter-loader').hide();$("#sort").hide();$(".jq-toggle-sort").removeClass("active").removeClass("selected");}});$("body").on("keydown","#filters",function(e){if(e.keyCode==27){if(!isHandheld()&&!$("#lowRangeEntry").is(":focus")&&!$("#highRangeEntry").is(":focus")){$(".filters-menu .active").removeClass("active");$(".categories-menu .open").removeClass("open");$(".categories-menu .active").removeClass("active");$("#categoryFlyout").slideUp(300);$(".jq-toggle-filters").removeClass("filters-open");$(".filters-menu a").attr("aria-expanded","false");$('.filters-menu-items > div').hide();$('.categories-menu__sub-menu').remove();$(".jq-toggle-sort").attr("aria-expanded","false");$(".jq-toggle-sort").removeClass("sort-open");$(".categoryFlyout__closeFilters").removeClass("filtersOpen").removeClass("sortOpen");$(".new-browse-filters__designer-options").hide();$("#filters").removeClass("open");$("#sort").hide();$(".jq-toggle-sort").removeClass("active").removeClass("selected");$(".floating_filters").removeClass("isOpen");$('.filter-loader').hide();}}});$("body #results img").load(function(){$(this).fadeIn(250);});$("#keywordSearchField").keyup(function(event){if(event.keyCode==13){handleKeywordSearch();}return false;});$("#lowRangeEntry").keyup(function(event){if(event.keyCode==13){handleUpdatePriceRange();}return false;});$("#highRangeEntry").keyup(function(event){if(event.keyCode==13){handleUpdatePriceRange();}return false;});$("body").on("click","#grid-popup .details, #grid-popup .image a, #grid-popup a#item_link, .grid-container div[id*='product_'] a",function(){var newSnapshot=StateModel.getInstance().pBrowseState;var itemRRUrl=$(this).attr('data-rrurl');var itemRedirectUrl=$(this).attr('href');newSnapshot.pagePosition=getPagePosition();window.history.pushState(newSnapshot,"",window.location.pathname+"?trackbgfm=pdp");if(typeof itemRRUrl!='undefined'&&itemRRUrl!='none'){e.preventDefault();itemRRUrlFire(itemRRUrl,itemRedirectUrl);}});$("body").on("click",".itemPopUp .details, .itemPopUp .image a, .itemPopUp a#item_link, .itemPopUp div[id*='product_'] a, #results a.itemDiv",function(e){var newSnapshot=StateModel.getInstance().pBrowseState;newSnapshot.pagePosition=getPagePosition();window.history.pushState(newSnapshot,"",window.location.pathname+"?trackbgfm=pdp");if(BREADCRUMB_CURRENT_FILTERS!=undefined){CookieManager.setCookieValue("userCurrentFilters",encodeURIComponent(JSON.stringify(BREADCRUMB_CURRENT_FILTERS)));}var itemRedirectUrl=$(this).attr('href');var itemRRUrl=$(this).attr('data-rrurl');if(typeof itemRRUrl!='undefined'&&itemRRUrl!='none'){e.preventDefault();itemRRUrlFire(itemRRUrl,itemRedirectUrl);}});function itemRRUrlFire(rrUrl,itemUrl){$.ajax({url:rrUrl,data:"",type:'POST',timeout:10000,dataType:"jsonp",success:function(data){window.location.href=itemUrl;},error:function(e){window.location.href=itemUrl;}});}if(locale.toLowerCase()=="zh-hant"||(locale.toLowerCase()=="intl"&&isRetail.toLowerCase()=="false")){$('html > head').append($('<style>.price { display:none !important; }</style>'));}model.removeAllProducts();model.setStateSnapshot(stateSnapshot);if(window.history.state!=null){if(window.history.state.pagePosition!=""){snapshot.pagePosition=window.history.state.pagePosition;}}window.history.replaceState(stateSnapshot,"",window.location.pathname+window.location.search);for(i=0,n=marketingLayoutData.tiles.length;i<n;i++){$("#"+marketingLayoutData.tiles[i].Id).attr("id",marketingLayoutData.tiles[i].Id+"_template");}layoutTiles();centerGridText();centerTileText();fixRecentItems();setInterval(function(){var model=StateModel.getInstance();var scrollTop=$(window).scrollTop();var rowInView=Math.ceil((scrollTop-$("#results").offset().top)/(gridUnit+gridGutter));var currentTile;var $currentTile;var $currentImage;var n=model.custom.gridLayoutBlocks.length;var i=n;var j,nj;var currentBlock;var newAdds=false;var categoryName=model.isSearchMode===true?"Search Results":$("#filters h1").text().split("(")[0];$("#results .to-delete").remove();for(i=0;i<n;i++){if(i<model.custom.lastBlockShown){currentBlock=model.custom.gridLayoutBlocks[i];if(i*3<rowInView-15||i*3>rowInView+15){if($(".block_"+i).length>0){$(".block_"+i+" img").attr("src","data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAAAAAAALAAAAAABAAEAAAICTAEAOw==");$(".block_"+i).addClass("to-delete");for(j=0,nj=currentBlock.length;j<nj;j++){if(currentBlock[j].Id.indexOf("tile")>-1){$("#"+currentBlock[j].Id).addClass("to-delete");}}$("#relatedStoryBlock"+i).addClass("to-delete");}}else{if($(".block_"+i).length==0){if(currentBlock.length==1&&$("#"+currentBlock[0].Id).length>0){}else{$("#results .browse-grid").append(model.custom.gridHTMLBlocks[i]);addHearts(savedItems);newAdds=true;}}}}}if(newAdds==true){layoutTiles();centerGridText();centerTileText();fixRecentItems();}if(model.custom.engageLazyLoad==true){if(scrollTop+$(window).innerHeight()>=$(document).height()-600){if(model.custom.gridHTMLBlocks.length>model.custom.lastBlockShown){for(var i=0;i<model.custom.lazyLoadBlockIncrement;i++){if(model.custom.gridLayoutBlocks.length>=model.custom.lastBlockShown){$("#results .browse-grid").append(model.custom.gridHTMLBlocks[model.custom.lastBlockShown]);addHearts(savedItems);layoutData.tiles=layoutData.tiles.concat(model.custom.gridLayoutBlocks[model.custom.lastBlockShown]);model.custom.lastBlockShown+=1;}}TrackViewRemainingItems("Category Browse - "+categoryName,"View Remaining Lazy Load -> Seen "+(model.custom.lastBlockShown-1)+" of "+model.custom.gridLayoutBlocks.length+" blocks");layoutTiles();}else{model.custom.engageLazyLoad=false;}}}},500);$("body").on("click","a.clearAllItems",function(e){clearAllItems();e.preventDefault();return false;});if(typeof layoutData_Header!="undefined"){setupHeaderFooterTiles(layoutData_Header,true);}if(typeof layoutData_Footer!="undefined"){setupHeaderFooterTiles(layoutData_Footer);}$("body").on("click",".visualFilterBtn",function(e){e.preventDefault();var catUrl=$(this).attr("href");var trackFilters=[];if(!$(this).hasClass("addVFBtnActive")){$(this).addClass("addVFBtnActive");$(".visualFilterBtn").not(this).each(function(){if($(this).hasClass("addVFBtnActive")){var updateFilters={"pageName":"","filterType":"visual","filterName":$(this).text(),"categoryName":"","action":"remove"
};trackFilters.push(updateFilters);}$(this).removeClass("addVFBtnActive");});var updateFilters={"pageName":"","filterType":"visual","filterName":$(this).text(),"categoryName":"","action":"add"
};trackFilters.push(updateFilters);}else{$(this).removeClass("addVFBtnActive");var selected=$(this).attr("href").split("/");selected.pop()
catUrl=selected.join("/");var updateFilters={"pageName":"","filterType":"visual","filterName":$(this).text(),"categoryName":"","action":"remove"
};trackFilters.push(updateFilters);}$.ajax({url:"/api/search/searchcategory",type:"POST",data:'{"SearchQueryString": "'+catUrl+'", "IsSearchMode": false, "SessionID": "'+browserSessionID+'", "UserID": "'+sessionUserid+'", "IsFriendlySearchUrl": true}',dataType:"json",contentType:"application/json; charset=utf-8",success:function(data){if(data!=null){var pagePosition="pp+"+getPagePosition();var filterSnap=URLFactory.convertHashToState(data.StateHash+"-"+pagePosition);StateModel.getInstance().setStateSnapshot(filterSnap,false);$(model).trigger("getProductsComplete",{results:data,service:"getProducts"
});window.history.pushState(filterSnap,"",data.CurrentStateURL);for(var i=0;i<trackFilters.length;i++){console.log("Calling "+i+" tracking");TrackEndecaDimensions(trackFilters[i]);}}else{$(model).trigger("getProductsError");}},error:function(data){}});});if($(".visualFilter").is(":visible")){$(window).scroll(function(e){e.preventDefault();if($("#filters").hasClass("fixed")){$("#filters .filtersVF").css("display","block");$("#filters").css("padding-top","10px")
$(".filtersVF").css("margin-bottom","10px");}else{$("#filters .filtersVF").hide();$("#filters").css("padding-top","10px")
}});var filters=window.location.pathname.split("/");var vfFilters=[];$(".visualFilter").find('a').each(function(){vfFilters.push($(this).attr("href"));});for(var i=0;i<filters.length;i++){for(var j=0;j<vfFilters.length;j++){if(filters[i]==vfFilters[j].split("/")[3]){$("a[href='"+vfFilters[j]+"']").addClass("addVFBtnActive");}}}}if($(".vf").is(":visible")){$(".vf span.catName").html($("#browse-fields span.catName").html());$("#browse-fields").html("<div class='t5'>"+$('.catName')[0].outerHTML+$('.num-results')[0].outerHTML+"</div>");$("#browse-fields").hide();$(window).scroll(function(e){e.preventDefault();if($("#filters").hasClass("fixed")){$("#filters .filtersVF").css("display","block");$("#filters").css("padding-top","10px")
$(".filtersVF").css("margin-bottom","10px");if($(".filterVFShow").is(":empty")){$(".filterVFShow").html($(".catName").html());}}else{$("#filters .filtersVF").hide();$("#filters").css("padding-top","20px")
}});var filters=window.location.pathname.split("/");var vfFilters=[];$(".vf .container").find('a').each(function(){vfFilters.push($(this).attr("href"));});for(var i=0;i<filters.length;i++){for(var j=0;j<vfFilters.length;j++){if(filters[i]==vfFilters[j].split("/")[3]){$("a[href='"+vfFilters[j]+"']").addClass("selected");}}}$.each($(".vf__question").next(),function(index){var answer=$(this).children(".selected").attr("data-response");if(answer==undefined){if(index==0){$(".noQuestion1").show();}}else{if(index==0){$(".noQuestion1").hide();}$(".question"+(index+1)+"Text").show();$(".question"+(index+1)+"Text").html(answer);$(".question"+(index)+"Textbr").show();$(".vf .catName").html($(".questionText").html());$("#filters .filterVFShow").html($(".questionText").html());$(".reloadStart").css("display","block");}});}else{$("#browse-fields").addClass("noVFAdjust");}$("body").on("click",".reloadStart",function(e){e.preventDefault();$(".reloadStart").hide();$(".floating_breadcrumbs .reloadStart").remove();$(".floating_breadcrumbs .restart-divider").remove();TrackSiteInteractions("start over","gift finder");$(".vf__question").next().find(".selected").removeClass("selected");var tab="#"+$("#headerTiles").find(".vf2__title").siblings("div.touch-carousel").attr("id")+"-tab-0";$(tab).click();var resetCat=$(".vf2__carousel .container").attr("data-masterCat")+"/sort-relevance";$('body,html').animate({scrollTop:0
},500);$.ajax({url:"/api/search/searchcategory",type:"POST",data:'{"SearchQueryString": "'+resetCat+'", "IsSearchMode": false, "SessionID": "'+browserSessionID+'", "UserID": "'+sessionUserid+'", "IsFriendlySearchUrl": true}',dataType:"json",contentType:"application/json; charset=utf-8",success:function(data){if(data!=null){var pagePosition="pp+"+getPagePosition();data.pagePosition=getPagePosition();var filterSnap=URLFactory.convertHashToState(data.StateHash+"-"+pagePosition);StateModel.getInstance().setStateSnapshot(filterSnap,false);$(model).trigger("getProductsComplete",{results:data,service:"getProducts"
});window.history.pushState(filterSnap,"",data.CurrentStateURL);$(".vf span.catName").html($("#browse-fields span.catName").html());$("#filters .filterVFShow").html("");}else{$(model).trigger("getProductsError");}},error:function(data){}});});$("body").on("click",".vf_link a",function(e){e.preventDefault();var trackFilters=[];$(".reloadStart").css("display","block");if(!$(this).hasClass("selected")){if($(this).siblings(".selected").length>0){var updateFilters={"pageName":"","filterType":"gift finder","filterName":$(this).siblings(".selected").text(),"categoryName":"","action":"remove"
};trackFilters.push(updateFilters);}$(this).siblings().removeClass("selected");$(this).addClass("selected");var updateFilters={"pageName":"","filterType":"gift finder","filterName":$(this).text(),"categoryName":"","action":"add"
};trackFilters.push(updateFilters);}else{$(this).removeClass("selected");var updateFilters={"pageName":"","filterType":"gift finder","filterName":$(this).text(),"categoryName":"","action":"remove"
};trackFilters.push(updateFilters);}var getSelected=$(this).closest("div.container").find(".selected");var mastCat=$(this).closest("div.container").attr("data-masterCat");var endURL=mastCat;for(var i=0;i<getSelected.length;i++){var answerUrl=$(getSelected[i]).attr("href").split("/");answerUrl=answerUrl[answerUrl.length-1];endURL=endURL+"/"+answerUrl;}if(getSelected.length===0){endURL=$(".vf2__carousel .container").attr("data-masterCat")+"/sort-relevance";$(".vf span.catName").html($("#browse-fields span.catName").html());$(".reloadStart").hide();$("#filters .filterVFShow").html("");}else{$.each($(".vf__question").next(),function(index){var answer=$(this).children(".selected").attr("data-response");if(answer==undefined){$(".catName .question"+(index+1)+"Text").html("");$(".question"+(index+1)+"Text").html("");$(".question"+(index)+"Textbr").hide();if(index==0){$(".noQuestion1").show();}}else{if(index==0){$(".noQuestion1").hide();}$(".question"+(index+1)+"Text").show();$(".question"+(index+1)+"Text").html(answer);$(".question"+(index)+"Textbr").show();}});$(".vf .catName").html($(".questionText").html());$("#filters .filterVFShow").html($(".questionText").html());}$.ajax({url:"/api/search/searchcategory",type:"POST",data:'{"SearchQueryString": "'+endURL+'", "IsSearchMode": false, "SessionID": "'+browserSessionID+'", "UserID": "'+sessionUserid+'", "IsFriendlySearchUrl": true}',dataType:"json",contentType:"application/json; charset=utf-8",success:function(data){if(data!=null){var pagePosition="pp+"+getPagePosition();data.pagePosition=getPagePosition();var filterSnap=URLFactory.convertHashToState(data.StateHash+"-"+pagePosition);StateModel.getInstance().setStateSnapshot(filterSnap,false);$(model).trigger("getProductsComplete",{results:data,service:"getProducts"
});window.history.pushState(filterSnap,"",data.CurrentStateURL);for(var i=0;i<trackFilters.length;i++){TrackEndecaDimensions(trackFilters[i]);}}else{$(model).trigger("getProductsError");}},error:function(data){}});visualFilterQnAAutoAdvance($(this));});$("body").on("click",".breadcrumb li a",function(e){e.preventDefault();TrackBreadcrumbInteractions('categorybrowse','breadcrumb','');window.location=$(this).attr("href");return false;});$("body").on("click",".vf .catName span b",function(e){var index=Math.floor($(this).parent().index()/2);var tab="#"+$(this).parents(".vf2__title").siblings("div.touch-carousel").attr("id")+"-tab-"+index;$(tab).click();});$("body").on(hoverOnEvent,"#results img.showTooltip, #extras-recent img.showTooltip",function(e){var img=$(this);$(".itemPopUp").remove();$(e.target).closest('div[id*="product_"]').append("<div class='itemPopUp flex-block' style='display:none'></div>");if(hoverOnEvent!="click"){if(timer){clearTimeout(timer);timer=null;}timer=setTimeout(function(){$("#flydown").fadeOut(300);$("#nav .flydowns a").removeClass("selected");$("#saved").fadeOut(300);$("a.searchstores, .bag a").removeClass("selected");$("#filters a").removeClass("selected");$("#grid-popup").hide();displayTooltipData(img,true);clearTimeout(timer);timer=null;},500);}else{$("#flydown").fadeOut(300);$("#nav .flydowns a").removeClass("selected");$("#saved").fadeOut(300);$("a.searchstores, .bag a").removeClass("selected");$("#filters a").removeClass("selected");$("#grid-popup").hide();displayTooltipData(img,true);}});var checkFiterCookie=CookieManager.getCookieValue('userCurrentFilters');if(typeof(checkFiterCookie)!="undefined"&&checkFiterCookie!=""&&checkFiterCookie!=null){CookieManager.eraseCookie("userCurrentFilters");}});function visualFilterQnAAutoAdvance(answer){if($(answer).hasClass("selected")){$(".touchcarousel-next").click();}}function populateBreadcrumb(data){if(typeof(data)!="undefined"&&data!=null){var itemBuffer="";var itemCount=data.length-1;for(var i=0;i<data.length;i++){if(i!=itemCount){itemBuffer+="<li><a href='"+data[i].CanonicalURL+"'>"+data[i].Name+"</a></li>";}else{itemBuffer+="<li>"+data[i].Name+"</li>";}}$("#breadCrumb ul").html(itemBuffer);setTimeout(function(){$('#breadCrumb').show();},500);}}function populateJsonLDScript(data){if(typeof(data)!="undefined"&&data!=null){var finalSchemaObj=[];var tempSchemaItems=[];for(var i=0;i<data.length;i++){var tempSchemaData={};tempSchemaData["@type"]="ListItem";tempSchemaData["position"]=data[i].DisplayOrder;tempSchemaData["item"]={"@id":data[i].CanonicalURL,"name":data[i].Name
};tempSchemaItems.push(tempSchemaData);}for(var i=0;i<tempSchemaItems.length;++i){finalSchemaObj.push(tempSchemaItems[i]);}var scriptSchema=document.createElement('script');scriptSchema.type='application/ld+json';scriptSchema.text=JSON.stringify({"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[finalSchemaObj]
});if($('head script[type="application/ld+json"]').length>0){$('head script[type="application/ld+json"]').remove();$("head").append(scriptSchema);}else{$("head").append(scriptSchema);}}}$("#viewRemainingButton").click(function(event){var model=StateModel.getInstance();var productsLeft;var productsShownSoFar=0;var increment;var i;var categoryName=model.isSearchMode===true?"Search Results":$("#filters h1").text().split("(")[0];if(model.custom.gridHTMLBlocks.length>model.custom.lastBlockShown){for(i=0;i<model.custom.lazyLoadBlockIncrement;i++){if(model.custom.gridLayoutBlocks.length>=model.custom.lastBlockShown){$("#results .browse-grid").append(model.custom.gridHTMLBlocks[model.custom.lastBlockShown]);addHearts(savedItems);layoutData.tiles=layoutData.tiles.concat(model.custom.gridLayoutBlocks[model.custom.lastBlockShown]);model.custom.lastBlockShown+=1;}}layoutTiles();fixRecentItems();}if($("body").hasClass("ios")==true||$("body").hasClass("android")==true){for(i=0;i<model.custom.lastBlockShown;i++){productsShownSoFar+=model.custom.gridSizeBlocks[i];}if(model.custom.lastBlockShown<model.custom.gridSizeBlocks.length){productsLeft=model.pCachedProducts.list.length-productsShownSoFar;var query=window.location.search.split("?").join("");var isSearchBrowse;if(query!=''){isSearchBrowse=(window.location.pathname.indexOf("search"))?1:0;}if(isSearchBrowse!="1"){increment=(productsLeft<96)?productsLeft:96;}else{increment=(productsLeft<120)?productsLeft:120;}if($("body").hasClass("ja-JP")){$("#viewRemainingButton h4 a").html(locViewNext+" "+productsLeft+" "+locBrowseOf+" "+increment+" "+locItems);}else{$("#viewRemainingButton h4 a").html(locViewNext+" "+increment+" "+locBrowseOf+" "+productsLeft+" "+locItems);}TrackViewRemainingItems("Category Browse - "+categoryName,"View Remaining Tablet Button -> Seen "+(model.custom.lastBlockShown)+" of "+model.custom.gridLayoutBlocks.length+" blocks");}else{$("#viewRemainingButton").hide();TrackViewRemainingItems("Category Browse - "+categoryName,"View Remaining Tablet Button -> Seen "+model.custom.gridLayoutBlocks.length+" of "+model.custom.gridLayoutBlocks.length+" blocks");}}else{$("#viewRemainingButton").hide();model.custom.engageLazyLoad=true;TrackViewRemainingItems("Category Browse - "+categoryName,"View Remaining Desktop Button -> Seen "+(model.custom.lastBlockShown)+" of "+model.custom.gridLayoutBlocks.length+" blocks");}fixRecentItems();});function centerItemInfo(){if($(".iteminfo").length){var containerheight=$(".item-container").height();var divheight=$(".iteminfo").height();var topmargin=(containerheight/2)-(divheight/2);$(".iteminfo").css("padding-top",topmargin);}}function clearBrowseGrid(){$("#results").empty();}function createPopUp(popUp){var sku=$(popUp).attr("data-sku");var model=StateModel.getInstance();var snapshot=model.getStateSnapshot();var productData=model.getProduct(sku);if(productData==null){return;}var src=$img.attr("src");var zoomImg=$img.attr("data-rollover-image");var desc=(productData.Name==null)?"":productData.Name;var price=productData.Price;var wholesalePrice=productData.Wholesaleprice;var crop=(productData.Crop==null)?StateModel.DEFAULT_IMAGE_CROP:productData.Crop;var state=URLFactory.convertStateToServiceHash(StateModel.getInstance().pBrowseState);var isGroup=(productData.IsGroup!=null&&productData.IsGroup.toLowerCase()=="true")?true:false;var isEngravable=productData.IsServiceable;var mcat=URLFactory.extractQueryStringValue(query,"mcat");var cid=URLFactory.extractQueryStringValue(query,"cid");var isSearch=URLFactory.extractQueryStringValue(query,"search")==1?1:0;var searchKeyword=encodeURIComponent(StateModel.getInstance().getStateSnapshot().searchTerms);var queryStringSearchKeyword=URLFactory.extractQueryStringValue(query,"searchkeyword");var origin=URLFactory.extractQueryStringValue(query,"search")==1?"search":"browse";var itemPageOriginQS=(origin=="search")?"search":"bg";if((cid==null||cid=='')&&typeof CATEGORY_ID!=="undefined"&&CATEGORY_ID!=null&&CATEGORY_ID!=""){cid=CATEGORY_ID;}if(model.custom.AdjustedTerms!=""){searchKeyword=model.custom.AdjustedTerms;}if(searchKeyword==""&&queryStringSearchKeyword!=null&&queryStringSearchKeyword!=""){searchKeyword=queryStringSearchKeyword;}var pkbpricemarket="";if(typeof productData.PriceMarketId!="undefined"&&productData.PriceMarketId!=null&&productData.PriceMarketId!=""){pkbpricemarket=productData.PriceMarketId;}else{pkbpricemarket=URLFactory.extractQueryStringValue(query,"pkbpricemarket");}if(pkbpricemarket!=""){pkbpricemarket="&pkbpricemarket="+pkbpricemarket;}if($("#engagementItemPage").length>0){var itemURL=productData.FriendlyUrl+'&search_params='+state+"&origin=engagement";}else if($("#StatementItemPage").length>0){var itemURL='/Shopping/ItemDesign.aspx?sku='+sku+'&cid='+cid;}else{if($("#categoryBrowsePage").length>0){state=URLFactory.updateHash(state,"pagePosition",getPagePosition());}var itemFriendlyURL="";if(productData.FriendlyUrl.indexOf("?")>0){itemFriendlyURL=productData.FriendlyUrl+'&';}else{itemFriendlyURL=productData.FriendlyUrl+'?';}var itemURL=itemFriendlyURL+"fromGrid=1&origin="+origin+pkbpricemarket+"&trackpdp="+itemPageOriginQS;itemURL=URLFactory.updateQuery(itemURL,"fromcid",cid);}}function renderBrowseGrid(productArray,marketingTileArray){var model=StateModel.getInstance();var hasMarketingTiles=false;var insideTwoHeight=false;var sectionNum=0,count=0;var whichPlacement="";var gridPlacement=1;var numProducts=productArray.length;var tempNumProducts=numProducts;var tempMarketingArray=[];if(marketingTileArray!=null){tempMarketingArray=marketingTileArray.slice();}if(model.isSearchMode){if(model.custom.AdjustedTerms!=""){var AdjustedTerms=model.custom.AdjustedTerms;}else{var AdjustedTerms=StateModel.getInstance().getStateSnapshot().searchTerms;}searchResultsText=searchResultsText.split("{0}").join(AdjustedTerms.split("and^").join("&amp;").split("~").join("-"));if(AdjustedTerms!=""){$("#search-fields").html(searchResultsText);}else{$("#search-fields").html(gTradeSearchResults);}$("#search-results-title").html($("#search-results-title").html().split("$numResults$").join(numProducts));$("#search-results-title").show();}if(tempMarketingArray.length>0&&!model.isSearchMode){hasMarketingTiles=true;var gridArray=[];for(var i=0;i<tempMarketingArray.length;i++){var placement=tempMarketingArray[i].Left+(tempMarketingArray[i].Top*5);var endOfTile;var amountOftiles;if(($("#"+tempMarketingArray[i].Id+"_template").attr("data-height")!=undefined&&parseFloat($("#"+tempMarketingArray[i].Id+"_template").attr("data-height"))!=tempMarketingArray[i].Height)||(tempMarketingArray[i].Height!=parseInt(tempMarketingArray[i].Height))){endOfTile=(tempMarketingArray[i].Width-1)+placement;amountOftiles=tempMarketingArray[i].Width;tempMarketingArray[i].Height=parseFloat($("#"+tempMarketingArray[i].Id+"_template").attr("data-height"));}else{endOfTile=(tempMarketingArray[i].Height-1)*5+(tempMarketingArray[i].Width-1)+placement;amountOftiles=tempMarketingArray[i].Height*tempMarketingArray[i].Width;}for(var j=0;j<amountOftiles;j++){var tempObject={"isTile":true,"tileId":tempMarketingArray[i].Id,"endOfTile":endOfTile};gridArray[placement]=tempObject;if(j==amountOftiles-1&&$("#"+tempMarketingArray[i].Id+"_template").attr("data-height")!=undefined){gridArray[placement].endOfTileHeight=parseFloat($("#"+tempMarketingArray[i].Id+"_template").attr("data-height"));}if($("#cachedMarketingTiles > div > div").eq(i).hasClass("productMT")){gridArray[placement].isProductTile=true;}if((j+1)%(tempMarketingArray[i].Width)!=0){placement+=1;}else{placement+=5-(tempMarketingArray[i].Width-1);}}}var lastPlacement=gridArray.length+(5-((gridArray.length-1)%5)-1);for(var i=0;i<lastPlacement;i++){var tempObject={"isTile":false,"tileId":""};if(!gridArray[i]){gridArray[i]=tempObject;}}var maxItemsInMarketingTiles=0;for(var i=0;i<gridArray.length;i++){if(!gridArray[i].isTile){maxItemsInMarketingTiles++;}}if(productArray.length<maxItemsInMarketingTiles){for(var h=0;h<tempMarketingArray.length;h++){var tileNumber=parseInt(tempMarketingArray[h].Id.split("tile")[1]);var amountOfProducts=0;for(var i=0;i<gridArray.length;i++){var getTileNum="";if(gridArray[i].isTile){getTileNum=parseInt(gridArray[i].tileId.split("tile")[1]);}if(!gridArray[i].isTile){amountOfProducts++;}else if(gridArray[i].isTile&&getTileNum>tileNumber){amountOfProducts++;}else if(gridArray[i].isTile&&gridArray[i].endOfTile==i&&gridArray[i].tileId==tempMarketingArray[h].Id){var endOfRow=5-(i%5)-1;gridArray[i].numProducts=amountOfProducts+endOfRow;break;}}}for(var i=0;i<tempMarketingArray.length;i++){for(var j=0;j<gridArray.length;j++){if(gridArray[j].tileId==tempMarketingArray[i].Id){var getEndOfTile=gridArray[j].endOfTile;var otherTiles=false;for(var k=0;k<5;k++){if(gridArray[getEndOfTile-(getEndOfTile%5)+k].isTile&&gridArray[getEndOfTile-(getEndOfTile%5)+k].tileId!=gridArray[j].tileId){if(gridArray[gridArray[getEndOfTile-(getEndOfTile%5)+k].endOfTile].numProducts<=productArray.length){otherTiles=true;break;}}}if(gridArray[getEndOfTile].numProducts>productArray.length&&!otherTiles){var tempObject={"isTile":false,"tileId":""};gridArray[j]=tempObject;}}}}var endTile;for(var i=0;i<tempMarketingArray.length;i++){var getTrueEnd=findTileIDIndex(gridArray,tempMarketingArray[i].Id);if(getTrueEnd>-1){if(gridArray[getTrueEnd].endOfTile!=-1){endTile=getTrueEnd;}}}if(endTile!=undefined){var newGridLength=gridArray[endTile].endOfTile;gridArray.length=newGridLength+(5-(newGridLength%5));}else{gridArray.length=0;}}var additionTileHeight=0;for(var i=0;i<gridArray.length;i++){if(typeof gridArray[i].endOfTileHeight!="undefined"){additionTileHeight=additionTileHeight+(gridArray[i].endOfTileHeight-1);}}var checkTiles=[];$("#results").append("<div id='marketingTiles'></div>");$("#marketingTiles").height(Math.floor(gridArray.length/5)*(($("#results").width()/5))-10+(additionTileHeight*($("#results").width()/5)));var mtHeight=Math.floor(gridArray.length/5)*(($("#results").width()/5))+(additionTileHeight*($("#results").width()/5));var endOfTileHeight=0;for(var i=0;i<gridArray.length;i++){var getTop=Math.floor(i/5)*(($("#results").width()/5))+(($("#results").width()/5)*endOfTileHeight);var getLeft=(i%5)*(($("#results").width()/5));var getBottom,getRight;if(gridArray[i].isTile==true&&checkTiles.indexOf(gridArray[i].tileId)==-1){if(typeof gridArray[gridArray[i].endOfTile].endOfTileHeight!="undefined"){endOfTileHeight=endOfTileHeight+(gridArray[gridArray[i].endOfTile].endOfTileHeight-1);}var whichTile=findIDIndex(tempMarketingArray,gridArray[i].tileId);getBottom=mtHeight-(getTop+((tempMarketingArray[whichTile].Height)*($("#results").width()/5)));getRight=$("#results").width()-(getLeft+(tempMarketingArray[whichTile].Width)*($("#results").width()/5));if(getRight<0){getRight=0;}$("#marketingTiles").append("<div id="+gridArray[i].tileId+" data-placement='"+i+"' data-height='"+tempMarketingArray[whichTile].Height+"' data-width='"+tempMarketingArray[whichTile].Width+"' class='tiles' style='top: "+getTop+"px ;left: "+getLeft+"px; bottom: "+getBottom+"px; right: "+getRight+"px; position:absolute;'></div>");if(gridArray[i].isProductTile){$("#"+gridArray[i].tileId).addClass("productMT");}checkTiles.push(gridArray[i].tileId);}else if(gridArray[i].isTile!=true){getBottom=mtHeight-(getTop+($("#results").width()/5));getRight=$("#results").width()-(getLeft+($("#results").width()/5));if(getRight<0){getRight=0;}$("#marketingTiles").append("<div class='product' data-placement='"+i+"' style='top: "+getTop+"px ;left: "+getLeft+"px; bottom: "+getBottom+"px; right: "+getRight+"px; position:absolute;'>"+i+"Product</div>");}}amountOfMarketingTile=gridArray.length;setTimeout(function(){$.each($(".tiles"),function(){$(this).html($("#"+$(this).attr("id")+"_template").html());$(this).attr("class",$("#"+$(this).attr("id")+"_template").attr("class")).addClass("tiles");$(this).children("img").height("100%");var topMargin=(parseInt($(this).attr("data-height"))*($("#results").width()/5));if(!$(this).hasClass("no-center")&&!$(this).hasClass("no-image")){$.each($(this).children("div"),function(){var textHeight=$(this).height();$(this).css("padding-top",Math.floor((topMargin-textHeight)/2));});}});initTouchCarousel();lazyLoad();},1500);$.each($("#marketingTiles .productMT"),function(index,value){var itemInfo=productArray.shift();var showNewClass='';if(itemInfo.IsNewProduct&&CATEGORY_ID!=622067){showNewClass='visible';}var titleArea="",shopNow="";var oldStyle="oldStyle";if(productTileDisplayPattern==2){titleArea="$titleArea$";shopNow="$shopNow$";oldStyle=oldStyle+" smallerImage";}itemInfo.isLargeImg=true;var popUpDirection=""
if(parseInt($(this).css("left"))>$("#results").width()/2){popUpDirection=" popUpLeft";}var tempDiv="<div class='flex-item "+oldStyle+popUpDirection+" itemSize2' id='product_"+itemInfo.Sku+"'><div>"+
titleArea+"<span class='new-product "+showNewClass+"'>"+LABEL_SHOP_NEW+"</span>"+createProductImage(itemInfo,index+1)+"</div></div>";if(itemInfo.Title2==undefined){tempDiv=tempDiv.split("$titleArea$").join("<div class='imgTitle'><div class='l1 eyebrow'></div><div class='t1'>"+itemInfo.Title+"</div>"+shopNow+"</div>");}else{tempDiv=tempDiv.split("$titleArea$").join("<div class='imgTitle'><div class='l1 eyebrow'>"+itemInfo.Title+"</div><div class='t1'>"+itemInfo.Title2+"</div>"+shopNow+"</div>");}tempDiv=tempDiv.split("$shopNow$").join("<div class='tileShopNow type-cta avenir'>"+shopNowText+" </div>");$(this).html(tempDiv);});$.each($(".product"),function(index,value){if(productArray.length>0){var itemInfo=productArray.shift();var showNewClass='';if(itemInfo.IsNewProduct&&CATEGORY_ID!=622067){showNewClass='visible';}var popUpDirection=""
if(parseInt($(this).css("left"))>$("#results").width()/2){popUpDirection=" popUpLeft";}$(this).html("<div class='marketingProducts "+popUpDirection+"' id='product_"+itemInfo.Sku+"'><span class='new-product "+showNewClass+"'>"+LABEL_SHOP_NEW+"</span>"+createProductImage(itemInfo,index+1)+"</div>");}else{$(this).addClass("emptyDiv").html("");}});}numProducts=productArray.length;var leftPopUp=0;var gridPlacement=tempNumProducts-numProducts+1;$.each(productArray,function(index,value){var frontImg,backImg
var titleArea="",shopNow="";var oldStyle="oldStyle";if(productTileDisplayPattern==2){titleArea="$titleArea$";shopNow="$shopNow$";oldStyle=oldStyle+" smallerImage";}if(numProducts-index<12){backImg=frontImg=false;}else if(model.layoutType==StateModel.LAYOUT_TOP_LEFT){if(hasMarketingTiles){frontImg=(index%24==5)?true:false;backImg=((index+3)%24==20)?true:false;}else{frontImg=(index%24==0&&numProducts>11)?true:false;backImg=((index+3)%24==15)?true:false;}}else{if(hasMarketingTiles){backImg=(index%24==5)?true:false;frontImg=((index+3)%24==20)?true:false;}else{backImg=(index%24==0&&numProducts>11)?true:false;frontImg=((index+3)%24==15)?true:false;}}var showNewClass='';if(this.IsNewProduct&&CATEGORY_ID!=622067){showNewClass='visible';}var $placement=$("#results");if(frontImg||backImg||insideTwoHeight){if(!insideTwoHeight){if(numProducts-index<=6){var tempDiv="<div class='flex-item' id='product_"+this.Sku+"'>"+
createProductImage(this,gridPlacement+index)+"</div>";$placement.append(tempDiv);}else{$placement.append("<div id='section"+(sectionNum+1)+"' class='flex-block flex-item'></div>");insideTwoHeight=true;$placement=$("#section"+(sectionNum+1));}}else{$placement=$("#section"+(sectionNum+1)+"__2");}if(frontImg&&insideTwoHeight){this.isLargeImg=true;var tempDiv="<div class='flex-item itemSize2 "+oldStyle+"' id='product_"+this.Sku+"'><div>"+
titleArea+"<span class='new-product "+showNewClass+"'>"+LABEL_SHOP_NEW+"</span>"+createProductImage(this,gridPlacement+index)+"</div></div><div id='section"+(sectionNum+1)+"__2' class='flex-block flex-item flex-wrap flex-shrink'></div>";if(this.Title2==undefined){tempDiv=tempDiv.split("$titleArea$").join("<div class='imgTitle'><div class='l1 eyebrow'></div><div class='t1'>"+this.Title+"</div>"+shopNow+"</div>");}else{tempDiv=tempDiv.split("$titleArea$").join("<div class='imgTitle'><div class='l1 eyebrow'>"+this.Title+"</div><div class='t1'>"+this.Title2+"</div>"+shopNow+"</div>");}tempDiv=tempDiv.split("$shopNow$").join("<div class='tileShopNow type-cta avenir'>"+shopNowText+" </div>");$placement.append(tempDiv);count+=1;whichPlacement="front";}else if(backImg&&insideTwoHeight){var tempDiv="<div id='section"+(sectionNum+1)+"__2' class='flex-block flex-item flex-wrap flex-shrink'>"+"<div class='flex-item' id='product_"+this.Sku+"'><span class='new-product "+showNewClass+"'>"+LABEL_SHOP_NEW+"</span>"+createProductImage(this,gridPlacement+index)+"</div></div>"+"<div class='flex-item "+oldStyle+" itemSize2'><div></div></div>";$placement.append(tempDiv);count+=1;whichPlacement="back";}if(count==6&&whichPlacement=="front"){$placement.append("<div class='flex-item popUpLeft' id='product_"+this.Sku+"'><span class='new-product "+showNewClass+"'>"+LABEL_SHOP_NEW+"</span>"+createProductImage(this,gridPlacement+index)+"</div>");insideTwoHeight=false;sectionNum=sectionNum+1;count=0;}else if(count==3&&whichPlacement=="back"){this.isLargeImg=true;if(productTileDisplayPattern==2){if(this.Title2==undefined){$placement.next().children().append("<div class='imgTitle'><div class='l1 eyebrow'></div><div class='t1'>"+this.Title+"</div></div>");}else{$placement.next().children().append("<div class='imgTitle'><div class='l1 eyebrow'>"+this.Title+"</div><div class='t1'>"+this.Title2+"</div></div>");}}if(shopNow!=""){$placement.next().children().find(".imgTitle").append("<div class='tileShopNow type-cta avenir'>"+shopNowText+" </div>");}$placement.next().children().append("<span class='new-product "+showNewClass+"'>"+LABEL_SHOP_NEW+"</span>"+createProductImage(this,gridPlacement+index));$placement.next().addClass("popUpLeft").attr("id","product_"+this.Sku);count+=1;}else if(!frontImg&&!backImg){var popUpLeft;if(whichPlacement=="front"){popUpLeft=(count!=1&&count!=0&&count-4)?"popUpLeft":"";}$placement.append("<div class='flex-item "+popUpLeft+"' id='product_"+this.Sku+"'><span class='new-product "+showNewClass+"'>"+LABEL_SHOP_NEW+"</span>"+createProductImage(this,gridPlacement+index)+"</div>");count+=1;if(count>6){count=0;insideTwoHeight=false;sectionNum=sectionNum+1;}}}else{$placement.append("<div class='flex-item' id='product_"+this.Sku+"'><span class='new-product "+showNewClass+"'>"+LABEL_SHOP_NEW+"</span>"+createProductImage(this,gridPlacement+index)+"</div>");if(leftPopUp>=3){$("#product_"+this.Sku).addClass("popUpLeft");}leftPopUp=(leftPopUp==4)?0:leftPopUp+1;}if(index%5<=4&&index==(numProducts-1)){var amountOfBlankSpaces=5-(($("#results > div:not(.grid-container)").length-$("#results > div[id^='section']").last().index()-1)%5);if($("#results #marketingTiles").children().length==0&&$("#results #marketingTiles").length>0){amountOfBlankSpaces=5-(($("#results > div:not(.grid-container)").length-$("#results > div[id^='section']").last().index()-2)%5);}else if($("#results > div[id^='section']").length==0){if($("#results > div:not(#marketingTiles):not(.grid-container)").length%5!=0){amountOfBlankSpaces=5-($("#results > div:not(#marketingTiles):not(.grid-container)").length%5);}else{amountOfBlankSpaces=0;}}else if(amountOfBlankSpaces==5){amountOfBlankSpaces=0;}for(var i=0;i<amountOfBlankSpaces;i++){$("#results").append("<div class='flex-item emptyDiv'><div></div></div>");}}});$("#results > .flex-item").height(($("#results").width()/5)-10);$("#results > .flex-block.flex-item").height((($("#results").width()/5)*2));lazyLoad();$("#results").append(templateStrings.searchTitle);}function findTileIDIndex(array,id){var index=-1;for(var i=0;i<array.length;++i){if(array[i].tileId==id){index=i;break;}}return index;}function findIDIndex(array,id){var index=-1;for(var i=0;i<array.length;++i){if(array[i].Id==id){index=i;break;}}return index;}function createProductImage(itemInfo,orderOfItems){var itemRRUrl=(itemInfo.RRClickTrackingURL!=null)?itemInfo.RRClickTrackingURL:'none';var imgSize='$EcomBrowseM$';if(itemInfo.isLargeImg){imgSize='$EcomBrowseL$';}var isSearch=0;if(URLFactory.extractQueryStringValue(query,"search")!=''){isSearch=URLFactory.extractQueryStringValue(query,"search");}else{isSearch=((/search/i).test(self.location.pathname))?"1":"0";}var origin=(isSearch==1)?"search":"browse";var pkbpricemarket="";if(typeof itemInfo.PriceMarketId!="undefined"&&itemInfo.PriceMarketId!=null&&itemInfo.PriceMarketId!=""){pkbpricemarket=itemInfo.PriceMarketId;}else{pkbpricemarket=URLFactory.extractQueryStringValue(query,"pkbpricemarket");}if(pkbpricemarket!=""){pkbpricemarket="&pkbpricemarket="+pkbpricemarket;}var itemPageOriginQS=(origin=="search")?"search":"bg";if($("body").closest("#extras-recent").length>0){itemPageOriginQS="rv";}else if($("body").closest("#extras-additional").length>0){itemPageOriginQS="ai";}var itemFriendlyURL="";if(itemInfo.FriendlyUrl.indexOf("?")>0){itemFriendlyURL=itemInfo.FriendlyUrl+'&';}else{itemFriendlyURL=itemInfo.FriendlyUrl+'?';}var stateSnapshot=StateModel.getInstance().getStateSnapshot();var cid=stateSnapshot.category;if((cid==null||cid=='')&&typeof CATEGORY_ID!=="undefined"&&CATEGORY_ID!=null&&CATEGORY_ID!=""){cid=CATEGORY_ID;}var itemURL=itemFriendlyURL+"fromGrid=1&origin="+origin+pkbpricemarket+"&trackpdp="+itemPageOriginQS+"&trackgridpos="+orderOfItems;var itemTracking="";if(itemInfo.IsNewProduct&&CATEGORY_ID!=622067){itemTracking=itemTracking+"&tracktile=new";}if(itemInfo.isLargeImg){if(itemTracking!=""){itemTracking=itemTracking+"|highlight";}else{itemTracking=itemTracking+"&tracktile=highlight";}}itemURL=itemURL+itemTracking;itemURL=URLFactory.updateQuery(itemURL,"fromcid",cid);var sharpen="";if(typeof(itemInfo.Sharpen)!="undefined"&&itemInfo.Sharpen!=null&&itemInfo.Sharpen!=""){sharpen=itemInfo.Sharpen;}var crop="";if(typeof(itemInfo.Crop)!="undefined"&&itemInfo.Crop!=null&&itemInfo.Crop!=""){crop=itemInfo.Crop;}var titleArea="";if(itemInfo.Title2!=undefined||itemInfo.Title!=undefined){if(itemInfo.Title2==undefined){var newTitle=itemInfo.Title.split("\"").join("&quot;");titleArea='data-title="'+newTitle+'"';}else{var newTitle=itemInfo.Title.split("\"").join("&quot;");var newTitle2=itemInfo.Title2.split("\"").join("&quot;");titleArea='data-title="'+newTitle+'" data-title2="'+newTitle2+'"';}}var tempDiv="<img class='showTooltip' "+titleArea+" data-placement="+orderOfItems+" data-sku='"+itemInfo.Sku+"' data-src='"+URLFactory.scene7ImageURL(itemInfo.ImgURL,imgSize,sharpen,'')+"' data-rollover-image='"+URLFactory.scene7ImageURL(itemInfo.ImgURL,imgSize,sharpen,crop)+"'>"
var tempLink="<a class='itemDiv' data-rrurl="+itemRRUrl+" href="+itemURL+">"+tempDiv+"</a>";var tempListOfImages="";if(itemInfo.IsMotifEnabled==true&&(itemInfo.GroupMemberImageUrls!=null||itemInfo.GroupMemberImageUrls.length>0)){tempListOfImages="<span class='altImages' style='display:none; visibility:none;' aria-hidden='true'><ul>";var howMany=(itemInfo.GroupMemberImageUrls.length>3)?3:itemInfo.GroupMemberImageUrls.length;for(var i=0;i<howMany;i++){tempListOfImages=tempListOfImages+"<li>"+URLFactory.scene7ImageURL(itemInfo.GroupMemberImageUrls[i],imgSize,sharpen,'')+"</li>";}}else if(itemInfo.AdditionalImageUrls!=null){tempListOfImages="<span class='altImages' style='display:none; visibility:none;' aria-hidden='true'><ul>";for(var i=0;i<itemInfo.AdditionalImageUrls.length;i++){tempListOfImages=tempListOfImages+"<li>"+URLFactory.scene7ImageURL(itemInfo.AdditionalImageUrls[i],imgSize,sharpen,'')+"</li>";}}tempListOfImages=tempListOfImages+"</ul></span>";tempLink=tempLink+tempListOfImages;return tempLink;}function rotatingProductImages(){var rotTimer;var counter=0;rotTimer=setInterval(function(){if(counter<$(".itemPopUp .hiddenList").children("li").length-1){counter++;}else{counter=0;}$(".itemPopUp .image img").attr("src",$($(".itemPopUp .hiddenList").children("li")[counter]).text());},1250);return rotTimer;}function resizePopUps(){var additionTileHeight=0;var amountOfTiles=0;for(var i=0;i<$("#marketingTiles .tiles").length;i++){if($($("#marketingTiles .tiles")[i]).attr("data-width")==5){additionTileHeight=additionTileHeight+($($("#marketingTiles .tiles")[i]).attr("data-height")-1);}}for(var i=0;i<$("#marketingTiles > div").length;i++){var whichTile=$($("#marketingTiles > div")[i]);if(!whichTile.hasClass("product")){if(whichTile.attr("data-width")==5){amountOfTiles=amountOfTiles+5;}else{amountOfTiles=amountOfTiles+(parseInt(whichTile.attr("data-width"))*parseInt(whichTile.attr("data-width")));}}else{amountOfTiles=amountOfTiles+1;}}$("#marketingTiles").height(Math.floor(amountOfTiles/5)*(($("#results").width()/5))-10+(additionTileHeight*($("#results").width()/5)));var mtHeight=Math.floor(amountOfTiles/5)*(($("#results").width()/5))+(additionTileHeight*($("#results").width()/5));var endOfTileHeight=0;for(var i=0;i<amountOfTiles;i++){var whichTile=$($("#marketingTiles > div")[i]);var getTop=Math.floor(whichTile.attr("data-placement")/5)*(($("#results").width()/5))+(($("#results").width()/5)*endOfTileHeight);var getLeft=(whichTile.attr("data-placement")%5)*(($("#results").width()/5));if(!whichTile.hasClass("product")){var getBottom=mtHeight-(getTop+((whichTile.attr("data-height"))*($("#results").width()/5)));var getRight=$("#results").width()-(getLeft+(whichTile.attr("data-width")*($("#results").width()/5)));if(getRight<0){getRight=0;}whichTile.css("top",getTop).css("bottom",Math.floor(getBottom)).css("left",getLeft).css("right",Math.floor(getRight));whichTile.find("img").height("auto");if(typeof whichTile.attr("data-height")!="undefined"&&whichTile.attr("data-width")==5){endOfTileHeight=endOfTileHeight+(whichTile.attr("data-height")-1);}}else{var getBottom=mtHeight-(getTop+($("#results").width()/5));var getRight=$("#results").width()-(getLeft+($("#results").width()/5));if(getRight<0){getRight=0;}whichTile.css("top",getTop).css("bottom",getBottom).css("left",getLeft).css("right",getRight);}}$.each($(".tiles"),function(){var topMargin=(parseInt($(this).attr("data-height"))*($("#results").width()/5));if(!$(this).hasClass("no-center")&&!$(this).hasClass("no-image")){$.each($(this).children("div"),function(){var textHeight=$(this).height();$(this).css("padding-top",Math.floor((topMargin-textHeight)/2));});}});}function setupHeaderFooterTiles(dataToUse,isHeader){calculateGrid();var maxHeight=0;var follows5x2=false;var num5by2=0;var topPos=0;var variH=[];var totalVari=0;$.each(dataToUse.tiles,function(i){var tile=$('#'+this.Id);if(tile.hasClass("no-gutters")){gridHorizontalGutter=0;}tile.show().css('width',gridSize(this.Width,gridUnit,gridVerticalGutter)+'px');if(tile.attr('data-height')){this.Height=tile.attr('data-height');variH.push(this.Height);}tile.css('height',gridSize(this.Height,gridUnit,gridHorizontalGutter)+'px');if(follows5x2){if(tile.attr('data-height')){totalVari=0;for(j=0;j<(variH.length-1);j++){totalVari+=parseFloat(variH[j]);}}else{totalVari=0;for(j=0;j<(variH.length);j++){totalVari+=parseFloat(variH[j]);}}topPos=this.Top+(totalVari-(1+(num5by2-1)));}else{topPos=this.Top;}if($(".landing-sticky-nav").length){topPos=topPos-2;if(topPos<0){topPos=0;}}tile.css('top',gridPos(topPos,gridUnit,gridHorizontalGutter)+'px');tile.css('left',gridPos(this.Left,gridUnit,gridVerticalGutter)+'px');tile.addClass('col'+this.Width);if(parseFloat(topPos)+parseFloat(this.Height)>maxHeight){maxHeight=parseFloat(topPos)+parseFloat(this.Height);}if(tile.attr('data-height')){follows5x2=true;num5by2++;}});if(isHeader){$('#headerTiles .flexible-height').css('height',(maxHeight*(gridUnit+gridHorizontalGutter))+'px');}else{$('#footerTiles .flexible-height').css('height',(maxHeight*(gridUnit+gridHorizontalGutter))+'px');}$(".video-tile.looping-video:not(#cachedMarketingTiles .video-tile.looping-video)").each(function(){addVideoBrowseTileEnding($(this));});$(".video-tile.looping-video-split:not(#cachedMarketingTiles .video-tile.looping-video-split)").each(function(){if(!$("body").hasClass("ios")){addVideoLoop($(this));}});$(".dcTile video.video1:not(#cachedMarketingTiles .dcTile video.video1)").bind("timeupdate",function(){if(this.currentTime>0){addDCFadeTimers($(this).closest(".dcTile"));$(".dcTile video.video1").unbind("timeupdate");}});setTimeout(function(){centerTileText();initTouchCarousel();lazyLoad();},1000);}function renderSearchGrid(productArray,storyTileArray){var model=StateModel.getInstance();var gridContainer;var currentBlock=0;var currentProduct=0;var currentMarketingTile=0;var marketingTileIndexed={};var marketingTileArray=[];var nextSpot;var gridType="";var i,j,n;var left;var right;var width;var height;var marketingTile;var maxProducts;var tempHTML;var blockHTML="";var grid=[[false,false,false,false,false],[false,false,false,false,false],[false,false,false,false,false]];var productHTML;var productData;var marketingTileRealEstate=0;var numProducts=productArray.length;var initialNumProducts=0;var blockLayoutArray=[];var storyHTML="";var blockSize=0;var $tempTile;if(typeof(storyTileArray)=="undefined"||storyTileArray==null){storyTileArray=[];}if(numProducts<storyTileArray.length*3){numProducts=storyTileArray.length*3;}$("#cachedMarketingTiles .grid-container").empty();for(i=0,n=storyTileArray.length;i<n;i+=3){height=(storyTileArray.length-i>2)?3:storyTileArray.length-i;if(i+3>=storyTileArray.length){$("#cachedMarketingTiles .grid-container").append(templateStrings.relatedStoriesTileTemplate.split("$tileID$").join("relatedStoryBlock"+i).split("$last$").join("last"));}else{$("#cachedMarketingTiles .grid-container").append(templateStrings.relatedStoriesTileTemplate.split("$tileID$").join("relatedStoryBlock"+i));}marketingTileArray.push({Id:"relatedStoryBlock"+i,Left:3,Top:i,Width:2,Height:height
});}for(i=0,n=marketingTileArray.length;i<n;i++){marketingTileIndexed[String(Math.round(marketingTileArray[i].Top/3))]=marketingTileArray[i];marketingTileRealEstate+=marketingTileArray[i].Width*marketingTileArray[i].Height;}gridContainer=$('<div class="tile-container grid-container browse-grid flexible-height"></div>');var resultsHtml="<div class='grid-container'>";resultsHtml+=templateStrings.searchTitle.split("$numResults$").join(productArray.length);if(storyTileArray.length>0){resultsHtml+=templateStrings.relatedStoriesTitle.split("$numResults$").join(storyTileArray.length);}resultsHtml+="</div>";$("#results").append(resultsHtml);$("#results").append(gridContainer);while(currentProduct<numProducts){gridType=StateModel.LAYOUT_UNIFORM;maxProducts=15;marketingTile=marketingTileIndexed[String(currentBlock)];if(typeof(marketingTile)!="undefined"&&marketingTile!=null){left=marketingTile.Left;width=marketingTile.Width;height=marketingTile.Height;right=5-left-width;markGridLocation(grid,{top:0,left:left,height:height,width:width});gridType=StateModel.LAYOUT_MARKETING;maxProducts=15-width*height;blockLayoutArray.push({Id:marketingTile.Id,Left:left,Top:currentBlock*3,Width:width,Height:height
});tempHTML=$("#"+marketingTile.Id+"_template").wrap('<p></p>').parent().html();if(tempHTML!=null){tempHTML=tempHTML.split("_template").join("");blockHTML+=tempHTML;}for(j=0;j<3;j++){if(storyTileArray.length>currentBlock*3+j){if(currentBlock*3+j>=storyTileArray.length){blockHTML+=storyTileArray[currentBlock*3+j].MediaContent.split('class="').join('class="related-stories last ');}else{blockHTML+=storyTileArray[currentBlock*3+j].MediaContent.split('class="').join('class="related-stories ');}layoutData.tiles.push({Id:storyTileArray[currentBlock*3+j].Id,Left:3,Top:currentBlock*3+j,Width:2,Height:1
});}}}for(i=0;i<maxProducts;i++){productData=productArray[currentProduct];if(typeof(productData)!="undefined"&&productData!=null){productData.itemGridPlacement=currentProduct+1;if(i==0&&gridType==StateModel.LAYOUT_TOP_LEFT&&calculateMinTilesNeeded({Left:0,Width:2,Height:2})<=numProducts-currentProduct-1){markGridLocation(grid,{top:0,left:0,height:2,width:2});blockLayoutArray.push({Id:"product_"+productData.Sku,Left:0,Top:currentBlock*3,Width:2,Height:2
});blockHTML+=createProductHTML(productData,"large",currentBlock);if(currentBlock<model.custom.initialNumBlocks){initialNumProducts++;}blockSize++;}else if(i==0&&gridType==StateModel.LAYOUT_TOP_RIGHT&&calculateMinTilesNeeded({Left:3,Width:2,Height:2})<=numProducts-currentProduct-1){markGridLocation(grid,{top:0,left:3,height:2,width:2});blockLayoutArray.push({Id:"product_"+productData.Sku,Left:3,Top:currentBlock*3,Width:2,Height:2
});blockHTML+=createProductHTML(productData,"large",currentBlock);if(currentBlock<model.custom.initialNumBlocks){initialNumProducts++;}blockSize++;}else{nextSpot=findNextGridLocation(grid);if(nextSpot!=null){markGridLocation(grid,{top:nextSpot.top,left:nextSpot.left,height:1,width:1});blockLayoutArray.push({Id:"product_"+productData.Sku,Left:nextSpot.left,Top:currentBlock*3+nextSpot.top,Width:1,Height:1
});blockHTML+=createProductHTML(productData,"small",currentBlock);if(currentBlock<model.custom.initialNumBlocks){initialNumProducts++;}blockSize++;}}currentProduct++;}else{nextSpot=findNextGridLocation(grid);if(nextSpot!=null){if(currentBlock*3+nextSpot.top<storyTileArray.length){markGridLocation(grid,{top:nextSpot.top,left:nextSpot.left,height:1,width:1});blockLayoutArray.push({Id:"product_empty_"+currentProduct,Left:nextSpot.left,Top:currentBlock*3+nextSpot.top,Width:1,Height:1
});blockHTML+='<div id="product_empty_'+currentProduct+'" class="empty">&nbsp;</div>';}currentProduct++;}}}if(currentProduct>=numProducts){nextSpot=findNextGridLocation(grid);if(nextSpot!=null&&nextSpot.left>0){for(i=nextSpot.left;i<5;i++){blockLayoutArray.push({Id:"product_empty_"+i,Left:i,Top:currentBlock*3+nextSpot.top,Width:1,Height:1
});blockHTML+='<div id="product_empty_'+i+'" class="empty">&nbsp;</div>';}}}currentBlock++;model.custom.gridHTMLBlocks.push(blockHTML);model.custom.gridLayoutBlocks.push(blockLayoutArray);model.custom.gridSizeBlocks.push(blockSize);blockLayoutArray=[];blockSize=0;blockHTML="";resetGrid(grid);}$("#viewRemainingButton").hide();if(initialNumProducts<productArray.length){$("#viewRemainingButton").show();$("#viewRemainingButton h4 a").html(templateStrings.viewRemainingLabel.split("$num$").join(productArray.length-initialNumProducts));}for(i=0,n=Math.min(model.custom.initialNumBlocks,model.custom.gridHTMLBlocks.length);i<n;i++){gridContainer.append(model.custom.gridHTMLBlocks[i]);layoutData.tiles=layoutData.tiles.concat(model.custom.gridLayoutBlocks[i]);}model.custom.lastBlockShown=n;layoutTiles();centerGridText();centerTileText();fixRecentItems();}function renderCategoryMenus(categoryArray,minPrice,maxPrice,minPriceModel,maxPriceModel,sortCriteria,numProducts,formattedLowPrice,formattedHighPrice){var i,j,n,nj;var ids=["Categories","CategoriesSub","DesignersCollections","DesignersCollectionsSub","Materials","Gemstones","GemstoneColor","Price"];var $target;var $labelTarget;var currentCategory;var snapshot=StateModel.getInstance().getStateSnapshot();var lowRange=snapshot.lowRange;var highRange=snapshot.highRange;var showPrice=true;var priceDiff;var step=50;var model=StateModel.getInstance();var userSetPriceMin=(minPriceModel==""||minPriceModel==null||minPriceModel=="0")?false:true;var userSetPriceMax=(maxPriceModel==""||maxPriceModel==null)?false:true;if(categoryArray==null||model.custom.isSearchEngine==false){categoryArray=[];}for(i=0,n=ids.length;i<n;i++){$("#"+ids[i]+"Label").hide();$("#"+ids[i]+"Label").html($("#"+ids[i]+"Label").attr("data-filter"));$("#"+ids[i]+"Label").removeClass("filter");$("#"+ids[i]).empty();}for(i=0,n=categoryArray.length;i<n;i++){currentCategory=categoryArray[i];$labelTarget=$("#"+currentCategory.DimensionGroup+"Label");$labelTarget.show();$target=$("#"+currentCategory.DimensionGroup);$target.empty();for(j=0,nj=currentCategory.MenuItems.length;j<nj;j++){if(currentCategory.MenuItems[j].Name=="---"){$target.append('<a data-hash="" href="javascript:;" class="spacer">&nbsp;</a>');}else{$target.append('<a data-hash="'+currentCategory.MenuItems[j].refinementQS+'" href="javascript:;">'+currentCategory.MenuItems[j].Name+'</a>');}}if(currentCategory.MenuItems.length==1&&typeof(currentCategory.MenuItems[0].resetQS)!="undefined"&&currentCategory.MenuItems[0].resetQS!=null){$labelTarget.html(currentCategory.MenuItems[0].Name+" <span>&times;</span>").addClass("filter");$labelTarget.attr("data-reset",currentCategory.MenuItems[0].resetQS);}}if(sortCriteria==StateModel.SORT_CRITERIA_DEFAULT||sortCriteria==""||sortCriteria=="0"||sortCriteria==9999){$("#sortLabel").html(templateStrings.sortMenuStartingHTML);var filter=sortCriteria;if(sortCriteria==9999){filter=5;}$("#sortLabel #sort-filter").html($("#sort a[data-filter='"+filter+"']").text());$("#sortLabel").removeClass("filter");}minPrice=(minPrice==null)?"":parseInt(minPrice);maxPrice=(maxPrice==null)?"":parseInt(maxPrice);minPrice=convertCurrencyToNumber(minPrice);maxPrice=convertCurrencyToNumber(maxPrice);if(model.custom.isSearchEngine==false){$("#filter-label-holder").hide();}else if(locale.toLowerCase()=="en-us-trade"||locale.toLowerCase()=="ja-jp-trade"||locale.toLowerCase()=="en-us-estr"||locale.toLowerCase()=="ja-jp-estr"||locale.toLowerCase()=="en-us-stmt"){showPrice=false;$("#price-slider-holder").hide();$("#price-field-holder").show();if(minPriceModel==""||minPriceModel=="0"||minPriceModel==0){$(".lowRangeEntry").val("0");minPriceModel=formattedLowPrice;}else{$(".lowRangeEntry").val(minPriceModel);showPrice=true;minPriceModel=formattedLowPrice;}if(maxPriceModel==""||maxPriceModel=="0"||maxPriceModel==0){$(".highRangeEntry").val(templateStrings.priceRangeNoLimitLabel);maxPriceModel=templateStrings.priceRangeNoLimitLabel;}else{$(".highRangeEntry").val(maxPriceModel);showPrice=true;maxPriceModel=formattedHighPrice;}if(numProducts<=1&&userSetPriceMin==false&&userSetPriceMax==false){$("#priceLabel").hide();}else{$("#priceLabel").show();}if(showPrice==true){$("#filters > p a:last").html(minPriceModel+" - "+maxPriceModel+"<span>&times;</span>").removeClass("selected");$("#filters > p a:last").addClass("filter");}}else{$("#price-slider-holder").show();$("#price-field-holder").hide();if(lowRange==""||lowRange=="0"){lowRange=minPrice;showPrice=false;}else{lowRange=convertCurrencyToNumber(lowRange);}if(highRange==""){highRange=maxPrice;showPrice=false;}else{highRange=convertCurrencyToNumber(highRange);}if(numProducts<=1&&userSetPriceMin==false&&userSetPriceMax==false){$("#priceLabel").hide();}else{$("#priceLabel").show();}if((model.pBrowseState.lowRange==""||model.pBrowseState.lowRange=="0")&&model.pBrowseState.highRange==""){$(".ui-slider-handle:first").html("").append("<div class='triangle'></div><span class=\"left-price\">"+formatCurrency(lowRange)+"</span>");$(".ui-slider-handle:last").html("").append("<div class='triangle'></div><span class=\"right-price\">"+formatCurrency(highRange)+"</span>");var maxsteps=20;var roundto;var range=highRange-lowRange;if(range>=5000){roundto=250;}else if(range>=1000&&range<5000){roundto=200;}else if(range<1000){roundto=100;}var degree;if(range>=500000){degree=0.5;}else if(range>=100000&&range<500000){degree=0.5;}else if(range>=25000&&range<100000){degree=0.6;}else if(range>=10000&&range<25000){degree=0.7;}else if(range<10000){degree=0.8;}var stepValues=[];var nextVal=highRange;var prevVal;var prevMin,prevMax;stepValues.push(highRange);for(var i=0;i<maxsteps-2;i++){prevVal=nextVal;nextVal=Math.round((nextVal*degree)/roundto)*roundto;if(nextVal>lowRange&&nextVal<prevVal){stepValues.push(nextVal);}}stepValues.push(lowRange);stepValues.reverse();$("#price-slider").slider({min:0,max:stepValues.length-1,values:[0,stepValues.length-1],range:true,create:function(event,ui){$("body").on("touchmove","#price-slider",function(e){e.preventDefault();});$(".ui-slider-handle:first").addClass("first").append("<div class='triangle'></div><span class=\"left-price\">"+formatCurrency(lowRange)+"</span>");$(".ui-slider-handle:last").append("<div class='triangle'></div><span class=\"right-price\">"+formatCurrency(highRange)+"</span>");},slide:function(event,ui){if(ui.values[0]==ui.values[1]){return false;}$(".ui-slider-handle:first").html("").append("<div class='triangle'></div><span class=\"left-price\">"+formatCurrency(stepValues[ui.values[0]])+"</span>");$(".ui-slider-handle:last").html("").append("<div class='triangle'></div><span class=\"right-price\">"+formatCurrency(stepValues[ui.values[1]])+"</span>");},start:function(event,ui){prevMin=ui.values[0];prevMax=ui.values[1];},stop:function(event,ui){if(ui.values[0]!=prevMin||ui.values[1]!=prevMax){var val1=$(".ui-slider-handle:first span").html();var val2=$(".ui-slider-handle:last span").html();$("#filters > p a:last").html(formatCurrency(val1)+" - "+formatCurrency(val2)+"<span>&times;</span>").removeClass("selected");$("#filters > p a:last").addClass("filter");var snapshot=StateModel.getInstance().getStateSnapshot();snapshot.lowRange=convertCurrencyToNumber(val1);snapshot.highRange=convertCurrencyToNumber(val2);StateModel.getInstance().setStateSnapshot(snapshot);if(window.location.pathname.indexOf("search")>0){var OmniPageName="Generic Search (Endeca)";var OmniCatName=null;}else{var OmniPageName="Category Browse (Endeca)";var OmniCatName=$.trim($("h1").text().split(" (")[0]);}var updateFilters={"pageName":OmniPageName,"filterType":"Price","filterName":snapshot.lowRange+" - "+snapshot.highRange,"categoryName":OmniCatName,"action":"add"
};TrackEndecaDimensions(updateFilters);if($(window).scrollTop()>$("#header").outerHeight()+40){$('body,html').animate({scrollTop:$("#header").outerHeight()+40},500);}}}});}if(showPrice==true){$("#filters > p a:last").html(formatCurrency(lowRange)+" - "+formatCurrency(highRange)+"<span>&times;</span>").removeClass("selected");$("#filters > p a:last").addClass("filter");}$('.ui-slider-range').mousedown(function(){return false;});}initRollbar();}function renderExceptions(errorMessage,AdjustedTerms,OriginalTerms,noService){noService=noService||false;var model=StateModel.getInstance();var numProducts=model.pCachedProducts.list.length;var errorHolder=(model.isSearchMode==true&&$(".error-holder.search").length>0)?".error-holder.search":".error-holder.browse";if(typeof(errorMessage)=="undefined"){errorMessage=model.custom.searchErrorMessage;}if(typeof(AdjustedTerms)=="undefined"){AdjustedTerms=model.custom.AdjustedTerms;}if(typeof(OriginalTerms)=="undefined"){OriginalTerms=model.custom.OriginalTerms;}$(errorHolder).hide();$("#filter-label-holder").show();$(".did-you-mean-body").hide();if(numProducts==0&&model.pBrowseState.lowRange==""&&model.pBrowseState.highRange==""){$("#viewRemainingButton").hide();if(model.pCategoryMenus.length==0){$("#filter-label-holder").hide();}}if(model.custom.isSearchEngine==false){$("#filter-label-holder").hide();}if(locale.toLowerCase()=="zh-cn"||locale.toLowerCase()=="zh-hant"||(locale.toLowerCase()=="intl"&&isRetail.toLowerCase()=="false")){if(model.pCategoryMenus.length==0&&numProducts==1){$("#filter-label-holder").hide();}}else{if(((model.pCategoryMenus==null||model.pCategoryMenus.length==0)&&numProducts==1)&&(model.pBrowseState.lowRange==""||model.pBrowseState.highRange=="")){$("#filter-label-holder").hide();}}$("#results").css("color","#000").css("padding-top","5px");if(errorMessage!=null&&errorMessage!=""){if(!noService&&model.isSearchMode==true){$("#search-results-title").hide();if($("#filter-label-holder a.filter").length==0){$("#filters").hide();}var searchTerm=(model.pBrowseState.searchTerms!="")?model.pBrowseState.searchTerms:window.location.pathname.split("/")[2];$("#searchTerms").text(searchTerm);$("#noSearch").show();$("#nosearch_tile1").height($("#nosearch_tile1").width()*0.558);$(".tile-container.grid-container.browse-grid.flexible-height").hide();$("body.ru-RU #nosearch_tile2, body.en-US-Trade #nosearch_tile2, body.ja-JP-Trade #nosearch_tile2").html("").hide();$("body.ru-RU #nosearch_tile3, body.en-US-Trade #nosearch_tile3, body.ja-JP-Trade #nosearch_tile3").css("margin-left","10px");$("body.en-US-Stmt #noSearchMain div ul li:last-child, body.en-US-Stmt #noSearchTiles").html("").hide();$("#viewRemainingButton").hide();}else{$("#results").html(errorMessage).css("color","#ff2909").css("padding-top","30px");}}else{if(AdjustedTerms!=""&&OriginalTerms!=""){$("#filters").css("margin-bottom","0px");searchResultsText=searchResultsText.split("{0}").join(AdjustedTerms.split("and^").join("&amp;").split("~").join("-"));$("#search-fields").html(searchResultsText);if($("#browse-fields").is(":visible")){$("#filter-label-holder").width(Math.ceil($("#filters").width())-Math.ceil($("#browse-fields").outerWidth())-6);}else{$("#filter-label-holder").width(Math.ceil($("#filters").width())-Math.ceil($("#search-fields").outerWidth())-6);}$(errorHolder).text(templateStrings.adjustedTerms.split('{0}').join(OriginalTerms).split('{1}').join(AdjustedTerms));$(errorHolder).show();}}}function createProductHTML(productData,size,blockNum){var crop="";var sharpen="";var imageId=Math.round(Math.random()*1000000);if(typeof(blockNum)=="undefined"){blockNum="";}if(typeof(productData.Crop)!="undefined"&&productData.Crop!=null&&productData.Crop!=""){crop=productData.Crop;}else{crop=templateStrings.defaultScene7Crop;}if(typeof(productData.Sharpen)!="undefined"&&productData.Sharpen!=null&&productData.Sharpen!=""){sharpen=productData.Sharpen;}var itemRRUrlLink=(productData.RRClickTrackingURL!=null)?productData.RRClickTrackingURL:'none';var productHTML=templateStrings.productTemplate.split("$sku$").join(productData.Sku);productHTML=productHTML.split("$itemRRUrl$").join(itemRRUrlLink);if(typeof(size)=="undefined"||size==null||size==""||size.toLowerCase()=="small"){productHTML=productHTML.split("$img$").join(URLFactory.scene7ImageURL(productData.ImgURL,"$EcomBrowseM$",sharpen,""));productHTML=productHTML.split("$tooltipImage$").join(URLFactory.scene7ImageURL(productData.ImgURL,"$EcomBrowseM$",sharpen,crop));}else{productHTML=productHTML.split("$img$").join(URLFactory.scene7ImageURL(productData.ImgURL,"$EcomBrowseL$",sharpen,""));productHTML=productHTML.split("$tooltipImage$").join(URLFactory.scene7ImageURL(productData.ImgURL,"$EcomBrowseL$",sharpen,crop));}productHTML=productHTML.split("$alt$").join(productData.Name.replace(/"/g,"&quot;")).split("$imageId$").join(imageId).split("$sharpen$").join(sharpen).split("$crop$").join(crop).split("$blockNum$").join(blockNum);productHTML=productHTML.split("$itemPlace$").join(productData.itemGridPlacement);var showNewClass='';if(productData.IsNewProduct&&CATEGORY_ID!=622067){showNewClass='visible';}productHTML=productHTML.split("$showNew$").join(showNewClass);var state=URLFactory.convertStateToServiceHash(StateModel.getInstance().pBrowseState);var isSearch=0;if(URLFactory.extractQueryStringValue(query,"search")!=''){isSearch=URLFactory.extractQueryStringValue(query,"search");}else{isSearch=((/search/i).test(self.location.pathname))?"1":"0";}var origin=(isSearch==1)?"search":"browse";var searchKeyword=encodeURIComponent(StateModel.getInstance().getStateSnapshot().searchTerms);state=URLFactory.updateHash(state,"pagePosition",getPagePosition());var pkbpricemarket="";if(typeof productData.PriceMarketId!="undefined"&&productData.PriceMarketId!=null&&productData.PriceMarketId!=""){pkbpricemarket=productData.PriceMarketId;}else{pkbpricemarket=URLFactory.extractQueryStringValue(query,"pkbpricemarket");}if(pkbpricemarket!=""){pkbpricemarket="&pkbpricemarket="+pkbpricemarket;}var itemPageOriginQS=(origin=="search")?"search":"bg";if($("body").closest("#extras-recent").length>0){itemPageOriginQS="rv";}else if($("body").closest("#extras-additional").length>0){itemPageOriginQS="ai";}var queryOperator="?";var itemFriendlyURL="";if(productData.FriendlyUrl.indexOf("?")>0){itemFriendlyURL=productData.FriendlyUrl+'&';}else{itemFriendlyURL=productData.FriendlyUrl+'?';}var itemTracking="";if(productData.IsNewProduct&&CATEGORY_ID!=622067){itemTracking=itemTracking+"&tracktile=new";}var stateSnapshot=StateModel.getInstance().getStateSnapshot();var cid=stateSnapshot.category;if((cid==null||cid=='')&&typeof CATEGORY_ID!=="undefined"&&CATEGORY_ID!=null&&CATEGORY_ID!=""){cid=CATEGORY_ID;}var itemURL=itemFriendlyURL+"fromGrid=1&origin="+origin+pkbpricemarket+"&trackpdp="+itemPageOriginQS+itemTracking;itemURL=URLFactory.updateQuery(itemURL,"fromcid",cid);productHTML=productHTML.split("$itemURL$").join(itemURL);return productHTML;}function markGridLocation(grid,coordinates){var gridLengthA=grid.length;var gridLengthB=grid[0].length;for(var i=coordinates.top;i<coordinates.top+coordinates.height;i++){for(var j=coordinates.left;j<coordinates.left+coordinates.width;j++){if(i<gridLengthA&&j<gridLengthB){grid[i][j]=true;}}}}function resetGrid(grid){for(var i=0;i<3;i++){for(var j=0;j<5;j++){grid[i][j]=false;}}}function findNextGridLocation(grid){for(var i=0;i<3;i++){for(var j=0;j<12;j++){if(grid[i][j]==false){return{left:j,top:i};}}}return null;}calculateMinTilesNeeded({Left:3,Width:2,Height:2});function calculateMinTilesNeeded(marketingTile){var left=marketingTile.Left;var width=marketingTile.Width;var height=marketingTile.Height;var right=5-left-width;var numLeftTiles=height*left;var numRightTiles=height*right;var numBottomTiles=5-right;return numLeftTiles+numRightTiles+numBottomTiles;}$(window).resize(function(){if($("#filters").hasClass("fixed")){var left=$("#wrapper").offset().left;$("#filters").css("left",left+20).css("right",left+20);}else{$("#filters").css("left","auto").css("right","auto");}if(!$("body").hasClass("ie-8")){$("#filters a").removeClass("selected");}layoutTiles();if(typeof layoutData_Header!="undefined"){setupHeaderFooterTiles(layoutData_Header,true);}if(typeof layoutData_Footer!="undefined"){setupHeaderFooterTiles(layoutData_Footer);}fixRecentItems();$("#nosearch_tile1").height($("#nosearch_tile1").width()*0.558);});function getLinkEngravingParams(mySku,source){var linkEngraving="";var query=window.location.search.split("?").join("");var origin=(typeof ORDER_ORIGINATION!="undefined")?ORDER_ORIGINATION:1;if(typeof source!="undefined"&&source=="digitalCatalogList"){var productData=StateModel.getInstance().custom.tooltipCatalogDataLookup[mySku];if(productData.IsGroup.toLowerCase()=="true"){var groupData=StateModel.getInstance().custom.tooltipCatalogDataLookup[mySku];}else{var groupData=null;}}else{var productData=StateModel.getInstance().getProduct(mySku);var tooltipGroupDataLookup=StateModel.getInstance().custom.tooltipGroupDataLookup;var groupData=(typeof(tooltipGroupDataLookup[mySku])!="undefined")?tooltipGroupDataLookup[mySku].d:null;}var groupType="Individual";var groupSelectValue="";var whichToolTip=($(".itemPopUp").length>0)?".itemPopUp":"#grid-popup";if(groupData!=null&&groupData.GroupTypeID!=null){groupType="Type"+groupData.GroupTypeID;if(typeof source!="undefined"&&source=="digitalCatalogList"){groupSelectValue=$(".digital-catalog-item[data-sku='"+mySku+"'] select").val();}else{if(whichToolTip==".itemPopUp"){groupSelectValue=$(whichToolTip).find("select").val();}else if(typeof($("#grid-popup select").val())!="undefined"){groupSelectValue=$("#grid-popup select").val();}}}CATEGORY_ID=(CATEGORY_ID=="")?0:CATEGORY_ID;MASTER_CATEGORY_ID=(MASTER_CATEGORY_ID=="")?0:MASTER_CATEGORY_ID;linkEngraving=URLFactory.appendQueryString("groupType",groupType,true);linkEngraving=linkEngraving+URLFactory.appendQueryString("cid",CATEGORY_ID,false);linkEngraving=linkEngraving+URLFactory.appendQueryString("mcid",MASTER_CATEGORY_ID,false);linkEngraving=linkEngraving+URLFactory.appendQueryString("origin",origin,false);linkEngraving=linkEngraving+URLFactory.appendQueryString("sku",mySku,false);if(groupSelectValue!=""){linkEngraving=linkEngraving+URLFactory.appendQueryString("selectedsku",groupSelectValue,false);}else if(typeof productData.SelectedSku!="undefined"&&productData.SelectedSku!=null){linkEngraving=linkEngraving+URLFactory.appendQueryString("selectedsku",productData.SelectedSku,false);}else if(typeof productData.DefaultSku!="undefined"&&productData.DefaultSku!=null){linkEngraving=linkEngraving+URLFactory.appendQueryString("selectedsku",productData.DefaultSku,false);}if(groupType=="Type2"){var quantity="";if(groupData.SKUList!=null){for(var i=0;i<groupData.SKUList.length;i++){if(i!=0){quantity+=",";}quantity+=groupData.SKUList[i].Sku+":1";}}if(groupData.Group!=null){if(groupData.SKUList!=null&&groupData.SKUList.length>0){quantity+=",";}quantity+=groupData.Group.Sku+":1";}linkEngraving=linkEngraving+URLFactory.appendQueryString("Quantity",quantity,false);linkEngraving=linkEngraving+URLFactory.appendQueryString("defaultsku",groupData.DefaultSku,false);}else{linkEngraving=linkEngraving+URLFactory.appendQueryString("Quantity",1,false);}return linkEngraving;}function handleUpdatePriceRange(){var model=StateModel.getInstance();var lowRange=$(".lowRangeEntry").val();var highRange=$(".highRangeEntry").val();if(lowRange=="0"||!IsValidPriceValue(lowRange)){lowRange="";}if(highRange==templateStrings.priceRangeNoLimitLabel||!IsValidPriceValue(highRange)){highRange="";}var snapshot=model.getStateSnapshot();if(!isNaN(parseInt(lowRange))&&!isNaN(parseInt(highRange))&&parseInt(lowRange)>parseInt(highRange)){snapshot.lowRange=highRange;snapshot.highRange=lowRange;}else{snapshot.lowRange=lowRange;snapshot.highRange=highRange;}if(snapshot.lowRange==""){snapshot.lowRange=parseInt(minInputPrice);}if(snapshot.highRange==""){snapshot.highRange=parseInt(maxInputPrice);}if(isNaN(snapshot.lowRange)==false&&isNaN(snapshot.highRange)==false){var refinements='';var i=0;$.each(model.pCategoryMenus,function(){if(this.DimensionGroup!="Price"){$.each(this.MenuItems,function(){if(this.isRefinementSelected==true){if(i>0){refinements+="+";}refinements+=this.ID;i++;}});}});snapshot.refinement=refinements;var stateURL=window.location.pathname.split("/");var newStateURL=[];for(var i=0;i<stateURL.length;i++){if(stateURL[i].indexOf("price")<0){newStateURL.push(stateURL[i]);}}var newPrice="price-"+snapshot.lowRange+"-"+snapshot.highRange;if(newStateURL[newStateURL.length-1].indexOf("sort")>=0){var sortFilter=newStateURL.pop();newStateURL.push(newPrice);newStateURL.push(sortFilter);}else{newStateURL.push(newPrice);}newStateURL=newStateURL.join("/");window.history.pushState(snapshot,"",newStateURL);$(".filter-loader").show();model.setStateSnapshot(snapshot);if(model.isSearchMode){var OmniPageName="Generic Search (Endeca)";var OmniCatName=null;}else{var OmniPageName="Category Browse (Endeca)";}var currencySymbol=$(".price-symbol:first").html();var range=currencySymbol+lowRange+" - "+currencySymbol+highRange;var updateFilters={action:"add",categoryName:OmniCatName,filterName:range,filterType:"Price",pageName:OmniPageName
};TrackEndecaDimensions(updateFilters);}}function IsValidPriceValue(inputPriceValue){var isValidPriceValue=false;var regexNumeric=new RegExp("^[\u0030-\u0039]*$");var maxNumericLength=11;var maxDecimalLength=13;if(inputPriceValue!=''){var priceValue=inputPriceValue.split(".");if(priceValue.length==1&&priceValue[0].length<=maxNumericLength){isValidPriceValue=regexNumeric.test(priceValue[0]);}else if(priceValue.length==2&&priceValue[0].length<=maxNumericLength&&priceValue[1].length<=maxDecimalLength){isValidPriceValue=regexNumeric.test(priceValue[0])&&regexNumeric.test(priceValue[1]);}}return isValidPriceValue;}function handleKeywordSearch(category,refinement){var model=StateModel.getInstance();var searchTerm=$("#keywordSearchField").val();var snapshot=model.getStateSnapshot();if(typeof(category)=="undefined"||category==null){category="";}if(typeof(refinement)=="undefined"||refinement==null){refinement="";}$(".error-holder").hide();if(searchTerm!=""&&searchTerm!=$("#keywordSearchField").attr("data-placeholder")){snapshot.searchTerms=searchTerm;snapshot.category=category;snapshot.refinement=refinement;snapshot.sortCriteria="1";model.setStateSnapshot(snapshot);}}function handleDidYouMean(keyword,qs){$('.did-you-mean-body').hide();var category="";var refinement="";var didYouMeanSnapshot={};if(typeof(qs)!="undefined"&&qs!=null&&qs!=""){didYouMeanSnapshot=URLFactory.convertHashToState(qs);if(didYouMeanSnapshot.category!=null&&didYouMeanSnapshot.category!=""){category=didYouMeanSnapshot.category;}if(didYouMeanSnapshot.refinement!=null&&didYouMeanSnapshot.refinement!=""){refinement=didYouMeanSnapshot.refinement;}}$("#searchInput").val(keyword);SearchManager.getInstance().searchSite();}function loadRelatedStories(productArray){var currentState=StateModel.getInstance().getStateSnapshot();var hashData=URLFactory.convertStateToServiceHash(currentState);if(currentState.refinement!=""||currentState.searchTerms!=""||currentState.category!=""){$.ajax({url:'/Shopping/CategoryBrowse.aspx/GetMarketingTilesForSearch',type:'POST',data:'{"searchQueryString": "'+hashData+'"}',dataType:"json",contentType:"application/json; charset=utf-8",success:function(data){if(typeof(data.d)=="undefined"||data.d==null){}else if(typeof(data.d.MarketingTiles)!="undefined"&&data.d.MarketingTiles!=null&&data.d.MarketingTiles.length>0){var model=StateModel.getInstance();var categoryName=model.isSearchMode===true?"Search Results":$("#filters h1").text().split("(")[0];clearBrowseGrid();layoutData.tiles=[];if(typeof(data.d.MarketingTiles)!="undefined"&&data.d.MarketingTiles!=null){for(var i=0;i<data.d.MarketingTiles.length;i++){data.d.MarketingTiles[i].MediaContent=data.d.MarketingTiles[i].MediaContent.split('class="').join('class="block_'+(Math.floor(i/3))+' ');}}model.custom.gridHTMLBlocks=[];model.custom.gridLayoutBlocks=[];model.custom.gridSizeBlocks=[];model.custom.lastBlockShown=-1;model.custom.engageLazyLoad=false;renderBrowseGrid(productArray,data.d.MarketingTiles);renderExceptions();if($("body").hasClass("ios")!=true&&$("body").hasClass("android")!=true){$("#viewRemainingButton").hide();model.custom.engageLazyLoad=true;TrackViewRemainingItems("Category Browse - "+categoryName,"View Remaining Desktop Button -> Seen "+(model.custom.lastBlockShown)+" of "+model.custom.gridLayoutBlocks.length+" blocks");}}},error:function(jqXHR,status,error){}});}}function populateProductGrid(containerId,products){var count=0;var $maincontainer=$("#extras-recent");$maincontainer.html("");$maincontainer.removeClass("grid-container browse-grid").addClass("flex-block flex-shrink");for(var i=0;i<5;i++){if(products.Items.length>i){if(i==3||i==4){$maincontainer.append('<div class="flex-item popUpLeft" id="product_'+products.Items[i].Sku+'">'+createProductImage(products.Items[i])+'</div>');}else{$maincontainer.append('<div class="flex-item" id="product_'+products.Items[i].Sku+'">'+createProductImage(products.Items[i])+'</div>');}}else{$maincontainer.append('<div class="flex-item emptyDiv"><div>');}}preloadImages(containerId);}var savedItems=[];function getSavedItemsList(){var url="/Customer/InlineCustomerSelections.aspx/GetInlineSavedItems";if(locale.toLowerCase()=="en-us-trade"||locale.toLowerCase()=="ja-jp-trade"){url="/Trade/Customer/SavedItems.aspx/GetSavedItems";}savedItems=[];$.ajax({url:url,type:"POST",data:'',dataType:"json",contentType:"application/json; charset=utf-8",success:function(data){if(data.d.ResponseObject){if(locale.toLowerCase()=="en-us-trade"||locale.toLowerCase()=="ja-jp-trade"){if(data.d.ResponseObject.EndecaGroups){$.each(data.d.ResponseObject.EndecaGroups,function(){$.each(this.Items,function(){savedItems.push(this);});});}if(data.d.ResponseObject.OtherGroup){$.each(data.d.ResponseObject.OtherGroup.SubGroups,function(){$.each(this.Items,function(){savedItems.push(this);});});}}else{savedItems=data.d.ResponseObject.SavedItems;}addHearts(savedItems);}else{$(".unheart").remove();}},error:function(jqXHR,status,error){}});}function addHearts(items){$(".unheart").remove();$.each(items,function(){var sku=this.GroupSku;if(!sku){sku=this.Sku;}var savedId=this.ID;if($("#product_"+sku+" .imgTitle").length==0){$("#product_"+sku).append('<span class="unheart" data-saved-id="'+savedId+'"><i class="icon-font">like_solid</i></>');}else{$("#product_"+sku+" .imgTitle").prepend('<span class="unheart" data-saved-id="'+savedId+'"><i class="icon-font">like_solid</i></>');}if($("#grid-popup").is(":visible")&&$("#grid-popup .jq-remove-saved").attr("data-sku")==sku){$("#grid-popup .jq-remove-saved").attr("data-itemid",savedId);}});}function removeGtradeSavedItem(savedId){var url="/Trade/Customer/SavedItems.aspx/RemoveSavedItems";var dataString='{"itemsToBeRemoved":[{"ID":'+savedId+'}]}';$.ajax({url:url,type:"POST",data:dataString,dataType:"json",contentType:"application/json; charset=utf-8",success:function(data){var count=0;if(data.d.ResponseObject.EndecaGroups){$.each(data.d.ResponseObject.EndecaGroups,function(){count+=this.Items.length;});}if(data.d.ResponseObject.OtherGroup){$.each(data.d.ResponseObject.OtherGroup.SubGroups,function(){count+=this.Items.length;});}CookieManager.setCookieValue("saveditemscnt",count);$("#spanSavedItemCount").html("("+count+")");if(count==0){$("#spanSavedItemCount").hide().parent().removeClass("active");}$(".saved-heart-add").show();$(".saved-heart-remove").hide();getSavedItemsList();},error:function(jqXHR,status,error){}});}function getRecentlyViewedItems(){var model=StateModel.getInstance();$.ajax({url:"/Shopping/CategoryBrowse.aspx/GetRecentlyViewedItemsForCategoryBrowse",type:"POST",data:'',dataType:"json",contentType:"application/json; charset=utf-8",success:function(data){for(i=0,n=data.d.ResponseObject.Items.length;i<n;i++){if(typeof model.pCachedProducts.lookup[data.d.ResponseObject.Items[i].Sku]=="undefined"){model.pCachedProducts.lookup[data.d.ResponseObject.Items[i].Sku]=data.d.ResponseObject.Items[i];}}populateProductGrid("extras-recent",data.d.ResponseObject);},error:function(jqXHR,status,error){}});}function clearAllItems(){$.ajax({url:"/shopping/item.aspx/ClearAllRecentlyViewedItems",type:"POST",data:'',dataType:"json",contentType:"application/json; charset=utf-8",success:function(data){$(".item-extras").hide();},error:function(jqXHR,status,error){}});}function preloadImages(containerId){var images=new Array();var imgcount=0;$("#"+containerId+" > div > img").each(function(){if(!$(this).parent().parent().hasClass("text-container")){var src=$(this).attr("src");images[imgcount]=new Image();images[imgcount].src=src;imgcount++;src=$(this).attr("data-rollover-image");if(typeof(src)!="undefined"&&src!=null&&src!=""){images[imgcount]=new Image();images[imgcount].src=src;imgcount++;}}});}function fixRecentItems(){$("#extras-recent .col2").removeClass("col2").attr("style","");}function getPagePosition(){var scrollPosition=$(window).scrollTop();var lastBlockShown=(StateModel.getInstance().custom.lastBlockShown==-1)?"":StateModel.getInstance().custom.lastBlockShown;var position=scrollPosition+"+"+lastBlockShown;return position;}function setPagePosition(pagePosition){var splitPagePosition=pagePosition.split("+");var scrollOffset=splitPagePosition[0];var lastBlockShown=splitPagePosition[1];var numBlocksToLoad=0;var model=StateModel.getInstance();var productsShownSoFar=0;var i;var categoryName=model.isSearchMode===true?"Search Results":$("#filters h1").text().split("(")[0];if(typeof(lastBlockShown)!="undefined"&&lastBlockShown!=null&&lastBlockShown!=""&&isNaN(lastBlockShown)==false&&Number(lastBlockShown)!=-1&&Number(lastBlockShown)!=model.custom.initialNumBlocks){numBlocksToLoad=lastBlockShown-model.custom.initialNumBlocks;if(numBlocksToLoad>0){for(i=0;i<numBlocksToLoad;i++){if(model.custom.gridLayoutBlocks.length>=model.custom.lastBlockShown){$("#results .browse-grid").append(model.custom.gridHTMLBlocks[model.custom.lastBlockShown]);addHearts(savedItems);layoutData.tiles=layoutData.tiles.concat(model.custom.gridLayoutBlocks[model.custom.lastBlockShown]);model.custom.lastBlockShown+=1;}}layoutTiles();fixRecentItems();}if($("body").hasClass("ios")==true||$("body").hasClass("android")==true){for(i=0;i<model.custom.lastBlockShown;i++){productsShownSoFar+=model.custom.gridSizeBlocks[i];}if(model.custom.lastBlockShown<model.custom.gridSizeBlocks.length){productsLeft=model.pCachedProducts.list.length-productsShownSoFar;var query=window.location.search.split("?").join("");var isSearchBrowse;if(query!=''){isSearchBrowse=URLFactory.extractQueryStringValue(query,"search");}if(isSearchBrowse!="1"){increment=(productsLeft<96)?productsLeft:96;}else{increment=(productsLeft<120)?productsLeft:120;}if($("body").hasClass("ja-JP")){$("#viewRemainingButton h4 a").html(locViewNext+" "+productsLeft+" "+locBrowseOf+" "+increment+" "+locItems);}else{$("#viewRemainingButton h4 a").html(locViewNext+" "+increment+" "+locBrowseOf+" "+productsLeft+" "+locItems);}}else{$("#viewRemainingButton").hide();}}else{$("#viewRemainingButton").hide();model.custom.engageLazyLoad=true;TrackViewRemainingItems("Category Browse - "+categoryName,"View Remaining Desktop Button -> Seen "+(model.custom.lastBlockShown)+" of "+model.custom.gridLayoutBlocks.length+" blocks");}fixRecentItems();}if(isNaN(scrollOffset)==false){$(window).scrollTop(scrollOffset);}}function resetCategoryText(){var num=$("#browse-fields > h1 > span");var browse_fields_h1=$("#browse-fields > h1.catName");var search_params="";if(FRIENDLY_SEARCH_PARAM!=""){search_params=FRIENDLY_SEARCH_PARAM;}else{search_params=URLFactory.extractQueryStringValue(window.location.search.split("?").join(""),"search_params");}var model=StateModel.getInstance();if(browse_fields_h1!=null&&num!=null&&model!=null&&model.isSearchMode==false&&search_params.length>0&&search_params.substring(0,1)=="r"){browse_fields_h1.html(CATEGORY_NAME).append(num);}}function redirectToStandardCategory(){var search_params="";if(FRIENDLY_SEARCH_PARAM!=""){search_params=FRIENDLY_SEARCH_PARAM;}else{search_params=URLFactory.extractQueryStringValue(window.location.search.split("?").join(""),"search_params");}var model=StateModel.getInstance();if(model!=null&&model.isSearchMode==false&&search_params.length>0&&search_params.substring(0,1)=="r"){window.location="/shopping/CategoryBrowse.aspx?cid="+CATEGORY_ID+"&mcat="+MASTER_CATEGORY_ID;}}function hiddenWidth(obj){var clone=obj.clone();clone.css("visibility","hidden");$('body').append(clone);var width=clone.outerWidth();clone.remove();return width;}function getUrlUniqueIDFromSortValue(dataFilter){var urlUniqueID="";switch(dataFilter){case"0":urlUniqueID="";break;case"1":urlUniqueID="high-to-low";break;case"2":urlUniqueID="low-to-high";break;case"3":urlUniqueID="new-to-tiffany";break;case"4":urlUniqueID="alphabetically";break;case"5":urlUniqueID="relevance";break;case"6":urlUniqueID="whats-old";break;case"7":urlUniqueID="alphabetically-backwards";break;case"8":urlUniqueID="reverse-category-order";break;case"9":urlUniqueID="related-items";break;case"10":urlUniqueID="reverse-related-items";break;case"11":urlUniqueID="relevance-search";break;}return urlUniqueID;}function appendTypeMenu(data,$chosenFilter){if(!$("a[data-filter-group='"+$chosenFilter.closest(".categories-menu").attr("data-filter-group")+"']").hasClass("active")){$('.filter-loader').hide();return false;}var $this=data;$(".categories-menu__sub-menu").remove();var menuItemsHtml='';for(var i=0;i<$this.Menus.length;i++){if($this.Menus[i].ParentCategoryID==$chosenFilter.attr("data-filter-id")){$this=$this.Menus[i];break;}}var newHash="";if($this.MenuItems){for(var i=0;i<$this.MenuItems.length;i++){if($this.MenuItems[i].isRefinementSelected){catAllArray[$chosenFilter.attr("data-filter-id")]=false;break;}}for(var i=0;i<$this.MenuItems.length;i++){if($this.MenuItems[i].ID!=$chosenFilter.attr("data-filter-id")&&$this.MenuItems[i].isRefinementSelected){newHash+=$this.MenuItems[i].ID+"+";}}if(newHash!=""){newHash=newHash.substring(0,newHash.length-1);}}if($this.MenuItems!=undefined){$this.MenuItems.sort(function(a,b){return(a.refinementDisplayOrder>b.refinementDisplayOrder)?1:((b.refinementDisplayOrder>a.refinementDisplayOrder)?-1:0);});var i=0;$.each($this.MenuItems,function(){var friendlyURL=this.refinementFriendlyUrl;var hash=this.refinementQS;if(this.resetQS){hash=this.resetQS;friendlyURL=this.resetFriendlyUrl;}var noFollow=(this.isSEOIndexFollow!="null"&&this.isSEOIndexFollow)?"nofollow noindex":"";var cssClass='';if(this.isRefinementSelected==true){cssClass+='active';c++;}if(this.refinementItemCount==0){cssClass+=' disabled';}if(this.refinementItemCount==0&&this.ID==0){hideDesigners=true;}if(this.ID==$chosenFilter.attr("data-filter-id")){if(catAllArray[this.ID]){cssClass+=" active";}var allHASH=(catAllArray[this.ID])?this.resetQS:(newHash=="")?this.refinementQS:this.refinementQS.split(newHash).join(this.ID);var allHREF=(catAllArray[this.ID])?this.resetFriendlyUrl:this.refinementFriendlyUrl;menuItemsHtml='<div class="flex-block"><div class="flex-item"><a href="'+allHREF+'" data-hash="'+allHASH+'" class="avenir type-cta-alt cat_all'+cssClass+'" rel="'+noFollow+'"><span class="checkbox"><i class="icon-font">checkmark</i></span>'+this.Name+' ('+this.refinementItemCount+')</a></div></div><div class="flex-block flex-shrink"><div class="flex-item new-menu-items">'+menuItemsHtml;}else{if(i>0&&i%8==0){menuItemsHtml+='</div><div class="flex-item new-menu-items">';}menuItemsHtml+='<a href="'+friendlyURL+'" data-hash="'+hash+'" class="avenir type-cta-alt '+cssClass+'" rel="'+noFollow+'"><span class="checkbox"><i class="icon-font">checkmark</i></span>'+this.Name+' ('+this.refinementItemCount+')</a>';i++;}});}else{var $copyLink=$("a[data-filter-id='"+$chosenFilter.attr("data-filter-id")+"']").parent().clone();$copyLink.find(".show-for-closed").remove();$copyLink.find("a").removeClass("type-cta").addClass("type-cta-alt").addClass("avenir").html("<span class='checkbox'><i class='icon-font'>checkmark</i></span> "+filterLabels["All"]+" ("+$chosenFilter.attr("data-filter-count")+")");if($copyLink.find("a").attr("data-isactive")=="active"){$copyLink.find("a").addClass("active");$copyLink.find("a").attr("href",$copyLink.find("a").attr("data-reset-url"));$copyLink.find("a").attr("data-hash",$copyLink.find("a").attr("data-reset-hash"));}menuItemsHtml+='<div class="flex-block"><div class="flex-item">'+$copyLink.html()+'</div></div><div class="flex-block flex-shrink"><div class="flex-item new-menu-items">';}menuItemsHtml+='</div>';menuItemsHtml+='</div>';menuItemsHtml='<div class="categories-menu__sub-menu" data-filter-id="'+$chosenFilter.attr("data-filter-id")+'">'+menuItemsHtml;$(".new-browse-filters__categories").html(menuItemsHtml);$(".categories-menu__sub-menu").css("padding-left",$("a[data-filter-id='"+$chosenFilter.attr("data-filter-id")+"']")[0].offsetLeft);$('.filter-loader').hide();}